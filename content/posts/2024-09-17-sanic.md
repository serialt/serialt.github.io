+++

title = 'sanic'
date = 2024-09-17T19:45:27+08:00
draft = false

tags = ["Sanic"]
categories = ["Dev"]

+++

### ä¸€ã€Helloworld

sanic å®‰è£… 

```
python3 -m venv venv 
. venv/bin/activate
pip3 install sanic
```

helloworld

```python
from sanic import Sanic
from sanic import text

app = Sanic("Myapp")


@app.route("/")
async def test(request):
    return response.text('Hello World')

if __name__ == '__main__':
    app.run(host="0.0.0.0", port=7777)

```

vscode debug

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python Debugger: Current File",
            "type": "debugpy",
            "request": "launch",
            "python": "${workspaceFolder}/venv/bin/python3",
            "program": "main.py",
            // "args": [
            // "-nu"
            // "-ro"
            // ],       
            // "console": "integratedTerminal",
            "console": "internalConsole",
        }
    ]
}
```

```
[root@Krab sanic]ğŸ³ curl 127.0.0.1:7777
Hello World
```

- Sanic æ„å»ºä¸€ä¸ªSanicæœåŠ¡çš„å®ä¾‹
  - name=None æœåŠ¡åã€‚é€šå¸¸å¯ä»¥ç”¨__name__é¢„ç½®å˜é‡ï¼Œå¦‚æœnameä¸ºNoneï¼Œåˆ™ä»ä¹‹å‰æ ˆä¸­è·å¾—module nameã€‚
- route() è·¯ç”±è£…é¥°å™¨ï¼Œæ³¨å†Œä¸€ä¸ªè·¯ç”±
  - uri URLè·¯å¾„



### äºŒã€Dev

#### 1ã€è·¯ç”±

ç”¨æˆ·å¯ä»¥é€šè¿‡è·¯ç”±æ¥è®¾ç½®URLä¸handlerä¹‹é—´çš„å…³è”ã€‚ä¸€ä¸ªåŸºæœ¬çš„è·¯ç”±å½¢å¼å¦‚ä¸‹ï¼š

```python
from sanic import response

@app.route("/")
async def test(request):
    return response.text('Hello World')
```

sanicçš„handleræ–¹æ³•å¿…é¡»ç”¨`async`å…³é”®å­—å®šä¹‰ä¸ºå¼‚æ­¥æ–¹æ³•ã€‚

**Requestå‚æ•°**

```python
from sanic.response import text

# ï¿½å‚æ•°å: tagï¼Œå¯ä»¥æ˜¯ä»»æ„å­—ç¬¦
@app.route('/tag/<tag>')
async def tag_handler(request, tag):
    return text('Tag - {}'.format(tag))

# å‚æ•°å: integer_argï¼Œintç±»å‹
@app.route('/number/<integer_arg:int>')
async def integer_handler(request, integer_arg):
    return text('Integer - {}'.format(integer_arg))

@app.route('/number/<number_arg:number>')
async def number_handler(request, number_arg):
    return text('Number - {}'.format(number_arg))

# å‚æ•°å: nameï¼Œè‹±æ–‡å­—æ¯
@app.route('/person/<name:[A-z]+>')
async def person_handler(request, name):
    return text('Person - {}'.format(name))

# å‚æ•°å: folder_idï¼Œè‹±æ–‡å­—æ¯+æ•°å­—ï¼Œ0~4ä¸ªå­—ç¬¦é•¿åº¦
@app.route('/folder/<folder_id:[A-z0-9]{0,4}>')
async def folder_handler(request, folder_id):
    return text('Folder - {}'.format(folder_id))
```

**HTTP è¯·æ±‚ç±»å‹**

é»˜è®¤è¯·æ±‚ç±»å‹æ˜¯GETï¼Œå¦‚æœç”¨å…¶å®ƒæ–¹æ³•ï¼Œéœ€è¦å•ç‹¬æŒ‡å®šã€‚

```python
from sanic.response import text

# postæ–¹æ³•
@app.route('/post', methods=['POST'])
async def post_handler(request):
    return text('POST request - {}'.format(request.json))

# getæ–¹æ³•
@app.route('/get')
async def get_handler(request):
    return text('GET request - {}'.format(request.args))

@app.route('/get', methods=['GET'])
async def get_handler(request):
    return text('GET request - {}'.format(request.args))
```

**Request**

å½“æœåŠ¡ç«¯æ”¶åˆ°HTTPè¯·æ±‚æ—¶ï¼Œè·¯ç”±æ–¹æ³•ä¼šä¼ è¿‡æ¥`Request`å¯¹è±¡ã€‚`Request`å¯¹è±¡åŒ…å«ä»¥ä¸‹å±æ€§ï¼š

- json JSONæ­£æ–‡ã€‚

```
from sanic.response import json

@app.route("/json")
def post_json(request):
    return json({ "received": True, "message": request.json })
```

- args dictï¼Œä¾‹å¦‚è¯·æ±‚å‚æ•°ä¸º`?key1=value1&key2=value2`ï¼Œè¿”å›`{'key1': ['value1'], 'key2': ['value2']}`
- raw_args dictï¼Œæ›´å°‘å°è£…çš„dictï¼Œå¾ˆå¤šæ—¶å€™æ¯”argsè¿˜å®ç”¨ã€‚ä¾‹å¦‚è¯·æ±‚å‚æ•°ä¸º`?key1=value1&key2=value2`ï¼Œè¿”å›`{'key1': 'value1', 'key2': 'value2'}`
- headers dictï¼Œä¸€ä¸ªå¤§å°å†™æ— å…³ï¼ˆä¸€èˆ¬éƒ½æ˜¯å°å†™ï¼‰çš„dictï¼ŒåŒ…å«request headerã€‚

å…¶å®ƒå¸¸ç”¨å±æ€§è¿˜åŒ…æ‹¬ï¼šip, port, url, host, path, quary_string



**Response**

ä½¿ç”¨`sanic.response`æ¨¡å—åˆ›å»ºresponseã€‚

- json

```python
from sanic import response

@app.route('/json')
def handle_request(request):
    return response.json({
        'message': 'Hello world!',
        # header
        headers={'X-Served-By': 'sanic'},
        # status
        status=200})
```

- redirect

```python
from sanic import response

@app.route('/redirect')
def handle_request(request):
    return response.redirect('/json')
```







