+++
title = 'Git'
date = 2023-11-18T10:26:27+08:00
draft = false

tags = ["git","vcs","dev"]
categories = ["DevOps"]

+++

# Git


## ä¸€ã€gitåŸºæœ¬ä½¿ç”¨

### 1ã€commit

```shell
[root@node01 project]# git add 1.txt
[root@node01 project]# git commit -m "create new 1.txt"
[master (root-commit) 3e8ce87] create new 1.txt
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 1.txt
```

### 2ã€diffæ–‡ä»¶

```shell
[root@node01 project]# git diff 1.txt
diff --git a/1.txt b/1.txt
index e69de29..21d56a0 100644
--- a/1.txt
+++ b/1.txt
@@ -0,0 +1 @@
+1111111111111111
```

### 3ã€ç‰ˆæœ¬å›é€€

åœ¨è¿›è¡Œç‰ˆæœ¬å›é€€æ—¶ï¼Œä½¿ç”¨HEADä»£è¡¨å½“å‰ç‰ˆæœ¬ï¼Œ`HEAD^` ä»£è¡¨ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œ`HEAD^^`ä»£è¡¨ä¸Šä¸Šä¸ªç‰ˆæœ¬ï¼Œè¿˜å¯ä»¥ä½¿ç”¨HEAD~10ä»£è¡¨å‰10ä¸ªç‰ˆæœ¬

```shell
[root@node01 project]# git reset --hard HEAD^
HEAD is now at fdf9d68 add new 1111
[root@node01 project]# 
[root@node01 project]# cat 1.txt 
1111111111111111
[root@node01 project]# 
```

ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ ¼å¼:

```shell
[root@node01 project] git reset --hard <commit_id>

[root@node01 project]# git reflog 1.txt
fdf9d68 HEAD@{0}: reset: moving to HEAD^
996cc77 HEAD@{1}: commit: add new 222
fdf9d68 HEAD@{2}: commit: add new 1111
3e8ce87 HEAD@{3}: commit (initial): create new 1.txt
[root@node01 project]# 
[root@node01 project]# git reset --hard 996cc77
```

### 4ã€æ’¤é”€æ›´æ”¹

1ï¼‰å¯¹äºå°šæœªæ·»åŠ åˆ°æš‚å­˜åŒºçš„ä¿®æ”¹ï¼Œå¯ç›´æ¥é€šè¿‡ç¼–è¾‘åŸæ–‡ä»¶æˆ–è€…ä½¿ç”¨`git checkout -- <file>`çš„æ–¹å¼è¿›è¡Œæ’¤é”€

```shell
[root@node01 project]# git checkout -- 1.txt
[root@node01 project]# git status 
# On branch master
nothing to commit, working directory clean
```

2ï¼‰å¯¹äºå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œä½†è¿˜æ²¡æœ‰git commitçš„ä¿®æ”¹ï¼Œå¯ä½¿ç”¨`git reset HEAD <file>`çš„æ–¹å¼æ’¤é”€

```shell
[root@node01 project]# vim 1.txt 

[root@node01 project]# git add 1.txt
[root@node01 project]# git status 
# On branch master
# Changes to be committed:
#   (use "git reset HEAD <file>..." to unstage)
#
#	modified:   1.txt
#
[root@node01 project]# git reset HEAD 1.txt
Unstaged changes after reset:
M	1.txt

[root@node01 project]# git status 
# On branch master
# Changes not staged for commit:
#   (use "git add <file>..." to update what will be committed)
#   (use "git checkout -- <file>..." to discard changes in working directory)
#
#	modified:   1.txt
#
no changes added to commit (use "git add" and/or "git commit -a")

[root@node01 project]# git checkout -- 1.txt
[root@node01 project]# git status 
# On branch master
nothing to commit, working directory clean
[root@node01 project]# cat 1.txt 
1111111111111111
22222222222222222
3333333333333
```

3ï¼‰å¯¹äºå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œå¹¶å·²ç»æäº¤çš„ä¿®æ”¹å¯é€šè¿‡git reset --hard <commit_id>çš„æ–¹å¼è¿›è¡Œæ’¤é”€

```shell
[root@node01 project]# vim 1.txt 

[root@node01 project]# git add 1.txt
[root@node01 project]# git commit -m "add new 44444444"
[master 240af53] add new 44444444
 1 file changed, 1 insertion(+)
 
[root@node01 project]# git reflog 1.txt
240af53 HEAD@{0}: commit: add new 44444444
5424335 HEAD@{1}: commit: add new 333333
996cc77 HEAD@{2}: reset: moving to 996cc77
3e8ce87 HEAD@{3}: reset: moving to 3e8ce87
996cc77 HEAD@{4}: reset: moving to 996cc77
fdf9d68 HEAD@{5}: reset: moving to HEAD^
996cc77 HEAD@{6}: commit: add new 222
fdf9d68 HEAD@{7}: commit: add new 1111
3e8ce87 HEAD@{8}: commit (initial): create new 1.txt
[root@node01 project]# 
[root@node01 project]# 
[root@node01 project]# git reset --hard 5424335
HEAD is now at 5424335 add new 333333
```



## äºŒã€gité…ç½®

### 1ã€é…ç½®åŸºæœ¬ä¿¡æ¯

```shell
[root@localhost srv]# git config --global user.name 'sugar'
[root@localhost srv]# git config --global user.email 't@local.com'
[root@localhost srv]# git config --global color.ui true      #é…ç½®æ˜¾ç¤ºçš„é¢œè‰²ï¼Œæ–¹ä¾¿çœ‹åˆ°æ›´æ”¹çš„ä¿¡æ¯
[root@localhost srv]# git config --global core.ignorecase false     # é…ç½®å¤§å°å†™æ•æ„Ÿï¼Œgité»˜è®¤å¤§å°å†™ä¸æ•æ„Ÿ
 
```

### 2ã€gitconfigé…ç½®æ–‡ä»¶

```ini
[user]
        name = sugar
        email = t@local.com
#       signingkey = DCE96Cxxxxxxxxxxxxxxxxxxxxxxxx
#[commit]
#        gpgsign = true

# ~/github/ ç›®å½•ä¸‹çš„é¡¹ç›®ä½¿ç”¨~/github/.gitconfigä¸‹çš„gitconfigé…ç½®æ–‡ä»¶
[includeIf "gitdir:~/github/"]
  path = ~/github/.gitconfig

[includeIf "gitdir:~/my-prod/"]
  path = ~/my-prod/.gitconfig

[init]
        defaultBranch = main 
[color]
        ui = true
[alias]
        lg = log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit
[alias]
        # status
        st  = status
        ss = status --short --branch

        # stash
        sh  = stash
        shp = stash pop
        shl = stash list
        shs = stash save
        sha = stash apply
        std = stash drop

        # branch
        br  = branch
        bra = branch -a
        brm = branch -m
        co  = checkout
        cob = checkout -b
        sw  = switch
        swc = switch -c
        
        # remote
        ra  = remote add
        rao = remote add origin
        ru  = remote set-url
        ruo = remote set-url origin
        rv = remote -v

        # fetch
        fe  = fetch
        fep = fetch -p
        fo  = fetch origin
        fop = fetch origin -p

        # merge
        mr  = merge
        mnc = merge --no-commit
        # msq = merge --squash

        # commit
        cm = commit -m

        # config user and mail
        user = config user.name
        mail = config user.email


[url "git@github.com:username"]
        insteadOf = https://github.com/username

# å¼ºåˆ¶httpsè½¬sshåè®®
[url "ssh://git@local.com/"]
        insteadOf = https://local.com/

[core]
        excludesfile = ~/.gitignore_global
        autocrlf = input
        quotepath = false
        ignorecase = false
        editor = vim

#       sshCommand = ssh -i ~/.ssh/id_rsa -o IdentitiesOnly=yes -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no

[i18n "commit"]
        encoding = utf-8
[i18n]
        logoutputencoding = utf-8

[http "https://github.com"]
        proxy = socks5://127.0.0.1:8888

[http]
        proxy = http://127.0.0.1:8889
[https]
        proxy = http://127.0.0.1:8889
```



### 3ã€windowsä¸Šç»ˆç«¯æ‰“å¼€å‡ºç°ä¹±ç 

cmdé…ç½®

```shell
git config --global core.quotepath false 
git config --global gui.encoding utf-8
git config --global i18n.commit.encoding utf-8 
git config --global i18n.logoutputencoding utf-8 
# bash ç¯å¢ƒä¸‹
export LESSCHARSET=utf-8
# cmdç¯å¢ƒä¸‹ï¼š
set LESSCHARSET=utf-8

```

powershellé…ç½®

```powershell
git config --global core.quotepath false
git config --global gui.encoding utf-8
git config --global i18n.commit.encoding utf-8
git config --global i18n.logoutputencoding utf-8
$env:LESSCHARSET='utf-8'

```

git bash

```shell
sugar@sugar MINGW64 /e/Desktop/company/github (master)
$ cat /etc/bash.bashrc
alias ls='ls -F --color --show-control-chars'
NOW_DIR="E:\Desktop"
cd ${NOW_DIR}
export LESSCHARSET=utf-8
```



## ä¸‰ã€åˆ†æ”¯ç®¡ç†

gitç‰ˆæœ¬åº“æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯è¿è¡Œåœ¨åˆ†æ”¯ä¸Šï¼Œgitä»“åº“åˆ›å»ºæ—¶ä¼šå»ºç«‹é»˜è®¤çš„åˆ†æ”¯ï¼Œåç§°ä¸ºmasterï¼›æ‰€æœ‰çš„æ“ä½œéƒ½åœ¨masteråˆ†æ”¯ä¸Šè¿›è¡Œ
åœ¨å¯¹ç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶è¿›è¡Œæ“ä½œæ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸åŒçš„åˆ†æ”¯ï¼Œä¸åŒçš„æ“ä½œè¿è¡Œåœ¨ä¸åŒçš„åˆ†æ”¯ä¸Šï¼Œä¸åŒåˆ†æ”¯ä¸Šçš„æ“ä½œä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œæ“ä½œè¿›è¡Œå®Œæˆåï¼Œå¯ä»¥åˆå¹¶ä¸åŒåˆ†æ”¯ä¸Šçš„æ“ä½œ

### 1ã€åˆ›å»ºåˆ†æ”¯

```shell
[root@node01 project]# git checkout -b game
Switched to a new branch 'game'
[root@node01 project]# 
[root@node01 project]# git branch 
  dev
* game
  master
```

1ï¼‰è¿œç¨‹chekoutåˆ°æœ¬åœ°

```shell
[root@node01 project]# git checkout origin/develop -b develop
```

2ï¼‰åˆ é™¤åˆ†æ”¯

```shell
# åˆ é™¤æœ¬åœ°åˆ†æ”¯
[root@node01 project]# git branch -d release-1.1.0

# å¼ºåˆ¶åˆ é™¤
[root@node01 project]# git branch -D release-1.1.0

# åˆ é™¤è¿œç¨‹åˆ†æ”¯
[root@node01 project]# git push origin --delete  release-1.1.0
æˆ–è€…
[root@node01 project]# git push origin :release-1.1.0
```

3ï¼‰æ ¹æ®hashå€¼è¿›è¡Œcheckout

```shell
git checkout  d21a8c517ca3xxxxxxxxxxxxxxxxxxxxxxxxxxx
```

4ï¼‰åˆ†æ”¯åˆå¹¶

åˆ‡æ¢åˆ°å‡†å¤‡åˆå¹¶åçš„åˆ†æ”¯ï¼Œåˆå¹¶å…¶ä»–åˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯

```shell
[root@node01 project]# git merge dev 
Updating bb6fb7a..d83dae8
Fast-forward
 1.txt | 2 ++
 1 file changed, 2 insertions(+)
```



## å››ã€tagç®¡ç†

æ‰“æ ‡ç­¾ï¼Œç”¨äºä»“åº“æŸä¸ªæäº¤æ‰“ä¸Šæ ‡ç­¾ï¼Œä»¥è¡¨ç¤ºå…¶ç‰¹æ®Šæ€§ã€‚æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„æ˜¯äººä»¬ä¼šä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æ¥æ ‡è®°å‘å¸ƒç»“ç‚¹ï¼ˆ `v1.0` ã€ `v2.0` ç­‰ç­‰ï¼‰

#### 1ã€æŸ¥çœ‹æœ¬åœ°å·²æœ‰æ ‡ç­¾

```shell
[root@localhost github_web]# git tag
4.101.0
4.103.0
4.103.1
```

åˆ—å‡ºæ‰€æœ‰æ ‡ç­¾ `-l`æˆ–è€…`--list`ï¼ŒæŒ‡å®šæŸäº›æäº¤ä¿¡æ¯`-l "v4.4*"`

#### 2ã€åˆ›å»ºtag

Git æ”¯æŒä¸¤ç§æ ‡ç­¾ï¼š

* è½»é‡æ ‡ç­¾ï¼ˆlightweightï¼‰

* é™„æ³¨æ ‡ç­¾ï¼ˆannotatedï¼‰ã€‚

è½»é‡æ ‡ç­¾å¾ˆåƒä¸€ä¸ªä¸ä¼šæ”¹å˜çš„åˆ†æ”¯â€”â€”å®ƒåªæ˜¯æŸä¸ªç‰¹å®šæäº¤çš„å¼•ç”¨ã€‚

è€Œé™„æ³¨æ ‡ç­¾æ˜¯å­˜å‚¨åœ¨ Git æ•°æ®åº“ä¸­çš„ä¸€ä¸ªå®Œæ•´å¯¹è±¡ï¼Œ å®ƒä»¬æ˜¯å¯ä»¥è¢«æ ¡éªŒçš„ï¼Œå…¶ä¸­åŒ…å«æ‰“æ ‡ç­¾è€…çš„åå­—ã€ç”µå­é‚®ä»¶åœ°å€ã€æ—¥æœŸæ—¶é—´ï¼Œ æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªæ ‡ç­¾ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ GNU Privacy Guard ï¼ˆGPGï¼‰ç­¾åå¹¶éªŒè¯ã€‚ é€šå¸¸ä¼šå»ºè®®åˆ›å»ºé™„æ³¨æ ‡ç­¾ï¼Œè¿™æ ·ä½ å¯ä»¥æ‹¥æœ‰ä»¥ä¸Šæ‰€æœ‰ä¿¡æ¯ã€‚ä½†æ˜¯å¦‚æœä½ åªæ˜¯æƒ³ç”¨ä¸€ä¸ªä¸´æ—¶çš„æ ‡ç­¾ï¼Œ æˆ–è€…å› ä¸ºæŸäº›åŸå› ä¸æƒ³è¦ä¿å­˜è¿™äº›ä¿¡æ¯ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ç”¨è½»é‡æ ‡ç­¾ã€‚

##### é™„å±æ ‡ç­¾ï¼š

```
git tag -a v1.4 -m "my version 1.4"
```

æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯

```
git show v1.4
```

è¾“å‡ºæ˜¾ç¤ºäº†æ‰“æ ‡ç­¾è€…çš„ä¿¡æ¯ã€æ‰“æ ‡ç­¾çš„æ—¥æœŸæ—¶é—´ã€é™„æ³¨ä¿¡æ¯ï¼Œç„¶åæ˜¾ç¤ºå…·ä½“çš„æäº¤ä¿¡æ¯ã€‚

##### è½»é‡æ ‡ç­¾:

å¦ä¸€ç§ç»™æäº¤æ‰“æ ‡ç­¾çš„æ–¹å¼æ˜¯ä½¿ç”¨è½»é‡æ ‡ç­¾ã€‚ è½»é‡æ ‡ç­¾æœ¬è´¨ä¸Šæ˜¯å°†æäº¤æ ¡éªŒå’Œå­˜å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­â€”â€”æ²¡æœ‰ä¿å­˜ä»»ä½•å…¶ä»–ä¿¡æ¯ã€‚ åˆ›å»ºè½»é‡æ ‡ç­¾ï¼Œä¸éœ€è¦ä½¿ç”¨ `-a`ã€`-s` æˆ– `-m` é€‰é¡¹ï¼Œåªéœ€è¦æä¾›æ ‡ç­¾åå­—ï¼š

```
$ git tag v1.4-lw
$ git tag
v0.1
v1.3
v1.4
```

è¿™æ—¶ï¼Œå¦‚æœåœ¨æ ‡ç­¾ä¸Šè¿è¡Œ `git show`ï¼Œä½ ä¸ä¼šçœ‹åˆ°é¢å¤–çš„æ ‡ç­¾ä¿¡æ¯ã€‚ å‘½ä»¤åªä¼šæ˜¾ç¤ºå‡ºæäº¤ä¿¡æ¯ï¼š

```
$ git show v1.4-lw
commit ca82a6dff817ec66f44342007202690a93763949
Author: Scott Chacon <t@local.com>
Date:   Mon Mar 17 21:52:11 2008 -0700

    changed the version number
```

##### åæœŸæ‰“æ ‡ç­¾

```
git tag -a v1.2 9fceb02
```

##### å…±äº«æ ‡ç­¾

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`git push` å‘½ä»¤å¹¶ä¸ä¼šä¼ é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“æœåŠ¡å™¨ä¸Šã€‚ åœ¨åˆ›å»ºå®Œæ ‡ç­¾åä½ å¿…é¡»æ˜¾å¼åœ°æ¨é€æ ‡ç­¾åˆ°å…±äº«æœåŠ¡å™¨ä¸Šã€‚ è¿™ä¸ªè¿‡ç¨‹å°±åƒå…±äº«è¿œç¨‹åˆ†æ”¯ä¸€æ ·â€”â€”ä½ å¯ä»¥è¿è¡Œ `git push origin <tagname>`ã€‚

```
$ git push origin v1.5
Counting objects: 14, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (12/12), done.
Writing objects: 100% (14/14), 2.05 KiB | 0 bytes/s, done.
Total 14 (delta 3), reused 0 (delta 0)
To git@github.com:schacon/simplegit.git
 * [new tag]         v1.5 -> v1.5
```

å¦‚æœæƒ³è¦ä¸€æ¬¡æ€§æ¨é€å¾ˆå¤šæ ‡ç­¾ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¸¦æœ‰ `--tags` é€‰é¡¹çš„ `git push` å‘½ä»¤ã€‚ è¿™å°†ä¼šæŠŠæ‰€æœ‰ä¸åœ¨è¿œç¨‹ä»“åº“æœåŠ¡å™¨ä¸Šçš„æ ‡ç­¾å…¨éƒ¨ä¼ é€åˆ°é‚£é‡Œã€‚

```
$ git push origin --tags
Counting objects: 1, done.
Writing objects: 100% (1/1), 160 bytes | 0 bytes/s, done.
Total 1 (delta 0), reused 0 (delta 0)
To git@github.com:schacon/simplegit.git
 * [new tag]         v1.4 -> v1.4
 * [new tag]         v1.4-lw -> v1.4-lw
```

#### 3ã€åˆ é™¤æ ‡ç­¾

è¦åˆ é™¤æ‰ä½ æœ¬åœ°ä»“åº“ä¸Šçš„æ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ `git tag -d <tagname>`ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ é™¤ä¸€ä¸ªè½»é‡æ ‡ç­¾ï¼š

```
$ git tag -d v1.4-lw
Deleted tag 'v1.4-lw' (was e7d5add)
```

æ³¨æ„ä¸Šè¿°å‘½ä»¤å¹¶ä¸ä¼šä»ä»»ä½•è¿œç¨‹ä»“åº“ä¸­ç§»é™¤è¿™ä¸ªæ ‡ç­¾ï¼Œä½ å¿…é¡»ç”¨ `git push <remote> :refs/tags/<tagname>` æ¥æ›´æ–°ä½ çš„è¿œç¨‹ä»“åº“ï¼š

**æ–¹æ³•ä¸€**ï¼š`git push <remote> :refs/tags/<tagname>` 

```
$ git push origin :refs/tags/v1.4-lw
To /git@github.com:username/project.git
 - [deleted]         v1.4-lw
```

ä¸Šé¢è¿™ç§æ“ä½œçš„å«ä¹‰æ˜¯ï¼Œå°†å†’å·å‰é¢çš„ç©ºå€¼æ¨é€åˆ°è¿œç¨‹æ ‡ç­¾åï¼Œä»è€Œé«˜æ•ˆåœ°åˆ é™¤å®ƒã€‚

**æ–¹æ³•äºŒ**ï¼šç›´æ¥åˆ é™¤è¿œç¨‹æ ‡ç­¾

```
$ git push origin --delete <tagname>
```

#### 4ã€æ£€å‡ºæ ‡ç­¾

æ£€å‡ºæ ‡ç­¾ä¸ºä¸€ä¸ªåˆ†æ”¯ï¼Œæ ¼å¼ä¸º`git checkout -b branch_name tag_name`

```
git checkout -b version2 v2.0.0
```

#### 5ã€.git ç›®å½•

```
 â”œâ”€â”€ HEAD    
    â”œâ”€â”€ branches
    â”œâ”€â”€ config
    â”œâ”€â”€ description
    â”œâ”€â”€ hooks
    â”‚ â”œâ”€â”€ pre-commit.sample
    â”‚ â”œâ”€â”€ pre-push.sample
    â”‚ â””â”€â”€ ...
    â”œâ”€â”€ info
    â”‚ â””â”€â”€ exclude
    â”œâ”€â”€ objects
    â”‚ â”œâ”€â”€ info
    â”‚ â””â”€â”€ pack
    â””â”€â”€ refs
     â”œâ”€â”€ heads
     â””â”€â”€ tags
```

- config ï¼ˆé…ç½®ï¼‰è¯¥æ–‡ä»¶åŒ…å«ä½ çš„ä»“åº“é…ç½®ï¼Œæ¯”å¦‚è¿œç¨‹çš„ url ï¼Œä½ çš„é‚®ç®±å’Œç”¨æˆ·åç­‰ã€‚æ¯æ¬¡ä½ åœ¨æ§åˆ¶å°ä½¿ç”¨ git config... éƒ½ä¼šå¯¹è¿™é‡Œäº§ç”Ÿå½±å“ã€‚
- descriptionï¼ˆæè¿°ï¼‰ä¾› gitweb ( github çš„ä¸€ç§å‰èº«) ä½¿ç”¨ï¼Œæ˜¾ç¤ºä»“åº“çš„æè¿°ã€‚
- hooks (é’©å­)è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç‰¹æ€§ã€‚ Git æä¾›äº†ä¸€å¥—è„šæœ¬ï¼Œå¯ä»¥åœ¨æ¯ä¸ªæœ‰æ„ä¹‰çš„ Git é˜¶æ®µè‡ªåŠ¨è¿è¡Œã€‚è¿™äº›è¢«ç§°ä¸ºé’©å­çš„è„šæœ¬å¯ä»¥åœ¨æäº¤ (commit)ã€å˜åŸº (rebase)ã€æ‹‰å– ( pull ) æ“ä½œçš„å‰åè¿è¡Œã€‚è„šæœ¬å‘½é¢„ç¤ºç€å®ƒçš„æ‰§è¡Œæ—¶æœºã€‚å¦‚æˆ‘ä»¬å¯ä»¥ç¼–å†™ pre-push çš„ä½œä¸ºé’©å­ï¼Œè¿›è¡Œæ¨é€ä»£ç å‰çš„æ£€æŸ¥ã€‚
- info (ä¿¡æ¯)ä½ å¯ä»¥å°†ä¸æƒ³è¢« git ç®¡ç†çš„æ–‡ä»¶è®°å½•åˆ° .gitignore æ–‡ä»¶ä¸­ã€‚æ’é™¤æ–‡ä»¶çš„æ„æ€æ˜¯ä¸æƒ³å…±äº«è¿™ä¸ªæ–‡ä»¶ã€‚ä¾‹å¦‚ä½ ä¸æƒ³å…±äº«ä½ çš„ IDE è‡ªå®šä¹‰é…ç½®ï¼Œå°†å…¶æ·»åŠ åˆ° .gitignore æ–‡ä»¶ä¸­å³å¯ã€‚



## äº”ã€cherry-pick

å‚è€ƒï¼šhttps://www.ruanyifeng.com/blog/2020/04/git-cherry-pick.html

å¯¹äºå¤šåˆ†æ”¯çš„ä»£ç åº“ï¼Œå°†ä»£ç ä»ä¸€ä¸ªåˆ†æ”¯è½¬ç§»åˆ°å¦ä¸€ä¸ªåˆ†æ”¯æ˜¯å¸¸è§éœ€æ±‚ã€‚

è¿™æ—¶åˆ†ä¸¤ç§æƒ…å†µã€‚ä¸€ç§æƒ…å†µæ˜¯ï¼Œä½ éœ€è¦å¦ä¸€ä¸ªåˆ†æ”¯çš„æ‰€æœ‰ä»£ç å˜åŠ¨ï¼Œé‚£ä¹ˆå°±é‡‡ç”¨åˆå¹¶ï¼ˆ`git merge`ï¼‰ã€‚å¦ä¸€ç§æƒ…å†µæ˜¯ï¼Œä½ åªéœ€è¦éƒ¨åˆ†ä»£ç å˜åŠ¨ï¼ˆæŸå‡ ä¸ªæäº¤ï¼‰ï¼Œè¿™æ—¶å¯ä»¥é‡‡ç”¨ Cherry pickã€‚



#### 1ã€åŸºæœ¬è¯­æ³•

`git cherry-pick`å‘½ä»¤çš„ä½œç”¨ï¼Œå°±æ˜¯å°†æŒ‡å®šçš„æäº¤ï¼ˆcommitï¼‰åº”ç”¨äºå…¶ä»–åˆ†æ”¯ã€‚

```
$ git cherry-pick <commitHash>
```

ä¸Šé¢å‘½ä»¤å°±ä¼šå°†æŒ‡å®šçš„æäº¤`commitHash`ï¼Œåº”ç”¨äºå½“å‰åˆ†æ”¯ã€‚è¿™ä¼šåœ¨å½“å‰åˆ†æ”¯äº§ç”Ÿä¸€ä¸ªæ–°çš„æäº¤ï¼Œå½“ç„¶å®ƒä»¬çš„å“ˆå¸Œå€¼ä¼šä¸ä¸€æ ·ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œä»£ç ä»“åº“æœ‰`master`å’Œ`feature`ä¸¤ä¸ªåˆ†æ”¯ã€‚

> ```bash
>  a - b - c - d   Master
>       \
>         e - f - g Feature
> ```

ç°åœ¨å°†æäº¤`f`åº”ç”¨åˆ°`master`åˆ†æ”¯ã€‚

> ```bash
> # åˆ‡æ¢åˆ° master åˆ†æ”¯
> $ git checkout master
> 
> # Cherry pick æ“ä½œ
> $ git cherry-pick f
> ```

ä¸Šé¢çš„æ“ä½œå®Œæˆä»¥åï¼Œä»£ç åº“å°±å˜æˆäº†ä¸‹é¢çš„æ ·å­ã€‚

> ```bash
>  a - b - c - d - f   Master
>       \
>         e - f - g Feature
> ```

ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œ`master`åˆ†æ”¯çš„æœ«å°¾å¢åŠ äº†ä¸€ä¸ªæäº¤`f`ã€‚

`git cherry-pick`å‘½ä»¤çš„å‚æ•°ï¼Œä¸ä¸€å®šæ˜¯æäº¤çš„å“ˆå¸Œå€¼ï¼Œåˆ†æ”¯åä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¡¨ç¤ºè½¬ç§»è¯¥åˆ†æ”¯çš„æœ€æ–°æäº¤ã€‚

> ```bash
> $ git cherry-pick feature
> ```

ä¸Šé¢ä»£ç è¡¨ç¤ºå°†`feature`åˆ†æ”¯çš„æœ€è¿‘ä¸€æ¬¡æäº¤ï¼Œè½¬ç§»åˆ°å½“å‰åˆ†æ”¯ã€‚

æ“ä½œç¤ºä¾‹ï¼š

```shell
[sugar@centos-7 git-test]$ git log -1
commit dcf3a215fd6ba3288ad21584d2112bdab5a713b4
Author: sugar <cccc@gmail.com>
Date:   Sun Sep 12 14:29:26 2021 +0800

    feat: v1 version 1s add
[sugar@centos-7 git-test]$ git checkout master
Switched to branch 'master'
[sugar@centos-7 git-test]$ git log
commit 31da420cc2d2ae6094f88e368a72f0353541d89f
Author: sugar <cccc@gmail.com>
Date:   Sun Sep 12 14:25:43 2021 +0800

    feat: ç¬¬ä¸€æ­¤å¢åŠ 
[sugar@centos-7 git-test]$ git cherry-pick dcf3a215fd6ba3288ad21584d2112bdab5a713b4
[master fa78bb0] feat: v1 version 1s add
 1 file changed, 2 insertions(+), 1 deletion(-)
[sugar@centos-7 git-test]$ ls
cccc.txt
[sugar@centos-7 git-test]$ git log -1
commit fa78bb090d3221ba2ff9cae59efa1f8691677115
Author: sugar <cccc@gmail.com>
Date:   Sun Sep 12 14:29:26 2021 +0800

    feat: v1 version 1s add

```

#### 2ã€è½¬ç§»å¤šä¸ªcommit

Cherry pick æ”¯æŒä¸€æ¬¡è½¬ç§»å¤šä¸ªæäº¤

```
[sugar@centos-7 git-test]$ git cherry-pick <HashA> <HashB>
```

è¿ç»­æäº¤å¤šä¸ªcommit

```shell
# æäº¤Aåˆ°Bçš„commitï¼Œä½†ä¸åŒ…å«Aï¼›æäº¤Aå¿…é¡»æ—©äºæäº¤Bï¼Œå¦åˆ™å‘½ä»¤å°†å¤±è´¥ï¼Œä½†ä¸ä¼šæŠ¥é”™ã€‚
[sugar@centos-7 git-test]$ git cherry-pick A..B 

# æäº¤Aåˆ°Bçš„commitï¼ŒåŒ…å«A
[sugar@centos-7 git-test]$ git cherry-pick A^..B 
```

#### 3ã€å‚æ•°

`git cherry-pick`å‘½ä»¤çš„å¸¸ç”¨é…ç½®é¡¹å¦‚ä¸‹ã€‚

ï¼ˆ1ï¼‰`-e`ï¼Œ`--edit`

æ‰“å¼€å¤–éƒ¨ç¼–è¾‘å™¨ï¼Œç¼–è¾‘æäº¤ä¿¡æ¯ã€‚

ï¼ˆ2ï¼‰`-n`ï¼Œ`--no-commit`

åªæ›´æ–°å·¥ä½œåŒºå’Œæš‚å­˜åŒºï¼Œä¸äº§ç”Ÿæ–°çš„æäº¤ã€‚

ï¼ˆ3ï¼‰`-x`

åœ¨æäº¤ä¿¡æ¯çš„æœ«å°¾è¿½åŠ ä¸€è¡Œ`(cherry picked from commit ...)`ï¼Œæ–¹ä¾¿ä»¥åæŸ¥åˆ°è¿™ä¸ªæäº¤æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚

ï¼ˆ4ï¼‰`-s`ï¼Œ`--signoff`

åœ¨æäº¤ä¿¡æ¯çš„æœ«å°¾è¿½åŠ ä¸€è¡Œæ“ä½œè€…çš„ç­¾åï¼Œè¡¨ç¤ºæ˜¯è°è¿›è¡Œäº†è¿™ä¸ªæ“ä½œã€‚

ï¼ˆ5ï¼‰`-m parent-number`ï¼Œ`--mainline parent-number`

å¦‚æœåŸå§‹æäº¤æ˜¯ä¸€ä¸ªåˆå¹¶èŠ‚ç‚¹ï¼Œæ¥è‡ªäºä¸¤ä¸ªåˆ†æ”¯çš„åˆå¹¶ï¼Œé‚£ä¹ˆ Cherry pick é»˜è®¤å°†å¤±è´¥ï¼Œå› ä¸ºå®ƒä¸çŸ¥é“åº”è¯¥é‡‡ç”¨å“ªä¸ªåˆ†æ”¯çš„ä»£ç å˜åŠ¨ã€‚

`-m`é…ç½®é¡¹å‘Šè¯‰ Gitï¼Œåº”è¯¥é‡‡ç”¨å“ªä¸ªåˆ†æ”¯çš„å˜åŠ¨ã€‚å®ƒçš„å‚æ•°`parent-number`æ˜¯ä¸€ä¸ªä»`1`å¼€å§‹çš„æ•´æ•°ï¼Œä»£è¡¨åŸå§‹æäº¤çš„çˆ¶åˆ†æ”¯ç¼–å·ã€‚

```shell
$ git cherry-pick -m 1 <commitHash>
```

ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼ŒCherry pick é‡‡ç”¨æäº¤`commitHash`æ¥è‡ªç¼–å·1çš„çˆ¶åˆ†æ”¯çš„å˜åŠ¨ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œ1å·çˆ¶åˆ†æ”¯æ˜¯æ¥å—å˜åŠ¨çš„åˆ†æ”¯ï¼ˆthe branch being merged intoï¼‰ï¼Œ2å·çˆ¶åˆ†æ”¯æ˜¯ä½œä¸ºå˜åŠ¨æ¥æºçš„åˆ†æ”¯ï¼ˆthe branch being merged fromï¼‰ã€‚

#### 4ã€ä»£ç å†²çª

å¦‚æœæ“ä½œè¿‡ç¨‹ä¸­å‘ç”Ÿä»£ç å†²çªï¼ŒCherry pick ä¼šåœä¸‹æ¥ï¼Œè®©ç”¨æˆ·å†³å®šå¦‚ä½•ç»§ç»­æ“ä½œã€‚

1ï¼‰`--contine`

ç”¨æˆ·è§£å†³ä»£ç å†²çªåï¼Œç¬¬ä¸€æ­¥å°†ä¿®æ”¹çš„æ–‡ä»¶é‡æ–°åŠ å…¥æš‚å­˜åŒºï¼ˆ`git add .`ï¼‰ï¼Œç¬¬äºŒæ­¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œè®© Cherry pick è¿‡ç¨‹ç»§ç»­æ‰§è¡Œã€‚

```shell
$ git cherry-pick --continue
```

2ï¼‰`--abort`

å‘ç”Ÿä»£ç å†²çªåï¼Œæ”¾å¼ƒåˆå¹¶ï¼Œå›åˆ°æ“ä½œå‰çš„æ ·å­ã€‚

3ï¼‰`--quit`

å‘ç”Ÿä»£ç å†²çªåï¼Œé€€å‡º Cherry pickï¼Œä½†æ˜¯ä¸å›åˆ°æ“ä½œå‰çš„æ ·å­ã€‚

#### 5ã€è½¬ç§»åˆ°å¦å¤–ä¸€ä¸ªä»“åº“

Cherry pick ä¹Ÿæ”¯æŒè½¬ç§»å¦ä¸€ä¸ªä»£ç åº“çš„æäº¤ï¼Œæ–¹æ³•æ˜¯å…ˆå°†è¯¥åº“åŠ ä¸ºè¿œç¨‹ä»“åº“ã€‚

```shell
# æ·»åŠ ä¸€ä¸ªè¿œç¨‹ä»“åº“
$ git remote add target git://gitUrl

# å°†è¿œç¨‹ä»“åº“çš„ä»£ç æŠ“å–åˆ°æœ¬åœ°
$ git fetch target

# æ£€æŸ¥ä¸€ä¸‹è¦ä»è¿œç¨‹ä»“åº“è½¬ç§»çš„æäº¤ï¼Œè·å–å®ƒçš„å“ˆå¸Œå€¼
$ git log target/master

# ä½¿ç”¨git cherry-pickå‘½ä»¤è½¬ç§»æäº¤
$ git cherry-pick <commitHash>
```



## å…­ã€åˆå¹¶commit

åœ¨ä½¿ç”¨ Git ä½œä¸ºç‰ˆæœ¬æ§åˆ¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”±äºå„ç§å„æ ·çš„åŸå› æäº¤äº†è®¸å¤šä¸´æ—¶çš„ commitï¼Œè€Œè¿™äº› commit æ‹¼æ¥èµ·æ¥æ‰æ˜¯å®Œæ•´çš„ä»»åŠ¡ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸ºäº†é¿å…å¤ªå¤šçš„ commit è€Œé€ æˆç‰ˆæœ¬æ§åˆ¶çš„æ··ä¹±ï¼Œé€šå¸¸æˆ‘ä»¬æ¨èå°†è¿™äº› commit åˆå¹¶æˆä¸€ä¸ªã€‚

### 1ã€æŸ¥çœ‹æäº¤å†å²

```
$ git log
commit 3ca6ec340edc66df13423f36f52919dfa3......

commit 1b4056686d1b494a5c86757f9eaed844......

commit 53f244ac8730d33b353bee3b24210b07......

commit 3a4226b4a0b6fa68783b07f1cee7b688.......
```

### 2ã€git rebase

æƒ³è¦åˆå¹¶1-3æ¡ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•

1ï¼‰ä»HEADç‰ˆæœ¬å¼€å§‹å¾€è¿‡å»æ•°3ä¸ªç‰ˆæœ¬

```
$ git rebase -i HEAD~3
```

2ï¼‰æŒ‡åè¦åˆå¹¶çš„ç‰ˆæœ¬ä¹‹å‰çš„ç‰ˆæœ¬å·

```
$ git rebase -i 3a4226b
```

è¯·æ³¨æ„`3a4226b`è¿™ä¸ªç‰ˆæœ¬æ˜¯ä¸å‚ä¸åˆå¹¶çš„ï¼Œåªæ˜¯æŠŠå®ƒå½“åšä¸€ä¸ªåæ ‡

### 3ã€é€‰æ‹©è¦åˆå¹¶çš„æäº¤

pæ˜¯ä¿ç•™ï¼Œsæ˜¯åˆå¹¶

1ï¼‰æ‰§è¡Œäº†rebaseå‘½ä»¤ä¹‹åï¼Œä¼šå¼¹å‡ºä¸€ä¸ªçª—å£ï¼Œå¤´å‡ è¡Œå¦‚ä¸‹ï¼š

```
pick 3ca6ec3   'æ³¨é‡Š**********'

pick 1b40566   'æ³¨é‡Š*********'

pick 53f244a   'æ³¨é‡Š**********'
```

2ï¼‰å°†pickæ”¹ä¸ºsquashæˆ–è€…s,ä¹‹åä¿å­˜å¹¶å…³é—­æ–‡æœ¬ç¼–è¾‘çª—å£å³å¯ã€‚æ”¹å®Œä¹‹åæ–‡æœ¬å†…å®¹å¦‚ä¸‹ï¼š

```
pick 3ca6ec3   'æ³¨é‡Š**********'

s 1b40566   'æ³¨é‡Š*********'

s 53f244a   'æ³¨é‡Š**********'
```

3ï¼‰ç„¶åä¿å­˜é€€å‡ºï¼ŒGitä¼šå‹ç¼©æäº¤å†å²ï¼Œå¦‚æœæœ‰å†²çªï¼Œéœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹çš„æ—¶å€™è¦æ³¨æ„ï¼Œä¿ç•™æœ€æ–°çš„å†å²ï¼Œä¸ç„¶æˆ‘ä»¬çš„ä¿®æ”¹å°±ä¸¢å¼ƒäº†ã€‚ä¿®æ”¹ä»¥åè¦è®°å¾—æ•²ä¸‹é¢çš„å‘½ä»¤ï¼š

```
pick 3ca6ec3   'æ³¨é‡Š**********'

s 1b40566   'æ³¨é‡Š*********'

s 53f244a   'æ³¨é‡Š**********'
```

### 4ï¼‰å†²çªè§£å†³

ç„¶åä¿å­˜é€€å‡ºï¼ŒGitä¼šå‹ç¼©æäº¤å†å²ï¼Œå¦‚æœæœ‰å†²çªï¼Œéœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹çš„æ—¶å€™è¦æ³¨æ„ï¼Œä¿ç•™æœ€æ–°çš„å†å²

```
git add .  

# ç»§ç»­åˆå¹¶
git rebase --continue 

# æ”¾å¼ƒåˆå¹¶
git rebase --abort  
```

å¦‚æœæ²¡æœ‰å†²çªï¼Œæˆ–è€…å†²çªå·²ç»è§£å†³ï¼Œåˆ™ä¼šå‡ºç°å¦‚ä¸‹çš„ç¼–è¾‘çª—å£ï¼š

```
# This is a combination of 4 commits.  
#The first commitâ€™s message is:  
æ³¨é‡Š......
# The 2nd commitâ€™s message is:  
æ³¨é‡Š......
# The 3rd commitâ€™s message is:  
æ³¨é‡Š......
# Please enter the commit message for your changes. Lines starting # with â€˜#â€™ will be ignored, and an empty message aborts the commit.
```

### 5ï¼‰æ£€æŸ¥

git logæŸ¥çœ‹ commit å†å²ä¿¡æ¯ï¼ŒæŸ¥è¯¢commitçš„ä¿¡æ¯



## ä¸ƒã€Git Hook



Git Hook ä¹Ÿåˆ†ä¸ºä¸¤ä¸ªç«¯: å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚

å®¢æˆ·ç«¯çš„ Git Hook å°±æ˜¯å·¥ä½œåœ¨æˆ‘ä»¬æœ¬åœ°æœºå™¨çš„ï¼ŒæœåŠ¡ç«¯çš„ Git Hook åˆ™æ˜¯å·¥ä½œåœ¨æˆ‘ä»¬æäº¤åˆ°è¿œç¨‹çš„æœåŠ¡å™¨ä»“åº“ä¸­ã€‚

å®¢æˆ·ç«¯ Git Hook:

- pre-commit: æ‰§è¡Œgit commitå‘½ä»¤æ—¶è§¦å‘ï¼Œå¸¸ç”¨äºæ£€æŸ¥ä»£ç é£æ ¼
- prepare-commit-msg: è§¦å‘äº commit message ç¼–è¾‘å™¨å‘¼èµ·å‰ ,default commit messageåˆ›å»ºå,å¸¸ç”¨äºç”Ÿæˆé»˜è®¤çš„æ ‡å‡†åŒ–çš„æäº¤è¯´æ˜
- commit-msg: å¼€å‘è€…ç¼–å†™å®Œå¹¶ç¡®è®¤commit messageåè§¦å‘ï¼Œå¸¸ç”¨äºæ ¡éªŒæäº¤è¯´æ˜æ˜¯å¦æ ‡å‡†
- post-commit: æ•´ä¸ªgit commitå®Œæˆåè§¦å‘ï¼Œå¸¸ç”¨äºé‚®ä»¶é€šçŸ¥ã€æé†’
- applypatch-msg: æ‰§è¡Œgit amå‘½ä»¤æ—¶è§¦å‘ï¼Œå¸¸ç”¨äºæ£€æŸ¥å‘½ä»¤æå–å‡ºæ¥çš„æäº¤ä¿¡æ¯æ˜¯å¦ç¬¦åˆç‰¹å®šæ ¼å¼
- pre-applypatch: git amæå–å‡ºè¡¥ä¸å¹¶åº”ç”¨äºå½“å‰åˆ†æ”¯åï¼Œå‡†å¤‡æäº¤å‰è§¦å‘ï¼Œå¸¸ç”¨äºæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹æˆ–æ£€æŸ¥ç¼“å†²åŒºä»£ç 
- post-applypatch: git amæäº¤åè§¦å‘ï¼Œå¸¸ç”¨äºé€šçŸ¥ã€æˆ–è¡¥ä¸é‚®ä»¶å›å¤ï¼ˆæ­¤é’©å­ä¸èƒ½åœæ­¢git amè¿‡ç¨‹ï¼‰
- pre-rebase: æ‰§è¡Œgit rebaseå‘½ä»¤æ—¶è§¦å‘
- post-rewrite: æ‰§è¡Œä¼šæ›¿æ¢commitçš„å‘½ä»¤æ—¶è§¦å‘ï¼Œæ¯”å¦‚git rebaseæˆ–git commit â€“amend
- post-checkout: æ‰§è¡Œgit checkoutå‘½ä»¤æˆåŠŸåè§¦å‘ï¼Œå¯ç”¨äºç”Ÿæˆç‰¹å®šæ–‡æ¡£ï¼Œå¤„ç†å¤§äºŒè¿›åˆ¶æ–‡ä»¶ç­‰
- post-merge: æˆåŠŸå®Œæˆä¸€æ¬¡ mergeè¡Œä¸ºåè§¦å‘
- pre-push: æ‰§è¡Œgit pushå‘½ä»¤æ—¶è§¦å‘ï¼Œå¯ç”¨äºæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹
- pre-auto-gc: æ‰§è¡Œåƒåœ¾å›æ”¶å‰è§¦å‘

æœåŠ¡ç«¯ Git Hook:

- pre-receive: å½“æœåŠ¡ç«¯æ”¶åˆ°ä¸€ä¸ª push æ“ä½œè¯·æ±‚æ—¶è§¦å‘ï¼Œå¯ç”¨äºæ£€æµ‹ push çš„å†…å®¹
- update: update è„šæœ¬å’Œ pre-receive è„šæœ¬ååˆ†ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä¼šä¸ºæ¯ä¸€ä¸ªå‡†å¤‡æ›´æ–°çš„åˆ†æ”¯å„è¿è¡Œä¸€æ¬¡ã€‚ å‡å¦‚æ¨é€è€…åŒæ—¶å‘å¤šä¸ªåˆ†æ”¯æ¨é€å†…å®¹ï¼Œpre-receive åªè¿è¡Œä¸€æ¬¡ï¼Œç›¸æ¯”ä¹‹ä¸‹ update åˆ™ä¼šä¸ºæ¯ä¸€ä¸ªè¢«æ¨é€çš„åˆ†æ”¯å„è¿è¡Œä¸€æ¬¡ã€‚
- post-receive: post-receive æŒ‚é’©åœ¨æ•´ä¸ªè¿‡ç¨‹å®Œç»“ä»¥åè¿è¡Œï¼Œå¯ä»¥ç”¨æ¥æ›´æ–°å…¶ä»–ç³»ç»ŸæœåŠ¡æˆ–è€…é€šçŸ¥ç”¨æˆ·ã€‚å®ƒçš„ç”¨é€”åŒ…æ‹¬ç»™æŸä¸ªé‚®ä»¶åˆ—è¡¨å‘ä¿¡ï¼Œé€šçŸ¥æŒç»­é›†æˆï¼ˆcontinous integrationï¼‰çš„æœåŠ¡å™¨ï¼Œæˆ–è€…æ›´æ–°é—®é¢˜è¿½è¸ªç³»ç»Ÿï¼ˆticket-tracking systemï¼‰ â€”â€” ç”šè‡³å¯ä»¥é€šè¿‡åˆ†ææäº¤ä¿¡æ¯æ¥å†³å®šæŸä¸ªé—®é¢˜ï¼ˆticketï¼‰æ˜¯å¦åº”è¯¥è¢«å¼€å¯ï¼Œä¿®æ”¹æˆ–è€…å…³é—­ã€‚

##### ä½¿ç”¨git hook

Git Hook æœ¬èº«è‡ªå¸¦æœ‰è„šæœ¬ï¼Œä¼šå­˜æ”¾åœ¨ä»“åº“ .git/hooks æ–‡ä»¶å¤¹ä¸­ï¼Œç›®å½•ä¸€èˆ¬æ˜¯è¿™æ ·çš„:

```
- YourGitRepo
  |- .git
     |- hooks
        |- hooks--commit-msg.sample
        |- hooks--post-update.sample
        ...
```

æ³¨æ„å¦‚æœæ˜¯ sample æ–‡ä»¶ï¼Œè¦å»æ‰ .sample åç¼€ï¼Œå˜æˆå‰é¢ `Git Hook åˆ†ç±»` ä¸­æåˆ°å¯¹åº”çš„æ“ä½œæ¥ä½œä¸ºæ–‡ä»¶åã€‚

æ¯”å¦‚æˆ‘è¦åšçš„æ ¡éªŒ commit çš„æäº¤ä¿¡æ¯ï¼Œé‚£ä¹ˆä½¿ç”¨çš„ Git Hook è„šæœ¬ååº”è¯¥ä¸º `commit-msg`.

åœ¨ `hooks--commit-msg.sample` é‡Œçš„å†…å®¹ä¸º:

```
#!/bin/sh
#
# An example hook script to check the commit log message.
# Called by "git commit" with one argument, the name of the file
# that has the commit message.  The hook should exit with non-zero
# status after issuing an appropriate message if it wants to stop the
# commit.  The hook is allowed to edit the commit message file.
#
# To enable this hook, rename this file to "commit-msg".

# Uncomment the below to add a Signed-off-by line to the message.
# Doing this in a hook is a bad idea in general, but the prepare-commit-msg
# hook is more suited to it.
#
# SOB=$(git var GIT_AUTHOR_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
# grep -qs "^$SOB" "$1" || echo "$SOB" >> "$1"

# This example catches duplicate Signed-off-by lines.

test "" = "$(grep '^Signed-off-by: ' "$1" |
	 sort | uniq -c | sed -e '/^[ 	]*1[ 	]/d')" || {
	echo >&2 Duplicate Signed-off-by lines.
	exit 1
}
```

ä¸Šé¢è¯´æ˜é‡Œæœ‰ä¸€äº›åŸºæœ¬è¯´æ˜, è¿™é‡Œè·å¾—çš„ $1 å‚æ•°ï¼Œå…¶å®æ˜¯å­˜æ”¾ commit msg å†…å®¹çš„æ–‡ä»¶è·¯å¾„ï¼Œä¸º `.git/COMMIT_EDITMSG`.

åˆ©ç”¨å‘½ä»¤:

```
msg=$(cat $1)
```

å°±èƒ½å–åˆ° commit çš„ä¿¡æ¯ï¼Œç¨ä½œä¿®æ”¹ï¼Œå°±èƒ½è¾¾åˆ°æˆ‘è¯´çš„ï¼Œæ ¡éªŒå›¢é˜Ÿ commit ä¿¡æ¯çš„è§„èŒƒçš„ç›®çš„äº†ã€‚

##### Git Hook ä¸ç”Ÿæ•ˆ

å¦‚æœé‡åˆ°ä¸èµ·ä½œç”¨çš„ï¼Œå¯èƒ½è„šæœ¬æ²¡æœ‰æ‰“å¼€æ‰§è¡Œæƒé™ï¼Œå¯¼è‡´æ²¡åŠæ³•æ‰§è¡Œã€‚æˆ‘å°±æ˜¯è¿™æ ·çš„æƒ…å†µã€‚

cd åˆ° .git/hooks ç›®å½•ä¸‹,æ‰§è¡Œ `chmod 777` å‘½ä»¤å³å¯,å¦‚ï¼š

```
chmod 777 commit-msg
```



## å…«ã€Git GC

æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶å¹¶ä¼˜åŒ–æœ¬åœ°å­˜å‚¨åº“

å‚è€ƒé“¾æ¥ï¼š[Git - ç®¡ç† | Administration - git gc - å¼€å‘è€…æ‰‹å†Œ - äº‘+ç¤¾åŒº - è…¾è®¯äº‘ (tencent.com)](https://cloud.tencent.com/developer/section/1138643)



Gitçš„åº•å±‚å¹¶æ²¡æœ‰é‡‡ç”¨ CVSã€SVN åº•å±‚æ‰€é‡‡ç”¨çš„é‚£å¥—å¢é‡å¼æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€å¥—è‡ªè¡Œç»´æŠ¤çš„å­˜å‚¨æ–‡ä»¶ç³»ç»Ÿã€‚å½“æ–‡ä»¶å˜åŠ¨å‘ç”Ÿæäº¤æ—¶ï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨çš„ä¸æ˜¯æ–‡ä»¶çš„å·®å¼‚ä¿¡æ¯ï¼Œè€Œæ˜¯æ–‡ä»¶å¿«ç…§ï¼Œå³æ•´ä¸ªæ–‡ä»¶å†…å®¹ï¼Œå¹¶ä¿å­˜æŒ‡å‘å¿«ç…§çš„ç´¢å¼•ã€‚è¿™ç§åšæ³•ï¼Œæé«˜ Git åˆ†æ”¯çš„ä½¿ç”¨æ•ˆç‡ï¼›ä½†ä¹Ÿå®¹æ˜“å¯¼è‡´ä»£ç ä»“åº“ä¸­å†…å®¹é‡å¤ç¨‹åº¦è¿‡é«˜ï¼Œä»è€Œä»“åº“ä½“ç§¯è¿‡å¤§ã€‚å½“é‡åˆ°è¿™ç§æƒ…å†µæ—¶ï¼Œæˆ–è€…éœ€è¦å°†ä»“åº“æ¨é€åˆ°è¿œç¨‹ä¸»æœºæ—¶ï¼Œå°±éœ€è¦Gitä¸­çš„gcï¼ˆgarbage collectï¼‰åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾å›æ”¶åŠŸèƒ½ã€‚

å¤§ä½“æ¥è¯´ï¼Œå½“è¿è¡Œ "git gc" å‘½ä»¤æ—¶ï¼ŒGitä¼šæ”¶é›†æ‰€æœ‰æ¾æ•£å¯¹è±¡å¹¶å°†å®ƒä»¬å­˜å…¥ packfileï¼Œåˆå¹¶è¿™äº› packfile è¿›ä¸€ä¸ªå¤§çš„ packfileï¼Œç„¶åå°†ä¸è¢«ä»»ä½• commit å¼•ç”¨å¹¶ä¸”å·²å­˜åœ¨ä¸€æ®µæ—¶é—´ (æ•°æœˆ) çš„å¯¹è±¡åˆ é™¤ã€‚ æ­¤å¤–ï¼ŒGitè¿˜ä¼šå°†æ‰€æœ‰å¼•ç”¨ (references) å¹¶å…¥ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ã€‚

å°±ç»†èŠ‚è€Œè¨€ï¼ŒGitåšäº†è¿™å‡ ä»¶äº‹ï¼š

* pack_refs è¿‡ç¨‹
* reflog expire è¿‡ç¨‹
* repack è¿‡ç¨‹
* prune è¿‡ç¨‹
* rerere è¿‡ç¨‹



æ¦‚è¦ï¼š

```
git gc [--aggressive] [--auto] [--quiet] [--prune=<date> | --no-prune] [--force]
```

æè¿°ï¼š

åœ¨å½“å‰å­˜å‚¨åº“ä¸­è¿è¡Œè®¸å¤šå†…åŠ¡å¤„ç†ä»»åŠ¡ï¼Œä¾‹å¦‚å‹ç¼©æ–‡ä»¶ä¿®è®¢ï¼ˆä»¥å‡å°‘ç£ç›˜ç©ºé—´å¹¶æé«˜æ€§èƒ½ï¼‰å¹¶ç§»é™¤å¯èƒ½ç”±ä¹‹å‰`git add`è°ƒç”¨åˆ›å»ºçš„ä¸å¯è¾¾å¯¹è±¡ã€‚

é¼“åŠ±ç”¨æˆ·åœ¨æ¯ä¸ªå­˜å‚¨åº“ä¸­å®šæœŸè¿è¡Œæ­¤ä»»åŠ¡ï¼Œä»¥ä¿æŒè‰¯å¥½çš„ç£ç›˜ç©ºé—´åˆ©ç”¨ç‡å’Œè‰¯å¥½çš„æ“ä½œæ€§èƒ½ã€‚

ä¸€äº›gitå‘½ä»¤å¯èƒ½ä¼šè‡ªåŠ¨è¿è¡Œ`git gc`; `--auto`è¯¦ç»†ä¿¡æ¯è¯·å‚é˜…ä¸‹é¢çš„æ ‡å¿—ã€‚å¦‚æœæ‚¨çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå¹¶ä¸”æ‰€æœ‰æ‚¨æƒ³è¦çš„éƒ½æ˜¯æ°¸ä¹…ç¦ç”¨æ­¤è¡Œä¸ºè€Œæ— éœ€è¿›ä¸€æ­¥è€ƒè™‘ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

```
$ git config --global gc.auto 0
```

é€‰é¡¹ï¼š

* --aggressive   

é€šå¸¸`git gc`è¿è¡Œé€Ÿåº¦å¾ˆå¿«ï¼ŒåŒæ—¶æä¾›è‰¯å¥½çš„ç£ç›˜ç©ºé—´åˆ©ç”¨ç‡å’Œæ€§èƒ½ æ­¤é€‰é¡¹å°†å¯¼è‡´`git gc`æ›´ç§¯æåœ°ä¼˜åŒ–å­˜å‚¨åº“ï¼Œä½†èŠ±è´¹æ›´å¤šæ—¶é—´ã€‚è¿™ç§ä¼˜åŒ–çš„æ•ˆæœæ˜¯æŒä¹…çš„ï¼Œæ‰€ä»¥è¿™ä¸ªé€‰é¡¹åªéœ€è¦å¶å°”ä½¿ç”¨; æ¯éš”å‡ ç™¾ä¸ªå˜æ›´é›†å·¦å³ã€‚

* --auto   

ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œ`git gc`æ£€æŸ¥æ˜¯å¦éœ€è¦è¿›è¡Œä»»ä½•æ¸…æ´å·¥ä½œ; å¦‚æœæ²¡æœ‰ï¼Œå®ƒä¼šé€€å‡ºè€Œä¸æ‰§è¡Œä»»ä½•å·¥ä½œã€‚ä¸€äº›gitå‘½ä»¤`git gc --auto`åœ¨æ‰§è¡Œå¯èƒ½ä¼šäº§ç”Ÿè®¸å¤šæ¾æ•£å¯¹è±¡çš„æ“ä½œä¹‹åè¿è¡Œã€‚

å¦‚æœå­˜å‚¨åº“ä¸­çš„æ¾æ•£å¯¹è±¡å¤ªå¤šæˆ–åŒ…è£…å¤ªå¤šï¼Œåˆ™éœ€è¦è¿›è¡Œå†…åŠ¡å¤„ç†ã€‚å¦‚æœæ¾æ•£å¯¹è±¡çš„æ•°é‡è¶…è¿‡äº†`gc.auto`é…ç½®å˜é‡çš„å€¼ï¼Œåˆ™æ‰€æœ‰æ¾æ•£å¯¹è±¡éƒ½å°†ä½¿ç”¨ç»„åˆåˆ°ä¸€ä¸ªåŒ…ä¸­`git repack -d -l`ã€‚å°†å€¼è®¾ç½®`gc.auto`ä¸º0å°†ç¦ç”¨è‡ªåŠ¨å¡«å……æ¾æ•£ç‰©ä½“ã€‚

å¦‚æœåŒ…è£…æ•°é‡è¶…è¿‡äº†ä»·å€¼`gc.autoPackLimit`ï¼Œé‚£ä¹ˆç°æœ‰åŒ…è£…ï¼ˆæ ‡æœ‰`.keep`æ–‡ä»¶çš„åŒ…è£…é™¤å¤–ï¼‰å°†é€šè¿‡ä½¿ç”¨`-A`é€‰é¡¹åˆå¹¶åˆ°ä¸€ä¸ªåŒ…è£…ä¸­`git repack`ã€‚è®¾ç½®`gc.autoPackLimit`ä¸º0å°†ç¦ç”¨è‡ªåŠ¨åˆå¹¶åŒ…è£…ã€‚

* --prune=<date>   

ä¿®å‰ªæ¯”æ—¥æœŸæ›´æ—§çš„æ¾æ•£å¯¹è±¡ï¼ˆé»˜è®¤ä¸º2å‘¨å‰ï¼Œå¯ç”±é…ç½®å˜é‡è¦†ç›–`gc.pruneExpire`ï¼‰ã€‚--prune =ä¸ç®¡å¹´é¾„å¤§å°ï¼Œéƒ½ä¿®å‰ªæ¾æ•£çš„ç‰©ä½“ï¼Œå¹¶ä¸”å¦‚æœå¦ä¸€ä¸ªè¿›ç¨‹åŒæ—¶å†™å…¥å­˜å‚¨åº“ï¼Œåˆ™ä¼šå¢åŠ è…è´¥é£é™©; è¯·å‚é˜…ä¸‹é¢çš„â€œæ³¨æ„äº‹é¡¹â€ã€‚--pruneé»˜è®¤æ‰“å¼€ã€‚

* --no-prune   

ä¸è¦ä¿®å‰ªä»»ä½•æ¾åŠ¨çš„ç‰©ä½“ã€‚

* --quiet   

å–æ¶ˆæ‰€æœ‰è¿›åº¦æŠ¥å‘Šã€‚

* --force   

`git gc`å³ä½¿å¯èƒ½æœ‰å¦ä¸€ä¸ª`git gc`å®ä¾‹åœ¨æ­¤å­˜å‚¨åº“ä¸Šè¿è¡Œï¼Œä¹Ÿå¼ºåˆ¶è¿è¡Œã€‚



æ³¨æ„ï¼š

`git gc`å°½é‡ä¸è¦åˆ é™¤åœ¨å­˜å‚¨åº“ä¸­ä»»ä½•ä½ç½®å¼•ç”¨çš„å¯¹è±¡ã€‚ç‰¹åˆ«æ˜¯ï¼Œå®ƒä¸ä»…ä¼šä¿å­˜å½“å‰ä¸€ç»„åˆ†æ”¯å’Œæ ‡è®°æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿˜ä¼šä¿ç•™ç”±ç´¢å¼•å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿œç¨‹è·Ÿè¸ªåˆ†æ”¯ï¼Œ`git filter-branch`refs / original /ä¸­ä¿å­˜çš„å¼•ç”¨æˆ–reflogsï¼ˆå¯å¼•ç”¨åˆ†æ”¯ä¸­çš„æäº¤åæ¥ä¿®æ”¹æˆ–å€’å¸¦ï¼‰ã€‚å¦‚æœæ‚¨å¸Œæœ›æŸäº›å¯¹è±¡è¢«åˆ é™¤è€Œä¸æ˜¯ï¼Œè¯·æ£€æŸ¥æ‰€æœ‰è¿™äº›ä½ç½®ï¼Œå¹¶å†³å®šåœ¨æ‚¨çš„æƒ…å†µä¸‹åˆ é™¤è¿™äº›å¼•ç”¨æ˜¯å¦æœ‰æ„ä¹‰ã€‚

å¦ä¸€æ–¹é¢ï¼Œå½“`git gc`ä¸å¦ä¸€ä¸ªè¿›ç¨‹åŒæ—¶è¿è¡Œæ—¶ï¼Œå¯èƒ½ä¼šåˆ é™¤å¦ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨ä½†å°šæœªåˆ›å»ºå¼•ç”¨çš„å¯¹è±¡ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´å…¶ä»–è¿›ç¨‹å¤±è´¥æˆ–è€…å¯èƒ½ä¼šæŸåå­˜å‚¨åº“ï¼Œå¦‚æœå…¶ä»–è¿›ç¨‹ç¨åæ·»åŠ å¯¹å·²åˆ é™¤å¯¹è±¡çš„å¼•ç”¨ã€‚Gitæœ‰ä¸¤ä¸ªåŠŸèƒ½å¯ä»¥æ˜¾ç€ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼š

1. `--prune`ä¿ç•™ä¿®æ”¹æ—¶é—´æ¯”æ—¥æœŸæ›´æ–°çš„ä»»ä½•å¯¹è±¡ä»¥åŠå¯ä»å…¶è®¿é—®çš„æ‰€æœ‰å¯¹è±¡ã€‚

1. å°†å¯¹è±¡æ·»åŠ åˆ°æ•°æ®åº“çš„å¤§å¤šæ•°æ“ä½œéƒ½ä¼šæ›´æ–°å¯¹è±¡çš„ä¿®æ”¹æ—¶é—´ï¼ˆå¦‚æœè¯¥å¯¹è±¡å·²å­˜åœ¨ï¼Œä»¥ä¾¿åº”ç”¨ï¼ƒ1ï¼‰ã€‚

ç„¶è€Œï¼Œè¿™äº›åŠŸèƒ½å¹¶ä¸èƒ½æä¾›å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œå› æ­¤ï¼ŒåŒæ—¶è¿è¡Œå‘½ä»¤çš„ç”¨æˆ·å¿…é¡»å¿å—ä¸€äº›è…è´¥é£é™©ï¼ˆå®è·µä¸­ä¼¼ä¹å¾ˆä½ï¼‰ï¼Œé™¤éä»–ä»¬å…³é—­è‡ªåŠ¨åƒåœ¾æ”¶é›†`git config gc.auto 0`





## ä¹ã€Git gpgç­¾å

```shell
# æŸ¥çœ‹gpgå¯†é’¥
[root@local ~]# gpg --list-key
/root/.gnupg/pubring.kbx
------------------------
pub   rsa4096 2021-08-23 [SC]
      C40EA42A60xxxxxxxxxxxxxxxxxx
uid           [ ç»å¯¹ ] cccc (local) <t@local.com>
sub   rsa4096 2021-08-23 [E]

pub   rsa4096 2021-08-23 [SC]
      3CB22116355xxxxxxxxxxxxxxxxxx
uid           [ ç»å¯¹ ] tom (github) <t@local.cc>
sub   rsa4096 2021-08-23 [E]
```

é…ç½®ä½¿ç”¨gpgç­¾å

```shell
# git é…ç½®ä½¿ç”¨gpgç­¾å
git config --global user.signingkey <gpg-key-id>

# æäº¤æ˜¯å¦å¼ºåˆ¶ GPGï¼Œå¸¦ä¸Š--global æ˜¯ä½œç”¨å…¨å±€ï¼Œå±€éƒ¨çš„å»é™¤--global
[root@sugar2 ~]# git config --global commit.gpgsign true


# commit æäº¤è®¾ç½®GPGç­¾åï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®å¼ºåˆ¶ï¼Œåˆ™éœ€è¦åŠ ä¸Š-S
[root@sugar2 ~]# git commit -S -m â€œcommit message"

# åœ¨githubä¸Šç­¾åçš„æäº¤å°†æ˜¾ç¤ºåŒ…å«â€œ Verifiedâ€
```

é—®é¢˜ï¼š

```shell
[root@sugar ssl]# git commit -m "init repo"
error: gpg æ•°æ®ç­¾åå¤±è´¥
fatal: å†™æäº¤å¯¹è±¡å¤±è´¥

å‚è€ƒé“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/97984430

è§£å†³åŠæ³•ï¼šexport GPG_TTY=$(tty)

åœ¨ç¯å¢ƒå˜é‡é‡Œå¢åŠ ä¸€é¡¹GPG_TTY


```



## åã€é…ç½®http

git æ‹‰å–ä»£ç ä½¿ç”¨çš„åè®®æ˜¯sshï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨http

é…ç½®ï¼š

```shell
[root@Krab ~]ğŸ³ git config --global credential.helper store

# é…ç½®å~/.gitconfig æ–‡ä»¶ä¼šå¢åŠ é…ç½®
[credential]
	helper = store

# åœ¨ç¬¬ä¸€æ¬¡è®¿é—®gitæœåŠ¡çš„æ—¶å€™ï¼Œå¯†é’¥ä¼šè¢«è®°å½•åœ¨ ~/.git-credentials æ–‡ä»¶ä¸­


# é…ç½®å†å²é¡¹ç›®æ”¹æˆä½¿ç”¨http(æ­¤æ–¹æ³•é€‚ç”¨httpè½¬sshæˆ–è€…sshè½¬httpï¼Œæˆ–è€…æ›´æ¢æŒ‡å®šgitæœåŠ¡å™¨)

[url "http://local.io/"]
        insteadOf = git@local.io:


```

é…ç½®github ssh èµ°ä»£ç†

```shell
[root@Krab ~]ğŸ³ cat ~/.ssh/config 
Host github.com
  User git
  ProxyCommand nc -v -x 127.0.0.1:5888 %h %p
```





