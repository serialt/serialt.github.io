+++
title = 'Go basic'
date = 2024-08-11T10:26:09+08:00
draft = false

tags = ["Go","basic"]
categories = ["Go åŸºç¡€"]

+++

## 1ã€å˜é‡å®šä¹‰

```go
var name string
var isOk bool

// éšå¼ç”³æ˜
a := 100
str := "sugar"

// æ‰¹é‡å£°æ˜
var (
    a string
    b int
    c bool
    d float32
)

// å˜é‡çš„åˆå§‹åŒ–
var name string = "github"
var age int = 10

var name, age = "github", 11

// ç±»å‹æ¨å¯¼
var name = "github"
var age = 11

// å¸¸é‡å£°æ˜
const pi = 3.1415
const e = 2.7182

const (
    pi = 3.1415
    e = 2.7182
)

// conståŒæ—¶å£°æ˜å¤šä¸ªå¸¸é‡æ—¶ï¼Œå¦‚æœçœç•¥äº†å€¼åˆ™è¡¨ç¤ºå’Œä¸Šé¢ä¸€è¡Œçš„å€¼ç›¸åŒã€‚
const (
    n1 = 100
    n2
    n3
)

// æšä¸¾
const (
		n1 = iota //0
		n2        //1
		n3        //2
		n4        //3
	)

// ä½¿ç”¨_è·³è¿‡æŸäº›å€¼
const (
		n1 = iota //0
		n2        //1
		_
		n4        //3
	)
```

## 2ã€æµç¨‹æ§åˆ¶
```go
func ifDemo1() {
	score := 65
	if score >= 90 {
		fmt.Println("A")
	} else if score > 75 {
		fmt.Println("B")
	} else {
		fmt.Println("C")
	}
}

func forDemo() {
	for i := 0; i < 10; i++ {
		fmt.Println(i)
	}
}

func forDemo3() {
	i := 0
	for i < 10 {
		fmt.Println(i)
		i++
	}
}

//  æ— é™å¾ªç¯
for {
    å¾ªç¯ä½“è¯­å¥
}


// switch è¯­æ³•
func testSwitch3() {
    n := 7
	switch n {
	case 1, 3, 5, 7, 9:
		fmt.Println("å¥‡æ•°")
	case 2, 4, 6, 8:
		fmt.Println("å¶æ•°")
	default:
		fmt.Println(n)
	}
}

```

## 3ã€slice
```go
a := []int{1, 2, 3, 4, 5}

// ä»åˆ‡ç‰‡ä¸­åˆ é™¤å…ƒç´ 
func main() {
	// ä»åˆ‡ç‰‡ä¸­åˆ é™¤å…ƒç´ 
	a := []int{30, 31, 32, 33, 34, 35, 36, 37}
	// è¦åˆ é™¤ç´¢å¼•ä¸º2çš„å…ƒç´ 
	a = append(a[:2], a[3:]...)
	fmt.Println(a) //[30 31 33 34 35 36 37]
}
```

## 4ã€å‡½æ•°
```go
// åŒ¿åå‡½æ•°
	func(x, y int) {
		fmt.Println(x + y)
	}(10, 20)
```

### ç»“æ„ä½“
```go
// åµŒå¥—åŒ¿åå­—æ®µ
type Address struct {
	Province string
	City     string
}

//User ç”¨æˆ·ç»“æ„ä½“
type User struct {
	Name    string
	Gender  string
	Address //åŒ¿åå­—æ®µ
}
```

## 5ã€ç¼–è¯‘
Mac ä¸‹ç¼–è¯‘ Linux å’Œ Windowså¹³å° 64ä½ å¯æ‰§è¡Œç¨‹åºï¼š

```bash
CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build
CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build

# go 1.16+ç‰ˆæœ¬
CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build
CGO_ENABLED=0 GOOS=windows GOARCH=arm64 go build
```

Linux ä¸‹ç¼–è¯‘ Mac å’Œ Windows å¹³å°64ä½å¯æ‰§è¡Œç¨‹åºï¼š

```bash
CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build
CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build
```

Windowsä¸‹ç¼–è¯‘Macå¹³å°64ä½å¯æ‰§è¡Œç¨‹åºï¼š

```bash
SET CGO_ENABLED=0
SET GOOS=darwin
SET GOARCH=amd64
go build
```

å›½å†…é•œåƒè®¾ç½®
```shell
export GOPROXY=https://goproxy.cn,direct
export GOPATH=/root/go
export GO111MODULE="on"
export GOBIN=$GOPATH/bin
export PATH=$PATH:$GOROOT/bin:$GOBIN
```

## 6ã€ç§æœ‰ä»“åº“è®¾ç½®
```shell
go env -w GOPRIVATE="github.com/private_org/private_repo"

go env -w GOPRIVATE="github.com/private_org"
```

å¼ºåˆ¶èµ°sshåè®®getç§æœ‰åŒ…ä»£ç 
```shell
[url "ssh://git@github.com/"]
	insteadOf = https://github.com/

# æˆ–è€…
git config --global url."ssh://git@github.com/".insteadOf https://github.com/

# go get/install é»˜è®¤æ˜¯èµ°httpsçš„ï¼Œé»˜è®¤go getå‘èµ·è¯·æ±‚ä½¿ç”¨çš„æ˜¯HTTPSï¼Œå¦‚æœè‡ªå·±çš„ç§æœ‰æœåŠ¡æ˜¯HTTPçš„ï¼Œåˆ™éœ€è¦é…ç½®ä¸‹ã€‚

go env -w GOINSECURE=git.local.com
```

## 7ã€makefile
```makefile
PROJECT_NAME= cli


GOBASE=$(shell pwd)
GOFILES=$(wildcard *.go)


BRANCH := $(shell git symbolic-ref HEAD 2>/dev/null | cut -d"/" -f 3)
# BRANCH := `git fetch --tags && git tag | sort -V | tail -1`
# BUILD := $(shell git rev-parse --short HEAD)
BUILD_DIR := $(GOBASE)/dist
VERSION = $(BRANCH)

BuildTime := $(shell date -u  '+%Y-%m-%d %H:%M:%S %Z')
GitHash := $(shell git rev-parse HEAD)
GoVersion = $(shell go version | cut -d " " -f 3 )
Maintainer := cccc@gmail.com 
KEY := wzFdVccccccccccccccc

PKGFLAGS := " -s -w -X 'main.APPVersion=$(VERSION)' -X 'main.GoVersion=$(GoVersion)'  -X 'main.BuildTime=$(BuildTime)' -X 'main.GitCommit=$(GitHash)' -X 'main.AesKey=$(KEY)'  "

APP_NAME = $(PROJECT_NAME)
# go-pkg.v0.1.1-linux-amd64

.PHONY: clean
clean:
	@-rm -rf dist/$(PROJECT_NAME)* 

.PHONY: serve
serve:
	go run .

.PHONY: build
build: clean
	@go build -trimpath -ldflags $(PKGFLAGS) -o "dist/$(APP_NAME)" 
	@echo "\n******************************"
	@echo "         build succeed "
	@echo "******************************\n"
	@ls -la dist/$(PROJECT_NAME)*
	@echo

.PHONY: build-linux
build-linux: clean
	@go mod tidy
	@GOOS="linux"   GOARCH="amd64" go build -trimpath -ldflags $(PKGFLAGS) -v -o "dist/$(APP_NAME)-linux-amd64"       
	@GOOS="linux"   GOARCH="arm64" go build -trimpath -ldflags $(PKGFLAGS) -v -o "dist/$(APP_NAME)-linux-arm64"    
	@echo "\n******************************"
	@echo "      build linux succeed "
	@echo "******************************\n"
	@ls -la dist/$(PROJECT_NAME)*
	@echo

.PHONY: release
release: clean
	@go mod tidy
	@GOOS="windows" GOARCH="amd64" go build -trimpath -ldflags $(PKGFLAGS) -v -o "dist/$(APP_NAME)-windows-amd64.exe" 
	@GOOS="linux"   GOARCH="amd64" go build -trimpath -ldflags $(PKGFLAGS) -v -o "dist/$(APP_NAME)-linux-amd64"       
	@GOOS="linux"   GOARCH="arm64" go build -trimpath -ldflags $(PKGFLAGS) -v -o "dist/$(APP_NAME)-linux-arm64"       
	@GOOS="darwin"  GOARCH="amd64" go build -trimpath -ldflags $(PKGFLAGS) -v -o "dist/$(APP_NAME)-darwin-amd64"      
	@GOOS="darwin"  GOARCH="arm64" go build -trimpath -ldflags $(PKGFLAGS) -v -o "dist/$(APP_NAME)-darwin-arm64"      
	@echo "\n******************************"
	@echo "        release succeed "
	@echo "******************************\n"
	@ls -la dist/$(PROJECT_NAME)*
	@echo
```

## 8ã€go work
å‚è€ƒé“¾æ¥ï¼šhttps://cloud.tencent.com/developer/article/1970405

go 1.18 æ–°å¢åŠ  workspaceçš„å¼€å‘æ¨¡å¼ï¼Œ

### Go work ä½¿ç”¨ä»‹ç»

1ï¼‰åˆ›å»ºä¸€ä¸ªworkspace

```shell
[root@tc ~]$ mkdir github
[root@tc ~]$ cd github
```

2ï¼‰åˆ›å»ºåŒ… p1

```
[root@tc p1]$ tree .
.
â”œâ”€â”€ go.mod
â””â”€â”€ p1.go

0 directories, 2 files

[root@tc p1]$ cat p1.go 
package p1

import "fmt"

func Hello(obj string) {
        fmt.Printf("Hello %s\n", obj)
}
```



3ï¼‰å›åˆ°githubç›®å½•ï¼Œç”Ÿæˆgo.work

```
[root@tc github]$ go work init ./p1

[root@tc github]$ cat go.work 
go 1.18

use (
        ./p1
) 
```

4ã€åˆ›å»ºp2ï¼Œgo 

```
[root@tc p2]$ tree .
.
â”œâ”€â”€ go.mod
â””â”€â”€ main.go

0 directories, 2 files
[root@tc p2]$ cat main.go 
package main

import (
        "github.com/serialt/p1"
)

func main() {
        p1.Hello("world")
}
```

```
[root@tc p2]$ go run main.go 
Hello world
```



æ³¨æ„ï¼šä»¥ä¸Šæ“ä½œä¸èƒ½buildæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› ä¸ºp2 æ²¡æœ‰è¢«æ·»åŠ go worké‡Œï¼Œéœ€è¦æŠŠp2 æ·»åŠ è¿›go workæ‰èƒ½ä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘githubç›®å½•ä¸‹çš„go.workï¼Œä¹Ÿå¯ä½¿ç”¨`go work use p2` æŠŠp2æ·»åŠ åˆ°go worké‡Œï¼Œç„¶åå†æ‰§è¡Œgo build

```
[root@tc p2]$ go build
[root@tc p2]$ ls
go.mod  main.go p2
[root@tc p2]$ ./p2 
Hello world
```



æ³¨æ„ï¼šå› ä¸ºæ­¤æ—¶p1 æ²¡æœ‰æäº¤åˆ°è¿œç¨‹gitä»“åº“ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œgo mod tidy çš„æ—¶å€™æ˜¯ä¼šå»è¿œç¨‹ä»“åº“ä¸‹è½½è§£å†³ä¾èµ–ï¼Œå¯ä»¥ç­‰p1 å¼€å‘å®Œå æŠŠp1 æäº¤åˆ°è¿œç¨‹ä»“åº“åå†å¯¹p2 è¿›è¡Œgo mod tidyã€‚



## 9ã€ä¾èµ–ç‰ˆæœ¬æ§åˆ¶
go ç‰ˆæœ¬ä¾èµ–åº“ç®¡ç†æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§

### æ–¹å¼1ï¼š

v1ç‰ˆæœ¬go.mod 

```
module github.com/serialt/sugar
```

v2ç‰ˆæœ¬go.md

```
module github.com/serialt/sugar/v2
```

ä½¿ç”¨åº“æ—¶åº“åä»ç„¶æ˜¯`sugar.xxxx`

å‚è€ƒåœ°å€

```
https://github.com/serialt/sugar
```



### æ–¹å¼2:

```
github.com/go-git/go-git/v5
```

ä½¿ç”¨åº“æ—¶å€™åº“åæ˜¯gitï¼Œä½¿ç”¨åº“åæ—¶å€™ä¼šè‡ªåŠ¨å»æ‰go-ï¼Œç›´æ¥ä½¿ç”¨gitã€‚

å‚è€ƒåœ°å€ï¼š

```
https://github.com/serialt/git-mirror/blob/master/service/github.go
```



### æ–¹å¼3ï¼š

```
gopkg.in/yaml.v3
```

å‚è€ƒåœ°å€ï¼š

```
https://github.com/go-yaml/yaml
```

ä½¿ç”¨åº“æ˜¯æ—¶å€™æ˜¯yaml.xxxxxï¼Œä¼šè‡ªåŠ¨å»æ‰.v3



æ³¨æ„ï¼Œä»¥ä¸Šæ–¹å¼ä¸€ä¸ªrepoå¤šä¸ªç‰ˆæœ¬å…±å­˜çš„åŸºç¡€æ˜¯éœ€è¦ä¸go.mdå¯¹åº”ã€‚



## 10ã€å¯é€‰å‚æ•°
```go
type Option func(*OptionSet)
func New(opts ...Option){
    //ä¸‹é¢è®¾ç½®é»˜è®¤å€¼
	options:=OptionSet{	
		A:"default-a",
		B:"default-b",
		C:"default-c",
	}
	for _,fun:=range opts{
        fun(&options)
	}
}
//å¦‚æœæˆ‘ä»¬éœ€è¦æä¾›optioné€‰é¡¹,æ¯”æ–¹è¯´è®¾ç½®A
func WithA(a string) Option{
    return func(opt *OptionSet){
        opt.A=a
    }
}
// ä½¿ç”¨çš„æ—¶å€™
a=New(WithA("abc"))
```

## 11ã€è¿›ç¨‹é€€å‡º

```go
// è¿›ç¨‹æŒç»­è¿è¡Œ
	c := make(chan os.Signal, 1)
	signal.Notify(c, syscall.SIGTERM, syscall.SIGINT)
	s := <-c
	slog.Info("Aborting...", "signal", s)
	os.Exit(2)
```



## 12ã€å‡çº§Goç‰ˆæœ¬

å®˜æ–¹æ¨èæ–¹æ³•ç¤ºä¾‹

```shell
[sugar@Sugar ~]ğŸ³ go install golang.org/dl/go1.22.6@latest
go: downloading golang.org/dl v0.0.0-20240806160245-f9b8f0a29fb9
[sugar@Sugar ~]ğŸ³ go1.22.6 download
Downloaded   0.0% (   16384 / 67301095 bytes) ...
Downloaded   1.8% ( 1179648 / 67301095 bytes) ...
Downloaded   7.8% ( 5242880 / 67301095 bytes) ...
Downloaded  12.9% ( 8667136 / 67301095 bytes) ...
Downloaded  18.3% (12337136 / 67301095 bytes) ...
Downloaded  23.9% (16056304 / 67301095 bytes) ...
Downloaded  27.7% (18661344 / 67301095 bytes) ...
Downloaded  31.7% (21348352 / 67301095 bytes) ...
Downloaded  36.9% (24821744 / 67301095 bytes) ...
Downloaded  44.3% (29818880 / 67301095 bytes) ...
Downloaded  50.1% (33750880 / 67301095 bytes) ...
Downloaded  55.6% (37437424 / 67301095 bytes) ...
Downloaded  61.2% (41205680 / 67301095 bytes) ...
Downloaded  65.9% (44367568 / 67301095 bytes) ...
Downloaded  71.8% (48348944 / 67301095 bytes) ...
Downloaded  77.4% (52084672 / 67301095 bytes) ...
Downloaded  82.5% (55492320 / 67301095 bytes) ...
Downloaded  88.9% (59834080 / 67301095 bytes) ...
Downloaded  95.1% (63995424 / 67301095 bytes) ...
Downloaded 100.0% (67301095 / 67301095 bytes)
Unpacking /home/sugar/sdk/go1.22.6/go1.22.6.darwin-arm64.tar.gz ...
Success. You may now run 'go1.22.6'
[sugar@Sugar ~]ğŸ³ 
```

å®˜æ–¹æ¨èæ–¹æ³•ä¼šæŠŠå®‰è£…åŒ…ä¸‹è½½åˆ° `~/sdk`ï¼ŒGOPATH è®¾ç½®ä¸º ~/sdk/goï¼Œåšè½¯é“¾æ¥å³å¯æ–¹ä¾¿ä½¿ç”¨

```shell
[sugar@Sugar sdk]ğŸ³ ll
total 0
lrwxr-xr-x@  1 sugar  staff   27 Jul 24 09:43 go -> /home/sugar/sdk/go1.21.1
drwxr-xr-x  20 sugar  staff  640 Jul 22 20:57 go1.21.1
drwxr-xr-x@ 20 sugar  staff  640 Aug 11 13:07 go1.22.6
```

gvm shell ç®€å•ç‰ˆï¼Œæ”¾å…¥`bash_profile`ä¸­

```shell
gvm(){
MY_GO_VERSION=$1
cd "${HOME}"/sdk

[[ -d "${HOME}"/sdk/go${MY_GO_VERSION} ]] 
if [[ $? -ne 0 ]]; then 
    go install golang.org/dl/go${MY_GO_VERSION}@latest &>/dev/null
    go${MY_GO_VERSION} download   &>/dev/null
fi
ln -snf "${HOME}"/sdk/go${MY_GO_VERSION} "${HOME}"/sdk/go
}
```

```
[sugar@Sugar sdk]ğŸ³ gvm 1.22.3
[sugar@Sugar sdk]ğŸ³ go version
go version go1.22.3 darwin/arm64
[sugar@Sugar sdk]ğŸ³ gvm 1.22.6
[sugar@Sugar sdk]ğŸ³ go version
go version go1.22.6 darwin/arm64
[sugar@Sugar sdk]ğŸ³
```

