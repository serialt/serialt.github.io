<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>postgresql - Blog</title><meta name="Description" content="This is my cool site"><meta property="og:title" content="postgresql" />
<meta property="og:description" content="PostgreSQL ä¸€ã€å®‰è£… docker å®‰è£… # docker-compose.yaml version: &#34;3&#34; services: postgres10-5432: image: &#34;postgres:10-bullseye&#34; container_name: postgres10-5432 shm_size: &#34;1gb&#34; restart: always ports: - &#34;5432:5432&#34; volumes: - /data/postgresql:/var/lib/postgresql/data - $PWD/init.sql:/docker-entrypoint-initdb.d/init.sql environment: - POSTGRES_PASSWORD=xxxxxxxxxxx # init.sql CREATE USER db_user WITH CREATEDB ENCRYPTED PASSWORD &#39;xxxxxxxxxx&#39;; alter user db_user superuser; mac ### install # å®‰è£…æŒ‡å®šç‰ˆæœ¬éœ€è¦åŠ @,ä¾‹å¦‚ @14 brew install postgresql@14 # æŸ¥" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://serialt.github.io/posts/2023-11-12-postgresql/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-08-11T11:30:27+08:00" />
<meta property="article:modified_time" content="2024-08-11T11:30:27+08:00" /><meta property="og:site_name" content="Log" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="postgresql"/>
<meta name="twitter:description" content="PostgreSQL ä¸€ã€å®‰è£… docker å®‰è£… # docker-compose.yaml version: &#34;3&#34; services: postgres10-5432: image: &#34;postgres:10-bullseye&#34; container_name: postgres10-5432 shm_size: &#34;1gb&#34; restart: always ports: - &#34;5432:5432&#34; volumes: - /data/postgresql:/var/lib/postgresql/data - $PWD/init.sql:/docker-entrypoint-initdb.d/init.sql environment: - POSTGRES_PASSWORD=xxxxxxxxxxx # init.sql CREATE USER db_user WITH CREATEDB ENCRYPTED PASSWORD &#39;xxxxxxxxxx&#39;; alter user db_user superuser; mac ### install # å®‰è£…æŒ‡å®šç‰ˆæœ¬éœ€è¦åŠ @,ä¾‹å¦‚ @14 brew install postgresql@14 # æŸ¥"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://serialt.github.io/posts/2023-11-12-postgresql/" /><link rel="prev" href="https://serialt.github.io/posts/2023-11-11-go-basic/" /><link rel="next" href="https://serialt.github.io/posts/2024-08-11-containerd-exit/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "postgresql",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/serialt.github.io\/posts\/2023-11-12-postgresql\/"
        },"genre": "posts","keywords": "pg, postgresql, db","wordcount":  2715 ,
        "url": "https:\/\/serialt.github.io\/posts\/2023-11-12-postgresql\/","datePublished": "2024-08-11T11:30:27+08:00","dateModified": "2024-08-11T11:30:27+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "serialt"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Blog">è®°å½•</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ–‡ç«  </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Blog">è®°å½•</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ–‡ç« </a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">postgresql</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>serialt</a></span>&nbsp;<span class="post-category">included in <a href="/categories/database/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Database</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-08-11">2024-08-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2715 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€å®‰è£…">ä¸€ã€å®‰è£…</a></li>
    <li><a href="#äºŒé…ç½®">äºŒã€é…ç½®</a>
      <ul>
        <li><a href="#1ä¿®æ”¹æ•°æ®åº“æ—¶åŒº">1ã€ä¿®æ”¹æ•°æ®åº“æ—¶åŒº</a></li>
        <li><a href="#2sqlä½¿ç”¨">2ã€sqlä½¿ç”¨</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰ä»åº“é…ç½®">ä¸‰ã€ä»åº“é…ç½®</a>
      <ul>
        <li><a href="#1é…ç½®postgresqlä¸»èŠ‚ç‚¹">1ã€é…ç½®PostgreSQLä¸»èŠ‚ç‚¹</a></li>
        <li><a href="#2ä»èŠ‚ç‚¹ä¸Šæ“ä½œ">2ã€ä»èŠ‚ç‚¹ä¸Šæ“ä½œ</a></li>
        <li><a href="#3éªŒè¯">3ã€éªŒè¯</a></li>
        <li><a href="#4æŸ¥çœ‹ä¸»ä»å»¶è¿Ÿ">4ã€æŸ¥çœ‹ä¸»ä»å»¶è¿Ÿ</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="postgresql">PostgreSQL</h1>
<h2 id="ä¸€å®‰è£…">ä¸€ã€å®‰è£…</h2>
<p>docker å®‰è£…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># docker-compose.yaml</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>version: <span class="s2">&#34;3&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>services:<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>  postgres10-5432:<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    image: <span class="s2">&#34;postgres:10-bullseye&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    container_name: postgres10-5432<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    shm_size: <span class="s2">&#34;1gb&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    restart: always<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    ports:<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>      - <span class="s2">&#34;5432:5432&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    volumes:<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>      - /data/postgresql:/var/lib/postgresql/data<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>      - <span class="nv">$PWD</span>/init.sql:/docker-entrypoint-initdb.d/init.sql<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    environment:<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>      - <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>xxxxxxxxxxx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># init.sql</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>CREATE USER db_user WITH CREATEDB ENCRYPTED PASSWORD <span class="s1">&#39;xxxxxxxxxx&#39;</span><span class="p">;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>alter user db_user superuser<span class="p">;</span><span class="err">
</span></span></span></code></pre></div><p>mac</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">### install </span>
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…æŒ‡å®šç‰ˆæœ¬éœ€è¦åŠ @,ä¾‹å¦‚ @14</span>
</span></span><span class="line"><span class="cl">brew install postgresql@14
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹å®‰è£…çš„åŒ…</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>localhost@Sugar ~<span class="o">]</span>ğŸ³ brew <span class="nv">list</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Formulae
</span></span><span class="line"><span class="cl">icu4c		openssl@1.1	postgresql@10	readline
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹åŒ…å®‰è£…çš„ä½ç½®</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>localhost@Sugar ~<span class="o">]</span>ğŸ³ brew list postgresql@14
</span></span><span class="line"><span class="cl">/opt/homebrew/Cellar/postgresql@14/14.12/bin/clusterdb
</span></span><span class="line"><span class="cl">/opt/homebrew/Cellar/postgresql@14/14.12/bin/createdb
</span></span><span class="line"><span class="cl">/opt/homebrew/Cellar/postgresql@14/14.12/bin/createuser
</span></span><span class="line"><span class="cl">/opt/homebrew/Cellar/postgresql@14/14.12/bin/dropdb
</span></span><span class="line"><span class="cl">/opt/homebrew/Cellar/postgresql@14/14.12/bin/dropuser
</span></span><span class="line"><span class="cl">/opt/homebrew/Cellar/postgresql@14/14.12/bin/ecpg
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é…ç½®ç¯å¢ƒå˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PG_HOME</span><span class="o">=</span><span class="s2">&#34;/opt/homebrew/opt/postgresql@14&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PG_HOME</span>/bin:<span class="nv">$PATH</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ è½½ç¯å¢ƒå˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="nb">source</span> ~/.bash_profile
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### åˆå§‹åŒ–æ•°æ®åº“</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹ç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>localhost@Sugar ~<span class="o">]</span>ğŸ³ pg_ctl -V
</span></span><span class="line"><span class="cl">pg_ctl <span class="o">(</span>PostgreSQL<span class="o">)</span> 14.12 <span class="o">(</span>Homebrew<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆå§‹åŒ–æ•°æ®åº“</span>
</span></span><span class="line"><span class="cl">initdb --locale<span class="o">=</span>C -E UTF-8 /opt/homebrew/var/postgresql@14
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨æœåŠ¡</span>
</span></span><span class="line"><span class="cl">brew services start postgresql@14
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åœæ­¢æœåŠ¡</span>
</span></span><span class="line"><span class="cl">brew services start postgresql@14
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># éåå°å¯åŠ¨</span>
</span></span><span class="line"><span class="cl">/opt/homebrew/opt/postgresql@14/bin/postgres -D /opt/homebrew/var/postgresql@14
</span></span></code></pre></div><h2 id="äºŒé…ç½®">äºŒã€é…ç½®</h2>
<h3 id="1ä¿®æ”¹æ•°æ®åº“æ—¶åŒº">1ã€ä¿®æ”¹æ•°æ®åº“æ—¶åŒº</h3>
<pre tabindex="0"><code>postgres=# show timezone;
 TimeZone 
----------
 Etc/UTC
(1 row)


sed -i &#34;s+timezone = &#39;Etc/UTC&#39;+timezone = &#39;Asia/Shanghai&#34; postgresql.conf
sed -i &#34;s+log_timezone = &#39;Etc/UTC&#39;+log_timezone = &#39;Asia/Shanghai&#39;&#34; postgresql.conf


postgres=# select pg_reload_conf();
 pg_reload_conf 
----------------
 t
(1 row)


postgres=# show timezone;
   TimeZone    
---------------
 Asia/Shanghai
(1 row)
</code></pre><h3 id="2sqlä½¿ç”¨">2ã€sqlä½¿ç”¨</h3>
<p>æŸ¥è¯¢æ•°æ®åº“å¤§å°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">datname</span><span class="p">,</span><span class="w"> </span><span class="n">pg_size_pretty</span><span class="w"> </span><span class="p">(</span><span class="n">pg_database_size</span><span class="p">(</span><span class="n">datname</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pg_database</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">size</span><span class="p">;</span><span class="w"> 
</span></span></span></code></pre></div><p>æŸ¥çœ‹è¡¨å¤§å°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">--æ•°æ®åº“ä¸­å•ä¸ªè¡¨çš„å¤§å°ï¼ˆä¸åŒ…å«ç´¢å¼•ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_relation_size</span><span class="p">(</span><span class="s1">&#39;è¡¨å&#39;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--æŸ¥å‡ºæ‰€æœ‰è¡¨ï¼ˆåŒ…å«ç´¢å¼•ï¼‰å¹¶æ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">table_schema</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">table_full_name</span><span class="p">,</span><span class="w"> </span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="s1">&#39;&#34;&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">table_schema</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#34;.&#34;&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#34;&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">size</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="s1">&#39;&#34;&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">table_schema</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#34;.&#34;&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#34;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--æŸ¥å‡ºè¡¨å¤§å°æŒ‰å¤§å°æ’åºå¹¶åˆ†ç¦»dataä¸index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">table_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">table_size</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">table_size</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">indexes_size</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">indexes_size</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">total_size</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_size</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">table_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">pg_table_size</span><span class="p">(</span><span class="k">table_name</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">table_size</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">pg_indexes_size</span><span class="p">(</span><span class="k">table_name</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">indexes_size</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="k">table_name</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_size</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;&#34;&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">table_schema</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#34;.&#34;&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#34;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">table_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">all_tables</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">total_size</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">pretty_sizes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ä¿®æ”¹ç”¨æˆ·å¯†ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">postgres</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="s1">&#39;hello_world&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ä¿®æ”¹æ•°æ®åº“å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">alter</span><span class="w">  </span><span class="k">database</span><span class="w">  </span><span class="n">db1</span><span class="w">  </span><span class="k">rename</span><span class="w">  </span><span class="k">to</span><span class="w">  </span><span class="n">db2</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>schema ç®¡ç†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- åˆ›å»ºschema
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">create</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- æŸ¥çœ‹schema
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">\</span><span class="n">dn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ä¿®æ”¹schema å±ä¸»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">alter</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">owner</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">highgo</span><span class="p">;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ä¿®æ”¹schemaåç§°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">alter</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">rename</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">testa</span><span class="p">;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">create</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">authorization</span><span class="w"> </span><span class="n">highgo</span><span class="p">;;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- åˆ‡æ¢schema
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">set</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">test_schema</span><span class="w">
</span></span></span></code></pre></div><p>ä¿®æ”¹æ•°æ®åº“å</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- ä¿®æ”¹æ•°æ®åº“å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">alter</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">src_dbname</span><span class="w"> </span><span class="k">rename</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">dst_dbname</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- å°†æ•°æ®åº“çš„åç§°ç”±database2æ”¹æˆdatabase1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">pg_database</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">datname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;database1&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">datname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;database2&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æ…¢æŸ¥è¯¢é…ç½®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># postgresql.conf</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 10s</span>
</span></span><span class="line"><span class="cl"><span class="nv">log_min_duration_statement</span><span class="o">=</span><span class="m">10000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># çƒ­åŠ è½½é…ç½®</span>
</span></span><span class="line"><span class="cl"><span class="nv">postgres</span><span class="o">=</span><span class="c1"># select pg_reload_conf();</span>
</span></span><span class="line"><span class="cl"><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹é…ç½®ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="nv">postgres</span><span class="o">=</span><span class="c1"># show log_min_duration_statement;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">log_min_duration_statement
</span></span><span class="line"><span class="cl">----------------------------
</span></span><span class="line"><span class="cl">10s
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="m">1</span> row<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¹Ÿå¯ä»¥é’ˆå¯¹æŸä¸ªç”¨æˆ·æˆ–è€…æŸæ•°æ®åº“è¿›è¡Œè®¾ç½®ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="nv">postgres</span><span class="o">=</span><span class="c1"># alter database test set log_min_duration_statement=5000;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># sql æŸ¥è¯¢æ…¢è¯­å¥ï¼Œè¶…è¿‡1s</span>
</span></span><span class="line"><span class="cl"><span class="nv">postgres</span><span class="o">=</span><span class="c1"># select * from pg_stat_activity where state&lt;&gt;&#39;idle&#39; and now()-query_start &gt; interval &#39;1 s&#39; order by query_start;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">select</span> * from pg_stat_activity where state&lt;&gt;<span class="s1">&#39;idle&#39;</span> and now<span class="o">()</span>-query_start &gt; interval <span class="s1">&#39;5 s&#39;</span> order by query_start<span class="p">;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ–­å¼€æ•°æ®åº“è¿æ¥</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">select</span> pg_terminate_backend<span class="o">(</span>pid<span class="o">)</span> from <span class="o">(</span><span class="k">select</span> pid from pg_stat_activity where <span class="nv">datname</span> <span class="o">=</span> <span class="s1">&#39;db_name&#39;</span> <span class="o">)</span> as a<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ªæ•°æ®åº“å½’å±å…¶ä»–ç”¨æˆ·</span>
</span></span><span class="line"><span class="cl">create database <span class="s1">&#39;db_name&#39;</span> OWNER db_user<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹æ•°æ®åº“è¿æ¥æ•°</span>
</span></span><span class="line"><span class="cl"><span class="k">select</span> count<span class="o">(</span>*<span class="o">)</span> from pg_stat_activity<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">select</span> * from pg_stat_activity<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥è¯¢æ•°æ®åº“æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯100</span>
</span></span><span class="line"><span class="cl"><span class="nv">postgres</span><span class="o">=</span>&gt; show max_connections<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># docker éƒ¨ç½²åˆ°æ•°æ®åº“ä¿®æ”¹æœ€å¤§è¿æ¥æ•°</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¿›å…¥å®¹å™¨ï¼Œä¿®æ”¹æœ€å¤§è¿æ¥æ•°</span>
</span></span><span class="line"><span class="cl">root@ip142:~# docker <span class="nb">exec</span> -ti postgres10-5433 bash
</span></span><span class="line"><span class="cl">root@568a83e098a5:/# sed  -ri   <span class="s1">&#39;/max_connections/c max_connections = 2000&#39;</span> /var/lib/postgresql/data/postgresql.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># sql åŠ è½½é…ç½®</span>
</span></span><span class="line"><span class="cl"><span class="k">select</span> pg_reload_conf<span class="o">()</span><span class="p">;</span>
</span></span></code></pre></div><p>ç”¨æˆ·åªè¯»æƒé™è®¾ç½®ï¼šhttps://blog.csdn.net/qq_41018743/article/details/105492884</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- ä»¥super useråˆ›å»ºåªè¯»ç”¨æˆ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">readonly</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="s1">&#39;*****&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ä»¥super userè®¾ç½®ç”¨æˆ·é»˜è®¤äº‹åŠ¡åªè¯»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">alter</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">readonly</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">default_transaction_read_only</span><span class="o">=</span><span class="k">on</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ä½¿ç”¨æ•°æ®åº“çš„åˆ›å»ºæ‰€æœ‰è€…å»æ‰§è¡Œä»¥ä¸‹æ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1">-- å¢åŠ è¿æ¥æ•°æ®åº“æƒé™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">CONNECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">testDB</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">readonly</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- åˆ‡æ¢åˆ° testDB
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">\</span><span class="k">c</span><span class="w"> </span><span class="n">testDB</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- èµ‹äºˆç”¨æˆ·æƒé™è®¿é—®publicæ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">USAGE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">readonly</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- èµ‹äºˆè¡¨åºåˆ—æŸ¥çœ‹æƒé™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">SEQUENCES</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">readonly</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">TABLES</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">readonly</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- æ–°å¢åŠ çš„è¡¨éƒ½é»˜è®¤å¢åŠ æƒé™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">alter</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">privileges</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">grant</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">readonly</span><span class="p">;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- æ–°å¢åŠ çš„åºåˆ—éƒ½é»˜è®¤å¢åŠ æƒé™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">alter</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">privileges</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">grant</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">SEQUENCES</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">readonly</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h2 id="ä¸‰ä»åº“é…ç½®">ä¸‰ã€ä»åº“é…ç½®</h2>
<p>å‚è€ƒé“¾æ¥ï¼šhttps://help.aliyun.com/document_detail/53096.html</p>
<h3 id="1é…ç½®postgresqlä¸»èŠ‚ç‚¹">1ã€é…ç½®PostgreSQLä¸»èŠ‚ç‚¹</h3>
<p>1ï¼‰è¾“å…¥ä»¥ä¸‹SQLè¯­å¥åˆ›å»ºæ•°æ®åº“è´¦å·replicaï¼Œå¹¶è®¾ç½®å¯†ç åŠç™»å½•æƒé™å’Œå¤‡ä»½æƒé™ã€‚</p>
<p>æœ¬ç¤ºä¾‹ä¸­å°†å¯†ç è®¾ç½®ä¸º<code>replica</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">login</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="k">encrypted</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="s1">&#39;replica&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="n">login</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="k">encrypted</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="s1">&#39;rRweb9iojLxhVeWNddddddddddd&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>2ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<p><code>data/pg_hba.conf</code></p>
<p>åœ¨<code>IPv4 local connections</code>æ®µæ·»åŠ ä¸‹é¢ä¸¤è¡Œå†…å®¹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">host</span>    <span class="nb">all</span>             <span class="nb">all</span>             <span class="o">&lt;</span><span class="n">ä»èŠ‚ç‚¹çš„VPC</span> <span class="n">IPv4ç½‘æ®µ</span><span class="o">&gt;</span>          <span class="n">md5</span>     <span class="c1">#å…è®¸VPCç½‘æ®µä¸­md5å¯†ç è®¤è¯è¿æ¥</span>
</span></span><span class="line"><span class="cl"><span class="n">host</span>    <span class="n">replication</span>     <span class="n">replica</span>         <span class="o">&lt;</span><span class="n">ä»èŠ‚ç‚¹çš„VPC</span> <span class="n">IPv4ç½‘æ®µ</span><span class="o">&gt;</span>          <span class="n">md5</span>     <span class="c1">#å…è®¸ç”¨æˆ·ä»replicationæ•°æ®åº“è¿›è¡Œæ•°æ®åŒæ­¥</span>
</span></span></code></pre></div><p><code>postgresql.conf</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">listen_addresses</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>   <span class="c1">#ç›‘å¬çš„IPåœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="nv">wal_level</span> <span class="o">=</span> hot_standby  <span class="c1">#å¯ç”¨çƒ­å¤‡æ¨¡å¼</span>
</span></span><span class="line"><span class="cl"><span class="nv">synchronous_commit</span> <span class="o">=</span> on  <span class="c1">#å¼€å¯åŒæ­¥å¤åˆ¶</span>
</span></span><span class="line"><span class="cl"><span class="nv">max_wal_senders</span> <span class="o">=</span> <span class="m">32</span>     <span class="c1">#åŒæ­¥æœ€å¤§çš„è¿›ç¨‹æ•°é‡</span>
</span></span><span class="line"><span class="cl"><span class="nv">wal_sender_timeout</span> <span class="o">=</span> 60s <span class="c1">#æµå¤åˆ¶ä¸»æœºå‘é€æ•°æ®çš„è¶…æ—¶æ—¶é—´</span>
</span></span><span class="line"><span class="cl"><span class="nv">max_connections</span> <span class="o">=</span> <span class="m">100</span>    <span class="c1">#æœ€å¤§è¿æ¥æ•°ï¼Œä»åº“çš„max_connectionså¿…é¡»è¦å¤§äºä¸»åº“çš„</span>
</span></span></code></pre></div><p>ä¿®æ”¹å®Œåé‡å¯æœåŠ¡</p>
<h3 id="2ä»èŠ‚ç‚¹ä¸Šæ“ä½œ">2ã€ä»èŠ‚ç‚¹ä¸Šæ“ä½œ</h3>
<p>å‚è€ƒé“¾æ¥ï¼šhttps://blog.51cto.com/u_13482808/6875114</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pg_basebackup --help 
</span></span><span class="line"><span class="cl">ç”¨æ³•ï¼š
</span></span><span class="line"><span class="cl">  pg_basebackup <span class="o">[</span>é€‰é¡¹<span class="o">]</span> ...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ§åˆ¶è¾“å‡ºçš„é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">  -D, --pgdata<span class="o">=</span>DIRECTORY æ¥æ”¶åŸºæœ¬å¤‡ä»½åˆ°ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º
</span></span><span class="line"><span class="cl">  -F, --format<span class="o">=</span>p<span class="p">|</span>t       è¾“å‡ºæ ¼å¼ï¼ˆplain,ç›´æ¥æ‹·è´æ•°æ®æ–‡ä»¶ï¼Œtar é…åˆ -z -Z è¿›è¡Œæ‰“åŒ…å‹ç¼©ï¼‰
</span></span><span class="line"><span class="cl">  -r, --max-rate<span class="o">=</span>RATE         ä¼ è¾“æ•°æ®ç›®å½•çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼ˆä»¥ kB/s ä¸ºå•ä½ï¼Œæˆ–ä½¿ç”¨åç¼€â€œkâ€æˆ–â€œMâ€ï¼‰
</span></span><span class="line"><span class="cl">  -R,--write-recovery-conf æ˜¯å¦è¾“å‡ºrecovery-confæ–‡ä»¶ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨å¤‡ä»½å¿«é€Ÿæ­å»ºå‡ºä»èŠ‚ç‚¹
</span></span><span class="line"><span class="cl">  -T, --tablespace-mapping<span class="o">=</span><span class="nv">OLDDIR</span><span class="o">=</span>NEWDIR å°† OLDDIR ä¸­çš„è¡¨ç©ºé—´é‡å®šä½åˆ° NEWDIR
</span></span><span class="line"><span class="cl">      --waldir<span class="o">=</span>WALDIR             é¢„å†™æ—¥å¿—ç›®å½•çš„ä½ç½®
</span></span><span class="line"><span class="cl">  -X, --wal-method<span class="o">=</span>none<span class="p">|</span>fetch<span class="p">|</span>stream åŒ…å«æŒ‡å®šæ–¹æ³•æ‰€éœ€çš„ WAL æ–‡ä»¶
</span></span><span class="line"><span class="cl">  -z, --gzip                   å‹ç¼© tar è¾“å‡º
</span></span><span class="line"><span class="cl">  -Z, --compress<span class="o">=</span>0-9    ä½¿ç”¨ç»™å®šçš„å‹ç¼©çº§åˆ«å‹ç¼© tar è¾“å‡º
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å¸¸è§„é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">  -c, --checkpoint<span class="o">=</span>fast<span class="p">|</span>spread è®¾ç½®å¿«é€Ÿæˆ–æ‰©å±•æ£€æŸ¥ç‚¹
</span></span><span class="line"><span class="cl">  -C, --create-slot   åˆ›å»ºå¤åˆ¶æ§½
</span></span><span class="line"><span class="cl">  -l, --label<span class="o">=</span>LABEL  è®¾ç½®å¤‡ä»½æ ‡ç­¾
</span></span><span class="line"><span class="cl">  -n, --no-clean     å‡ºé”™åä¸æ¸…ç†
</span></span><span class="line"><span class="cl">  -N, --no-sync     ä¸ç­‰å¾…æ›´æ”¹å®‰å…¨å†™å…¥ç£ç›˜
</span></span><span class="line"><span class="cl">  -P, --progress    æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯
</span></span><span class="line"><span class="cl">  -S, --slot<span class="o">=</span>SLOTNAME è¦ä½¿ç”¨çš„å¤åˆ¶æ§½
</span></span><span class="line"><span class="cl">  -v, --verbose è¾“å‡ºè¯¦ç»†ä¿¡æ¯
</span></span><span class="line"><span class="cl">  -V, --version è¾“å‡ºç‰ˆæœ¬ä¿¡æ¯ï¼Œç„¶åé€€å‡º
</span></span><span class="line"><span class="cl">      --no-slot é˜²æ­¢åˆ›å»ºä¸´æ—¶å¤åˆ¶æ§½
</span></span><span class="line"><span class="cl">      --no-verify-checksums ä¸éªŒè¯æ ¡éªŒå’Œ
</span></span><span class="line"><span class="cl">  -?, --help æ˜¾ç¤ºæ­¤å¸®åŠ©ï¼Œç„¶åé€€å‡º
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¿æ¥é€‰é¡¹ï¼š
</span></span><span class="line"><span class="cl">  -d, --dbname  æ•°æ®åº“åç§°
</span></span><span class="line"><span class="cl">  -h, --host      æ•°æ®åº“æœåŠ¡å™¨ä¸»æœºipæˆ–å¥—æ¥å­—ç›®å½•
</span></span><span class="line"><span class="cl">  -p, --port      æ•°æ®åº“å£å·
</span></span><span class="line"><span class="cl">  -s, --status-interval<span class="o">=</span>çŠ¶æ€åŒ…å‘é€åˆ°æœåŠ¡å™¨çš„é—´éš”æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰
</span></span><span class="line"><span class="cl">  -U, --username è¿æ¥ç”¨æˆ·ï¼Œè¦æœ‰superæƒé™
</span></span><span class="line"><span class="cl">  -w, --no-password ä»ä¸æç¤ºè¾“å…¥å¯†ç 
</span></span></code></pre></div><p>1ï¼‰å¤‡ä»½æ•°æ®</p>
<p>ä½¿ç”¨pg_basebackupåŸºç¡€å¤‡ä»½å·¥å…·æŒ‡å®šå¤‡ä»½ç›®å½•ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#ä¿æŒpg dataç›®å½•æ ¼å¼</span>
</span></span><span class="line"><span class="cl">pg_basebackup -h 192.168.1.1 -p <span class="m">5432</span> -U replica -D /data/test -cfast -Xs -Pv
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è‡ªåŠ¨åˆ›å»ºrecovery.conf </span>
</span></span><span class="line"><span class="cl">pg_basebackup -h 192.168.1.1 -p <span class="m">5432</span> -U replica -D /data/test -cfast -Xs -Pv -R
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰“åŒ…æˆtaræ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">pg_basebackup -h 192.168.1.1 -p <span class="m">5432</span> -U replica -D /data/test -cfast -Xs -Pv -Ft
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰“åŒ…æˆtar.gzæ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">pg_basebackup -h 192.168.1.1 -p <span class="m">5432</span> -U replica -D /data/test -cfast -Xs -Pv -Ft -z 
</span></span></code></pre></div><p>æ–°å»ºå¹¶ä¿®æ”¹recovery.confé…ç½®æ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vim /var/lib/pgsql/11/data/recovery.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">####åˆ†åˆ«æ‰¾åˆ°ä»¥ä¸‹å‚æ•°ï¼Œå¹¶å°†å‚æ•°ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="nv">standby_mode</span> <span class="o">=</span> on     <span class="c1">#å£°æ˜æ­¤èŠ‚ç‚¹ä¸ºä»åº“</span>
</span></span><span class="line"><span class="cl"><span class="nv">primary_conninfo</span> <span class="o">=</span> <span class="s1">&#39;host=&lt;ä¸»èŠ‚ç‚¹IP&gt; port=5432 user=replica password=replica&#39;</span> <span class="c1">#å¯¹åº”ä¸»åº“çš„è¿æ¥ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl"><span class="nv">recovery_target_timeline</span> <span class="o">=</span> <span class="s1">&#39;latest&#39;</span> <span class="c1">#æµå¤åˆ¶åŒæ­¥åˆ°æœ€æ–°çš„æ•°æ®</span>
</span></span></code></pre></div><p>ä¿®æ”¹postgresql.confæ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">max_connections</span> <span class="o">=</span> <span class="m">1000</span>             <span class="c1"># æœ€å¤§è¿æ¥æ•°ï¼Œä»èŠ‚ç‚¹éœ€è®¾ç½®æ¯”ä¸»èŠ‚ç‚¹å¤§</span>
</span></span><span class="line"><span class="cl"><span class="nv">hot_standby</span> <span class="o">=</span> on                   <span class="c1"># å¼€å¯çƒ­å¤‡</span>
</span></span><span class="line"><span class="cl"><span class="nv">max_standby_streaming_delay</span> <span class="o">=</span> 30s  <span class="c1"># æ•°æ®æµå¤‡ä»½çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´</span>
</span></span><span class="line"><span class="cl"><span class="nv">wal_receiver_status_interval</span> <span class="o">=</span> 5s  <span class="c1"># ä»èŠ‚ç‚¹å‘ä¸»èŠ‚ç‚¹æŠ¥å‘Šè‡ªèº«çŠ¶æ€çš„æœ€é•¿é—´éš”æ—¶é—´</span>
</span></span><span class="line"><span class="cl"><span class="nv">hot_standby_feedback</span> <span class="o">=</span> on          <span class="c1"># å¦‚æœæœ‰é”™è¯¯çš„æ•°æ®å¤åˆ¶å‘ä¸»è¿›è¡Œåé¦ˆ</span>
</span></span></code></pre></div><p>ä¿®æ”¹æ•°æ®ç›®å½•çš„æƒé™</p>
<pre tabindex="0"><code>chown -R postgres.postgres /var/lib/pgsql/11/data
</code></pre><p>å¯åŠ¨æœåŠ¡</p>
<h3 id="3éªŒè¯">3ã€éªŒè¯</h3>
<p>1ï¼‰åœ¨ä¸»èŠ‚ç‚¹ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹senderè¿›ç¨‹ã€‚</p>
<pre tabindex="0"><code class="language-undefined" data-lang="undefined">ps aux |grep sender
</code></pre><p>è¿”å›ç»“æœå¦‚ä¸‹ï¼Œè¡¨ç¤ºå¯æˆåŠŸæŸ¥çœ‹åˆ°senderè¿›ç¨‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">postgres  2916  0.0  0.3 340388  3220 ?        Ss   15:38   0:00 postgres</span><span class="p">:</span><span class="w"> </span><span class="l">wal sender     process replica 192.168.**.**(49640) streaming 0/F01C1A8</span><span class="w">
</span></span></span></code></pre></div><p>2ï¼‰åœ¨ä»èŠ‚ç‚¹ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹receiverè¿›ç¨‹ã€‚</p>
<pre tabindex="0"><code class="language-undefined" data-lang="undefined">ps aux |grep receiver
</code></pre><p>è¿”å›ç»“æœå¦‚ä¸‹ï¼Œè¡¨ç¤ºå¯æˆåŠŸæŸ¥çœ‹åˆ°receiverè¿›ç¨‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">postgres 23284  0.0  0.3 387100  3444 ?        Ss   16:04   0:00 postgres</span><span class="p">:</span><span class="w"> </span><span class="l">wal receiver process   streaming 0/F01C1A8</span><span class="w">
</span></span></span></code></pre></div><p>3ï¼‰åœ¨ä¸»èŠ‚ç‚¹ä¸­è¿›å…¥PostgreSQLäº¤äº’ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹SQLè¯­å¥ï¼Œåœ¨ä¸»åº“ä¸­æŸ¥çœ‹ä»åº“çŠ¶æ€ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pg_stat_replication</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>è¿”å›ç»“æœå¦‚ä¸‹ï¼Œè¡¨ç¤ºå¯æˆåŠŸæŸ¥çœ‹åˆ°ä»åº“çŠ¶æ€ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">pid</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">usesysid</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">usename</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">application_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">client_addr</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">client_hostname</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">client_port</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">backend_start</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">backend_xmin</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sent_location</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">write_locati</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">on</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">flush_location</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">replay_location</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sync_priority</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sync_state</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">------+----------+---------+------------------+---------------+-----------------+------------- +-------------------------------+--------------+-----------+---------------+-------------
</span></span></span><span class="line"><span class="cl"><span class="c1">---+----------------+-----------------+---------------+------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">2916</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">16393</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">walreceiver</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="o">**</span><span class="p">.</span><span class="o">**</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">49640</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">02</span><span class="w"> </span><span class="mi">15</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">06</span><span class="p">.</span><span class="mi">188988</span><span class="o">+</span><span class="mi">08</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1836</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">streaming</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="o">/</span><span class="n">F01C0C8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="o">/</span><span class="n">F01C0C8</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="o">/</span><span class="n">F01C0C8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="o">/</span><span class="n">F01C0C8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">async</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><h3 id="4æŸ¥çœ‹ä¸»ä»å»¶è¿Ÿ">4ã€æŸ¥çœ‹ä¸»ä»å»¶è¿Ÿ</h3>
<p>å¦‚æœä¸»åº“æ²¡æœ‰æ’å…¥æˆ–è€…ä¿®æ”¹çš„æ•°æ®çš„sqlæ‰§è¡Œï¼Œä¸»ä»åŒæ­¥çš„å»¶æ—¶ä¼šé€æ¸å¢åŠ </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pg_last_xact_replay_timestamp</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">replication_delay</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-08-11</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/pg/">pg</a>,&nbsp;<a href="/tags/postgresql/">postgresql</a>,&nbsp;<a href="/tags/db/">db</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/2023-11-11-go-basic/" class="prev" rel="prev" title="Go basic"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Go basic</a>
            <a href="/posts/2024-08-11-containerd-exit/" class="next" rel="next" title="containerd-exit-code">containerd-exit-code<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">serialt</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":80},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
