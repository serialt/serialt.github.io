<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Go gopsutil - Blog</title><meta name="Description" content="This is my cool site"><meta property="og:title" content="Go gopsutil" />
<meta property="og:description" content="gopsutil 库 参考链接：https://segmentfault.com/a/1190000022281174 简介 gopsutil是 Python 工具库psuti" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://serialt.github.io/posts/2023-11-11-gopsutil/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-11T10:25:07+08:00" />
<meta property="article:modified_time" content="2023-11-11T10:25:07+08:00" /><meta property="og:site_name" content="Log" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go gopsutil"/>
<meta name="twitter:description" content="gopsutil 库 参考链接：https://segmentfault.com/a/1190000022281174 简介 gopsutil是 Python 工具库psuti"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://serialt.github.io/posts/2023-11-11-gopsutil/" /><link rel="prev" href="https://serialt.github.io/posts/2023-11-11-go-yaml/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Go gopsutil",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/serialt.github.io\/posts\/2023-11-11-gopsutil\/"
        },"genre": "posts","keywords": "Go, gopsutil","wordcount":  4346 ,
        "url": "https:\/\/serialt.github.io\/posts\/2023-11-11-gopsutil\/","datePublished": "2023-11-11T10:25:07+08:00","dateModified": "2023-11-11T10:25:07+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "serialt"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Blog">记录</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Blog">记录</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Go gopsutil</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>serialt</a></span>&nbsp;<span class="post-category">included in <a href="/categories/go-%E5%BA%93%E6%96%87%E6%A1%A3/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Go 库文档</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-11-11">2023-11-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;4346 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;9 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#gopsutil-库">gopsutil 库</a>
      <ul>
        <li><a href="#简介">简介</a></li>
        <li><a href="#快速使用">快速使用</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="gopsutil-库">gopsutil 库</h2>
<p>参考链接：https://segmentfault.com/a/1190000022281174</p>
<h3 id="简介">简介</h3>
<p><code>gopsutil</code>是 Python 工具库<a href="https://link.segmentfault.com/?enc=n5Wd68NqJlwR6lZAlSQpng%3D%3D.FJUs2%2BFqfg4yoRRdsZW6P%2Bi%2F225n%2BHjOnrpbb9iPd%2FtBIDXHrW%2BUoSa17tzUX3VZ" target="_blank" rel="noopener noreffer "><code>psutil</code></a> 的 Golang 移植版，可以帮助我们方便地获取各种系统和硬件信息。<code>gopsutil</code>为我们屏蔽了各个系统之间的差异，具有非常强悍的可移植性。有了<code>gopsutil</code>，我们不再需要针对不同的系统使用<code>syscall</code>调用对应的系统方法。更棒的是<code>gopsutil</code>的实现中没有任何<code>cgo</code>的代码，使得交叉编译成为可能。</p>
<h3 id="快速使用">快速使用</h3>
<p>安装</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">go</span> <span class="nx">get</span> <span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">shirou</span><span class="o">/</span><span class="nx">gopsutil</span>
</span></span></code></pre></div><p>使用</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="s">&#34;github.com/shirou/gopsutil/mem&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">v</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">mem</span><span class="p">.</span><span class="nf">VirtualMemory</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Total: %v, Available: %v, UsedPercent:%f%%\n&#34;</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Total</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Available</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">UsedPercent</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>gopsutil</code>将不同的功能划分到不同的子包中：</p>
<ul>
<li><code>cpu</code>：CPU 相关；</li>
<li><code>disk</code>：磁盘相关；</li>
<li><code>docker</code>：docker 相关；</li>
<li><code>host</code>：主机相关；</li>
<li><code>mem</code>：内存相关；</li>
<li><code>net</code>：网络相关；</li>
<li><code>process</code>：进程相关；</li>
<li><code>winservices</code>：Windows 服务相关。</li>
</ul>
<p>想要使用对应的功能，要导入对应的子包。例如，上面代码中，我们要获取内存信息，导入的是<code>mem</code>子包。<code>mem.VirtualMemory()</code>方法返回内存信息结构<code>mem.VirtualMemoryStat</code>，该结构有丰富的字段，我们最常使用的无外乎<code>Total</code>（总内存）、<code>Available</code>（可用内存）、<code>Used</code>（已使用内存）和<code>UsedPercent</code>（内存使用百分比）。<code>mem.VirtualMemoryStat</code>还实现了<code>fmt.Stringer</code>接口，以 JSON 格式返回内存信息。语句<code>fmt.Println(v)</code>会自动调用<code>v.String()</code>，将返回信息输出。程序输出：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">Total:</span> <span class="mi">8526921728</span><span class="err">,</span> <span class="err">Available:</span> <span class="mi">3768975360</span><span class="err">,</span> <span class="err">UsedPercent:</span><span class="mf">55.000000</span><span class="err">%</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;total&#34;</span><span class="p">:</span><span class="mi">8526921728</span><span class="p">,</span><span class="nt">&#34;available&#34;</span><span class="p">:</span><span class="mi">3768975360</span><span class="p">,</span><span class="nt">&#34;used&#34;</span><span class="p">:</span><span class="mi">4757946368</span><span class="p">,</span><span class="nt">&#34;usedPercent&#34;</span><span class="p">:</span><span class="mi">55</span><span class="p">,</span><span class="nt">&#34;free&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;active&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;inactive&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;wired&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;laundry&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;buffers&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;cached&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;writeback&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;dirty&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;writebacktmp&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;shared&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;slab&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;sreclaimable&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;sunreclaim&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;pagetables&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;swapcached&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;commitlimit&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;committedas&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;hightotal&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;highfree&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;lowtotal&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;lowfree&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;swaptotal&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;swapfree&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;mapped&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;vmalloctotal&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;vmallocused&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;vmallocchunk&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;hugepagestotal&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;hugepagesfree&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&#34;hugepagesize&#34;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span></span></code></pre></div><p>单位为字节，我的电脑内存 8GB，当前使用百分比为 55%，可用内存 3768975360B（即 3.51GB）。</p>
<h4 id="cpu">CPU</h4>
<p>我们知道 CPU 的核数有两种，一种是物理核数，一种是逻辑核数。物理核数就是主板上实际有多少个 CPU，一个物理 CPU 上可以有多个核心，这些核心被称为逻辑核。<code>gopsutil</code>中 CPU 相关功能在<code>cpu</code>子包中，<code>cpu</code>子包提供了获取物理和逻辑核数、CPU 使用率的接口：</p>
<ul>
<li><code>Counts(logical bool)</code>：传入<code>false</code>，返回物理核数，传入<code>true</code>，返回逻辑核数；</li>
<li><code>Percent(interval time.Duration, percpu bool)</code>：表示获取<code>interval</code>时间间隔内的 CPU 使用率，<code>percpu</code>为<code>false</code>时，获取总的 CPU 使用率，<code>percpu</code>为<code>true</code>时，分别获取每个 CPU 的使用率，返回一个<code>[]float64</code>类型的值。</li>
</ul>
<p>例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">physicalCnt</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Counts</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">logicalCnt</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Counts</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;physical count:%d logical count:%d\n&#34;</span><span class="p">,</span> <span class="nx">physicalCnt</span><span class="p">,</span> <span class="nx">logicalCnt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">totalPercent</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Percent</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">perPercents</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Percent</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;total percent:%v per percents:%v&#34;</span><span class="p">,</span> <span class="nx">totalPercent</span><span class="p">,</span> <span class="nx">perPercents</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>上面代码获取物理核数和逻辑核数，并获取 3s 内的总 CPU 使用率和每个 CPU 各自的使用率，程序输出（注意每次运行输出可能都不相同）：</p>
<pre tabindex="0"><code>physical count:4 logical count:8
total percent:[30.729166666666668] per percents:[32.64248704663213 26.94300518134715 44.559585492227974 23.958333333333336 36.787564766839374 20.3125 38.54166666666667 28.125]
</code></pre><h5 id="详细信息调用cpuinfo可获取-cpu-的详细信息返回cpuinfostat">详细信息调用<code>cpu.Info()</code>可获取 CPU 的详细信息，返回<code>[]cpu.InfoStat</code>：</h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">infos</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Info</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">info</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">infos</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">info</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>为了方便查看，我使用 JSON 输出结果：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;cpu&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;vendorId&#34;</span><span class="p">:</span> <span class="s">&#34;GenuineIntel&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;family&#34;</span><span class="p">:</span> <span class="s">&#34;198&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;model&#34;</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;stepping&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;physicalId&#34;</span><span class="p">:</span> <span class="s">&#34;BFEBFBFF000906E9&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;coreId&#34;</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;cores&#34;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;modelName&#34;</span><span class="p">:</span> <span class="s">&#34;Intel(R) Core(TM) i7-7700 CPU @ 3.60GHz&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;mhz&#34;</span><span class="p">:</span> <span class="mi">3601</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;cacheSize&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;flags&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;microcode&#34;</span><span class="p">:</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>由结果可以看出，CPU 是 Intel 的 i7-7700 系列，频率 3.60GHz。上面是我在 Windows 上运行的返回结果，内部使用了<code>github.com/StackExchange/wmi</code>库。在 Linux 下每个逻辑 CPU 都会返回一个<code>InfoStat</code>结构。</p>
<h4 id="时间占用">时间占用</h4>
<p>调用<code>cpu.Times(percpu bool)</code>可以获取从开机算起，总 CPU 和 每个单独的 CPU 时间占用情况。传入<code>percpu=false</code>返回总的，传入<code>percpu=true</code>返回单个的。每个 CPU 时间占用情况是一个<code>TimeStat</code>结构：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// src/github.com/shirou/gopsutil/cpu/cpu.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">TimesStat</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">CPU</span>       <span class="kt">string</span>  <span class="s">`json:&#34;cpu&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">User</span>      <span class="kt">float64</span> <span class="s">`json:&#34;user&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">System</span>    <span class="kt">float64</span> <span class="s">`json:&#34;system&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Idle</span>      <span class="kt">float64</span> <span class="s">`json:&#34;idle&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Nice</span>      <span class="kt">float64</span> <span class="s">`json:&#34;nice&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Iowait</span>    <span class="kt">float64</span> <span class="s">`json:&#34;iowait&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Irq</span>       <span class="kt">float64</span> <span class="s">`json:&#34;irq&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Softirq</span>   <span class="kt">float64</span> <span class="s">`json:&#34;softirq&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Steal</span>     <span class="kt">float64</span> <span class="s">`json:&#34;steal&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Guest</span>     <span class="kt">float64</span> <span class="s">`json:&#34;guest&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">GuestNice</span> <span class="kt">float64</span> <span class="s">`json:&#34;guestNice&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>CPU</code>：CPU 标识，如果是总的，该字段为<code>cpu-total</code>，否则为<code>cpu0</code>、<code>cpu1</code>&hellip;；</li>
<li><code>User</code>：用户时间占用（用户态）；</li>
<li><code>System</code>：系统时间占用（内核态）；</li>
<li><code>Idle</code>：空闲时间；</li>
<li>&hellip;</li>
</ul>
<p>例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">infos</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cpu</span><span class="p">.</span><span class="nf">Times</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">info</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">infos</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">info</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>为了方便查看，我用 JSON 输出结果，下面是其中一个输出：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;cpu&#34;</span><span class="p">:</span> <span class="s">&#34;cpu0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;user&#34;</span><span class="p">:</span> <span class="mf">674.46875</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;system&#34;</span><span class="p">:</span> <span class="mf">1184.984375</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;idle&#34;</span><span class="p">:</span> <span class="mf">7497.1875</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;nice&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;iowait&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;irq&#34;</span><span class="p">:</span> <span class="mf">75.578125</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;softirq&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;steal&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;guest&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;guestNice&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="磁盘">磁盘</h4>
<p>子包<code>disk</code>用于获取磁盘信息。<code>disk</code>可获取 IO 统计、分区和使用率信息。下面依次介绍。</p>
<h5 id="io-统计">IO 统计</h5>
<p>调用<code>disk.IOCounters()</code>函数，返回的 IO 统计信息用<code>map[string]IOCountersStat</code>类型表示。每个分区一个结构，键为分区名，值为统计信息。这里摘取统计结构的部分字段，主要有读写的次数、字节数和时间：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// src/github.com/shirou/gopsutil/disk/disk.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">IOCountersStat</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ReadCount</span>        <span class="kt">uint64</span> <span class="s">`json:&#34;readCount&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">MergedReadCount</span>  <span class="kt">uint64</span> <span class="s">`json:&#34;mergedReadCount&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">WriteCount</span>       <span class="kt">uint64</span> <span class="s">`json:&#34;writeCount&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">MergedWriteCount</span> <span class="kt">uint64</span> <span class="s">`json:&#34;mergedWriteCount&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ReadBytes</span>        <span class="kt">uint64</span> <span class="s">`json:&#34;readBytes&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">WriteBytes</span>       <span class="kt">uint64</span> <span class="s">`json:&#34;writeBytes&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ReadTime</span>         <span class="kt">uint64</span> <span class="s">`json:&#34;readTime&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">WriteTime</span>        <span class="kt">uint64</span> <span class="s">`json:&#34;writeTime&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mapStat</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">disk</span><span class="p">.</span><span class="nf">IOCounters</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">stat</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">mapStat</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">stat</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;  &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>输出包括所有分区，我这里只展示一个：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">C</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;readCount&#34;</span><span class="p">:</span> <span class="mi">184372</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;mergedReadCount&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;writeCount&#34;</span><span class="p">:</span> <span class="mi">42252</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;mergedWriteCount&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;readBytes&#34;</span><span class="p">:</span> <span class="mi">5205152768</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;writeBytes&#34;</span><span class="p">:</span> <span class="mi">701583872</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;readTime&#34;</span><span class="p">:</span> <span class="mi">333</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;writeTime&#34;</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;iopsInProgress&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;ioTime&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;weightedIO&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;C:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;serialNumber&#34;</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;label&#34;</span><span class="p">:</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>注意，<code>disk.IOCounters()</code>可传入可变数量的字符串参数用于标识分区，<strong>此参数在 Windows 上无效</strong>。</p>
<h5 id="分区">分区</h5>
<p>调用<code>disk.PartitionStat(all bool)</code>函数，返回分区信息。如果<code>all = false</code>，只返回实际的物理分区（包括硬盘、CD-ROM、USB），忽略其它的虚拟分区。如果<code>all = true</code>则返回所有的分区。返回类型为<code>[]PartitionStat</code>，每个分区对应一个<code>PartitionStat</code>结构：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// src/github.com/shirou/gopsutil/disk/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">PartitionStat</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Device</span>     <span class="kt">string</span> <span class="s">`json:&#34;device&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Mountpoint</span> <span class="kt">string</span> <span class="s">`json:&#34;mountpoint&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Fstype</span>     <span class="kt">string</span> <span class="s">`json:&#34;fstype&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Opts</span>       <span class="kt">string</span> <span class="s">`json:&#34;opts&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>Device</code>：分区标识，在 Windows 上即为<code>C:</code>这类格式；</li>
<li><code>Mountpoint</code>：挂载点，即该分区的文件路径起始位置；</li>
<li><code>Fstype</code>：文件系统类型，Windows 常用的有 FAT、NTFS 等，Linux 有 ext、ext2、ext3等；</li>
<li><code>Opts</code>：选项，与系统相关。</li>
</ul>
<p>例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">infos</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">disk</span><span class="p">.</span><span class="nf">Partitions</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">info</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">infos</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">info</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;  &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>我的 Windows 机器输出（只展示第一个分区）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;device&#34;</span><span class="p">:</span> <span class="s">&#34;C:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;mountpoint&#34;</span><span class="p">:</span> <span class="s">&#34;C:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;fstype&#34;</span><span class="p">:</span> <span class="s">&#34;NTFS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;opts&#34;</span><span class="p">:</span> <span class="s">&#34;rw.compress&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>由上面的输出可知，我的第一个分区为<code>C:</code>，文件系统类型为<code>NTFS</code>。</p>
<h5 id="使用率">使用率</h5>
<p>调用<code>disk.Usage(path string)</code>即可获得路径<code>path</code>所在磁盘的使用情况，返回一个<code>UsageStat</code>结构：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// src/github.com/shirou/gopsutil/disk.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">UsageStat</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Path</span>              <span class="kt">string</span>  <span class="s">`json:&#34;path&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Fstype</span>            <span class="kt">string</span>  <span class="s">`json:&#34;fstype&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Total</span>             <span class="kt">uint64</span>  <span class="s">`json:&#34;total&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Free</span>              <span class="kt">uint64</span>  <span class="s">`json:&#34;free&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Used</span>              <span class="kt">uint64</span>  <span class="s">`json:&#34;used&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">UsedPercent</span>       <span class="kt">float64</span> <span class="s">`json:&#34;usedPercent&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">InodesTotal</span>       <span class="kt">uint64</span>  <span class="s">`json:&#34;inodesTotal&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">InodesUsed</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;inodesUsed&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">InodesFree</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;inodesFree&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">InodesUsedPercent</span> <span class="kt">float64</span> <span class="s">`json:&#34;inodesUsedPercent&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>Path</code>：路径，传入的参数；</li>
<li><code>Fstype</code>：文件系统类型；</li>
<li><code>Total</code>：该分区总容量；</li>
<li><code>Free</code>：空闲容量；</li>
<li><code>Used</code>：已使用的容量；</li>
<li><code>UsedPercent</code>：使用百分比。</li>
</ul>
<p>例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">info</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">disk</span><span class="p">.</span><span class="nf">Usage</span><span class="p">(</span><span class="s">&#34;D:/code/golang&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">info</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;  &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>由于返回的是磁盘的使用情况，所以路径<code>D:/code/golang</code>和<code>D:</code>返回同样的结果，只是结构中的<code>Path</code>字段不同而已。程序输出：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;path&#34;</span><span class="p">:</span> <span class="s">&#34;D:/code/golang&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;fstype&#34;</span><span class="p">:</span> <span class="s">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;total&#34;</span><span class="p">:</span> <span class="mi">475779821568</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;free&#34;</span><span class="p">:</span> <span class="mi">385225650176</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;used&#34;</span><span class="p">:</span> <span class="mi">90554171392</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;usedPercent&#34;</span><span class="p">:</span> <span class="mf">19.032789388496106</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;inodesTotal&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;inodesUsed&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;inodesFree&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;inodesUsedPercent&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="主机">主机</h4>
<p>子包<code>host</code>可以获取主机相关信息，如开机时间、内核版本号、平台信息等等。</p>
<h5 id="开机时间">开机时间</h5>
<p><code>host.BootTime()</code>返回主机开机时间的时间戳：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">timestamp</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">host</span><span class="p">.</span><span class="nf">BootTime</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">t</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Unix</span><span class="p">(</span><span class="nb">int64</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nf">Local</span><span class="p">().</span><span class="nf">Format</span><span class="p">(</span><span class="s">&#34;2006-01-02 15:04:05&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>上面先获取开机时间，然后通过<code>time.Unix()</code>将其转为<code>time.Time</code>类型，最后输出<code>2006-01-02 15:04:05</code>格式的时间：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="mi">2020</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mo">06</span> <span class="mi">20</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">32</span>
</span></span></code></pre></div><h4 id="内核版本和平台信息">内核版本和平台信息</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">version</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">host</span><span class="p">.</span><span class="nf">KernelVersion</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">platform</span><span class="p">,</span> <span class="nx">family</span><span class="p">,</span> <span class="nx">version</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">host</span><span class="p">.</span><span class="nf">PlatformInformation</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;platform:&#34;</span><span class="p">,</span> <span class="nx">platform</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;family:&#34;</span><span class="p">,</span> <span class="nx">family</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;version:&#34;</span><span class="p">,</span> <span class="nx">version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>在我的 Win10 上运行输出：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="mf">10.0.18362</span> <span class="nx">Build</span> <span class="mi">18362</span>
</span></span><span class="line"><span class="cl"><span class="nx">platform</span><span class="p">:</span> <span class="nx">Microsoft</span> <span class="nx">Windows</span> <span class="mi">10</span> <span class="nx">Pro</span>
</span></span><span class="line"><span class="cl"><span class="nx">family</span><span class="p">:</span> <span class="nx">Standalone</span> <span class="nx">Workstation</span>
</span></span><span class="line"><span class="cl"><span class="nx">version</span><span class="p">:</span> <span class="mf">10.0.18362</span> <span class="nx">Build</span> <span class="mi">18362</span>
</span></span></code></pre></div><h4 id="终端用户">终端用户</h4>
<p><code>host.Users()</code>返回终端连接上来的用户信息，每个用户一个<code>UserStat</code>结构：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// src/github.com/shirou/gopsutil/host/host.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">UserStat</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">User</span>     <span class="kt">string</span> <span class="s">`json:&#34;user&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Terminal</span> <span class="kt">string</span> <span class="s">`json:&#34;terminal&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Host</span>     <span class="kt">string</span> <span class="s">`json:&#34;host&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Started</span>  <span class="kt">int</span>    <span class="s">`json:&#34;started&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>字段一目了然，看示例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">users</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">host</span><span class="p">.</span><span class="nf">Users</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">user</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">users</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="内存">内存</h4>
<p>在<a href="https://segmentfault.com/a/1190000022281174#%e5%bf%ab%e9%80%9f%e5%bc%80%e5%a7%8b" target="_blank" rel="noopener noreffer ">快速开始</a>中，我们演示了如何使用<code>mem.VirtualMemory()</code>来获取内存信息。该函数返回的只是物理内存信息。我们还可以使用<code>mem.SwapMemory()</code>获取交换内存的信息，信息存储在结构<code>SwapMemoryStat</code>中：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// src/github.com/shirou/gopsutil/mem/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">SwapMemoryStat</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Total</span>       <span class="kt">uint64</span>  <span class="s">`json:&#34;total&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Used</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;used&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Free</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;free&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">UsedPercent</span> <span class="kt">float64</span> <span class="s">`json:&#34;usedPercent&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Sin</span>         <span class="kt">uint64</span>  <span class="s">`json:&#34;sin&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Sout</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;sout&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">PgIn</span>        <span class="kt">uint64</span>  <span class="s">`json:&#34;pgin&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">PgOut</span>       <span class="kt">uint64</span>  <span class="s">`json:&#34;pgout&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">PgFault</span>     <span class="kt">uint64</span>  <span class="s">`json:&#34;pgfault&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>字段含义很容易理解，<code>PgIn/PgOut/PgFault</code>这三个字段我们重点介绍一下。交换内存是以<strong>页</strong>为单位的，如果出现缺页错误(<code>page fault</code>)，操作系统会将磁盘中的某些页载入内存，同时会根据特定的机制淘汰一些内存中的页。<code>PgIn</code>表征载入页数，<code>PgOut</code>淘汰页数，<code>PgFault</code>缺页错误数。</p>
<p>例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">swapMemory</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">mem</span><span class="p">.</span><span class="nf">SwapMemory</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">data</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">swapMemory</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="进程">进程</h4>
<p><code>process</code>可用于获取系统当前运行的进程信息，创建新进程，对进程进行一些操作等。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">rootProcess</span> <span class="o">*</span><span class="nx">process</span><span class="p">.</span><span class="nx">Process</span>
</span></span><span class="line"><span class="cl">  <span class="nx">processes</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">process</span><span class="p">.</span><span class="nf">Processes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">p</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">processes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">p</span><span class="p">.</span><span class="nx">Pid</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">rootProcess</span> <span class="p">=</span> <span class="nx">p</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">rootProcess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;children:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">children</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">rootProcess</span><span class="p">.</span><span class="nf">Children</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">p</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">children</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>先调用<code>process.Processes()</code>获取当前系统中运行的所有进程，然后找到<code>Pid</code>为 0 的进程，即操作系统的第一个进程，最后调用<code>Children()</code>返回其子进程。还有很多方法可获取进程信息，感兴趣可查看文档了解~</p>
<h4 id="windows-服务">Windows 服务</h4>
<p><code>winservices</code>子包可以获取 Windows 系统中的服务信息，内部使用了<code>golang.org/x/sys</code>包。在<code>winservices</code>中，一个服务对应一个<code>Service</code>结构：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// src/github.com/shirou/gopsutil/winservices/winservices.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Service</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Name</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Config</span> <span class="nx">mgr</span><span class="p">.</span><span class="nx">Config</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Status</span> <span class="nx">ServiceStatus</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// contains filtered or unexported fields
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p><code>mgr.Config</code>为包<code>golang.org/x/sys</code>中的结构，该结构详细记录了服务类型、启动类型（自动/手动）、二进制文件路径等信息：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// src/golang.org/x/sys/windows/svc/mgr/config.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Config</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ServiceType</span>      <span class="kt">uint32</span>
</span></span><span class="line"><span class="cl">  <span class="nx">StartType</span>        <span class="kt">uint32</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ErrorControl</span>     <span class="kt">uint32</span>
</span></span><span class="line"><span class="cl">  <span class="nx">BinaryPathName</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">LoadOrderGroup</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">TagId</span>            <span class="kt">uint32</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Dependencies</span>     <span class="p">[]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ServiceStartName</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">DisplayName</span>      <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Password</span>         <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Description</span>      <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SidType</span>          <span class="kt">uint32</span>
</span></span><span class="line"><span class="cl">  <span class="nx">DelayedAutoStart</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>ServiceStatus</code>结构记录了服务的状态：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// src/github.com/shirou/gopsutil/winservices/winservices.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">ServiceStatus</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">State</span>         <span class="nx">svc</span><span class="p">.</span><span class="nx">State</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Accepts</span>       <span class="nx">svc</span><span class="p">.</span><span class="nx">Accepted</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Pid</span>           <span class="kt">uint32</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Win32ExitCode</span> <span class="kt">uint32</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>State</code>：为服务状态，有已停止、运行、暂停等；</li>
<li><code>Accepts</code>：表示服务接收哪些操作，有暂停、继续、会话切换等；</li>
<li><code>Pid</code>：进程 ID；</li>
<li><code>Win32ExitCode</code>：应用程序退出状态码。</li>
</ul>
<p>下面程序中，我将系统中所有服务的名称、二进制文件路径和状态输出到控制台：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">services</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">winservices</span><span class="p">.</span><span class="nf">ListServices</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">service</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">services</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">newservice</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">winservices</span><span class="p">.</span><span class="nf">NewService</span><span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">newservice</span><span class="p">.</span><span class="nf">GetServiceDetail</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Name:&#34;</span><span class="p">,</span> <span class="nx">newservice</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span> <span class="s">&#34;Binary Path:&#34;</span><span class="p">,</span> <span class="nx">newservice</span><span class="p">.</span><span class="nx">Config</span><span class="p">.</span><span class="nx">BinaryPathName</span><span class="p">,</span> <span class="s">&#34;State: &#34;</span><span class="p">,</span> <span class="nx">newservice</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">State</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>注意，调用<code>winservices.ListServices()</code>返回的<code>Service</code>对象信息是不全的，我们通过<code>NewService()</code>以该服务名称创建一个服务，然后调用<code>GetServiceDetail()</code>方法获取该服务的详细信息。不能直接通过<code>service.GetServiceDetail()</code>来调用，因为<code>ListService()</code>返回的对象缺少必要的系统资源句柄（为了节约资源），调用<code>GetServiceDetail()</code>方法会<code>panic</code>！！！</p>
<h4 id="错误和超时">错误和超时</h4>
<p>由于大部分函数都涉及到底层的系统调用，所以发生错误和超时是在所难免的。几乎所有的接口都有两个返回值，第二个作为错误。在前面的例子中，我们为了简化代码都忽略了错误，在实际使用中，建议对错误进行处理。</p>
<p>另外，大部分接口都是一对，一个不带<code>context.Context</code>类型的参数，另一个带有该类型参数，用于做上下文控制。在内部调用发生错误或超时后能及时处理，避免长时间等待返回。实际上，不带<code>context.Context</code>参数的函数内部都是以<code>context.Background()</code>为参数调用带有<code>context.Context</code>的函数的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// src/github.com/shirou/gopsutil/cpu_windows.go
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">Times</span><span class="p">(</span><span class="nx">percpu</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">([]</span><span class="nx">TimesStat</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">TimesWithContext</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">percpu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TimesWithContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">percpu</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">([]</span><span class="nx">TimesStat</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-11-11</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://serialt.github.io/posts/2023-11-11-gopsutil/" data-title="Go gopsutil" data-hashtags="Go,gopsutil"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://serialt.github.io/posts/2023-11-11-gopsutil/" data-hashtag="Go"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://serialt.github.io/posts/2023-11-11-gopsutil/" data-title="Go gopsutil"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://serialt.github.io/posts/2023-11-11-gopsutil/" data-title="Go gopsutil"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://serialt.github.io/posts/2023-11-11-gopsutil/" data-title="Go gopsutil"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/go/">Go</a>,&nbsp;<a href="/tags/gopsutil/">gopsutil</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/2023-11-11-go-yaml/" class="prev" rel="prev" title="Go yaml"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Go yaml</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">serialt</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
