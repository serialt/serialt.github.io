[{"categories":["Go åº“æ–‡æ¡£"],"content":"gopsutil åº“ å‚è€ƒé“¾æ¥ï¼šhttps://segmentfault.com/a/1190000022281174 ","date":"2023-11-11","objectID":"/posts/2023-11-11-gopsutil/:1:0","tags":["Go","gopsutil"],"title":"Go gopsutil","uri":"/posts/2023-11-11-gopsutil/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç®€ä»‹ gopsutilæ˜¯ Python å·¥å…·åº“psutil çš„ Golang ç§»æ¤ç‰ˆï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ–¹ä¾¿åœ°è·å–å„ç§ç³»ç»Ÿå’Œç¡¬ä»¶ä¿¡æ¯ã€‚gopsutilä¸ºæˆ‘ä»¬å±è”½äº†å„ä¸ªç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ï¼Œå…·æœ‰éå¸¸å¼ºæ‚çš„å¯ç§»æ¤æ€§ã€‚æœ‰äº†gopsutilï¼Œæˆ‘ä»¬ä¸å†éœ€è¦é’ˆå¯¹ä¸åŒçš„ç³»ç»Ÿä½¿ç”¨syscallè°ƒç”¨å¯¹åº”çš„ç³»ç»Ÿæ–¹æ³•ã€‚æ›´æ£’çš„æ˜¯gopsutilçš„å®ç°ä¸­æ²¡æœ‰ä»»ä½•cgoçš„ä»£ç ï¼Œä½¿å¾—äº¤å‰ç¼–è¯‘æˆä¸ºå¯èƒ½ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-gopsutil/:1:1","tags":["Go","gopsutil"],"title":"Go gopsutil","uri":"/posts/2023-11-11-gopsutil/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å¿«é€Ÿä½¿ç”¨ å®‰è£… go get github.com/shirou/gopsutil ä½¿ç”¨ package main import ( \"fmt\" \"github.com/shirou/gopsutil/mem\" ) func main() { v, _ := mem.VirtualMemory() fmt.Printf(\"Total: %v, Available: %v, UsedPercent:%f%%\\n\", v.Total, v.Available, v.UsedPercent) fmt.Println(v) } gopsutilå°†ä¸åŒçš„åŠŸèƒ½åˆ’åˆ†åˆ°ä¸åŒçš„å­åŒ…ä¸­ï¼š cpuï¼šCPU ç›¸å…³ï¼› diskï¼šç£ç›˜ç›¸å…³ï¼› dockerï¼šdocker ç›¸å…³ï¼› hostï¼šä¸»æœºç›¸å…³ï¼› memï¼šå†…å­˜ç›¸å…³ï¼› netï¼šç½‘ç»œç›¸å…³ï¼› processï¼šè¿›ç¨‹ç›¸å…³ï¼› winservicesï¼šWindows æœåŠ¡ç›¸å…³ã€‚ æƒ³è¦ä½¿ç”¨å¯¹åº”çš„åŠŸèƒ½ï¼Œè¦å¯¼å…¥å¯¹åº”çš„å­åŒ…ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¦è·å–å†…å­˜ä¿¡æ¯ï¼Œå¯¼å…¥çš„æ˜¯memå­åŒ…ã€‚mem.VirtualMemory()æ–¹æ³•è¿”å›å†…å­˜ä¿¡æ¯ç»“æ„mem.VirtualMemoryStatï¼Œè¯¥ç»“æ„æœ‰ä¸°å¯Œçš„å­—æ®µï¼Œæˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„æ— å¤–ä¹Totalï¼ˆæ€»å†…å­˜ï¼‰ã€Availableï¼ˆå¯ç”¨å†…å­˜ï¼‰ã€Usedï¼ˆå·²ä½¿ç”¨å†…å­˜ï¼‰å’ŒUsedPercentï¼ˆå†…å­˜ä½¿ç”¨ç™¾åˆ†æ¯”ï¼‰ã€‚mem.VirtualMemoryStatè¿˜å®ç°äº†fmt.Stringeræ¥å£ï¼Œä»¥ JSON æ ¼å¼è¿”å›å†…å­˜ä¿¡æ¯ã€‚è¯­å¥fmt.Println(v)ä¼šè‡ªåŠ¨è°ƒç”¨v.String()ï¼Œå°†è¿”å›ä¿¡æ¯è¾“å‡ºã€‚ç¨‹åºè¾“å‡ºï¼š Total: 8526921728, Available: 3768975360, UsedPercent:55.000000% {\"total\":8526921728,\"available\":3768975360,\"used\":4757946368,\"usedPercent\":55,\"free\":0,\"active\":0,\"inactive\":0,\"wired\":0,\"laundry\":0,\"buffers\":0,\"cached\":0,\"writeback\":0,\"dirty\":0,\"writebacktmp\":0,\"shared\":0,\"slab\":0,\"sreclaimable\":0,\"sunreclaim\":0,\"pagetables\":0,\"swapcached\":0,\"commitlimit\":0,\"committedas\":0,\"hightotal\":0,\"highfree\":0,\"lowtotal\":0,\"lowfree\":0,\"swaptotal\":0,\"swapfree\":0,\"mapped\":0,\"vmalloctotal\":0,\"vmallocused\":0,\"vmallocchunk\":0,\"hugepagestotal\":0,\"hugepagesfree\":0,\"hugepagesize\":0} å•ä½ä¸ºå­—èŠ‚ï¼Œæˆ‘çš„ç”µè„‘å†…å­˜ 8GBï¼Œå½“å‰ä½¿ç”¨ç™¾åˆ†æ¯”ä¸º 55%ï¼Œå¯ç”¨å†…å­˜ 3768975360Bï¼ˆå³ 3.51GBï¼‰ã€‚ CPU æˆ‘ä»¬çŸ¥é“ CPU çš„æ ¸æ•°æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç‰©ç†æ ¸æ•°ï¼Œä¸€ç§æ˜¯é€»è¾‘æ ¸æ•°ã€‚ç‰©ç†æ ¸æ•°å°±æ˜¯ä¸»æ¿ä¸Šå®é™…æœ‰å¤šå°‘ä¸ª CPUï¼Œä¸€ä¸ªç‰©ç† CPU ä¸Šå¯ä»¥æœ‰å¤šä¸ªæ ¸å¿ƒï¼Œè¿™äº›æ ¸å¿ƒè¢«ç§°ä¸ºé€»è¾‘æ ¸ã€‚gopsutilä¸­ CPU ç›¸å…³åŠŸèƒ½åœ¨cpuå­åŒ…ä¸­ï¼Œcpuå­åŒ…æä¾›äº†è·å–ç‰©ç†å’Œé€»è¾‘æ ¸æ•°ã€CPU ä½¿ç”¨ç‡çš„æ¥å£ï¼š Counts(logical bool)ï¼šä¼ å…¥falseï¼Œè¿”å›ç‰©ç†æ ¸æ•°ï¼Œä¼ å…¥trueï¼Œè¿”å›é€»è¾‘æ ¸æ•°ï¼› Percent(interval time.Duration, percpu bool)ï¼šè¡¨ç¤ºè·å–intervalæ—¶é—´é—´éš”å†…çš„ CPU ä½¿ç”¨ç‡ï¼Œpercpuä¸ºfalseæ—¶ï¼Œè·å–æ€»çš„ CPU ä½¿ç”¨ç‡ï¼Œpercpuä¸ºtrueæ—¶ï¼Œåˆ†åˆ«è·å–æ¯ä¸ª CPU çš„ä½¿ç”¨ç‡ï¼Œè¿”å›ä¸€ä¸ª[]float64ç±»å‹çš„å€¼ã€‚ ä¾‹å¦‚ï¼š func main() { physicalCnt, _ := cpu.Counts(false) logicalCnt, _ := cpu.Counts(true) fmt.Printf(\"physical count:%d logical count:%d\\n\", physicalCnt, logicalCnt) totalPercent, _ := cpu.Percent(3*time.Second, false) perPercents, _ := cpu.Percent(3*time.Second, true) fmt.Printf(\"total percent:%v per percents:%v\", totalPercent, perPercents) } ä¸Šé¢ä»£ç è·å–ç‰©ç†æ ¸æ•°å’Œé€»è¾‘æ ¸æ•°ï¼Œå¹¶è·å– 3s å†…çš„æ€» CPU ä½¿ç”¨ç‡å’Œæ¯ä¸ª CPU å„è‡ªçš„ä½¿ç”¨ç‡ï¼Œç¨‹åºè¾“å‡ºï¼ˆæ³¨æ„æ¯æ¬¡è¿è¡Œè¾“å‡ºå¯èƒ½éƒ½ä¸ç›¸åŒï¼‰ï¼š physical count:4 logical count:8 total percent:[30.729166666666668] per percents:[32.64248704663213 26.94300518134715 44.559585492227974 23.958333333333336 36.787564766839374 20.3125 38.54166666666667 28.125] è¯¦ç»†ä¿¡æ¯è°ƒç”¨cpu.Info()å¯è·å– CPU çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿”å›[]cpu.InfoStatï¼š func main() { infos, _ := cpu.Info() for _, info := range infos { data, _ := json.MarshalIndent(info, \"\", \" \") fmt.Print(string(data)) } } ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ‘ä½¿ç”¨ JSON è¾“å‡ºç»“æœï¼š { \"cpu\": 0, \"vendorId\": \"GenuineIntel\", \"family\": \"198\", \"model\": \"\", \"stepping\": 0, \"physicalId\": \"BFEBFBFF000906E9\", \"coreId\": \"\", \"cores\": 8, \"modelName\": \"Intel(R) Core(TM) i7-7700 CPU @ 3.60GHz\", \"mhz\": 3601, \"cacheSize\": 0, \"flags\": [], \"microcode\": \"\" } ç”±ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒCPU æ˜¯ Intel çš„ i7-7700 ç³»åˆ—ï¼Œé¢‘ç‡ 3.60GHzã€‚ä¸Šé¢æ˜¯æˆ‘åœ¨ Windows ä¸Šè¿è¡Œçš„è¿”å›ç»“æœï¼Œå†…éƒ¨ä½¿ç”¨äº†github.com/StackExchange/wmiåº“ã€‚åœ¨ Linux ä¸‹æ¯ä¸ªé€»è¾‘ CPU éƒ½ä¼šè¿”å›ä¸€ä¸ªInfoStatç»“æ„ã€‚ æ—¶é—´å ç”¨ è°ƒç”¨cpu.Times(percpu bool)å¯ä»¥è·å–ä»å¼€æœºç®—èµ·ï¼Œæ€» CPU å’Œ æ¯ä¸ªå•ç‹¬çš„ CPU æ—¶é—´å ç”¨æƒ…å†µã€‚ä¼ å…¥percpu=falseè¿”å›æ€»çš„ï¼Œä¼ å…¥percpu=trueè¿”å›å•ä¸ªçš„ã€‚æ¯ä¸ª CPU æ—¶é—´å ç”¨æƒ…å†µæ˜¯ä¸€ä¸ªTimeStatç»“æ„ï¼š // src/github.com/shirou/gopsutil/cpu/cpu.go type TimesStat struct { CPU string `json:\"cpu\"` User float64 `json:\"user\"` System float64 `json:\"system\"` Idle float64 `json:\"idle\"` Nice float64 `json:\"nice\"` Iowait float64 `json:\"iowait\"` Irq float64 `json:\"irq\"` Softirq float64 `json:\"softirq\"` Steal float64 `json:\"steal\"` Guest float64 `json:\"guest\"` GuestNice float64 `json:\"guestNice\"` } CPUï¼šCPU æ ‡è¯†ï¼Œå¦‚æœæ˜¯æ€»çš„ï¼Œè¯¥å­—æ®µä¸ºcpu-totalï¼Œå¦åˆ™ä¸ºcpu0ã€cpu1â€¦ï¼› Userï¼šç”¨æˆ·æ—¶é—´å ç”¨ï¼ˆç”¨æˆ·æ€ï¼‰ï¼› Systemï¼šç³»ç»Ÿæ—¶é—´å ç”¨ï¼ˆå†…æ ¸æ€ï¼‰ï¼› Idleï¼šç©ºé—²æ—¶é—´ï¼› â€¦ ä¾‹å¦‚ï¼š func main() { infos, _ := cpu.Times(true) for _, info := range infos { data, _ := json.MarshalIndent(info, \"\", \" \") fmt.Print(string(data)) } } ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ‘ç”¨ JSON è¾“å‡ºç»“æœï¼Œä¸‹é¢æ˜¯å…¶ä¸­ä¸€ä¸ªè¾“å‡ºï¼š { \"cpu\": \"cpu0\", \"user\": 674.46875, \"system\": 1184.984375, \"idle\": 7497.1875, \"nice\": 0, \"iowait\": 0, \"irq\": 75.578125, \"softirq\": 0, \"steal\": 0, \"guest\": 0, \"guestNice\": 0 } ç£ç›˜ å­åŒ…diskç”¨äºè·å–ç£ç›˜ä¿¡æ¯ã€‚diskå¯è·å– IO ç»Ÿè®¡ã€åˆ†åŒºå’Œä½¿ç”¨ç‡ä¿¡æ¯ã€‚ä¸‹é¢ä¾æ¬¡ä»‹ç»ã€‚ IO ç»Ÿè®¡ è°ƒç”¨disk.IOCounters()å‡½æ•°ï¼Œè¿”å›çš„ IO ç»Ÿè®¡ä¿¡æ¯ç”¨map[string]IOCountersStatç±»å‹è¡¨ç¤ºã€‚æ¯ä¸ªåˆ†åŒºä¸€ä¸ªç»“æ„ï¼Œé”®ä¸ºåˆ†åŒºåï¼Œå€¼ä¸ºç»Ÿè®¡ä¿¡æ¯ã€‚è¿™é‡Œæ‘˜å–ç»Ÿè®¡","date":"2023-11-11","objectID":"/posts/2023-11-11-gopsutil/:1:2","tags":["Go","gopsutil"],"title":"Go gopsutil","uri":"/posts/2023-11-11-gopsutil/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go è¯»å–yamlæ ¼å¼é…ç½®æ–‡ä»¶ package config import ( \"fmt\" \"io/ioutil\" \"gopkg.in/yaml.v3\" ) type Service struct { Host string `json:\"host\" yaml:\"host\"` Port string `json:\"port\" yaml:\"port\"` } type MyConfig struct { Service Service `json:\"service\" yaml:\"service\"` } var Config *MyConfig func LoadConfig(filepath string) { if filepath == \"\" { return } // è¯»yamlæ–‡ä»¶ config, err := ioutil.ReadFile(filepath) if err != nil { fmt.Printf(\"read config failed, please check the path: %v , err: %v\", filepath, err) } err = yaml.Unmarshal(config, \u0026Config) if err != nil { fmt.Printf(\"Unmarshal to struct, err: %v\", err) } fmt.Printf(\"LoadConfig: %v\", Config) } // å†™yamlæ–‡ä»¶ data, err := yaml.Marshal(SkopeoData) if err != nil { slog.Error(\"yaml marshal failed\", \"err\", err) return } err = os.WriteFile(config.AutoSyncfile, data, 0644) if err != nil { slog.Error(\"Write auto sync data to file failed\", \"err\", err) } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-yaml/:1:0","tags":["Go","yaml"],"title":"Go yaml","uri":"/posts/2023-11-11-go-yaml/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Goè¯­è¨€å†…ç½®åŒ…ä¹‹strconv Goè¯­è¨€ä¸­strconvåŒ…å®ç°äº†åŸºæœ¬æ•°æ®ç±»å‹å’Œå…¶å­—ç¬¦ä¸²è¡¨ç¤ºçš„ç›¸äº’è½¬æ¢ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-strconv/:0:0","tags":["Go","strconv"],"title":"Go strconv","uri":"/posts/2023-11-11-go-strconv/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"strconvåŒ… strconvåŒ…å®ç°äº†åŸºæœ¬æ•°æ®ç±»å‹ä¸å…¶å­—ç¬¦ä¸²è¡¨ç¤ºçš„è½¬æ¢ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å¸¸ç”¨å‡½æ•°ï¼š Atoi()ã€Itia()ã€parseç³»åˆ—ã€formatç³»åˆ—ã€appendç³»åˆ—ã€‚ æ›´å¤šå‡½æ•°è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-strconv/:0:1","tags":["Go","strconv"],"title":"Go strconv","uri":"/posts/2023-11-11-go-strconv/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"stringä¸intç±»å‹è½¬æ¢ è¿™ä¸€ç»„å‡½æ•°æ˜¯æˆ‘ä»¬å¹³æ—¶ç¼–ç¨‹ä¸­ç”¨çš„æœ€å¤šçš„ã€‚ Atoi() Atoi()å‡½æ•°ç”¨äºå°†å­—ç¬¦ä¸²ç±»å‹çš„æ•´æ•°è½¬æ¢ä¸ºintç±»å‹ï¼Œå‡½æ•°ç­¾åå¦‚ä¸‹ã€‚ func Atoi(s string) (i int, err error) å¦‚æœä¼ å…¥çš„å­—ç¬¦ä¸²å‚æ•°æ— æ³•è½¬æ¢ä¸ºintç±»å‹ï¼Œå°±ä¼šè¿”å›é”™è¯¯ã€‚ s1 := \"100\" i1, err := strconv.Atoi(s1) if err != nil { fmt.Println(\"can't convert to int\") } else { fmt.Printf(\"type:%T value:%#v\\n\", i1, i1) //type:int value:100 } Itoa() Itoa()å‡½æ•°ç”¨äºå°†intç±»å‹æ•°æ®è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå…·ä½“çš„å‡½æ•°ç­¾åå¦‚ä¸‹ã€‚ func Itoa(i int) string ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š i2 := 200 s2 := strconv.Itoa(i2) fmt.Printf(\"type:%T value:%#v\\n\", s2, s2) //type:string value:\"200\" açš„å…¸æ•… ã€æ‰©å±•é˜…è¯»ã€‘è¿™æ˜¯Cè¯­è¨€é—ç•™ä¸‹çš„å…¸æ•…ã€‚Cè¯­è¨€ä¸­æ²¡æœ‰stringç±»å‹è€Œæ˜¯ç”¨å­—ç¬¦æ•°ç»„(array)è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥Itoaå¯¹å¾ˆå¤šCç³»çš„ç¨‹åºå‘˜å¾ˆå¥½ç†è§£ã€‚ Parseç³»åˆ—å‡½æ•° Parseç±»å‡½æ•°ç”¨äºè½¬æ¢å­—ç¬¦ä¸²ä¸ºç»™å®šç±»å‹çš„å€¼ï¼šParseBool()ã€ParseFloat()ã€ParseInt()ã€ParseUint()ã€‚ ParseBool() func ParseBool(str string) (value bool, err error) è¿”å›å­—ç¬¦ä¸²è¡¨ç¤ºçš„boolå€¼ã€‚å®ƒæ¥å—1ã€0ã€tã€fã€Tã€Fã€trueã€falseã€Trueã€Falseã€TRUEã€FALSEï¼›å¦åˆ™è¿”å›é”™è¯¯ã€‚ ParseInt() func ParseInt(s string, base int, bitSize int) (i int64, err error) è¿”å›å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ•´æ•°å€¼ï¼Œæ¥å—æ­£è´Ÿå·ã€‚ baseæŒ‡å®šè¿›åˆ¶ï¼ˆ2åˆ°36ï¼‰ï¼Œå¦‚æœbaseä¸º0ï¼Œåˆ™ä¼šä»å­—ç¬¦ä¸²å‰ç½®åˆ¤æ–­ï¼Œâ€0xâ€æ˜¯16è¿›åˆ¶ï¼Œâ€0â€æ˜¯8è¿›åˆ¶ï¼Œå¦åˆ™æ˜¯10è¿›åˆ¶ï¼› bitSizeæŒ‡å®šç»“æœå¿…é¡»èƒ½æ— æº¢å‡ºèµ‹å€¼çš„æ•´æ•°ç±»å‹ï¼Œ0ã€8ã€16ã€32ã€64 åˆ†åˆ«ä»£è¡¨ intã€int8ã€int16ã€int32ã€int64ï¼› è¿”å›çš„erræ˜¯*NumErrç±»å‹çš„ï¼Œå¦‚æœè¯­æ³•æœ‰è¯¯ï¼Œerr.Error = ErrSyntaxï¼›å¦‚æœç»“æœè¶…å‡ºç±»å‹èŒƒå›´err.Error = ErrRangeã€‚ ParseUnit() func ParseUint(s string, base int, bitSize int) (n uint64, err error) ParseUintç±»ä¼¼ParseIntä½†ä¸æ¥å—æ­£è´Ÿå·ï¼Œç”¨äºæ— ç¬¦å·æ•´å‹ã€‚ ParseFloat() func ParseFloat(s string, bitSize int) (f float64, err error) è§£æä¸€ä¸ªè¡¨ç¤ºæµ®ç‚¹æ•°çš„å­—ç¬¦ä¸²å¹¶è¿”å›å…¶å€¼ã€‚ å¦‚æœsåˆä¹è¯­æ³•è§„åˆ™ï¼Œå‡½æ•°ä¼šè¿”å›æœ€ä¸ºæ¥è¿‘sè¡¨ç¤ºå€¼çš„ä¸€ä¸ªæµ®ç‚¹æ•°ï¼ˆä½¿ç”¨IEEE754è§„èŒƒèˆå…¥ï¼‰ã€‚ bitSizeæŒ‡å®šäº†æœŸæœ›çš„æ¥æ”¶ç±»å‹ï¼Œ32æ˜¯float32ï¼ˆè¿”å›å€¼å¯ä»¥ä¸æ”¹å˜ç²¾ç¡®å€¼çš„èµ‹å€¼ç»™float32ï¼‰ï¼Œ64æ˜¯float64ï¼› è¿”å›å€¼erræ˜¯*NumErrç±»å‹çš„ï¼Œè¯­æ³•æœ‰è¯¯çš„ï¼Œerr.Error=ErrSyntaxï¼›ç»“æœè¶…å‡ºè¡¨ç¤ºèŒƒå›´çš„ï¼Œè¿”å›å€¼fä¸ºÂ±Infï¼Œerr.Error= ErrRangeã€‚ ä»£ç ç¤ºä¾‹ b, err := strconv.ParseBool(\"true\") f, err := strconv.ParseFloat(\"3.1415\", 64) i, err := strconv.ParseInt(\"-2\", 10, 64) u, err := strconv.ParseUint(\"2\", 10, 64) è¿™äº›å‡½æ•°éƒ½æœ‰ä¸¤ä¸ªè¿”å›å€¼ï¼Œç¬¬ä¸€ä¸ªè¿”å›å€¼æ˜¯è½¬æ¢åçš„å€¼ï¼Œç¬¬äºŒä¸ªè¿”å›å€¼ä¸ºè½¬åŒ–å¤±è´¥çš„é”™è¯¯ä¿¡æ¯ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-strconv/:0:2","tags":["Go","strconv"],"title":"Go strconv","uri":"/posts/2023-11-11-go-strconv/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Formatç³»åˆ—å‡½æ•° Formatç³»åˆ—å‡½æ•°å®ç°äº†å°†ç»™å®šç±»å‹æ•°æ®æ ¼å¼åŒ–ä¸ºstringç±»å‹æ•°æ®çš„åŠŸèƒ½ã€‚ FormatBool() func FormatBool(b bool) string æ ¹æ®bçš„å€¼è¿”å›â€trueâ€æˆ–â€falseâ€ã€‚ FormatInt() func FormatInt(i int64, base int) string è¿”å›içš„baseè¿›åˆ¶çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚base å¿…é¡»åœ¨2åˆ°36ä¹‹é—´ï¼Œç»“æœä¸­ä¼šä½¿ç”¨å°å†™å­—æ¯â€™aâ€™åˆ°â€™zâ€™è¡¨ç¤ºå¤§äº10çš„æ•°å­—ã€‚ FormatUint() func FormatUint(i uint64, base int) string æ˜¯FormatIntçš„æ— ç¬¦å·æ•´æ•°ç‰ˆæœ¬ã€‚ FormatFloat() func FormatFloat(f float64, fmt byte, prec, bitSize int) string å‡½æ•°å°†æµ®ç‚¹æ•°è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²å¹¶è¿”å›ã€‚ bitSizeè¡¨ç¤ºfçš„æ¥æºç±»å‹ï¼ˆ32ï¼šfloat32ã€64ï¼šfloat64ï¼‰ï¼Œä¼šæ®æ­¤è¿›è¡Œèˆå…¥ã€‚ fmtè¡¨ç¤ºæ ¼å¼ï¼šâ€™fâ€™ï¼ˆ-ddd.ddddï¼‰ã€â€™bâ€™ï¼ˆ-ddddpÂ±dddï¼ŒæŒ‡æ•°ä¸ºäºŒè¿›åˆ¶ï¼‰ã€â€™eâ€™ï¼ˆ-d.ddddeÂ±ddï¼Œåè¿›åˆ¶æŒ‡æ•°ï¼‰ã€â€™Eâ€™ï¼ˆ-d.ddddEÂ±ddï¼Œåè¿›åˆ¶æŒ‡æ•°ï¼‰ã€â€™gâ€™ï¼ˆæŒ‡æ•°å¾ˆå¤§æ—¶ç”¨â€™eâ€™æ ¼å¼ï¼Œå¦åˆ™â€™fâ€™æ ¼å¼ï¼‰ã€â€™Gâ€™ï¼ˆæŒ‡æ•°å¾ˆå¤§æ—¶ç”¨â€™Eâ€™æ ¼å¼ï¼Œå¦åˆ™â€™fâ€™æ ¼å¼ï¼‰ã€‚ precæ§åˆ¶ç²¾åº¦ï¼ˆæ’é™¤æŒ‡æ•°éƒ¨åˆ†ï¼‰ï¼šå¯¹â€™fâ€™ã€â€™eâ€™ã€â€™Eâ€™ï¼Œå®ƒè¡¨ç¤ºå°æ•°ç‚¹åçš„æ•°å­—ä¸ªæ•°ï¼›å¯¹â€™gâ€™ã€â€™Gâ€™ï¼Œå®ƒæ§åˆ¶æ€»çš„æ•°å­—ä¸ªæ•°ã€‚å¦‚æœprec ä¸º-1ï¼Œåˆ™ä»£è¡¨ä½¿ç”¨æœ€å°‘æ•°é‡çš„ã€ä½†åˆå¿…éœ€çš„æ•°å­—æ¥è¡¨ç¤ºfã€‚ ä»£ç ç¤ºä¾‹ s1 := strconv.FormatBool(true) s2 := strconv.FormatFloat(3.1415, 'E', -1, 64) s3 := strconv.FormatInt(-2, 16) s4 := strconv.FormatUint(2, 16) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-strconv/:0:3","tags":["Go","strconv"],"title":"Go strconv","uri":"/posts/2023-11-11-go-strconv/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å…¶ä»– isPrint() func IsPrint(r rune) bool è¿”å›ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯å¯æ‰“å°çš„ï¼Œå’Œunicode.IsPrintä¸€æ ·ï¼Œrå¿…é¡»æ˜¯ï¼šå­—æ¯ï¼ˆå¹¿ä¹‰ï¼‰ã€æ•°å­—ã€æ ‡ç‚¹ã€ç¬¦å·ã€ASCIIç©ºæ ¼ã€‚ CanBackquote() func CanBackquote(s string) bool è¿”å›å­—ç¬¦ä¸²sæ˜¯å¦å¯ä»¥ä¸è¢«ä¿®æ”¹çš„è¡¨ç¤ºä¸ºä¸€ä¸ªå•è¡Œçš„ã€æ²¡æœ‰ç©ºæ ¼å’Œtabä¹‹å¤–æ§åˆ¶å­—ç¬¦çš„åå¼•å·å­—ç¬¦ä¸²ã€‚ å…¶ä»– é™¤ä¸Šæ–‡åˆ—å‡ºçš„å‡½æ•°å¤–ï¼ŒstrconvåŒ…ä¸­è¿˜æœ‰Appendç³»åˆ—ã€Quoteç³»åˆ—ç­‰å‡½æ•°ã€‚å…·ä½“ç”¨æ³•å¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-strconv/:0:4","tags":["Go","strconv"],"title":"Go strconv","uri":"/posts/2023-11-11-go-strconv/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go tailåº“ å®æ—¶è¯»å–æ–‡ä»¶å†…å®¹ go get github.com/hpcloud/tail ç¤ºä¾‹ï¼š package main import ( \"fmt\" \"time\" \"github.com/hpcloud/tail\" ) func main() { fileName := \"./my.log\" config := tail.Config{ ReOpen: true, // é‡æ–°æ‰“å¼€ Follow: true, // æ˜¯å¦è·Ÿéš Location: \u0026tail.SeekInfo{Offset: 0, Whence: 2}, // ä»æ–‡ä»¶çš„å“ªä¸ªåœ°æ–¹å¼€å§‹è¯» MustExist: false, // æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™ Poll: true, } tails, err := tail.TailFile(fileName, config) if err != nil { fmt.Println(\"tail file failed, err:\", err) return } var ( line *tail.Line ok bool ) for { line, ok = \u003c-tails.Lines if !ok { fmt.Printf(\"tail file close reopen, filename:%s\\n\", tails.Filename) time.Sleep(time.Second) continue } fmt.Println(\"line:\", line.Text) } } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-tail/:1:0","tags":["Go","tail"],"title":"Go tail","uri":"/posts/2023-11-11-go-tail/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Goè¯­è¨€æ ‡å‡†åº“netåŒ…ä»‹ç» ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-net/:1:0","tags":["Go","net"],"title":"Go net","uri":"/posts/2023-11-11-go-net/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ä¸€ã€åŸŸåè§£æ DNS è®°å½•æ˜¯ä¸ DNS æœåŠ¡å™¨å…³è”çš„æ˜ å°„æ–‡ä»¶ï¼Œæ— è®ºæ¯ä¸ªåŸŸåä¸å“ªä¸ª IP åœ°å€å…³è”ï¼Œå®ƒä»¬éƒ½èƒ½å¤„ç†å‘é€åˆ°æ¯ä¸ªåŸŸåçš„è¯·æ±‚ã€‚net åŒ…åŒ…å«å„ç§æ–¹æ³•æ¥æŸ¥æ‰¾ DNS è®°å½•çš„ç»†èŠ‚ã€‚è®©æˆ‘ä»¬è¿è¡Œä¸€äº›ç¤ºä¾‹ï¼Œæ”¶é›†æœ‰å…³ DNS æœåŠ¡å™¨çš„ä¿¡æ¯ä»¥åŠç›®æ ‡åŸŸåçš„ç›¸åº”è®°å½•ï¼š æœ¬æ–‡æ˜¯ Goè¯­è¨€ä¸­æ–‡ç½‘ç»„ç»‡çš„ GCTT ç¿»è¯‘ï¼Œå‘å¸ƒåœ¨ Goè¯­è¨€ä¸­æ–‡ç½‘å…¬ä¼—å·ï¼Œè½¬è½½è¯·è”ç³»æˆ‘ä»¬æˆæƒã€‚ 1ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„ A è®°å½• net.LookupIP() å‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆdomain-nameï¼‰å¹¶è¿”å›ä¸€ä¸ªåŒ…å«ä¸»æœºçš„ IPv4 å’Œ IPv6 åœ°å€çš„ net.IP å¯¹è±¡åˆ‡ç‰‡ã€‚ package main import ( \"fmt\" \"net\" ) func main() { iprecords, _ := net.LookupIP(\"facebook.com\") for _, ip := range iprecords { fmt.Println(ip) } } ä¸Šè¿°ç¨‹åºçš„è¾“å‡ºåˆ—å‡ºäº†ä»¥ IPv4 å’Œ IPv6 æ ¼å¼è¿”å›çš„ facebook.com çš„ A è®°å½•ã€‚ C:\\golang\\dns\u003e Go run example1.go 2a03:2880:f12f:83:face:b00c:0:25de 31.13.79.35 2ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„ CNAME è®°å½• CNAME æ˜¯è§„èŒƒåç§°çš„ç¼©å†™ã€‚CNAME æœ¬è´¨ä¸Šæ˜¯ç»‘å®šè·¯å¾„çš„åŸŸåå’Œå­åŸŸåçš„æ–‡æœ¬åˆ«åã€‚net.LookupCNAME() å‡½æ•°æ¥å—ä¸»æœºåŸŸåï¼ˆm.facebook.comï¼‰ä½œä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ç»™å®šä¸»æœºçš„å•ä¸ªè§„èŒƒåŸŸå package main import ( \"fmt\" \"net\" ) func main() { cname, _ := net.LookupCNAME(\"m.facebook.com\") fmt.Println(cname) } m.facebook.com åŸŸåè¿”å›çš„ CNAME è®°å½•å¦‚ä¸‹æ‰€ç¤ºï¼š C:\\golang\\dns\u003e Go run example2.go star-mini.c10r.facebook.comã€‚ 3ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„ PTR æŒ‡é’ˆè®°å½• è¿™äº›è®°å½•æä¾›ä»åœ°å€åˆ°åç§°çš„åå‘ç»‘å®šã€‚PTR è®°å½•åº”ä¸æ­£å‘è®°å½•å®Œå…¨åŒ¹é…ã€‚net.LookupAddr() å‡½æ•°å¯¹åœ°å€æ‰§è¡Œåå‘æŸ¥æ‰¾ï¼Œå¹¶è¿”å›æ˜ å°„åˆ°ç»™å®šåœ°å€çš„åç§°åˆ—è¡¨ã€‚ package main import ( \"fmt\" \"net\" ) func main() { ptr, _ := net.LookupAddr(\"6.8.8.8\") for _, ptrvalue := range ptr { fmt.Println(ptrvalue) } } å¯¹äºç»™å®šçš„åœ°å€ï¼Œä¸Šè¿°ç¨‹åºè¿”å›å•ä¸ªåå‘è®°å½•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š C:\\golang\\dns\u003ego run example3.go tms_server.yuma.army.mil. 4ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„åç§°æœåŠ¡å™¨ï¼ˆNSï¼‰è®°å½• NS è®°å½•æè¿°äº†åŒºåŸŸçš„æˆæƒåç§°æœåŠ¡å™¨ã€‚NS è¿˜å°†å­åŸŸåå§”æ‰˜ç»™åŒºåŸŸæ–‡ä»¶ä¸Šçš„å…¶ä»–ç»„ç»‡ã€‚net.LookupNS() å‡½æ•°å°†åŸŸåï¼ˆfacebook.comï¼‰ä½œä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å› DNS-NS è®°å½•ä½œä¸º NS ç»“æ„çš„åˆ‡ç‰‡ã€‚ package main import ( \"fmt\" \"net\" ) func main() { nameserver, _ := net.LookupNS(\"facebook.com\") for _, ns := range nameserver { fmt.Println(ns) } } æ”¯æŒè¯¥åŸŸåçš„ NS è®°å½•å¦‚ä¸‹æ‰€ç¤ºï¼š C:\\golang\\dns\u003ego run example4.go \u0026{a.ns.facebook.com.} \u0026{b.ns.facebook.com.} 5ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸçš„ MX è®°å½• è¿™äº›è®°å½•ç”¨æ¥è®°å½•å¯ä»¥äº¤æ¢ç”µå­é‚®ä»¶çš„æœåŠ¡å™¨ã€‚net.LookupMX() å‡½æ•°å°†åŸŸåä½œä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›æŒ‰é¦–é€‰é¡¹æ’åºçš„ MX ç»“æ„åˆ‡ç‰‡ã€‚MX ç»“æ„ç”±ç±»å‹ä¸ºå­—ç¬¦ä¸²çš„ HOST å’Œ ç±»å‹ä¸º uint16 çš„ Pref ç»„æˆã€‚ package main import ( \"fmt\" \"net\" ) func main() { mxrecords, _ := net.LookupMX(\"facebook.com\") for _, mx := range mxrecords { fmt.Println(mx.Host, mx.Pref) } } åŸŸåï¼ˆfacebook.comï¼‰çš„è¾“å‡ºåˆ—è¡¨ MX è®°å½•ã€‚ C:\\golang\\dns\u003ego run example5.go msgin.vvv.facebook.com. 10 6ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„ SRV æœåŠ¡è®°å½• LookupSRV å‡½æ•°å°è¯•è§£æç»™å®šæœåŠ¡ï¼Œåè®®å’ŒåŸŸåçš„ SRV æŸ¥è¯¢ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ â€œtcpâ€ æˆ– â€œudpâ€ã€‚è¿”å›çš„è®°å½•æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œå¹¶æŒ‰ç…§æƒé‡éšæœºåŒ–ã€‚ package main import ( \"fmt\" \"net\" ) func main() { cname, srvs, err := net.LookupSRV(\"xmpp-server\", \"tcp\", \"golang.org\") if err != nil { panic(err) } fmt.Printf(\"\\ncname: %s \\n\\n\", cname) for _, srv := range srvs { fmt.Printf(\"%v:%v:%d:%d\\n\", srv.Target, srv.Port, srv.Priority, srv.Weight) } } ä¸‹é¢çš„è¾“å‡ºæ¼”ç¤ºäº† CNAME è¿”å›ï¼Œåè·Ÿç”±å†’å·åˆ†éš”çš„ SRV è®°å½•çš„ç›®æ ‡ï¼Œç«¯å£ï¼Œä¼˜å…ˆçº§å’Œæƒé‡ã€‚ C:\\golang\\dns\u003ego run example6.go cname: _xmpp-server._tcp.golang.org. 7ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„ TXT è®°å½• TXT è®°å½•å­˜å‚¨æœ‰å…³ SPF çš„ä¿¡æ¯ï¼Œè¯¥ä¿¡æ¯å¯ä»¥è¯†åˆ«æˆæƒæœåŠ¡å™¨ä»¥ä»£è¡¨æ‚¨çš„ç»„ç»‡å‘é€ç”µå­é‚®ä»¶ã€‚net.LookupTXT() å‡½æ•°å°†åŸŸåï¼ˆfacebook.comï¼‰ä½œä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å› DNS TXT è®°å½•çš„å­—ç¬¦ä¸²åˆ‡ç‰‡ã€‚ package main import ( \"fmt\" \"net\" ) func main() { txtrecords, _ := net.LookupTXT(\"facebook.com\") for _, txt := range txtrecords { fmt.Println(txt) } } gmail.com çš„å•ä¸ª TXT è®°å½•å¦‚ä¸‹æ‰€ç¤ºã€‚ C:\\golang\\dns\u003ego run example7.go v=spf1 redirect=_spf.facebook.com via: http://www.golangprograms.com/find-dns-records-programmatically.html ä½œè€…ï¼šgolangprograms[1]è¯‘è€…ï¼šlovechuck[2]æ ¡å¯¹ï¼špolaris1119[3] ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-net/:1:1","tags":["Go","net"],"title":"Go net","uri":"/posts/2023-11-11-go-net/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å‚è€ƒèµ„æ–™ [1]golangprograms: http://www.golangprograms.com [2]lovechuck: https://github.com/lovechuck [3]polaris1119: https://github.com/polaris1119 [4]GCTT: https://github.com/studygolang/GCTT [5]Go ä¸­æ–‡ç½‘: https://studygolang.com/ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-net/:1:2","tags":["Go","net"],"title":"Go net","uri":"/posts/2023-11-11-go-net/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"mapstructure è½¬æ¢åº“ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:0","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç®€ä»‹ mapstructureç”¨äºå°†é€šç”¨çš„map[string]interface{}è§£ç åˆ°å¯¹åº”çš„ Go ç»“æ„ä½“ä¸­ï¼Œæˆ–è€…æ‰§è¡Œç›¸åçš„æ“ä½œã€‚å¾ˆå¤šæ—¶å€™ï¼Œè§£ææ¥è‡ªå¤šç§æºå¤´çš„æ•°æ®æµæ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬äº‹å…ˆå¹¶ä¸çŸ¥é“ä»–ä»¬å¯¹åº”çš„å…·ä½“ç±»å‹ã€‚åªæœ‰è¯»å–åˆ°ä¸€äº›å­—æ®µä¹‹åæ‰èƒ½åšå‡ºåˆ¤æ–­ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨æ ‡å‡†çš„encoding/jsonåº“å°†æ•°æ®è§£ç ä¸ºmap[string]interface{}ç±»å‹ï¼Œç„¶åæ ¹æ®æ ‡è¯†å­—æ®µåˆ©ç”¨mapstructureåº“è½¬ä¸ºç›¸åº”çš„ Go ç»“æ„ä½“ä»¥ä¾¿ä½¿ç”¨ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:1","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å¿«é€Ÿä½¿ç”¨ æœ¬æ–‡ä»£ç é‡‡ç”¨ Go Modulesã€‚ é¦–å…ˆåˆ›å»ºç›®å½•å¹¶åˆå§‹åŒ–ï¼š $ mkdir mapstructure \u0026\u0026 cd mapstructure $ go mod init github.com/darjun/go-daily-lib/mapstructure ä¸‹è½½mapstructureåº“ï¼š $ go get github.com/mitchellh/mapstructure ä½¿ç”¨ï¼š package main import ( \"encoding/json\" \"fmt\" \"log\" \"github.com/mitchellh/mapstructure\" ) type Person struct { Name string Age int Job string } type Cat struct { Name string Age int Breed string } func main() { datas := []string{` { \"type\": \"person\", \"name\":\"dj\", \"age\":18, \"job\": \"programmer\" } `, ` { \"type\": \"cat\", \"name\": \"kitty\", \"age\": 1, \"breed\": \"Ragdoll\" } `, } for _, data := range datas { var m map[string]interface{} err := json.Unmarshal([]byte(data), \u0026m) if err != nil { log.Fatal(err) } switch m[\"type\"].(string) { case \"person\": var p Person mapstructure.Decode(m, \u0026p) fmt.Println(\"person\", p) case \"cat\": var cat Cat mapstructure.Decode(m, \u0026cat) fmt.Println(\"cat\", cat) } } } è¿è¡Œç»“æœï¼š $ go run main.go person {dj 18 programmer} cat {kitty 1 Ragdoll} æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªç»“æ„ä½“Personå’ŒCatï¼Œä»–ä»¬çš„å­—æ®µæœ‰äº›è®¸ä¸åŒã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çº¦å®šé€šä¿¡çš„ JSON ä¸²ä¸­æœ‰ä¸€ä¸ªtypeå­—æ®µã€‚å½“typeçš„å€¼ä¸ºpersonæ—¶ï¼Œè¯¥ JSON ä¸²è¡¨ç¤ºçš„æ˜¯Personç±»å‹çš„æ•°æ®ã€‚å½“typeçš„å€¼ä¸ºcatæ—¶ï¼Œè¯¥ JSON ä¸²è¡¨ç¤ºçš„æ˜¯Catç±»å‹çš„æ•°æ®ã€‚ ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬å…ˆç”¨json.Unmarshalå°†å­—èŠ‚æµè§£ç ä¸ºmap[string]interface{}ç±»å‹ã€‚ç„¶åè¯»å–é‡Œé¢çš„typeå­—æ®µã€‚æ ¹æ®typeå­—æ®µçš„å€¼ï¼Œå†ä½¿ç”¨mapstructure.Decodeå°†è¯¥ JSON ä¸²åˆ†åˆ«è§£ç ä¸ºPersonå’ŒCatç±»å‹çš„å€¼ï¼Œå¹¶è¾“å‡ºã€‚ å®é™…ä¸Šï¼ŒGoogle Protobuf é€šå¸¸ä¹Ÿä½¿ç”¨è¿™ç§æ–¹å¼ã€‚åœ¨åè®®ä¸­æ·»åŠ æ¶ˆæ¯ ID æˆ–å…¨é™å®šæ¶ˆæ¯åã€‚æ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åï¼Œå…ˆè¯»å–åè®® ID æˆ–å…¨é™å®šæ¶ˆæ¯åã€‚ç„¶åè°ƒç”¨ Protobuf çš„è§£ç æ–¹æ³•å°†å…¶è§£ç ä¸ºå¯¹åº”çš„Messageç»“æ„ã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œmapstructureä¹Ÿå¯ä»¥ç”¨äºç½‘ç»œæ¶ˆæ¯è§£ç ï¼Œå¦‚æœä½ ä¸è€ƒè™‘æ€§èƒ½çš„è¯ğŸ˜„ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:2","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å­—æ®µæ ‡ç­¾ é»˜è®¤æƒ…å†µä¸‹ï¼Œmapstructureä½¿ç”¨ç»“æ„ä½“ä¸­å­—æ®µçš„åç§°åšè¿™ä¸ªæ˜ å°„ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„ç»“æ„ä½“æœ‰ä¸€ä¸ªNameå­—æ®µï¼Œmapstructureè§£ç æ—¶ä¼šåœ¨map[string]interface{}ä¸­æŸ¥æ‰¾é”®ånameã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„nameæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼ type Person struct { Name string } å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šæ˜ å°„çš„å­—æ®µåã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå­—æ®µè®¾ç½®mapstructureæ ‡ç­¾ã€‚ä¾‹å¦‚ä¸‹é¢ä½¿ç”¨usernameä»£æ›¿ä¸Šä¾‹ä¸­çš„nameï¼š type Person struct { Name string `mapstructure:\"username\"` } çœ‹ç¤ºä¾‹ï¼š type Person struct { Name string `mapstructure:\"username\"` Age int Job string } type Cat struct { Name string Age int Breed string } func main() { datas := []string{` { \"type\": \"person\", \"username\":\"dj\", \"age\":18, \"job\": \"programmer\" } `, ` { \"type\": \"cat\", \"name\": \"kitty\", \"Age\": 1, \"breed\": \"Ragdoll\" } `, ` { \"type\": \"cat\", \"Name\": \"rooooose\", \"age\": 2, \"breed\": \"shorthair\" } `, } for _, data := range datas { var m map[string]interface{} err := json.Unmarshal([]byte(data), \u0026m) if err != nil { log.Fatal(err) } switch m[\"type\"].(string) { case \"person\": var p Person mapstructure.Decode(m, \u0026p) fmt.Println(\"person\", p) case \"cat\": var cat Cat mapstructure.Decode(m, \u0026cat) fmt.Println(\"cat\", cat) } } } ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ ‡ç­¾mapstructure:\"username\"å°†Personçš„Nameå­—æ®µæ˜ å°„ä¸ºusernameï¼Œåœ¨ JSON ä¸²ä¸­æˆ‘ä»¬éœ€è¦è®¾ç½®usernameæ‰èƒ½æ­£ç¡®è§£æã€‚å¦å¤–ï¼Œæ³¨æ„åˆ°ï¼Œæˆ‘ä»¬å°†ç¬¬äºŒä¸ª JSON ä¸²ä¸­çš„Ageå’Œç¬¬ä¸‰ä¸ª JSON ä¸²ä¸­çš„Nameé¦–å­—æ¯å¤§å†™äº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å½±å“è§£ç ç»“æœã€‚mapstructureå¤„ç†å­—æ®µæ˜ å°„æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:3","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å†…åµŒç»“æ„ ç»“æ„ä½“å¯ä»¥ä»»æ„åµŒå¥—ï¼ŒåµŒå¥—çš„ç»“æ„è¢«è®¤ä¸ºæ˜¯æ‹¥æœ‰è¯¥ç»“æ„ä½“åå­—çš„å¦ä¸€ä¸ªå­—æ®µã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ä¸¤ç§Friendçš„å®šä¹‰æ–¹å¼å¯¹äºmapstructureæ˜¯ä¸€æ ·çš„ï¼š type Person struct { Name string } // æ–¹å¼ä¸€ type Friend struct { Person } // æ–¹å¼äºŒ type Friend struct { Person Person } ä¸ºäº†æ­£ç¡®è§£ç ï¼ŒPersonç»“æ„çš„æ•°æ®è¦åœ¨personé”®ä¸‹ï¼š map[string]interface{} { \"person\": map[string]interface{}{\"name\": \"dj\"}, } æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®mapstructure:\",squash\"å°†è¯¥ç»“æ„ä½“çš„å­—æ®µæåˆ°çˆ¶ç»“æ„ä¸­ï¼š type Friend struct { Person `mapstructure:\",squash\"` } è¿™æ ·åªéœ€è¦è¿™æ ·çš„ JSON ä¸²ï¼Œæ— æ•ˆåµŒå¥—personé”®ï¼š map[string]interface{}{ \"name\": \"dj\", } çœ‹ç¤ºä¾‹ï¼š type Person struct { Name string } type Friend1 struct { Person } type Friend2 struct { Person `mapstructure:\",squash\"` } func main() { datas := []string{` { \"type\": \"friend1\", \"person\": { \"name\":\"dj\" } } `, ` { \"type\": \"friend2\", \"name\": \"dj2\" } `, } for _, data := range datas { var m map[string]interface{} err := json.Unmarshal([]byte(data), \u0026m) if err != nil { log.Fatal(err) } switch m[\"type\"].(string) { case \"friend1\": var f1 Friend1 mapstructure.Decode(m, \u0026f1) fmt.Println(\"friend1\", f1) case \"friend2\": var f2 Friend2 mapstructure.Decode(m, \u0026f2) fmt.Println(\"friend2\", f2) } } } æ³¨æ„å¯¹æ¯”Friend1å’ŒFriend2ä½¿ç”¨çš„ JSON ä¸²çš„ä¸åŒã€‚ å¦å¤–éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœçˆ¶ç»“æ„ä½“ä¸­æœ‰åŒåçš„å­—æ®µï¼Œé‚£ä¹ˆmapstructureä¼šå°†JSON ä¸­å¯¹åº”çš„å€¼åŒæ—¶è®¾ç½®åˆ°è¿™ä¸¤ä¸ªå­—æ®µä¸­ï¼Œå³è¿™ä¸¤ä¸ªå­—æ®µæœ‰ç›¸åŒçš„å€¼ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:4","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æœªæ˜ å°„çš„å€¼ å¦‚æœæºæ•°æ®ä¸­æœ‰æœªæ˜ å°„çš„å€¼ï¼ˆå³ç»“æ„ä½“ä¸­æ— å¯¹åº”çš„å­—æ®µï¼‰ï¼Œmapstructureé»˜è®¤ä¼šå¿½ç•¥å®ƒã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ç»“æ„ä½“ä¸­å®šä¹‰ä¸€ä¸ªå­—æ®µï¼Œä¸ºå…¶è®¾ç½®mapstructure:\",remain\"æ ‡ç­¾ã€‚è¿™æ ·æœªæ˜ å°„çš„å€¼å°±ä¼šæ·»åŠ åˆ°è¿™ä¸ªå­—æ®µä¸­ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå­—æ®µçš„ç±»å‹åªèƒ½ä¸ºmap[string]interface{}æˆ–map[interface{}]interface{}ã€‚ çœ‹ç¤ºä¾‹ï¼š type Person struct { Name string Age int Job string Other map[string]interface{} `mapstructure:\",remain\"` } func main() { data := ` { \"name\": \"dj\", \"age\":18, \"job\":\"programmer\", \"height\":\"1.8m\", \"handsome\": true } ` var m map[string]interface{} err := json.Unmarshal([]byte(data), \u0026m) if err != nil { log.Fatal(err) } var p Person mapstructure.Decode(m, \u0026p) fmt.Println(\"other\", p.Other) } ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸ºç»“æ„ä½“å®šä¹‰äº†ä¸€ä¸ªOtherå­—æ®µï¼Œç”¨äºä¿å­˜æœªæ˜ å°„çš„é”®å€¼ã€‚è¾“å‡ºç»“æœï¼š other map[handsome:true height:1.8m] ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:5","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"é€†å‘è½¬æ¢ å‰é¢æˆ‘ä»¬éƒ½æ˜¯å°†map[string]interface{}è§£ç åˆ° Go ç»“æ„ä½“ä¸­ã€‚mapstructureå½“ç„¶ä¹Ÿå¯ä»¥å°† Go ç»“æ„ä½“åå‘è§£ç ä¸ºmap[string]interface{}ã€‚åœ¨åå‘è§£ç æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæŸäº›å­—æ®µè®¾ç½®mapstructure:\",omitempty\"ã€‚è¿™æ ·å½“è¿™äº›å­—æ®µä¸ºé»˜è®¤å€¼æ—¶ï¼Œå°±ä¸ä¼šå‡ºç°åœ¨ç»“æ„çš„map[string]interface{}ä¸­ï¼š type Person struct { Name string Age int Job string `mapstructure:\",omitempty\"` } func main() { p := \u0026Person{ Name: \"dj\", Age: 18, } var m map[string]interface{} mapstructure.Decode(p, \u0026m) data, _ := json.Marshal(m) fmt.Println(string(data)) } ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸ºJobå­—æ®µè®¾ç½®äº†mapstructure:\",omitempty\"ï¼Œä¸”å¯¹è±¡pçš„Jobå­—æ®µæœªè®¾ç½®ã€‚è¿è¡Œç»“æœï¼š $ go run main.go {\"Age\":18,\"Name\":\"dj\"} ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:6","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Metadata è§£ç æ—¶ä¼šäº§ç”Ÿä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œmapstructureå¯ä»¥ä½¿ç”¨Metadataæ”¶é›†è¿™äº›ä¿¡æ¯ã€‚Metadataç»“æ„å¦‚ä¸‹ï¼š // mapstructure.go type Metadata struct { Keys []string Unused []string } Metadataåªæœ‰ä¸¤ä¸ªå¯¼å‡ºå­—æ®µï¼š Keysï¼šè§£ç æˆåŠŸçš„é”®åï¼› Unusedï¼šåœ¨æºæ•°æ®ä¸­å­˜åœ¨ï¼Œä½†æ˜¯ç›®æ ‡ç»“æ„ä¸­ä¸å­˜åœ¨çš„é”®åã€‚ ä¸ºäº†æ”¶é›†è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨DecodeMetadataæ¥ä»£æ›¿Decodeæ–¹æ³•ï¼š type Person struct { Name string Age int } func main() { m := map[string]interface{}{ \"name\": \"dj\", \"age\": 18, \"job\": \"programmer\", } var p Person var metadata mapstructure.Metadata mapstructure.DecodeMetadata(m, \u0026p, \u0026metadata) fmt.Printf(\"keys:%#v unused:%#v\\n\", metadata.Keys, metadata.Unused) } å…ˆå®šä¹‰ä¸€ä¸ªMetadataç»“æ„ï¼Œä¼ å…¥DecodeMetadataæ”¶é›†è§£ç çš„ä¿¡æ¯ã€‚è¿è¡Œç»“æœï¼š $ go run main.go keys:[]string{\"Name\", \"Age\"} unused:[]string{\"job\"} ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:7","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"é”™è¯¯å¤„ç† mapstructureæ‰§è¡Œè½¬æ¢çš„è¿‡ç¨‹ä¸­ä¸å¯é¿å…åœ°ä¼šäº§ç”Ÿé”™è¯¯ï¼Œä¾‹å¦‚ JSON ä¸­æŸä¸ªé”®çš„ç±»å‹ä¸å¯¹åº” Go ç»“æ„ä½“ä¸­çš„å­—æ®µç±»å‹ä¸ä¸€è‡´ã€‚Decode/DecodeMetadataä¼šè¿”å›è¿™äº›é”™è¯¯ï¼š type Person struct { Name string Age int Emails []string } func main() { m := map[string]interface{}{ \"name\": 123, \"age\": \"bad value\", \"emails\": []int{1, 2, 3}, } var p Person err := mapstructure.Decode(m, \u0026p) if err != nil { fmt.Println(err.Error()) } } ä¸Šé¢ä»£ç ä¸­ï¼Œç»“æ„ä½“ä¸­Personä¸­å­—æ®µNameä¸ºstringç±»å‹ï¼Œä½†è¾“å…¥ä¸­nameä¸ºintç±»å‹ï¼›å­—æ®µAgeä¸ºintç±»å‹ï¼Œä½†è¾“å…¥ä¸­ageä¸ºstringç±»å‹ï¼›å­—æ®µEmailsä¸º[]stringç±»å‹ï¼Œä½†è¾“å…¥ä¸­emailsä¸º[]intç±»å‹ã€‚æ•…Decodeè¿”å›é”™è¯¯ã€‚è¿è¡Œç»“æœï¼š $ go run main.go 5 error(s) decoding: * 'Age' expected type 'int', got unconvertible type 'string' * 'Emails[0]' expected type 'string', got unconvertible type 'int' * 'Emails[1]' expected type 'string', got unconvertible type 'int' * 'Emails[2]' expected type 'string', got unconvertible type 'int' * 'Name' expected type 'string', got unconvertible type 'int' ä»é”™è¯¯ä¿¡æ¯ä¸­å¾ˆå®¹æ˜“çœ‹å‡ºå“ªé‡Œå‡ºé”™äº†ã€‚ å¼±ç±»å‹è¾“å…¥ æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³å¯¹ç»“æ„ä½“å­—æ®µç±»å‹å’Œmap[string]interface{}çš„å¯¹åº”é”®å€¼åšå¼ºç±»å‹ä¸€è‡´çš„æ ¡éªŒã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨WeakDecode/WeakDecodeMetadataæ–¹æ³•ï¼Œå®ƒä»¬ä¼šå°è¯•åšç±»å‹è½¬æ¢ï¼š type Person struct { Name string Age int Emails []string } func main() { m := map[string]interface{}{ \"name\": 123, \"age\": \"18\", \"emails\": []int{1, 2, 3}, } var p Person err := mapstructure.WeakDecode(m, \u0026p) if err == nil { fmt.Println(\"person:\", p) } else { fmt.Println(err.Error()) } } è™½ç„¶é”®nameå¯¹åº”çš„å€¼123æ˜¯intç±»å‹ï¼Œä½†æ˜¯åœ¨WeakDecodeä¸­ä¼šå°†å…¶è½¬æ¢ä¸ºstringç±»å‹ä»¥åŒ¹é…Person.Nameå­—æ®µçš„ç±»å‹ã€‚åŒæ ·çš„ï¼Œageçš„å€¼\"18\"æ˜¯stringç±»å‹ï¼Œåœ¨WeakDecodeä¸­ä¼šå°†å…¶è½¬æ¢ä¸ºintç±»å‹ä»¥åŒ¹é…Person.Ageå­—æ®µçš„ç±»å‹ã€‚ éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœç±»å‹è½¬æ¢å¤±è´¥äº†ï¼ŒWeakDecodeåŒæ ·ä¼šè¿”å›é”™è¯¯ã€‚ä¾‹å¦‚å°†ä¸Šä¾‹ä¸­çš„ageè®¾ç½®ä¸º\"bad value\"ï¼Œå®ƒå°±ä¸èƒ½è½¬ä¸ºintç±»å‹ï¼Œæ•…è€Œè¿”å›é”™è¯¯ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:8","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"è§£ç å™¨ é™¤äº†ä¸Šé¢ä»‹ç»çš„æ–¹æ³•å¤–ï¼Œmapstructureè¿˜æä¾›äº†æ›´çµæ´»çš„è§£ç å™¨ï¼ˆDecoderï¼‰ã€‚å¯ä»¥é€šè¿‡é…ç½®DecoderConfigå®ç°ä¸Šé¢ä»‹ç»çš„ä»»ä½•åŠŸèƒ½ï¼š // mapstructure.go type DecoderConfig struct { ErrorUnused bool ZeroFields bool WeaklyTypedInput bool Metadata *Metadata Result interface{} TagName string } å„ä¸ªå­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š ErrorUnusedï¼šä¸ºtrueæ—¶ï¼Œå¦‚æœè¾“å…¥ä¸­çš„é”®å€¼æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„å­—æ®µå°±è¿”å›é”™è¯¯ï¼› ZeroFieldsï¼šä¸ºtrueæ—¶ï¼Œåœ¨Decodeå‰æ¸…ç©ºç›®æ ‡mapã€‚ä¸ºfalseæ—¶ï¼Œåˆ™æ‰§è¡Œçš„æ˜¯mapçš„åˆå¹¶ã€‚ç”¨åœ¨structåˆ°mapçš„è½¬æ¢ä¸­ï¼› WeaklyTypedInputï¼šå®ç°WeakDecode/WeakDecodeMetadataçš„åŠŸèƒ½ï¼› Metadataï¼šä¸ä¸ºnilæ—¶ï¼Œæ”¶é›†Metadataæ•°æ®ï¼› Resultï¼šä¸ºç»“æœå¯¹è±¡ï¼Œåœ¨mapåˆ°structçš„è½¬æ¢ä¸­ï¼ŒResultä¸ºstructç±»å‹ã€‚åœ¨structåˆ°mapçš„è½¬æ¢ä¸­ï¼ŒResultä¸ºmapç±»å‹ï¼› TagNameï¼šé»˜è®¤ä½¿ç”¨mapstructureä½œä¸ºç»“æ„ä½“çš„æ ‡ç­¾åï¼Œå¯ä»¥é€šè¿‡è¯¥å­—æ®µè®¾ç½®ã€‚ çœ‹ç¤ºä¾‹ï¼š type Person struct { Name string Age int } func main() { m := map[string]interface{}{ \"name\": 123, \"age\": \"18\", \"job\": \"programmer\", } var p Person var metadata mapstructure.Metadata decoder, err := mapstructure.NewDecoder(\u0026mapstructure.DecoderConfig{ WeaklyTypedInput: true, Result: \u0026p, Metadata: \u0026metadata, }) if err != nil { log.Fatal(err) } err = decoder.Decode(m) if err == nil { fmt.Println(\"person:\", p) fmt.Printf(\"keys:%#v, unused:%#v\\n\", metadata.Keys, metadata.Unused) } else { fmt.Println(err.Error()) } } è¿™é‡Œç”¨Decoderçš„æ–¹å¼å®ç°äº†å‰é¢å¼±ç±»å‹è¾“å…¥å°èŠ‚ä¸­çš„ç¤ºä¾‹ä»£ç ã€‚å®é™…ä¸ŠWeakDecodeå†…éƒ¨å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼å®ç°çš„ï¼Œä¸‹é¢æ˜¯WeakDecodeçš„æºç ï¼š // mapstructure.go func WeakDecode(input, output interface{}) error { config := \u0026DecoderConfig{ Metadata: nil, Result: output, WeaklyTypedInput: true, } decoder, err := NewDecoder(config) if err != nil { return err } return decoder.Decode(input) } å†å®é™…ä¸Šï¼ŒDecode/DecodeMetadata/WeakDecodeMetadataå†…éƒ¨éƒ½æ˜¯å…ˆè®¾ç½®DecoderConfigçš„å¯¹åº”å­—æ®µï¼Œç„¶ååˆ›å»ºDecoderå¯¹è±¡ï¼Œæœ€åè°ƒç”¨å…¶Decodeæ–¹æ³•å®ç°çš„ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:9","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go leveldbåº“ githubåœ°å€ï¼šhttps://github.com/syndtr/goleveldb å®‰è£…ï¼š go get github.com/syndtr/goleveldb/leveldb ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-leveldb/:1:0","tags":["Go","leveldb"],"title":"Go leveldb","uri":"/posts/2023-11-11-go-leveldb/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç®€ä»‹ï¼š levelDBåœ¨åŒºå—é“¾ä¸­æ¯”è¾ƒå¸¸ç”¨ï¼Œå…¶æ˜¯Googleå¼€æºçš„æŒä¹…åŒ–å•æœºKey-Valueæ–‡ä»¶æ•°æ®åº“ï¼Œå…¶æ”¯æŒæŒ‰ç…§æ–‡ä»¶å¤§å°åˆ‡åˆ†æ–‡ä»¶çš„åŠŸèƒ½ã€‚levelDBå…·æœ‰å¾ˆé«˜çš„éšæœºå†™ï¼Œé¡ºåºè¯»/å†™æ€§èƒ½ï¼Œä½†æ˜¯éšæœºè¯»çš„æ€§èƒ½å¾ˆä¸€èˆ¬ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒlevelDBå¾ˆé€‚åˆåº”ç”¨åœ¨æŸ¥è¯¢è¾ƒå°‘ï¼Œè€Œå†™å¾ˆå¤šçš„åœºæ™¯ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-leveldb/:1:1","tags":["Go","leveldb"],"title":"Go leveldb","uri":"/posts/2023-11-11-go-leveldb/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"LevelDBç‰¹ç‚¹ 1ï¼‰keyå’Œvalueéƒ½æ˜¯ä»»æ„é•¿åº¦çš„å­—èŠ‚æ•°ç»„ï¼› 2ï¼‰entryï¼ˆå³ä¸€æ¡k-vè®°å½•ï¼‰é»˜è®¤æ˜¯æŒ‰ç…§keyçš„å­—å…¸é¡ºåºå­˜å‚¨çš„ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•ï¼› 3ï¼‰æä¾›äº†åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥æ¥å£ï¼› 4ï¼‰æ”¯æŒæ‰¹é‡æ“ä½œä»¥åŸå­æ“ä½œè¿›è¡Œï¼› 5ï¼‰å¼€æºåˆ›å»ºæ•°æ®å…¨æ™¯çš„snapshotï¼ˆå¿«ç…§ï¼‰ï¼Œå¹¶å…è®¸åœ¨å¿«ç…§ä¸­æŸ¥è¯¢ï¼› 6ï¼‰å¼€æºé€šè¿‡å‘å‰ï¼ˆåï¼‰è¿­ä»£å™¨éå†æ•°æ®ï¼ˆè¿­ä»£å™¨éšå«çš„åˆ›å»ºäº†ä¸€ä¸ªsnapshotï¼‰ï¼› 7ï¼‰è‡ªåŠ¨ä½¿ç”¨Snappyå‹ç¼©æ•°æ®ï¼› 8ï¼‰å¯ç§»æ¤æ€§ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-leveldb/:1:2","tags":["Go","leveldb"],"title":"Go leveldb","uri":"/posts/2023-11-11-go-leveldb/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"levelDBé™åˆ¶ 1ï¼‰NoSQLï¼Œä¸æ”¯æŒsqlè¯­å¥ï¼Œä¹Ÿä¸æ”¯æŒç´¢å¼•ï¼› 2ï¼‰ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åº“ï¼› 3ï¼‰æ²¡æœ‰å†…ç½®çš„C/Sæ¶æ„ï¼Œå¼€å‘è€…éœ€è¦ä½¿ç”¨levelDBåº“è‡ªå·±å°è£…ä¸€ä¸ªserverï¼› ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-leveldb/:1:3","tags":["Go","leveldb"],"title":"Go leveldb","uri":"/posts/2023-11-11-go-leveldb/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ä½¿ç”¨ï¼š 1ï¼‰æ‰“å¼€ã€åˆ›å»ºæ•°æ®åº“ db, err := leveldb.OpenFile(\"./block.db\", nil) 2ï¼‰å†™å…¥keyæ•°æ® err = db.Put([]byte(\"hello\"), []byte(\"world\"), nil) 3ï¼‰è¯»å–keyæ•°æ® data, _ := db.Get([]byte(\"hello\"), nil) 4ï¼‰éå†æ•°æ®åº“ iter := db.NewIterator(nil, nil) for iter.Next() { logger.Debug(iter.Key() + iter.Value()) } 5ï¼‰è¯»å–æŸä¸ªå‰ç¼€çš„æ‰€æœ‰KEYæ•°æ® è¯»å‡ºæ¥çš„æ•°æ®ä¼šè¢«æ”¾è¿›ä¸€ä¸ªIteratorä¸­ã€‚åŠ å…¥æ•°æ®åº“ç°åœ¨æœ‰key-$numä¸ºå¤´çš„æ•°æ¡æ•°æ® iter := db.NewIterator(dbUtil.BytesPrefix([]byte(\"key-\")), nil) éå†è¯»å–è¿™äº›æ•°æ® for iter.Next() { logger.Debug(string(iter.Key()) + string(iter.Value())) } è¯»å–æœ€åä¸€æ¡æ•°æ® if iter.Last() { logger.Debug(iter.Key() + iter.Value()) } 6ï¼‰åˆ é™¤æŸä¸ªKEY err = db.Delete([]byte(\"key-3\"), nil) 7ï¼‰æ‰¹é‡å†™ batch := new(leveldb.Batch) batch.Put([]byte(\"foo\"), []byte(\"value\")) batch.Put([]byte(\"bar\"), []byte(\"another value\")) batch.Delete([]byte(\"baz\")) err = db.Write(batch, nil) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-leveldb/:1:4","tags":["Go","leveldb"],"title":"Go leveldb","uri":"/posts/2023-11-11-go-leveldb/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go iniåº“ å‚è€ƒï¼šhttps://juejin.cn/post/6844904048764649479 ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:0","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç®€ä»‹ ini æ˜¯ Windows ä¸Šå¸¸ç”¨çš„é…ç½®æ–‡ä»¶æ ¼å¼ã€‚MySQL çš„ Windows ç‰ˆå°±æ˜¯ä½¿ç”¨ ini æ ¼å¼å­˜å‚¨é…ç½®çš„ã€‚ go-iniæ˜¯ Go è¯­è¨€ä¸­ç”¨äºæ“ä½œ ini æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“ã€‚ æœ¬æ–‡ä»‹ç»go-iniåº“çš„ä½¿ç”¨ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:1","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å¿«é€Ÿä½¿ç”¨ go-ini æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œä½¿ç”¨å‰éœ€è¦å®‰è£…ï¼š $ go get gopkg.in/ini.v1 ä¹Ÿå¯ä»¥ä½¿ç”¨ GitHub ä¸Šçš„ä»“åº“ï¼š $ go get github.com/go-ini/ini é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªmy.inié…ç½®æ–‡ä»¶ï¼š app_name = awesome web # possible values: DEBUG, INFO, WARNING, ERROR, FATAL log_level = DEBUG [mysql] ip = 127.0.0.1 port = 3306 user = dj password = 123456 database = awesome [redis] ip = 127.0.0.1 port = 6381 ä½¿ç”¨ go-ini åº“è¯»å–ï¼š package main import ( \"fmt\" \"log\" \"gopkg.in/ini.v1\" ) func main() { cfg, err := ini.Load(\"my.ini\") if err != nil { log.Fatal(\"Fail to read file: \", err) } fmt.Println(\"App Name:\", cfg.Section(\"\").Key(\"app_name\").String()) fmt.Println(\"Log Level:\", cfg.Section(\"\").Key(\"log_level\").String()) fmt.Println(\"MySQL IP:\", cfg.Section(\"mysql\").Key(\"ip\").String()) mysqlPort, err := cfg.Section(\"mysql\").Key(\"port\").Int() if err != nil { log.Fatal(err) } fmt.Println(\"MySQL Port:\", mysqlPort) fmt.Println(\"MySQL User:\", cfg.Section(\"mysql\").Key(\"user\").String()) fmt.Println(\"MySQL Password:\", cfg.Section(\"mysql\").Key(\"password\").String()) fmt.Println(\"MySQL Database:\", cfg.Section(\"mysql\").Key(\"database\").String()) fmt.Println(\"Redis IP:\", cfg.Section(\"redis\").Key(\"ip\").String()) redisPort, err := cfg.Section(\"redis\").Key(\"port\").Int() if err != nil { log.Fatal(err) } fmt.Println(\"Redis Port:\", redisPort) } åœ¨ ini æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªé”®å€¼å¯¹å ç”¨ä¸€è¡Œï¼Œä¸­é—´ä½¿ç”¨=éš”å¼€ã€‚ä»¥#å¼€å¤´çš„å†…å®¹ä¸ºæ³¨é‡Šã€‚ini æ–‡ä»¶æ˜¯ä»¥åˆ†åŒºï¼ˆsectionï¼‰ç»„ç»‡çš„ã€‚ åˆ†åŒºä»¥[name]å¼€å§‹ï¼Œåœ¨ä¸‹ä¸€ä¸ªåˆ†åŒºå‰ç»“æŸã€‚æ‰€æœ‰åˆ†åŒºå‰çš„å†…å®¹å±äºé»˜è®¤åˆ†åŒºï¼Œå¦‚my.iniæ–‡ä»¶ä¸­çš„app_nameå’Œlog_levelã€‚ ä½¿ç”¨go-iniè¯»å–é…ç½®æ–‡ä»¶çš„æ­¥éª¤å¦‚ä¸‹ï¼š é¦–å…ˆè°ƒç”¨ini.LoadåŠ è½½æ–‡ä»¶ï¼Œå¾—åˆ°é…ç½®å¯¹è±¡cfgï¼› ç„¶åä»¥åˆ†åŒºåè°ƒç”¨é…ç½®å¯¹è±¡çš„Sectionæ–¹æ³•å¾—åˆ°å¯¹åº”çš„åˆ†åŒºå¯¹è±¡sectionï¼Œé»˜è®¤åˆ†åŒºçš„åå­—ä¸º\"\"ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ini.DefaultSectionï¼› ä»¥é”®åè°ƒç”¨åˆ†åŒºå¯¹è±¡çš„Keyæ–¹æ³•å¾—åˆ°å¯¹åº”çš„é…ç½®é¡¹keyå¯¹è±¡ï¼› ç”±äºæ–‡ä»¶ä¸­è¯»å–å‡ºæ¥çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œkeyå¯¹è±¡éœ€æ ¹æ®ç±»å‹è°ƒç”¨å¯¹åº”çš„æ–¹æ³•è¿”å›å…·ä½“ç±»å‹çš„å€¼ä½¿ç”¨ï¼Œå¦‚ä¸Šé¢çš„Stringã€MustIntæ–¹æ³•ã€‚ è¿è¡Œä»¥ä¸‹ç¨‹åºï¼Œå¾—åˆ°è¾“å‡ºï¼š App Name: awesome web Log Level: DEBUG MySQL IP: 127.0.0.1 MySQL Port: 3306 MySQL User: dj MySQL Password: 123456 MySQL Database: awesome Redis IP: 127.0.0.1 Redis Port: 6381 é…ç½®æ–‡ä»¶ä¸­å­˜å‚¨çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ç±»å‹ä¸ºå­—ç¬¦ä¸²çš„é…ç½®é¡¹ä¸ä¼šå‡ºç°ç±»å‹è½¬æ¢å¤±è´¥çš„ï¼Œæ•…String()æ–¹æ³•åªè¿”å›ä¸€ä¸ªå€¼ã€‚ ä½†å¦‚æœç±»å‹ä¸ºInt/Uint/Float64è¿™äº›æ—¶ï¼Œè½¬æ¢å¯èƒ½å¤±è´¥ã€‚æ‰€ä»¥Int()/Uint()/Float64()è¿”å›ä¸€ä¸ªå€¼å’Œä¸€ä¸ªé”™è¯¯ã€‚ è¦ç•™æ„è¿™ç§ä¸ä¸€è‡´ï¼å¦‚æœæˆ‘ä»¬å°†é…ç½®ä¸­ redis ç«¯å£æ”¹æˆéæ³•çš„æ•°å­— x6381ï¼Œé‚£ä¹ˆè¿è¡Œç¨‹åºå°†æŠ¥é”™ï¼š 2020/01/14 22:43:13 strconv.ParseInt: parsing \"x6381\": invalid syntax å¤åˆ¶ä»£ç  ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:2","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Must*ä¾¿æ·æ–¹æ³• å¦‚æœæ¯æ¬¡å–å€¼éƒ½éœ€è¦è¿›è¡Œé”™è¯¯åˆ¤æ–­ï¼Œé‚£ä¹ˆä»£ç å†™èµ·æ¥ä¼šéå¸¸ç¹çã€‚ä¸ºæ­¤ï¼Œgo-iniä¹Ÿæä¾›å¯¹åº”çš„MustTypeï¼ˆType ä¸ºInit/Uint/Float64ç­‰ï¼‰æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åªè¿”å›ä¸€ä¸ªå€¼ã€‚ åŒæ—¶å®ƒæ¥å—å¯å˜å‚æ•°ï¼Œå¦‚æœç±»å‹æ— æ³•è½¬æ¢ï¼Œå–å‚æ•°ä¸­ç¬¬ä¸€ä¸ªå€¼è¿”å›ï¼Œå¹¶ä¸”è¯¥å‚æ•°è®¾ç½®ä¸ºè¿™ä¸ªé…ç½®çš„å€¼ï¼Œä¸‹æ¬¡è°ƒç”¨è¿”å›è¿™ä¸ªå€¼ï¼š package main import ( \"fmt\" \"log\" \"gopkg.in/ini.v1\" ) func main() { cfg, err := ini.Load(\"my.ini\") if err != nil { log.Fatal(\"Fail to read file: \", err) } redisPort, err := cfg.Section(\"redis\").Key(\"port\").Int() if err != nil { fmt.Println(\"before must, get redis port error:\", err) } else { fmt.Println(\"before must, get redis port:\", redisPort) } fmt.Println(\"redis Port:\", cfg.Section(\"redis\").Key(\"port\").MustInt(6381)) redisPort, err = cfg.Section(\"redis\").Key(\"port\").Int() if err != nil { fmt.Println(\"after must, get redis port error:\", err) } else { fmt.Println(\"after must, get redis port:\", redisPort) } } é…ç½®æ–‡ä»¶è¿˜æ˜¯ redis ç«¯å£ä¸ºéæ•°å­— x6381 æ—¶çš„çŠ¶æ€ï¼Œè¿è¡Œç¨‹åºï¼š before must, get redis port error: strconv.ParseInt: parsing \"x6381\": invalid syntax redis Port: 6381 after must, get redis port: 6381 å¤åˆ¶ä»£ç  æˆ‘ä»¬çœ‹åˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨Intè¿”å›é”™è¯¯ï¼Œä»¥ 6381 ä¸ºå‚æ•°è°ƒç”¨MustIntä¹‹åï¼Œå†æ¬¡è°ƒç”¨Intï¼ŒæˆåŠŸè¿”å› 6381ã€‚MustIntæºç ä¹Ÿæ¯”è¾ƒç®€å•ï¼š // gopkg.in/ini.v1/key.go func (k *Key) MustInt(defaultVal ...int) int { val, err := k.Int() if len(defaultVal) \u003e 0 \u0026\u0026 err != nil { k.value = strconv.FormatInt(int64(defaultVal[0]), 10) return defaultVal[0] } return val } å¤åˆ¶ä»£ç  ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:3","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"åˆ†åŒºæ“ä½œ è·å–ä¿¡æ¯ åœ¨åŠ è½½é…ç½®ä¹‹åï¼Œå¯ä»¥é€šè¿‡Sectionsæ–¹æ³•è·å–æ‰€æœ‰åˆ†åŒºï¼ŒSectionStrings()æ–¹æ³•è·å–æ‰€æœ‰åˆ†åŒºåã€‚ sections := cfg.Sections() names := cfg.SectionStrings() fmt.Println(\"sections: \", sections) fmt.Println(\"names: \", names) å¤åˆ¶ä»£ç  è¿è¡Œè¾“å‡º 3 ä¸ªåˆ†åŒºï¼š [DEFAULT mysql redis] å¤åˆ¶ä»£ç  è°ƒç”¨Section(name)è·å–åä¸ºnameçš„åˆ†åŒºï¼Œå¦‚æœè¯¥åˆ†åŒºä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåˆ†åŒºè¿”å›ï¼š newSection := cfg.Section(\"new\") fmt.Println(\"new section: \", newSection) fmt.Println(\"names: \", cfg.SectionStrings()) åˆ›å»ºä¹‹åè°ƒç”¨SectionStringsæ–¹æ³•ï¼Œæ–°åˆ†åŒºä¹Ÿä¼šè¿”å›ï¼š names: [DEFAULT mysql redis new] ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªæ–°åˆ†åŒºï¼Œå¦‚æœåˆ†åŒºå·²å­˜åœ¨ï¼Œåˆ™è¿”å›é”™è¯¯ï¼š err := cfg.NewSection(\"new\") çˆ¶å­åˆ†åŒº åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å ä½ç¬¦%(name)sè¡¨ç¤ºç”¨ä¹‹å‰å·²å®šä¹‰çš„é”®nameçš„å€¼æ¥æ›¿æ¢ï¼Œè¿™é‡Œçš„sè¡¨ç¤ºå€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼š NAME = ini VERSION = v1 IMPORT_PATH = gopkg.in/%(NAME)s.%(VERSION)s [package] CLONE_URL = https://%(IMPORT_PATH)s [package.sub] ä¸Šé¢åœ¨é»˜è®¤åˆ†åŒºä¸­è®¾ç½®IMPORT_PATHçš„å€¼æ—¶ï¼Œä½¿ç”¨äº†å‰é¢å®šä¹‰çš„NAMEå’ŒVERSIONã€‚ åœ¨packageåˆ†åŒºä¸­è®¾ç½®CLONE_URLçš„å€¼æ—¶ï¼Œä½¿ç”¨äº†é»˜è®¤åˆ†åŒºä¸­å®šä¹‰çš„IMPORT_PATHã€‚ æˆ‘ä»¬è¿˜å¯ä»¥åœ¨åˆ†åŒºåä¸­ä½¿ç”¨.è¡¨ç¤ºä¸¤ä¸ªæˆ–å¤šä¸ªåˆ†åŒºä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼Œä¾‹å¦‚package.subçš„çˆ¶åˆ†åŒºä¸ºpackageï¼Œpackageçš„çˆ¶åˆ†åŒºä¸ºé»˜è®¤åˆ†åŒºã€‚ å¦‚æœæŸä¸ªé”®åœ¨å­åˆ†åŒºä¸­ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåœ¨å®ƒçš„çˆ¶åˆ†åŒºä¸­å†æ¬¡æŸ¥æ‰¾ï¼Œç›´åˆ°æ²¡æœ‰çˆ¶åˆ†åŒºä¸ºæ­¢ï¼š cfg, err := ini.Load(\"parent_child.ini\") if err != nil { fmt.Println(\"Fail to read file: \", err) return } fmt.Println(\"Clone url from package.sub:\", cfg.Section(\"package.sub\").Key(\"CLONE_URL\").String()) è¿è¡Œç¨‹åºè¾“å‡ºï¼š Clone url from package.sub: https://gopkg.in/ini.v1 å­åˆ†åŒºä¸­package.subä¸­æ²¡æœ‰é”®CLONE_URLï¼Œè¿”å›äº†çˆ¶åˆ†åŒºpackageä¸­çš„å€¼ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:4","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ä¿å­˜é…ç½® æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†ç”Ÿæˆçš„é…ç½®å†™åˆ°æ–‡ä»¶ä¸­ã€‚ä¾‹å¦‚åœ¨å†™å·¥å…·çš„æ—¶å€™ã€‚ä¿å­˜æœ‰ä¸¤ç§ç±»å‹çš„æ¥å£ï¼Œä¸€ç§ç›´æ¥ä¿å­˜åˆ°æ–‡ä»¶ï¼Œå¦ä¸€ç§å†™å…¥åˆ°io.Writerä¸­ï¼š err = cfg.SaveTo(\"my.ini\") err = cfg.SaveToIndent(\"my.ini\", \"\\t\") cfg.WriteTo(writer) cfg.WriteToIndent(writer, \"\\t\") ä¸‹é¢æˆ‘ä»¬é€šè¿‡ç¨‹åºç”Ÿæˆå‰é¢ä½¿ç”¨çš„é…ç½®æ–‡ä»¶my.iniå¹¶ä¿å­˜ï¼š package main import ( \"fmt\" \"os\" \"gopkg.in/ini.v1\" ) func main() { cfg := ini.Empty() defaultSection := cfg.Section(\"\") defaultSection.NewKey(\"app_name\", \"awesome web\") defaultSection.NewKey(\"log_level\", \"DEBUG\") mysqlSection, err := cfg.NewSection(\"mysql\") if err != nil { fmt.Println(\"new mysql section failed:\", err) return } mysqlSection.NewKey(\"ip\", \"127.0.0.1\") mysqlSection.NewKey(\"port\", \"3306\") mysqlSection.NewKey(\"user\", \"root\") mysqlSection.NewKey(\"password\", \"123456\") mysqlSection.NewKey(\"database\", \"awesome\") redisSection, err := cfg.NewSection(\"redis\") if err != nil { fmt.Println(\"new redis section failed:\", err) return } redisSection.NewKey(\"ip\", \"127.0.0.1\") redisSection.NewKey(\"port\", \"6381\") err = cfg.SaveTo(\"my.ini\") if err != nil { fmt.Println(\"SaveTo failed: \", err) } err = cfg.SaveToIndent(\"my-pretty.ini\", \"\\t\") if err != nil { fmt.Println(\"SaveToIndent failed: \", err) } cfg.WriteTo(os.Stdout) fmt.Println() cfg.WriteToIndent(os.Stdout, \"\\t\") } è¿è¡Œç¨‹åºï¼Œç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶my.iniå’Œmy-pretty.iniï¼ŒåŒæ—¶æ§åˆ¶å°è¾“å‡ºæ–‡ä»¶å†…å®¹ã€‚ my.iniï¼š app_name = awesome web log_level = DEBUG [mysql] ip = 127.0.0.1 port = 3306 user = root password = 123456 database = awesome [redis] ip = 127.0.0.1 port = 6381 my-pretty.iniï¼š app_name = awesome web log_level = DEBUG [mysql] ip = 127.0.0.1 port = 3306 user = root password = 123456 database = awesome [redis] ip = 127.0.0.1 port = 6381 *Indentæ–¹æ³•ä¼šå¯¹å­åˆ†åŒºä¸‹çš„é”®å¢åŠ ç¼©è¿›ï¼Œçœ‹èµ·æ¥ç¾è§‚ä¸€ç‚¹ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:5","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"åˆ†åŒºä¸ç»“æ„ä½“å­—æ®µæ˜ å°„ å®šä¹‰ç»“æ„å˜é‡ï¼ŒåŠ è½½å®Œé…ç½®æ–‡ä»¶åï¼Œè°ƒç”¨MapToå°†é…ç½®é¡¹èµ‹å€¼åˆ°ç»“æ„å˜é‡çš„å¯¹åº”å­—æ®µä¸­ã€‚ package main import ( \"fmt\" \"gopkg.in/ini.v1\" ) type Config struct { AppName string `ini:\"app_name\"` LogLevel string `ini:\"log_level\"` MySQL MySQLConfig `ini:\"mysql\"` Redis RedisConfig `ini:\"redis\"` } type MySQLConfig struct { IP string `ini:\"ip\"` Port int `ini:\"port\"` User string `ini:\"user\"` Password string `ini:\"password\"` Database string `ini:\"database\"` } type RedisConfig struct { IP string `ini:\"ip\"` Port int `ini:\"port\"` } func main() { cfg, err := ini.Load(\"my.ini\") if err != nil { fmt.Println(\"load my.ini failed: \", err) } c := Config{} cfg.MapTo(\u0026c) fmt.Println(c) } MapToå†…éƒ¨ä½¿ç”¨äº†åå°„ï¼Œæ‰€ä»¥ç»“æ„ä½“å­—æ®µå¿…é¡»éƒ½æ˜¯å¯¼å‡ºçš„ã€‚å¦‚æœé”®åä¸å­—æ®µåä¸ç›¸åŒï¼Œé‚£ä¹ˆéœ€è¦åœ¨ç»“æ„æ ‡ç­¾ä¸­æŒ‡å®šå¯¹åº”çš„é”®åã€‚ è¿™ä¸€ç‚¹ä¸ Go æ ‡å‡†åº“encoding/jsonå’Œencoding/xmlä¸åŒã€‚æ ‡å‡†åº“json/xmlè§£ææ—¶å¯ä»¥å°†é”®åapp_nameå¯¹åº”åˆ°å­—æ®µåAppNameã€‚ æˆ–è®¸è¿™æ˜¯go-iniåº“å¯ä»¥ä¼˜åŒ–çš„ç‚¹ï¼Ÿ å…ˆåŠ è½½ï¼Œå†æ˜ å°„æœ‰ç‚¹ç¹çï¼Œç›´æ¥ä½¿ç”¨ini.MapToå°†ä¸¤æ­¥åˆå¹¶ï¼š err = ini.MapTo(\u0026c, \"my.ini\") å¤åˆ¶ä»£ç  ä¹Ÿå¯ä»¥åªæ˜ å°„ä¸€ä¸ªåˆ†åŒºï¼š mysqlCfg := MySQLConfig{} err = cfg.Section(\"mysql\").MapTo(\u0026mysqlCfg) è¿˜å¯ä»¥é€šè¿‡ç»“æ„ä½“ç”Ÿæˆé…ç½®ï¼š cfg := ini.Empty() c := Config { AppName: \"awesome web\", LogLevel: \"DEBUG\", MySQL: MySQLConfig { IP: \"127.0.0.1\", Port: 3306, User: \"root\", Password:\"123456\", Database:\"awesome\", }, Redis: RedisConfig { IP: \"127.0.0.1\", Port: 6381, }, } err := ini.ReflectFrom(cfg, \u0026c) if err != nil { fmt.Println(\"ReflectFrom failed: \", err) return } err = cfg.SaveTo(\"my-copy.ini\") if err != nil { fmt.Println(\"SaveTo failed: \", err) return } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:6","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ€»ç»“ æœ¬æ–‡ä»‹ç»äº†go-iniåº“çš„åŸºæœ¬ç”¨æ³•å’Œä¸€äº›æœ‰è¶£çš„ç‰¹æ€§ã€‚ç¤ºä¾‹ä»£ç å·²ä¸Šä¼ GitHubã€‚ å…¶å®go-iniè¿˜æœ‰å¾ˆå¤šé«˜çº§ç‰¹æ€§ã€‚å®˜æ–¹æ–‡æ¡£éå¸¸è¯¦ç»†ï¼Œæ¨èå»çœ‹ï¼Œè€Œä¸”æœ‰ä¸­æ–‡å“Ÿ~ ä½œè€…æ— é—»ï¼Œç›¸ä¿¡åš Go å¼€å‘çš„éƒ½ä¸é™Œç”Ÿã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:7","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å‚è€ƒ go-ini GitHub ä»“åº“ go-ini å®˜æ–¹æ–‡æ¡£ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:8","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"homedirå®¶ç›®å½• GitHubåœ°å€ï¼šhttps://github.com/mitchellh/go-homedir ä½¿ç”¨os/userè·å–ç”¨æˆ·å®¶ç›®å½•ï¼š package main import ( \"fmt\" \"log\" \"os/user\" ) func main() { u, err := user.Current() if err != nil { log.Fatal(err) } fmt.Println(\"Home dir:\", u.HomeDir) } é‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦go-homediråº“ï¼Ÿ åœ¨ Darwin ç³»ç»Ÿä¸Šï¼Œæ ‡å‡†åº“os/userçš„ä½¿ç”¨éœ€è¦ cgoã€‚æ‰€ä»¥ï¼Œä»»ä½•ä½¿ç”¨os/userçš„ä»£ç éƒ½ä¸èƒ½äº¤å‰ç¼–è¯‘ã€‚ ä½†æ˜¯ï¼Œå¤§å¤šæ•°äººä½¿ç”¨os/userçš„ç›®çš„ä»…ä»…åªæ˜¯æƒ³è·å–ä¸»ç›®å½•ã€‚å› æ­¤ï¼Œgo-homediråº“å‡ºç°äº†ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-homedir/:1:0","tags":["Go","homedir"],"title":"Go homedir","uri":"/posts/2023-11-11-go-homedir/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å¿«é€Ÿä½¿ç”¨ go-homediræ˜¯ç¬¬ä¸‰æ–¹åŒ…ï¼Œä½¿ç”¨å‰éœ€è¦å…ˆå®‰è£…ï¼š $ go get github.com/mitchellh/go-homedir ä½¿ç”¨éå¸¸ç®€å•ï¼š package main import ( \"fmt\" \"log\" \"github.com/mitchellh/go-homedir\" ) func main() { dir, err := homedir.Dir() if err != nil { log.Fatal(err) } fmt.Println(\"Home dir:\", dir) dir = \"~/golang/src\" expandedDir, err := homedir.Expand(dir) if err != nil { log.Fatal(err) } fmt.Printf(\"Expand of %s is: %s\\n\", dir, expandedDir) } go-homediræœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼š Dirï¼šè·å–ç”¨æˆ·ä¸»ç›®å½•ï¼› Expandï¼šå°†è·¯å¾„ä¸­çš„ç¬¬ä¸€ä¸ª~æ‰©å±•æˆç”¨æˆ·ä¸»ç›®å½•ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-homedir/:1:1","tags":["Go","homedir"],"title":"Go homedir","uri":"/posts/2023-11-11-go-homedir/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"é«˜çº§ç”¨æ³• ç”±äºDirçš„è°ƒç”¨å¯èƒ½æ¶‰åŠä¸€äº›ç³»ç»Ÿè°ƒç”¨å’Œå¤–éƒ¨æ‰§è¡Œå‘½ä»¤ï¼Œå¤šæ¬¡è°ƒç”¨è´¹æ€§èƒ½ã€‚æ‰€ä»¥go-homediræä¾›äº†ç¼“å­˜çš„åŠŸèƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜æ˜¯å¼€å¯çš„ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†DisableCacheè®¾ç½®ä¸ºfalseæ¥å…³é—­å®ƒã€‚ package main import ( \"fmt\" \"log\" \"github.com/mitchellh/go-homedir\" ) func main() { homedir.DisableCache = false dir, err := homedir.Dir() if err != nil { log.Fatal(err) } fmt.Println(\"Home dir:\", dir) } ä½¿ç”¨ç¼“å­˜æ—¶ï¼Œå¦‚æœç¨‹åºè¿è¡Œä¸­ä¿®æ”¹äº†ä¸»ç›®å½•ï¼Œå†æ¬¡è°ƒç”¨Dirè¿˜æ˜¯è¿”å›ä¹‹å‰çš„ç›®å½•ã€‚å¦‚æœéœ€è¦è·å–æœ€æ–°çš„ä¸»ç›®å½•ï¼Œå¯ä»¥å…ˆè°ƒç”¨Resetæ¸…é™¤ç¼“å­˜ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-homedir/:1:2","tags":["Go","homedir"],"title":"Go homedir","uri":"/posts/2023-11-11-go-homedir/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å®ç° go-homediræºç åªæœ‰ä¸€ä¸ªæ–‡ä»¶homedir.goï¼Œä»Šå¤©æˆ‘ä»¬å¤§æ¦‚çœ‹ä¸€ä¸‹Dirçš„å®ç°ï¼Œå»æ‰ç¼“å­˜ç›¸å…³ä»£ç ï¼š func Dir() (string, error) { var result string var err error if runtime.GOOS == \"windows\" { result, err = dirWindows() } else { // Unix-like system, so just assume Unix result, err = dirUnix() } if err != nil { return \"\", err } return result, nil } åˆ¤æ–­å½“å‰çš„ç³»ç»Ÿæ˜¯windowsè¿˜æ˜¯ç±» Unixï¼Œåˆ†åˆ«è°ƒç”¨ä¸åŒçš„æ–¹æ³•ã€‚å…ˆçœ‹ windows çš„ï¼Œæ¯”è¾ƒç®€å•ï¼š func dirWindows() (string, error) { // First prefer the HOME environmental variable if home := os.Getenv(\"HOME\"); home != \"\" { return home, nil } // Prefer standard environment variable USERPROFILE if home := os.Getenv(\"USERPROFILE\"); home != \"\" { return home, nil } drive := os.Getenv(\"HOMEDRIVE\") path := os.Getenv(\"HOMEPATH\") home := drive + path if drive == \"\" || path == \"\" { return \"\", errors.New(\"HOMEDRIVE, HOMEPATH, or USERPROFILE are blank\") } return home, nil } æµç¨‹å¦‚ä¸‹ï¼š è¯»å–ç¯å¢ƒå˜é‡HOMEï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œè¿”å›è¿™ä¸ªå€¼ï¼› è¯»å–ç¯å¢ƒå˜é‡USERPROFILEï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œè¿”å›è¿™ä¸ªå€¼ï¼› è¯»å–ç¯å¢ƒå˜é‡HOMEDRIVEå’ŒHOMEPATHï¼Œå¦‚æœä¸¤è€…éƒ½ä¸ä¸ºç©ºï¼Œæ‹¼æ¥è¿™ä¸¤ä¸ªå€¼è¿”å›ã€‚ ç±» Unix ç³»ç»Ÿçš„å®ç°ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼š func dirUnix() (string, error) { homeEnv := \"HOME\" if runtime.GOOS == \"plan9\" { // On plan9, env vars are lowercase. homeEnv = \"home\" } // First prefer the HOME environmental variable if home := os.Getenv(homeEnv); home != \"\" { return home, nil } var stdout bytes.Buffer // If that fails, try OS specific commands if runtime.GOOS == \"darwin\" { cmd := exec.Command(\"sh\", \"-c\", `dscl -q . -read /Users/\"$(whoami)\" NFSHomeDirectory | sed 's/^[^ ]*: //'`) cmd.Stdout = \u0026stdout if err := cmd.Run(); err == nil { result := strings.TrimSpace(stdout.String()) if result != \"\" { return result, nil } } } else { cmd := exec.Command(\"getent\", \"passwd\", strconv.Itoa(os.Getuid())) cmd.Stdout = \u0026stdout if err := cmd.Run(); err != nil { // If the error is ErrNotFound, we ignore it. Otherwise, return it. if err != exec.ErrNotFound { return \"\", err } } else { if passwd := strings.TrimSpace(stdout.String()); passwd != \"\" { // username:password:uid:gid:gecos:home:shell passwdParts := strings.SplitN(passwd, \":\", 7) if len(passwdParts) \u003e 5 { return passwdParts[5], nil } } } } // If all else fails, try the shell stdout.Reset() cmd := exec.Command(\"sh\", \"-c\", \"cd \u0026\u0026 pwd\") cmd.Stdout = \u0026stdout if err := cmd.Run(); err != nil { return \"\", err } result := strings.TrimSpace(stdout.String()) if result == \"\" { return \"\", errors.New(\"blank output when reading home directory\") } return result, nil } æµç¨‹å¦‚ä¸‹ï¼š å…ˆè¯»å–ç¯å¢ƒå˜é‡HOMEï¼ˆæ³¨æ„ plan9 ç³»ç»Ÿä¸Šä¸ºhomeï¼‰ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œè¿”å›è¿™ä¸ªå€¼ï¼› ä½¿ç”¨getnetå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿçš„æ•°æ®åº“ä¸­çš„ç›¸å…³è®°å½•ï¼Œæˆ‘ä»¬çŸ¥é“passwdæ–‡ä»¶ä¸­å­˜å‚¨äº†ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚ä½¿ç”¨getentå‘½ä»¤æŸ¥çœ‹passwdä¸­å½“å‰ç”¨æˆ·çš„é‚£æ¡è®°å½•ï¼Œç„¶åä»ä¸­æ‰¾åˆ°ä¸»ç›®å½•éƒ¨åˆ†è¿”å›ï¼› å¦‚æœä¸Šä¸€ä¸ªæ­¥éª¤å¤±è´¥äº†ï¼Œæˆ‘ä»¬çŸ¥é“cdåä¸åŠ å‚æ•°æ˜¯ç›´æ¥åˆ‡æ¢åˆ°ç”¨æˆ·ä¸»ç›®å½•çš„ï¼Œè€Œpwdå¯ä»¥æ˜¾ç¤ºå½“å‰ç›®å½•ã€‚é‚£ä¹ˆå°±å¯ä»¥ç»“åˆè¿™ä¸¤ä¸ªå‘½ä»¤è¿”å›ä¸»ç›®å½•ã€‚ è¿™é‡Œåˆ†ææºç å¹¶ä¸æ˜¯è¡¨ç¤ºä½¿ç”¨ä»»ä½•åº“éƒ½è¦ç†Ÿæ‚‰å®ƒçš„æºç ï¼Œæ¯•ç«Ÿä½¿ç”¨åº“å°±æ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘ã€‚ ä½†æ˜¯æºç æ˜¯æˆ‘ä»¬å­¦ä¹ å’Œæé«˜çš„ä¸€ä¸ªéå¸¸é‡è¦çš„é€”å¾„ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨åº“é‡åˆ°é—®é¢˜çš„æ—¶å€™ä¹Ÿè¦æœ‰èƒ½åŠ›ä»æ–‡æ¡£æˆ–ç”šè‡³æºç ä¸­æŸ¥æ‰¾åŸå› ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-homedir/:1:3","tags":["Go","homedir"],"title":"Go homedir","uri":"/posts/2023-11-11-go-homedir/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go Fsnotifyåº“ å®˜æ–¹ä»“åº“ï¼šgithub.com/fsnotify/fsnotify ç”¨äºç›‘æ§æ–‡ä»¶æˆ–ç›®å½•çš„æ”¹å˜ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fsnotify/:1:0","tags":["Go","fsnotify"],"title":"Go fsnotify","uri":"/posts/2023-11-11-go-fsnotify/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"1ã€å®˜ç½‘ç¤ºä¾‹ package main import ( \"log\" \"github.com/fsnotify/fsnotify\" ) func main() { watcher, err := fsnotify.NewWatcher() if err != nil { log.Fatal(err) } defer watcher.Close() done := make(chan bool) go func() { for { select { case event := \u003c-watcher.Events: log.Println(\"event:\", event) if event.Op\u0026fsnotify.Write == fsnotify.Write { log.Println(\"modified file:\", event.Name) } case err := \u003c-watcher.Errors: log.Println(\"error:\", err) } } }() err = watcher.Add(\"/tmp/foo\") if err != nil { log.Fatal(err) } \u003c-done } fsnotifyçš„ä½¿ç”¨æ¯”è¾ƒç®€å•: å…ˆæ¡ç”¨NewWatcheråˆ›å»ºä¸€ä¸ªç›‘å¬å™¨ ç„¶åæ¡ç”¨ç›‘å¬å™¨çš„Addç›‘å¬æ–‡ä»¶æˆ–ç›®å½• å¦‚æœç›®å½•æˆ–æ–‡ä»¶æœ‰äº‹ä»¶å‘ç”Ÿï¼Œç›‘å¬å™¨çš„é€šé“Eventså¯ä»¥å–å‡ºäº‹ä»¶ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼Œç›‘å¬å™¨ä¸­çš„é€šé“Errorså¯ä»¥å–å‡ºé”™è¯¯ä¿¡æ¯ã€‚ å…¶å®ï¼Œé‡å‘½åæ—¶ä¼šäº§ç”Ÿä¸¤ä¸ªäº‹ä»¶ï¼Œä¸€ä¸ªæ˜¯åŸæ–‡ä»¶çš„RENAMEäº‹ä»¶ï¼Œä¸€ä¸ªæ˜¯æ–°æ–‡ä»¶çš„CREATEäº‹ä»¶ã€‚ æ³¨æ„ï¼Œfsnotifyä½¿ç”¨äº†æ“ä½œç³»ç»Ÿæ¥å£ï¼Œç›‘å¬å™¨ä¸­ä¿å­˜äº†ç³»ç»Ÿèµ„æºçš„å¥æŸ„ï¼Œæ‰€ä»¥ä½¿ç”¨åéœ€è¦å…³é—­ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fsnotify/:1:1","tags":["Go","fsnotify"],"title":"Go fsnotify","uri":"/posts/2023-11-11-go-fsnotify/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"2ã€äº‹ä»¶ ä¸Šé¢ç¤ºä¾‹ä¸­çš„äº‹ä»¶æ˜¯fsnotify.Eventç±»å‹ï¼š // fsnotify/fsnotify.go type Event struct { Name string Op Op } äº‹ä»¶åªæœ‰ä¸¤ä¸ªå­—æ®µï¼ŒNameè¡¨ç¤ºå‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶æˆ–ç›®å½•åï¼ŒOpè¡¨ç¤ºå…·ä½“çš„å˜åŒ–ã€‚Opæœ‰ 5 ä¸­å–å€¼ï¼š // fsnotify/fsnotify.go type Op uint32 const ( Create Op = 1 \u003c\u003c iota Write Remove Rename Chmod ) 3ã€ç›‘æ§ç›®å½• å‚è€ƒé“¾æ¥ï¼šhttps://blog.csdn.net/finghting321/article/details/102852746 package main; import ( \"github.com/fsnotify/fsnotify\" \"fmt\" \"path/filepath\" \"os\" ) type NotifyFile struct { watch *fsnotify.Watcher } func NewNotifyFile() *NotifyFile { w := new(NotifyFile) w.watch, _ = fsnotify.NewWatcher() return w } //ç›‘æ§ç›®å½• func (this *NotifyFile) WatchDir(dir string) { //é€šè¿‡Walkæ¥éå†ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½• filepath.Walk(dir, func(path string, info os.FileInfo, err error) error { //åˆ¤æ–­æ˜¯å¦ä¸ºç›®å½•ï¼Œç›‘æ§ç›®å½•,ç›®å½•ä¸‹æ–‡ä»¶ä¹Ÿåœ¨ç›‘æ§èŒƒå›´å†…ï¼Œä¸éœ€è¦åŠ  if info.IsDir() { path, err := filepath.Abs(path) if err != nil { return err } err = this.watch.Add(path) if err != nil { return err } fmt.Println(\"ç›‘æ§ : \", path) } return nil }) go this.WatchEvent() //åç¨‹ } func (this *NotifyFile) WatchEvent() { for { select { case ev := \u003c-this.watch.Events: { if ev.Op\u0026fsnotify.Create == fsnotify.Create { fmt.Println(\"åˆ›å»ºæ–‡ä»¶ : \", ev.Name) //è·å–æ–°åˆ›å»ºæ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ç›®å½•ï¼Œåˆ™åŠ å…¥ç›‘æ§ä¸­ file, err := os.Stat(ev.Name) if err == nil \u0026\u0026 file.IsDir() { this.watch.Add(ev.Name) fmt.Println(\"æ·»åŠ ç›‘æ§ : \", ev.Name) } } if ev.Op\u0026fsnotify.Write == fsnotify.Write { //fmt.Println(\"å†™å…¥æ–‡ä»¶ : \", ev.Name) } if ev.Op\u0026fsnotify.Remove == fsnotify.Remove { fmt.Println(\"åˆ é™¤æ–‡ä»¶ : \", ev.Name) //å¦‚æœåˆ é™¤æ–‡ä»¶æ˜¯ç›®å½•ï¼Œåˆ™ç§»é™¤ç›‘æ§ fi, err := os.Stat(ev.Name) if err == nil \u0026\u0026 fi.IsDir() { this.watch.Remove(ev.Name) fmt.Println(\"åˆ é™¤ç›‘æ§ : \", ev.Name) } } if ev.Op\u0026fsnotify.Rename == fsnotify.Rename { //å¦‚æœé‡å‘½åæ–‡ä»¶æ˜¯ç›®å½•ï¼Œåˆ™ç§»é™¤ç›‘æ§ ,æ³¨æ„è¿™é‡Œæ— æ³•ä½¿ç”¨os.Statæ¥åˆ¤æ–­æ˜¯å¦æ˜¯ç›®å½•äº† //å› ä¸ºé‡å‘½ååï¼Œgoå·²ç»æ— æ³•æ‰¾åˆ°åŸæ–‡ä»¶æ¥è·å–ä¿¡æ¯äº†,æ‰€ä»¥ç®€å•ç²—çˆ†ç›´æ¥remove fmt.Println(\"é‡å‘½åæ–‡ä»¶ : \", ev.Name) this.watch.Remove(ev.Name) } if ev.Op\u0026fsnotify.Chmod == fsnotify.Chmod { fmt.Println(\"ä¿®æ”¹æƒé™ : \", ev.Name) } } case err := \u003c-this.watch.Errors: { fmt.Println(\"error : \", err) return } } } func main() { watch := FSNotify.NewNotifyFile() watch.WatchDir(\"G:\\\\Ferry\") select {} return } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fsnotify/:1:2","tags":["Go","fsnotify"],"title":"Go fsnotify","uri":"/posts/2023-11-11-go-fsnotify/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go fmtæ¨¡å— å‚è€ƒé“¾æ¥ï¼šhttps://www.liwenzhou.com/posts/Go/go_fmt/ fmt fmtåŒ…å®ç°äº†ç±»ä¼¼Cè¯­è¨€printfå’Œscanfçš„æ ¼å¼åŒ–I/Oã€‚ä¸»è¦åˆ†ä¸ºå‘å¤–è¾“å‡ºå†…å®¹å’Œè·å–è¾“å…¥å†…å®¹ä¸¤å¤§éƒ¨åˆ†ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fmt/:1:0","tags":["Go","fmt"],"title":"Go fmt","uri":"/posts/2023-11-11-go-fmt/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å‘å¤–è¾“å‡º æ ‡å‡†åº“fmtæä¾›äº†ä»¥ä¸‹å‡ ç§è¾“å‡ºç›¸å…³å‡½æ•°ã€‚ Print Printç³»åˆ—å‡½æ•°ä¼šå°†å†…å®¹è¾“å‡ºåˆ°ç³»ç»Ÿçš„æ ‡å‡†è¾“å‡ºï¼ŒåŒºåˆ«åœ¨äºPrintå‡½æ•°ç›´æ¥è¾“å‡ºå†…å®¹ï¼ŒPrintfå‡½æ•°æ”¯æŒæ ¼å¼åŒ–è¾“å‡ºå­—ç¬¦ä¸²ï¼ŒPrintlnå‡½æ•°ä¼šåœ¨è¾“å‡ºå†…å®¹çš„ç»“å°¾æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ func Print(a ...interface{}) (n int, err error) func Printf(format string, a ...interface{}) (n int, err error) func Println(a ...interface{}) (n int, err error) ä¾‹å¦‚ï¼š func main() { fmt.Print(\"åœ¨ç»ˆç«¯æ‰“å°è¯¥ä¿¡æ¯ã€‚\") name := \"æ²™æ²³å°ç‹å­\" fmt.Printf(\"æˆ‘æ˜¯ï¼š%s\\n\", name) fmt.Println(\"åœ¨ç»ˆç«¯æ‰“å°å•ç‹¬ä¸€è¡Œæ˜¾ç¤º\") } è¾“å‡ºç»“æœï¼š åœ¨ç»ˆç«¯æ‰“å°è¯¥ä¿¡æ¯ã€‚æˆ‘æ˜¯ï¼šæ²™æ²³å°ç‹å­ åœ¨ç»ˆç«¯æ‰“å°å•ç‹¬ä¸€è¡Œæ˜¾ç¤º Fprint Fprintç³»åˆ—å‡½æ•°ä¼šå°†å†…å®¹è¾“å‡ºåˆ°ä¸€ä¸ªio.Writeræ¥å£ç±»å‹çš„å˜é‡wä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨è¿™ä¸ªå‡½æ•°å¾€æ–‡ä»¶ä¸­å†™å…¥å†…å®¹ã€‚ func Fprint(w io.Writer, a ...interface{}) (n int, err error) func Fprintf(w io.Writer, format string, a ...interface{}) (n int, err error) func Fprintln(w io.Writer, a ...interface{}) (n int, err error) ä¾‹å¦‚ï¼š // å‘æ ‡å‡†è¾“å‡ºå†™å…¥å†…å®¹ fmt.Fprintln(os.Stdout, \"å‘æ ‡å‡†è¾“å‡ºå†™å…¥å†…å®¹\") fileObj, err := os.OpenFile(\"./xx.txt\", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0644) if err != nil { fmt.Println(\"æ‰“å¼€æ–‡ä»¶å‡ºé”™ï¼Œerr:\", err) return } name := \"æ²™æ²³å°ç‹å­\" // å‘æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ä¸­å†™å…¥å†…å®¹ fmt.Fprintf(fileObj, \"å¾€æ–‡ä»¶ä¸­å†™å¦‚ä¿¡æ¯ï¼š%s\", name) Sprint Sprintç³»åˆ—å‡½æ•°ä¼šæŠŠä¼ å…¥çš„æ•°æ®ç”Ÿæˆå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ func Sprint(a ...interface{}) string func Sprintf(format string, a ...interface{}) string func Sprintln(a ...interface{}) string ç¤ºä¾‹ï¼š s1 := fmt.Sprint(\"æ²™æ²³å°ç‹å­\") name := \"æ²™æ²³å°ç‹å­\" age := 18 s2 := fmt.Sprintf(\"name:%s,age:%d\", name, age) s3 := fmt.Sprintln(\"æ²™æ²³å°ç‹å­\") fmt.Println(s1, s2, s3) Errorf Errorfå‡½æ•°æ ¹æ®formatå‚æ•°ç”Ÿæˆæ ¼å¼åŒ–å­—ç¬¦ä¸²å¹¶è¿”å›ä¸€ä¸ªåŒ…å«è¯¥å­—ç¬¦ä¸²çš„é”™è¯¯ã€‚ func Errorf(format string, a ...interface{}) error é€šå¸¸ä½¿ç”¨è¿™ç§æ–¹å¼æ¥è‡ªå®šä¹‰é”™è¯¯ç±»å‹ï¼Œä¾‹å¦‚ï¼š err := fmt.Errorf(\"è¿™æ˜¯ä¸€ä¸ªé”™è¯¯\") Go1.13ç‰ˆæœ¬ä¸ºfmt.Errorfå‡½æ•°æ–°åŠ äº†ä¸€ä¸ª%wå ä½ç¬¦ç”¨æ¥ç”Ÿæˆä¸€ä¸ªå¯ä»¥åŒ…è£¹Errorçš„Wrapping Errorã€‚ e := errors.New(\"åŸå§‹é”™è¯¯e\") w := fmt.Errorf(\"Wrapäº†ä¸€ä¸ªé”™è¯¯%w\", e) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fmt/:1:1","tags":["Go","fmt"],"title":"Go fmt","uri":"/posts/2023-11-11-go-fmt/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ ¼å¼åŒ–å ä½ç¬¦ *printfç³»åˆ—å‡½æ•°éƒ½æ”¯æŒformatæ ¼å¼åŒ–å‚æ•°ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æŒ‰ç…§å ä½ç¬¦å°†è¢«æ›¿æ¢çš„å˜é‡ç±»å‹åˆ’åˆ†ï¼Œæ–¹ä¾¿æŸ¥è¯¢å’Œè®°å¿†ã€‚ é€šç”¨å ä½ç¬¦ å ä½ç¬¦ è¯´æ˜ %v å€¼çš„é»˜è®¤æ ¼å¼è¡¨ç¤º %+v ç±»ä¼¼%vï¼Œä½†è¾“å‡ºç»“æ„ä½“æ—¶ä¼šæ·»åŠ å­—æ®µå %#v å€¼çš„Goè¯­æ³•è¡¨ç¤º %T æ‰“å°å€¼çš„ç±»å‹ %% ç™¾åˆ†å· ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š fmt.Printf(\"%v\\n\", 100) fmt.Printf(\"%v\\n\", false) o := struct{ name string }{\"å°ç‹å­\"} fmt.Printf(\"%v\\n\", o) fmt.Printf(\"%#v\\n\", o) fmt.Printf(\"%T\\n\", o) fmt.Printf(\"100%%\\n\") è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 100 false {å°ç‹å­} struct { name string }{name:\"å°ç‹å­\"} struct { name string } 100% å¸ƒå°”å‹ å ä½ç¬¦ è¯´æ˜ %t trueæˆ–false æ•´å‹ å ä½ç¬¦ è¯´æ˜ %b è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶ %c è¯¥å€¼å¯¹åº”çš„unicodeç å€¼ %d è¡¨ç¤ºä¸ºåè¿›åˆ¶ %o è¡¨ç¤ºä¸ºå…«è¿›åˆ¶ %x è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œä½¿ç”¨a-f %X è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œä½¿ç”¨A-F %U è¡¨ç¤ºä¸ºUnicodeæ ¼å¼ï¼šU+1234ï¼Œç­‰ä»·äºâ€U+%04Xâ€ %q è¯¥å€¼å¯¹åº”çš„å•å¼•å·æ‹¬èµ·æ¥çš„goè¯­æ³•å­—ç¬¦å­—é¢å€¼ï¼Œå¿…è¦æ—¶ä¼šé‡‡ç”¨å®‰å…¨çš„è½¬ä¹‰è¡¨ç¤º ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š n := 65 fmt.Printf(\"%b\\n\", n) fmt.Printf(\"%c\\n\", n) fmt.Printf(\"%d\\n\", n) fmt.Printf(\"%o\\n\", n) fmt.Printf(\"%x\\n\", n) fmt.Printf(\"%X\\n\", n) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 1000001 A 65 101 41 41 æµ®ç‚¹æ•°ä¸å¤æ•° å ä½ç¬¦ è¯´æ˜ %b æ— å°æ•°éƒ¨åˆ†ã€äºŒè¿›åˆ¶æŒ‡æ•°çš„ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-123456p-78 %e ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-1234.456e+78 %E ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-1234.456E+78 %f æœ‰å°æ•°éƒ¨åˆ†ä½†æ— æŒ‡æ•°éƒ¨åˆ†ï¼Œå¦‚123.456 %F ç­‰ä»·äº%f %g æ ¹æ®å®é™…æƒ…å†µé‡‡ç”¨%eæˆ–%fæ ¼å¼ï¼ˆä»¥è·å¾—æ›´ç®€æ´ã€å‡†ç¡®çš„è¾“å‡ºï¼‰ %G æ ¹æ®å®é™…æƒ…å†µé‡‡ç”¨%Eæˆ–%Fæ ¼å¼ï¼ˆä»¥è·å¾—æ›´ç®€æ´ã€å‡†ç¡®çš„è¾“å‡ºï¼‰ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š f := 12.34 fmt.Printf(\"%b\\n\", f) fmt.Printf(\"%e\\n\", f) fmt.Printf(\"%E\\n\", f) fmt.Printf(\"%f\\n\", f) fmt.Printf(\"%g\\n\", f) fmt.Printf(\"%G\\n\", f) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 6946802425218990p-49 1.234000e+01 1.234000E+01 12.340000 12.34 12.34 å­—ç¬¦ä¸²å’Œ[]byte å ä½ç¬¦ è¯´æ˜ %s ç›´æ¥è¾“å‡ºå­—ç¬¦ä¸²æˆ–è€…[]byte %q è¯¥å€¼å¯¹åº”çš„åŒå¼•å·æ‹¬èµ·æ¥çš„goè¯­æ³•å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œå¿…è¦æ—¶ä¼šé‡‡ç”¨å®‰å…¨çš„è½¬ä¹‰è¡¨ç¤º %x æ¯ä¸ªå­—èŠ‚ç”¨ä¸¤å­—ç¬¦åå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼ˆä½¿ç”¨a-f %X æ¯ä¸ªå­—èŠ‚ç”¨ä¸¤å­—ç¬¦åå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼ˆä½¿ç”¨A-Fï¼‰ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š s := \"å°ç‹å­\" fmt.Printf(\"%s\\n\", s) fmt.Printf(\"%q\\n\", s) fmt.Printf(\"%x\\n\", s) fmt.Printf(\"%X\\n\", s) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š å°ç‹å­ \"å°ç‹å­\" e5b08fe78e8be5ad90 E5B08FE78E8BE5AD90 æŒ‡é’ˆ å ä½ç¬¦ è¯´æ˜ %p è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œå¹¶åŠ ä¸Šå‰å¯¼çš„0x ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š a := 10 fmt.Printf(\"%p\\n\", \u0026a) fmt.Printf(\"%#p\\n\", \u0026a) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 0xc000094000 c000094000 å®½åº¦æ ‡è¯†ç¬¦ å®½åº¦é€šè¿‡ä¸€ä¸ªç´§è·Ÿåœ¨ç™¾åˆ†å·åé¢çš„åè¿›åˆ¶æ•°æŒ‡å®šï¼Œå¦‚æœæœªæŒ‡å®šå®½åº¦ï¼Œåˆ™è¡¨ç¤ºå€¼æ—¶é™¤å¿…éœ€ä¹‹å¤–ä¸ä½œå¡«å……ã€‚ç²¾åº¦é€šè¿‡ï¼ˆå¯é€‰çš„ï¼‰å®½åº¦åè·Ÿç‚¹å·åè·Ÿçš„åè¿›åˆ¶æ•°æŒ‡å®šã€‚å¦‚æœæœªæŒ‡å®šç²¾åº¦ï¼Œä¼šä½¿ç”¨é»˜è®¤ç²¾åº¦ï¼›å¦‚æœç‚¹å·åæ²¡æœ‰è·Ÿæ•°å­—ï¼Œè¡¨ç¤ºç²¾åº¦ä¸º0ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š å ä½ç¬¦ è¯´æ˜ %f é»˜è®¤å®½åº¦ï¼Œé»˜è®¤ç²¾åº¦ %9f å®½åº¦9ï¼Œé»˜è®¤ç²¾åº¦ %.2f é»˜è®¤å®½åº¦ï¼Œç²¾åº¦2 %9.2f å®½åº¦9ï¼Œç²¾åº¦2 %9.f å®½åº¦9ï¼Œç²¾åº¦0 ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š n := 12.34 fmt.Printf(\"%f\\n\", n) fmt.Printf(\"%9f\\n\", n) fmt.Printf(\"%.2f\\n\", n) fmt.Printf(\"%9.2f\\n\", n) fmt.Printf(\"%9.f\\n\", n) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 12.340000 12.340000 12.34 12.34 12 å…¶ä»–falg å ä½ç¬¦ è¯´æ˜ â€™+â€™ æ€»æ˜¯è¾“å‡ºæ•°å€¼çš„æ­£è´Ÿå·ï¼›å¯¹%qï¼ˆ%+qï¼‰ä¼šç”Ÿæˆå…¨éƒ¨æ˜¯ASCIIå­—ç¬¦çš„è¾“å‡ºï¼ˆé€šè¿‡è½¬ä¹‰ï¼‰ï¼› â€™ â€˜ å¯¹æ•°å€¼ï¼Œæ­£æ•°å‰åŠ ç©ºæ ¼è€Œè´Ÿæ•°å‰åŠ è´Ÿå·ï¼›å¯¹å­—ç¬¦ä¸²é‡‡ç”¨%xæˆ–%Xæ—¶ï¼ˆ% xæˆ–% Xï¼‰ä¼šç»™å„æ‰“å°çš„å­—èŠ‚ä¹‹é—´åŠ ç©ºæ ¼ â€™-â€™ åœ¨è¾“å‡ºå³è¾¹å¡«å……ç©ºç™½è€Œä¸æ˜¯é»˜è®¤çš„å·¦è¾¹ï¼ˆå³ä»é»˜è®¤çš„å³å¯¹é½åˆ‡æ¢ä¸ºå·¦å¯¹é½ï¼‰ï¼› â€™#â€™ å…«è¿›åˆ¶æ•°å‰åŠ 0ï¼ˆ%#oï¼‰ï¼Œåå…­è¿›åˆ¶æ•°å‰åŠ 0xï¼ˆ%#xï¼‰æˆ–0Xï¼ˆ%#Xï¼‰ï¼ŒæŒ‡é’ˆå»æ‰å‰é¢çš„0xï¼ˆ%#pï¼‰å¯¹%qï¼ˆ%#qï¼‰ï¼Œå¯¹%Uï¼ˆ%#Uï¼‰ä¼šè¾“å‡ºç©ºæ ¼å’Œå•å¼•å·æ‹¬èµ·æ¥çš„goå­—é¢å€¼ï¼› â€˜0â€™ ä½¿ç”¨0è€Œä¸æ˜¯ç©ºæ ¼å¡«å……ï¼Œå¯¹äºæ•°å€¼ç±»å‹ä¼šæŠŠå¡«å……çš„0æ”¾åœ¨æ­£è´Ÿå·åé¢ï¼› ä¸¾ä¸ªä¾‹å­ï¼š s := \"å°ç‹å­\" fmt.Printf(\"%s\\n\", s) fmt.Printf(\"%5s\\n\", s) fmt.Printf(\"%-5s\\n\", s) fmt.Printf(\"%5.7s\\n\", s) fmt.Printf(\"%-5.7s\\n\", s) fmt.Printf(\"%5.2s\\n\", s) fmt.Printf(\"%05s\\n\", s) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š å°ç‹å­ å°ç‹å­ å°ç‹å­ å°ç‹å­ å°ç‹å­ å°ç‹ 00å°ç‹å­ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fmt/:1:2","tags":["Go","fmt"],"title":"Go fmt","uri":"/posts/2023-11-11-go-fmt/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"è·å–è¾“å…¥ Goè¯­è¨€fmtåŒ…ä¸‹æœ‰fmt.Scanã€fmt.Scanfã€fmt.Scanlnä¸‰ä¸ªå‡½æ•°ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä»æ ‡å‡†è¾“å…¥è·å–ç”¨æˆ·çš„è¾“å…¥ã€‚ fmt.Scan å‡½æ•°å®šç­¾åå¦‚ä¸‹ï¼š func Scan(a ...interface{}) (n int, err error) Scanä»æ ‡å‡†è¾“å…¥æ‰«ææ–‡æœ¬ï¼Œè¯»å–ç”±ç©ºç™½ç¬¦åˆ†éš”çš„å€¼ä¿å­˜åˆ°ä¼ é€’ç»™æœ¬å‡½æ•°çš„å‚æ•°ä¸­ï¼Œæ¢è¡Œç¬¦è§†ä¸ºç©ºç™½ç¬¦ã€‚ æœ¬å‡½æ•°è¿”å›æˆåŠŸæ‰«æçš„æ•°æ®ä¸ªæ•°å’Œé‡åˆ°çš„ä»»ä½•é”™è¯¯ã€‚å¦‚æœè¯»å–çš„æ•°æ®ä¸ªæ•°æ¯”æä¾›çš„å‚æ•°å°‘ï¼Œä¼šè¿”å›ä¸€ä¸ªé”™è¯¯æŠ¥å‘ŠåŸå› ã€‚ å…·ä½“ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š func main() { var ( name string age int married bool ) fmt.Scan(\u0026name, \u0026age, \u0026married) fmt.Printf(\"æ‰«æç»“æœ name:%s age:%d married:%t \\n\", name, age, married) } å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘ååœ¨ç»ˆç«¯æ‰§è¡Œï¼Œåœ¨ç»ˆç«¯ä¾æ¬¡è¾“å…¥å°ç‹å­ã€28å’Œfalseä½¿ç”¨ç©ºæ ¼åˆ†éš”ã€‚ $ ./scan_demo å°ç‹å­ 28 false æ‰«æç»“æœ name:å°ç‹å­ age:28 married:false fmt.Scanä»æ ‡å‡†è¾“å…¥ä¸­æ‰«æç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå°†ä»¥ç©ºç™½ç¬¦åˆ†éš”çš„æ•°æ®åˆ†åˆ«å­˜å…¥æŒ‡å®šçš„å‚æ•°ã€‚ fmt.Scanf å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š func Scanf(format string, a ...interface{}) (n int, err error) Scanfä»æ ‡å‡†è¾“å…¥æ‰«ææ–‡æœ¬ï¼Œæ ¹æ®formatå‚æ•°æŒ‡å®šçš„æ ¼å¼å»è¯»å–ç”±ç©ºç™½ç¬¦åˆ†éš”çš„å€¼ä¿å­˜åˆ°ä¼ é€’ç»™æœ¬å‡½æ•°çš„å‚æ•°ä¸­ã€‚ æœ¬å‡½æ•°è¿”å›æˆåŠŸæ‰«æçš„æ•°æ®ä¸ªæ•°å’Œé‡åˆ°çš„ä»»ä½•é”™è¯¯ã€‚ ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š func main() { var ( name string age int married bool ) fmt.Scanf(\"1:%s 2:%d 3:%t\", \u0026name, \u0026age, \u0026married) fmt.Printf(\"æ‰«æç»“æœ name:%s age:%d married:%t \\n\", name, age, married) } å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘ååœ¨ç»ˆç«¯æ‰§è¡Œï¼Œåœ¨ç»ˆç«¯æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼ä¾æ¬¡è¾“å…¥å°ç‹å­ã€28å’Œfalseã€‚ $ ./scan_demo 1:å°ç‹å­ 2:28 3:false æ‰«æç»“æœ name:å°ç‹å­ age:28 married:false fmt.Scanfä¸åŒäºfmt.Scanç®€å•çš„ä»¥ç©ºæ ¼ä½œä¸ºè¾“å…¥æ•°æ®çš„åˆ†éš”ç¬¦ï¼Œfmt.Scanfä¸ºè¾“å…¥æ•°æ®æŒ‡å®šäº†å…·ä½“çš„è¾“å…¥å†…å®¹æ ¼å¼ï¼Œåªæœ‰æŒ‰ç…§æ ¼å¼è¾“å…¥æ•°æ®æ‰ä¼šè¢«æ‰«æå¹¶å­˜å…¥å¯¹åº”å˜é‡ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§ä¸Šä¸ªç¤ºä¾‹ä¸­ä»¥ç©ºæ ¼åˆ†éš”çš„æ–¹å¼è¾“å…¥ï¼Œfmt.Scanfå°±ä¸èƒ½æ­£ç¡®æ‰«æåˆ°è¾“å…¥çš„æ•°æ®ã€‚ $ ./scan_demo å°ç‹å­ 28 false æ‰«æç»“æœ name: age:0 married:false fmt.Scanln å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š func Scanln(a ...interface{}) (n int, err error) Scanlnç±»ä¼¼Scanï¼Œå®ƒåœ¨é‡åˆ°æ¢è¡Œæ—¶æ‰åœæ­¢æ‰«æã€‚æœ€åä¸€ä¸ªæ•°æ®åé¢å¿…é¡»æœ‰æ¢è¡Œæˆ–è€…åˆ°è¾¾ç»“æŸä½ç½®ã€‚ æœ¬å‡½æ•°è¿”å›æˆåŠŸæ‰«æçš„æ•°æ®ä¸ªæ•°å’Œé‡åˆ°çš„ä»»ä½•é”™è¯¯ã€‚ å…·ä½“ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š func main() { var ( name string age int married bool ) fmt.Scanln(\u0026name, \u0026age, \u0026married) fmt.Printf(\"æ‰«æç»“æœ name:%s age:%d married:%t \\n\", name, age, married) } å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘ååœ¨ç»ˆç«¯æ‰§è¡Œï¼Œåœ¨ç»ˆç«¯ä¾æ¬¡è¾“å…¥å°ç‹å­ã€28å’Œfalseä½¿ç”¨ç©ºæ ¼åˆ†éš”ã€‚ $ ./scan_demo å°ç‹å­ 28 false æ‰«æç»“æœ name:å°ç‹å­ age:28 married:false fmt.Scanlné‡åˆ°å›è½¦å°±ç»“æŸæ‰«æäº†ï¼Œè¿™ä¸ªæ¯”è¾ƒå¸¸ç”¨ã€‚ bufio.NewReader æœ‰æ—¶å€™æˆ‘ä»¬æƒ³å®Œæ•´è·å–è¾“å…¥çš„å†…å®¹ï¼Œè€Œè¾“å…¥çš„å†…å®¹å¯èƒ½åŒ…å«ç©ºæ ¼ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨bufioåŒ…æ¥å®ç°ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š func bufioDemo() { reader := bufio.NewReader(os.Stdin) // ä»æ ‡å‡†è¾“å…¥ç”Ÿæˆè¯»å¯¹è±¡ fmt.Print(\"è¯·è¾“å…¥å†…å®¹ï¼š\") text, _ := reader.ReadString('\\n') // è¯»åˆ°æ¢è¡Œ text = strings.TrimSpace(text) fmt.Printf(\"%#v\\n\", text) } Fscanç³»åˆ— è¿™å‡ ä¸ªå‡½æ•°åŠŸèƒ½åˆ†åˆ«ç±»ä¼¼äºfmt.Scanã€fmt.Scanfã€fmt.Scanlnä¸‰ä¸ªå‡½æ•°ï¼Œåªä¸è¿‡å®ƒä»¬ä¸æ˜¯ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®è€Œæ˜¯ä»io.Readerä¸­è¯»å–æ•°æ®ã€‚ func Fscan(r io.Reader, a ...interface{}) (n int, err error) func Fscanln(r io.Reader, a ...interface{}) (n int, err error) func Fscanf(r io.Reader, format string, a ...interface{}) (n int, err error) Sscanç³»åˆ— è¿™å‡ ä¸ªå‡½æ•°åŠŸèƒ½åˆ†åˆ«ç±»ä¼¼äºfmt.Scanã€fmt.Scanfã€fmt.Scanlnä¸‰ä¸ªå‡½æ•°ï¼Œåªä¸è¿‡å®ƒä»¬ä¸æ˜¯ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®è€Œæ˜¯ä»æŒ‡å®šå­—ç¬¦ä¸²ä¸­è¯»å–æ•°æ®ã€‚ func Sscan(str string, a ...interface{}) (n int, err error) func Sscanln(str string, a ...interface{}) (n int, err error) func Sscanf(str string, format string, a ...interface{}) (n int, err error) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fmt/:1:3","tags":["Go","fmt"],"title":"Go fmt","uri":"/posts/2023-11-11-go-fmt/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Goæ–‡ä»¶æ“ä½œ å‚è€ƒé“¾æ¥ï¼šhttps://www.liwenzhou.com/posts/Go/go_file/ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-file/:1:0","tags":["Go","file"],"title":"Go file","uri":"/posts/2023-11-11-go-file/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ–‡ä»¶ è®¡ç®—æœºä¸­çš„æ–‡ä»¶æ˜¯å­˜å‚¨åœ¨å¤–éƒ¨ä»‹è´¨ï¼ˆé€šå¸¸æ˜¯ç£ç›˜ï¼‰ä¸Šçš„æ•°æ®é›†åˆï¼Œæ–‡ä»¶åˆ†ä¸ºæ–‡æœ¬æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-file/:1:1","tags":["Go","file"],"title":"Go file","uri":"/posts/2023-11-11-go-file/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ–‡ä»¶æ‰“å¼€å’Œå…³é—­ os.Open()å‡½æ•°èƒ½å¤Ÿæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ª*Fileå’Œä¸€ä¸ªerrã€‚å¯¹å¾—åˆ°çš„æ–‡ä»¶å®ä¾‹è°ƒç”¨close()æ–¹æ³•èƒ½å¤Ÿå…³é—­æ–‡ä»¶ã€‚ package main import ( \"fmt\" \"os\" ) func main() { // åªè¯»æ–¹å¼æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„main.goæ–‡ä»¶ file, err := os.Open(\"./main.go\") if err != nil { fmt.Println(\"open file failed!, err:\", err) return } // å…³é—­æ–‡ä»¶ file.Close() } ä¸ºäº†é˜²æ­¢æ–‡ä»¶å¿˜è®°å…³é—­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨deferæ³¨å†Œæ–‡ä»¶å…³é—­è¯­å¥ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-file/:1:2","tags":["Go","file"],"title":"Go file","uri":"/posts/2023-11-11-go-file/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"è¯»å–æ–‡ä»¶ file.Read() åŸºæœ¬ä½¿ç”¨ Readæ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š func (f *File) Read(b []byte) (n int, err error) å®ƒæ¥æ”¶ä¸€ä¸ªå­—èŠ‚åˆ‡ç‰‡ï¼Œè¿”å›è¯»å–çš„å­—èŠ‚æ•°å’Œå¯èƒ½çš„å…·ä½“é”™è¯¯ï¼Œè¯»åˆ°æ–‡ä»¶æœ«å°¾æ—¶ä¼šè¿”å›0å’Œio.EOFã€‚ ä¸¾ä¸ªä¾‹å­ï¼š func main() { // åªè¯»æ–¹å¼æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„main.goæ–‡ä»¶ file, err := os.Open(\"./main.go\") if err != nil { fmt.Println(\"open file failed!, err:\", err) return } defer file.Close() // ä½¿ç”¨Readæ–¹æ³•è¯»å–æ•°æ® var tmp = make([]byte, 128) n, err := file.Read(tmp) if err == io.EOF { fmt.Println(\"æ–‡ä»¶è¯»å®Œäº†\") return } if err != nil { fmt.Println(\"read file failed, err:\", err) return } fmt.Printf(\"è¯»å–äº†%då­—èŠ‚æ•°æ®\\n\", n) fmt.Println(string(tmp[:n])) } å¾ªç¯è¯»å– ä½¿ç”¨forå¾ªç¯è¯»å–æ–‡ä»¶ä¸­æ‰€æœ‰çš„æ•°æ® func main() { // åªè¯»æ–¹å¼æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„main.goæ–‡ä»¶ file, err := os.Open(\"./main.go\") if err != nil { fmt.Println(\"open file failed!, err:\", err) return } defer file.Close() // å¾ªç¯è¯»å–æ–‡ä»¶ var content []byte var tmp = make([]byte, 128) for { n, err := file.Read(tmp) if err == io.EOF { fmt.Println(\"æ–‡ä»¶è¯»å®Œäº†\") break } if err != nil { fmt.Println(\"read file failed, err:\", err) return } content = append(content, tmp[:n]...) } fmt.Println(string(content)) } bufioè¯»å–æ–‡ä»¶ bufioæ˜¯åœ¨fileçš„åŸºç¡€ä¸Šå°è£…äº†ä¸€å±‚APIï¼Œæ”¯æŒæ›´å¤šçš„åŠŸèƒ½ã€‚ package main import ( \"bufio\" \"fmt\" \"io\" \"os\" ) // bufioæŒ‰è¡Œè¯»å–ç¤ºä¾‹ func main() { file, err := os.Open(\"./xx.txt\") if err != nil { fmt.Println(\"open file failed, err:\", err) return } defer file.Close() reader := bufio.NewReader(file) for { line, err := reader.ReadString('\\n') //æ³¨æ„æ˜¯å­—ç¬¦ if err == io.EOF { if len(line) != 0 { fmt.Println(line) } fmt.Println(\"æ–‡ä»¶è¯»å®Œäº†\") break } if err != nil { fmt.Println(\"read file failed, err:\", err) return } fmt.Print(line) } } ioutilè¯»å–æ•´ä¸ªæ–‡ä»¶ io/ioutilåŒ…çš„ReadFileæ–¹æ³•èƒ½å¤Ÿè¯»å–å®Œæ•´çš„æ–‡ä»¶ï¼Œåªéœ€è¦å°†æ–‡ä»¶åä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ package main import ( \"fmt\" \"io/ioutil\" ) // ioutil.ReadFileè¯»å–æ•´ä¸ªæ–‡ä»¶ func main() { content, err := ioutil.ReadFile(\"./main.go\") if err != nil { fmt.Println(\"read file failed, err:\", err) return } fmt.Println(string(content)) } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-file/:1:3","tags":["Go","file"],"title":"Go file","uri":"/posts/2023-11-11-go-file/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ–‡ä»¶å†™å…¥ os.OpenFile()å‡½æ•°èƒ½å¤Ÿä»¥æŒ‡å®šæ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Œä»è€Œå®ç°æ–‡ä»¶å†™å…¥ç›¸å…³åŠŸèƒ½ã€‚ func OpenFile(name string, flag int, perm FileMode) (*File, error) { ... } å…¶ä¸­ï¼š nameï¼šè¦æ‰“å¼€çš„æ–‡ä»¶å flagï¼šæ‰“å¼€æ–‡ä»¶çš„æ¨¡å¼ã€‚ æ¨¡å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š æ¨¡å¼ å«ä¹‰ os.O_WRONLY åªå†™ os.O_CREATE åˆ›å»ºæ–‡ä»¶ os.O_RDONLY åªè¯» os.O_RDWR è¯»å†™ os.O_TRUNC æ¸…ç©º os.O_APPEND è¿½åŠ  permï¼šæ–‡ä»¶æƒé™ï¼Œä¸€ä¸ªå…«è¿›åˆ¶æ•°ã€‚rï¼ˆè¯»ï¼‰4ï¼Œwï¼ˆå†™ï¼‰2ï¼Œxï¼ˆæ‰§è¡Œï¼‰1ã€‚ Writeå’ŒWriteString func main() { file, err := os.OpenFile(\"xx.txt\", os.O_CREATE|os.O_TRUNC|os.O_WRONLY, 0666) if err != nil { fmt.Println(\"open file failed, err:\", err) return } defer file.Close() str := \"hello æ²™æ²³\" file.Write([]byte(str)) //å†™å…¥å­—èŠ‚åˆ‡ç‰‡æ•°æ® file.WriteString(\"hello å°ç‹å­\") //ç›´æ¥å†™å…¥å­—ç¬¦ä¸²æ•°æ® } bufio.NewWriter func main() { file, err := os.OpenFile(\"xx.txt\", os.O_CREATE|os.O_TRUNC|os.O_WRONLY, 0666) if err != nil { fmt.Println(\"open file failed, err:\", err) return } defer file.Close() writer := bufio.NewWriter(file) for i := 0; i \u003c 10; i++ { writer.WriteString(\"helloæ²™æ²³\\n\") //å°†æ•°æ®å…ˆå†™å…¥ç¼“å­˜ } writer.Flush() //å°†ç¼“å­˜ä¸­çš„å†…å®¹å†™å…¥æ–‡ä»¶ } ioutil.WriteFile func main() { str := \"hello æ²™æ²³\" err := ioutil.WriteFile(\"./xx.txt\", []byte(str), 0666) if err != nil { fmt.Println(\"write file failed, err:\", err) return } } ç»ƒä¹ ï¼š 1ã€å®ç°cpå‘½ä»¤ å€ŸåŠ©io.Copy()å®ç°ä¸€ä¸ªæ‹·è´æ–‡ä»¶å‡½æ•°ã€‚ // CopyFile æ‹·è´æ–‡ä»¶å‡½æ•° func CopyFile(dstName, srcName string) (written int64, err error) { // ä»¥è¯»æ–¹å¼æ‰“å¼€æºæ–‡ä»¶ src, err := os.Open(srcName) if err != nil { fmt.Printf(\"open %s failed, err:%v.\\n\", srcName, err) return } defer src.Close() // ä»¥å†™|åˆ›å»ºçš„æ–¹å¼æ‰“å¼€ç›®æ ‡æ–‡ä»¶ dst, err := os.OpenFile(dstName, os.O_WRONLY|os.O_CREATE, 0644) if err != nil { fmt.Printf(\"open %s failed, err:%v.\\n\", dstName, err) return } defer dst.Close() return io.Copy(dst, src) //è°ƒç”¨io.Copy()æ‹·è´å†…å®¹ } func main() { _, err := CopyFile(\"dst.txt\", \"src.txt\") if err != nil { fmt.Println(\"copy file failed, err:\", err) return } fmt.Println(\"copy done!\") } 2ã€å®ç°catå‘½ä»¤ ä½¿ç”¨æ–‡ä»¶æ“ä½œç›¸å…³çŸ¥è¯†ï¼Œæ¨¡æ‹Ÿå®ç°linuxå¹³å°catå‘½ä»¤çš„åŠŸèƒ½ package main import ( \"bufio\" \"flag\" \"fmt\" \"io\" \"os\" ) // catå‘½ä»¤å®ç° func cat(r *bufio.Reader) { for { buf, err := r.ReadBytes('\\n') //æ³¨æ„æ˜¯å­—ç¬¦ if err == io.EOF { // é€€å‡ºä¹‹å‰å°†å·²è¯»åˆ°çš„å†…å®¹è¾“å‡º fmt.Fprintf(os.Stdout, \"%s\", buf) break } fmt.Fprintf(os.Stdout, \"%s\", buf) } } func main() { flag.Parse() // è§£æå‘½ä»¤è¡Œå‚æ•° if flag.NArg() == 0 { // å¦‚æœæ²¡æœ‰å‚æ•°é»˜è®¤ä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹ cat(bufio.NewReader(os.Stdin)) } // ä¾æ¬¡è¯»å–æ¯ä¸ªæŒ‡å®šæ–‡ä»¶çš„å†…å®¹å¹¶æ‰“å°åˆ°ç»ˆç«¯ for i := 0; i \u003c flag.NArg(); i++ { f, err := os.Open(flag.Arg(i)) if err != nil { fmt.Fprintf(os.Stdout, \"reading from %s failed, err:%v\\n\", flag.Arg(i), err) continue } cat(bufio.NewReader(f)) } } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-file/:1:4","tags":["Go","file"],"title":"Go file","uri":"/posts/2023-11-11-go-file/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Excelåº“excelize å‚è€ƒé“¾æ¥ï¼š[Go è¯­è¨€è¯»å†™ Excel - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/33417413#:~:text=Excelize æ˜¯ Go è¯­è¨€ç¼–å†™çš„ç”¨äºæ“ä½œ Office Excel æ–‡æ¡£ç±»åº“ï¼ŒåŸºäº ECMA-376,æ ‡å‡†ã€‚ å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å–ã€å†™å…¥ç”± Microsoft Excelâ„¢ 2007 åŠä»¥ä¸Šç‰ˆæœ¬åˆ›å»ºçš„ XLSX æ–‡æ¡£ã€‚) Excelize æ˜¯ Go è¯­è¨€ç¼–å†™çš„ç”¨äºæ“ä½œ Office Excel æ–‡æ¡£ç±»åº“ï¼ŒåŸºäº ECMA-376 Office OpenXML æ ‡å‡†ã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å–ã€å†™å…¥ç”± Microsoft Excelâ„¢ 2007 åŠä»¥ä¸Šç‰ˆæœ¬åˆ›å»ºçš„ XLSX æ–‡æ¡£ã€‚ç›¸æ¯”è¾ƒå…¶ä»–çš„å¼€æºç±»åº“ï¼ŒExcelize æ”¯æŒå†™å…¥åŸæœ¬å¸¦æœ‰å›¾ç‰‡(è¡¨)ã€é€è§†è¡¨å’Œåˆ‡ç‰‡å™¨ç­‰å¤æ‚æ ·å¼çš„æ–‡æ¡£ï¼Œè¿˜æ”¯æŒå‘ Excel æ–‡æ¡£ä¸­æ’å…¥å›¾ç‰‡ä¸å›¾è¡¨ï¼Œå¹¶ä¸”åœ¨ä¿å­˜åä¸ä¼šä¸¢å¤±æ–‡æ¡£åŸæœ‰æ ·å¼ï¼Œå¯ä»¥åº”ç”¨äºå„ç±»æŠ¥è¡¨ç³»ç»Ÿä¸­ã€‚ä½¿ç”¨æœ¬ç±»åº“è¦æ±‚ä½¿ç”¨çš„ Go è¯­è¨€ä¸º 1.8 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå®Œæ•´çš„ API ä½¿ç”¨æ–‡æ¡£è¯·è®¿é—® godoc.org æˆ–æŸ¥çœ‹å‚è€ƒæ–‡æ¡£ã€‚ GitHub: excelize å®˜æ–¹æ–‡æ¡£ï¼šhttps://xuri.me/excelize ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-excelize/:1:0","tags":["Go","excelize","xls","xlsx"],"title":"Go excelize","uri":"/posts/2023-11-11-go-excelize/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"1ã€ç®€å•ä½¿ç”¨ å®‰è£… go get github.com/xuri/excelize/v2 1ï¼‰åˆ›å»ºXLSX package main import \"github.com/360EntSecGroup-Skylar/excelize\" func main() { f := excelize.NewFile() // åˆ›å»ºä¸€ä¸ªå·¥ä½œè¡¨ index := f.NewSheet(\"Sheet2\") // è®¾ç½®å•å…ƒæ ¼çš„å€¼ f.SetCellValue(\"Sheet1\", \"A2\", \"Hello world.\") f.SetCellValue(\"Sheet1\", \"B2\", 100) f.SetCellValue(\"Sheet1\", \"B3\", \"github\") // è®¾ç½®å·¥ä½œç°¿çš„é»˜è®¤å·¥ä½œè¡¨ f.SetActiveSheet(index) // æ ¹æ®æŒ‡å®šè·¯å¾„ä¿å­˜æ–‡ä»¶ if err := f.SaveAs(\"Book1.xlsx\"); err != nil { println(err.Error()) } } ç»“æœï¼š SetCellValueå‡½æ•°è§£é‡Š f.SetCellValue(sheet string, axis string, value interface{}) f.SetCellValue(\"Sheet1\", \"B3\", \"github\") sheetï¼šæ˜¯sheetè¡¨æ ¼çš„çš„åå­—ã€‚ axisï¼šåŒ…å«ä¸¤éƒ¨åˆ†ï¼Œå­—æ¯è¡¨ç¤ºåˆ—ï¼Œæ•°å­—è¡¨ç¤ºè¡Œã€‚ valueï¼šè¡¨ç¤ºå€¼ã€‚ 2ï¼‰è¯»å–xlsx func ReadXlsx() { filename := \"Book1.xlsx\" f, err := excelize.OpenFile(filename) if err != nil { fmt.Printf(\"æ— æ³•æ‰“å¼€xlsxï¼š%v é”™è¯¯åŸå› ï¼š%v\", filename, err) return } // è·å–å·¥ä½œè¡¨ä¸­æŒ‡å®šå•å…ƒæ ¼çš„å€¼ cell, err := f.GetCellValue(\"Sheet1\", \"B3\") if err != nil { fmt.Printf(\"è·å– %v çš„%vçš„ å€¼ å¤±è´¥,å¤±è´¥åŸå› ï¼š%v\", \"Sheet1\", \"B3\", err) } fmt.Printf(\"è¯»å–çš„å†…å®¹ä¸ºï¼š%v\", cell) // è·å– Sheet1 ä¸Šæ‰€æœ‰å•å…ƒæ ¼ rows, err := f.GetRows(\"Sheet1\") if err != nil { fmt.Printf(\"è·å– %vçš„å•å…ƒæ ¼å¤±è´¥,å¤±è´¥åŸå› ï¼š%v\", \"Sheet1\", err) } for _, row := range rows { for _, colCell := range row { print(colCell, \"\\t\") } println() } } 3ï¼‰æ’å…¥ä¸€è¡Œæ•°æ® func (exa *ExcelService) ParseInfoList2Excel(infoList []system.SysBaseMenu, filePath string) error { excel := excelize.NewFile() excel.SetSheetRow(\"Sheet1\", \"A1\", \u0026[]string{\"ID\", \"è·¯ç”±Name\", \"è·¯ç”±Path\", \"æ˜¯å¦éšè—\", \"çˆ¶èŠ‚ç‚¹\", \"æ’åº\", \"æ–‡ä»¶åç§°\"}) for i, menu := range infoList { axis := fmt.Sprintf(\"A%d\", i+2) excel.SetSheetRow(\"Sheet1\", axis, \u0026[]interface{}{ menu.ID, menu.Name, menu.Path, menu.Hidden, menu.ParentId, menu.Sort, menu.Component, }) } err := excel.SaveAs(filePath) return err } 4ï¼‰ä»è¡¨æ ¼ä¸­å¯¼å…¥æ•°æ® func PasreExcel2List(filepath string, fileHeader []string, skipHeader bool) (data [][]string, err error) { file, err := excelize.OpenFile(filepath) if err != nil { return } defer file.Close() rows, err := file.GetRows(\"Sheet1\") if err != nil { return } if skipHeader { if ForEqualStringSlice(rows[0], fileHeader) { rows = rows[1:] } else { err = errors.New(\"FileHeader not Equal.\") return } } data = rows return } func (exa *ExcelService) ParseExcel2InfoList() ([]system.SysBaseMenu, error) { skipHeader := true fixedHeader := []string{\"ID\", \"è·¯ç”±Name\", \"è·¯ç”±Path\", \"æ˜¯å¦éšè—\", \"çˆ¶èŠ‚ç‚¹\", \"æ’åº\", \"æ–‡ä»¶åç§°\"} file, err := excelize.OpenFile(global.GVA_CONFIG.Excel.Dir + \"ExcelImport.xlsx\") if err != nil { return nil, err } menus := make([]system.SysBaseMenu, 0) rows, err := file.Rows(\"Sheet1\") if err != nil { return nil, err } for rows.Next() { row, err := rows.Columns() if err != nil { return nil, err } if skipHeader { if exa.compareStrSlice(row, fixedHeader) { skipHeader = false continue } else { return nil, errors.New(\"Excelæ ¼å¼é”™è¯¯\") } } if len(row) != len(fixedHeader) { continue } id, _ := strconv.Atoi(row[0]) hidden, _ := strconv.ParseBool(row[3]) sort, _ := strconv.Atoi(row[5]) menu := system.SysBaseMenu{ GVA_MODEL: global.GVA_MODEL{ ID: uint(id), }, Name: row[1], Path: row[2], Hidden: hidden, ParentId: row[4], Sort: sort, Component: row[6], } menus = append(menus, menu) } return menus, nil } func (exa *ExcelService) compareStrSlice(a, b []string) bool { if len(a) != len(b) { return false } if (b == nil) != (a == nil) { return false } for key, value := range a { if value != b[key] { return false } } return true } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-excelize/:1:1","tags":["Go","excelize","xls","xlsx"],"title":"Go excelize","uri":"/posts/2023-11-11-go-excelize/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"cronå®šæ—¶ä»»åŠ¡ å‚è€ƒé“¾æ¥ï¼šhttps://segmentfault.com/a/1190000023029219 ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:0","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç®€ä»‹ cronä¸€ä¸ªç”¨äºç®¡ç†å®šæ—¶ä»»åŠ¡çš„åº“ï¼Œç”¨ Go å®ç° Linux ä¸­crontabè¿™ä¸ªå‘½ä»¤çš„æ•ˆæœã€‚ä¹‹å‰æˆ‘ä»¬ä¹Ÿä»‹ç»è¿‡ä¸€ä¸ªç±»ä¼¼çš„ Go åº“â€”â€”gronã€‚gronä»£ç å°å·§ï¼Œç”¨äºå­¦ä¹ æ˜¯æ¯”è¾ƒå¥½çš„ã€‚ä½†æ˜¯å®ƒåŠŸèƒ½ç›¸å¯¹ç®€å•äº›ï¼Œå¹¶ä¸”å·²ç»ä¸ç»´æŠ¤äº†ã€‚å¦‚æœæœ‰å®šæ—¶ä»»åŠ¡éœ€æ±‚ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨cronã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:1","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å¿«é€Ÿä½¿ç”¨ å®‰è£…cronï¼Œç›®å‰æœ€æ–°ç¨³å®šç‰ˆæœ¬ä¸º v3ï¼š $ go get github.com/robfig/cron/v3 ä½¿ç”¨ package main import ( \"fmt\" \"time\" \"github.com/robfig/cron/v3\" ) func main() { c := cron.New() c.AddFunc(\"@every 1s\", func() { fmt.Println(\"tick every 1 second\") }) c.Start() time.Sleep(time.Second * 5) } ä½¿ç”¨éå¸¸ç®€å•ï¼Œåˆ›å»ºcronå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç”¨äºç®¡ç†å®šæ—¶ä»»åŠ¡ã€‚ è°ƒç”¨cronå¯¹è±¡çš„AddFunc()æ–¹æ³•å‘ç®¡ç†å™¨ä¸­æ·»åŠ å®šæ—¶ä»»åŠ¡ã€‚AddFunc()æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå‚æ•° 1 ä»¥å­—ç¬¦ä¸²å½¢å¼æŒ‡å®šè§¦å‘æ—¶é—´è§„åˆ™ï¼Œå‚æ•° 2 æ˜¯ä¸€ä¸ªæ— å‚çš„å‡½æ•°ï¼Œæ¯æ¬¡è§¦å‘æ—¶è°ƒç”¨ã€‚@every 1sè¡¨ç¤ºæ¯ç§’è§¦å‘ä¸€æ¬¡ï¼Œ@everyååŠ ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œè¡¨ç¤ºæ¯éš”å¤šé•¿æ—¶é—´è§¦å‘ä¸€æ¬¡ã€‚ä¾‹å¦‚@every 1hè¡¨ç¤ºæ¯å°æ—¶è§¦å‘ä¸€æ¬¡ï¼Œ@every 1m2sè¡¨ç¤ºæ¯éš” 1 åˆ† 2 ç§’è§¦å‘ä¸€æ¬¡ã€‚time.ParseDuration()æ”¯æŒçš„æ ¼å¼éƒ½å¯ä»¥ç”¨åœ¨è¿™é‡Œã€‚ è°ƒç”¨c.Start()å¯åŠ¨å®šæ—¶å¾ªç¯ã€‚ æ³¨æ„ä¸€ç‚¹ï¼Œå› ä¸ºc.Start()å¯åŠ¨ä¸€ä¸ªæ–°çš„ goroutine åšå¾ªç¯æ£€æµ‹ï¼Œæˆ‘ä»¬åœ¨ä»£ç æœ€ååŠ äº†ä¸€è¡Œtime.Sleep(time.Second * 5)é˜²æ­¢ä¸» goroutine é€€å‡ºã€‚ è¿è¡Œæ•ˆæœï¼Œæ¯éš” 1s è¾“å‡ºä¸€è¡Œå­—ç¬¦ä¸²ï¼š $ go run main.go tick every 1 second tick every 1 second tick every 1 second tick every 1 second tick every 1 second ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:2","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ—¶é—´æ ¼å¼ ä¸Linux ä¸­crontabå‘½ä»¤ç›¸ä¼¼ï¼Œcronåº“æ”¯æŒç”¨ 5 ä¸ªç©ºæ ¼åˆ†éš”çš„åŸŸæ¥è¡¨ç¤ºæ—¶é—´ã€‚è¿™ 5 ä¸ªåŸŸå«ä¹‰ä¾æ¬¡ä¸ºï¼š Minutesï¼šåˆ†é’Ÿï¼Œå–å€¼èŒƒå›´[0-59]ï¼Œæ”¯æŒç‰¹æ®Šå­—ç¬¦* / , -ï¼› Hoursï¼šå°æ—¶ï¼Œå–å€¼èŒƒå›´[0-23]ï¼Œæ”¯æŒç‰¹æ®Šå­—ç¬¦* / , -ï¼› Day of monthï¼šæ¯æœˆçš„ç¬¬å‡ å¤©ï¼Œå–å€¼èŒƒå›´[1-31]ï¼Œæ”¯æŒç‰¹æ®Šå­—ç¬¦* / , - ?ï¼› Monthï¼šæœˆï¼Œå–å€¼èŒƒå›´[1-12]æˆ–è€…ä½¿ç”¨æœˆä»½åå­—ç¼©å†™[JAN-DEC]ï¼Œæ”¯æŒç‰¹æ®Šå­—ç¬¦* / , -ï¼› Day of weekï¼šå‘¨å†ï¼Œå–å€¼èŒƒå›´[0-6]æˆ–åå­—ç¼©å†™[JUN-SAT]ï¼Œæ”¯æŒç‰¹æ®Šå­—ç¬¦* / , - ?ã€‚ æ³¨æ„ï¼Œæœˆä»½å’Œå‘¨å†åç§°éƒ½æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´SUN/Sun/sunè¡¨ç¤ºåŒæ ·çš„å«ä¹‰ï¼ˆéƒ½æ˜¯å‘¨æ—¥ï¼‰ã€‚ ç‰¹æ®Šå­—ç¬¦å«ä¹‰å¦‚ä¸‹ï¼š *ï¼šä½¿ç”¨*çš„åŸŸå¯ä»¥åŒ¹é…ä»»ä½•å€¼ï¼Œä¾‹å¦‚å°†æœˆä»½åŸŸï¼ˆç¬¬ 4 ä¸ªï¼‰è®¾ç½®ä¸º*ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆï¼› /ï¼šç”¨æ¥æŒ‡å®šèŒƒå›´çš„æ­¥é•¿ï¼Œä¾‹å¦‚å°†å°æ—¶åŸŸï¼ˆç¬¬ 2 ä¸ªï¼‰è®¾ç½®ä¸º3-59/15è¡¨ç¤ºç¬¬ 3 åˆ†é’Ÿè§¦å‘ï¼Œä»¥åæ¯éš” 15 åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ï¼Œå› æ­¤ç¬¬ 2 æ¬¡è§¦å‘ä¸ºç¬¬ 18 åˆ†é’Ÿï¼Œç¬¬ 3 æ¬¡ä¸º 33 åˆ†é’Ÿã€‚ã€‚ã€‚ç›´åˆ°åˆ†é’Ÿå¤§äº 59ï¼› ,ï¼šç”¨æ¥åˆ—ä¸¾ä¸€äº›ç¦»æ•£çš„å€¼å’Œå¤šä¸ªèŒƒå›´ï¼Œä¾‹å¦‚å°†å‘¨å†çš„åŸŸï¼ˆç¬¬ 5 ä¸ªï¼‰è®¾ç½®ä¸ºMON,WED,FRIè¡¨ç¤ºå‘¨ä¸€ã€ä¸‰å’Œäº”ï¼› -ï¼šç”¨æ¥è¡¨ç¤ºèŒƒå›´ï¼Œä¾‹å¦‚å°†å°æ—¶çš„åŸŸï¼ˆç¬¬ 1 ä¸ªï¼‰è®¾ç½®ä¸º9-17è¡¨ç¤ºä¸Šåˆ 9 ç‚¹åˆ°ä¸‹åˆ 17 ç‚¹ï¼ˆåŒ…æ‹¬ 9 å’Œ 17ï¼‰ï¼› ?ï¼šåªèƒ½ç”¨åœ¨æœˆå†å’Œå‘¨å†çš„åŸŸä¸­ï¼Œç”¨æ¥ä»£æ›¿*ï¼Œè¡¨ç¤ºæ¯æœˆ/å‘¨çš„ä»»æ„ä¸€å¤©ã€‚ äº†è§£è§„åˆ™ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä»»æ„æ—¶é—´ï¼š 30 * * * *ï¼šåˆ†é’ŸåŸŸä¸º 30ï¼Œå…¶ä»–åŸŸéƒ½æ˜¯*è¡¨ç¤ºä»»æ„ã€‚æ¯å°æ—¶çš„ 30 åˆ†è§¦å‘ï¼› 30 3-6,20-23 * * *ï¼šåˆ†é’ŸåŸŸä¸º 30ï¼Œå°æ—¶åŸŸçš„3-6,20-23è¡¨ç¤º 3 ç‚¹åˆ° 6 ç‚¹å’Œ 20 ç‚¹åˆ° 23 ç‚¹ã€‚3,4,5,6,20,21,22,23 æ—¶çš„ 30 åˆ†è§¦å‘ï¼› 0 0 1 1 *ï¼š1ï¼ˆç¬¬ 4 ä¸ªï¼‰ æœˆ 1ï¼ˆç¬¬ 3 ä¸ªï¼‰ å·çš„ 0ï¼ˆç¬¬ 2 ä¸ªï¼‰ æ—¶ 0ï¼ˆç¬¬ 1 ä¸ªï¼‰ åˆ†è§¦å‘ã€‚ è®°ç†Ÿäº†è¿™å‡ ä¸ªåŸŸçš„é¡ºåºï¼Œå†å¤šç»ƒä¹ å‡ æ¬¡å¾ˆå®¹æ˜“å°±èƒ½æŒæ¡æ ¼å¼ã€‚ç†Ÿæ‚‰è§„åˆ™äº†ä¹‹åï¼Œå°±èƒ½ç†Ÿç»ƒä½¿ç”¨crontabå‘½ä»¤äº†ã€‚ func main() { c := cron.New() c.AddFunc(\"30 * * * *\", func() { fmt.Println(\"Every hour on the half hour\") }) c.AddFunc(\"30 3-6,20-23 * * *\", func() { fmt.Println(\"On the half hour of 3-6am, 8-11pm\") }) c.AddFunc(\"0 0 1 1 *\", func() { fmt.Println(\"Jun 1 every year\") }) c.Start() for { time.Sleep(time.Second) } } é¢„å®šä¹‰æ—¶é—´è§„åˆ™ ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œcroné¢„å®šä¹‰äº†ä¸€äº›æ—¶é—´è§„åˆ™ï¼š @yearlyï¼šä¹Ÿå¯ä»¥å†™ä½œ@annuallyï¼Œè¡¨ç¤ºæ¯å¹´ç¬¬ä¸€å¤©çš„ 0 ç‚¹ã€‚ç­‰ä»·äº0 0 1 1 *ï¼› @monthlyï¼šè¡¨ç¤ºæ¯æœˆç¬¬ä¸€å¤©çš„ 0 ç‚¹ã€‚ç­‰ä»·äº0 0 1 * *ï¼› @weeklyï¼šè¡¨ç¤ºæ¯å‘¨ç¬¬ä¸€å¤©çš„ 0 ç‚¹ï¼Œæ³¨æ„ç¬¬ä¸€å¤©ä¸ºå‘¨æ—¥ï¼Œå³å‘¨å…­ç»“æŸï¼Œå‘¨æ—¥å¼€å§‹çš„é‚£ä¸ª 0 ç‚¹ã€‚ç­‰ä»·äº0 0 * * 0ï¼› @dailyï¼šä¹Ÿå¯ä»¥å†™ä½œ@midnightï¼Œè¡¨ç¤ºæ¯å¤© 0 ç‚¹ã€‚ç­‰ä»·äº0 0 * * *ï¼› @hourlyï¼šè¡¨ç¤ºæ¯å°æ—¶çš„å¼€å§‹ã€‚ç­‰ä»·äº0 * * * *ã€‚ ä¾‹å¦‚ï¼š func main() { c := cron.New() c.AddFunc(\"@hourly\", func() { fmt.Println(\"Every hour\") }) c.AddFunc(\"@daily\", func() { fmt.Println(\"Every day on midnight\") }) c.AddFunc(\"@weekly\", func() { fmt.Println(\"Every week\") }) c.Start() for { time.Sleep(time.Second) } } ä¸Šé¢ä»£ç åªæ˜¯æ¼”ç¤ºç”¨æ³•ï¼Œå®é™…è¿è¡Œå¯èƒ½è¦ç­‰å¾…éå¸¸é•¿çš„æ—¶é—´æ‰èƒ½æœ‰è¾“å‡ºã€‚ å›ºå®šæ—¶é—´é—´éš” cronæ”¯æŒå›ºå®šæ—¶é—´é—´éš”ï¼Œæ ¼å¼ä¸ºï¼š @every \u003cduration\u003e å«ä¹‰ä¸ºæ¯éš”durationè§¦å‘ä¸€æ¬¡ã€‚``ä¼šè°ƒç”¨time.ParseDuration()å‡½æ•°è§£æï¼Œæ‰€ä»¥ParseDurationæ”¯æŒçš„æ ¼å¼éƒ½å¯ä»¥ã€‚ä¾‹å¦‚1h30m10sã€‚åœ¨å¿«é€Ÿå¼€å§‹éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»æ¼”ç¤ºäº†@everyçš„ç”¨æ³•äº†ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:3","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ—¶åŒº é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ—¶é—´éƒ½æ˜¯åŸºäºå½“å‰æ—¶åŒºçš„ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šæ—¶åŒºï¼Œæœ‰ 2 ä¸¤ç§æ–¹å¼ï¼š åœ¨æ—¶é—´å­—ç¬¦ä¸²å‰é¢æ·»åŠ ä¸€ä¸ªCRON_TZ= + å…·ä½“æ—¶åŒºï¼Œå…·ä½“æ—¶åŒºçš„æ ¼å¼åœ¨ä¹‹å‰carbonçš„æ–‡ç« ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚ä¸œäº¬æ—¶åŒºä¸ºAsia/Tokyoï¼Œçº½çº¦æ—¶åŒºä¸ºAmerica/New_Yorkï¼› åˆ›å»ºcronå¯¹è±¡æ—¶å¢åŠ ä¸€ä¸ªæ—¶åŒºé€‰é¡¹cron.WithLocation(location)ï¼Œlocationä¸ºtime.LoadLocation(zone)åŠ è½½çš„æ—¶åŒºå¯¹è±¡ï¼Œzoneä¸ºå…·ä½“çš„æ—¶åŒºæ ¼å¼ã€‚æˆ–è€…è°ƒç”¨å·²åˆ›å»ºå¥½çš„cronå¯¹è±¡çš„SetLocation()æ–¹æ³•è®¾ç½®æ—¶åŒºã€‚ ç¤ºä¾‹ï¼š func main() { nyc, _ := time.LoadLocation(\"America/New_York\") c := cron.New(cron.WithLocation(nyc)) c.AddFunc(\"0 6 * * ?\", func() { fmt.Println(\"Every 6 o'clock at New York\") }) c.AddFunc(\"CRON_TZ=Asia/Tokyo 0 6 * * ?\", func() { fmt.Println(\"Every 6 o'clock at Tokyo\") }) c.Start() for { time.Sleep(time.Second) } } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:4","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Jobæ¥å£ é™¤äº†ç›´æ¥å°†æ— å‚å‡½æ•°ä½œä¸ºå›è°ƒå¤–ï¼Œcronè¿˜æ”¯æŒJobæ¥å£ï¼š // cron.go type Job interface { Run() } æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå®ç°æ¥å£Jobçš„ç»“æ„ï¼š type GreetingJob struct { Name string } func (g GreetingJob) Run() { fmt.Println(\"Hello \", g.Name) } è°ƒç”¨cronå¯¹è±¡çš„AddJob()æ–¹æ³•å°†GreetingJobå¯¹è±¡æ·»åŠ åˆ°å®šæ—¶ç®¡ç†å™¨ä¸­ï¼š func main() { c := cron.New() c.AddJob(\"@every 1s\", GreetingJob{\"dj\"}) c.Start() time.Sleep(5 * time.Second) } è¿è¡Œæ•ˆæœï¼š $ go run main.go Hello dj Hello dj Hello dj Hello dj Hello dj ä½¿ç”¨è‡ªå®šä¹‰çš„ç»“æ„å¯ä»¥è®©ä»»åŠ¡æºå¸¦çŠ¶æ€ï¼ˆNameå­—æ®µï¼‰ã€‚ å®é™…ä¸ŠAddFunc()æ–¹æ³•å†…éƒ¨ä¹Ÿè°ƒç”¨äº†AddJob()æ–¹æ³•ã€‚é¦–å…ˆï¼ŒcronåŸºäºfunc()ç±»å‹å®šä¹‰ä¸€ä¸ªæ–°çš„ç±»å‹FuncJobï¼š // cron.go type FuncJob func() ç„¶åè®©FuncJobå®ç°Jobæ¥å£ï¼š // cron.go func (f FuncJob) Run() { f() } åœ¨AddFunc()æ–¹æ³•ä¸­ï¼Œå°†ä¼ å…¥çš„å›è°ƒè½¬ä¸ºFuncJobç±»å‹ï¼Œç„¶åè°ƒç”¨AddJob()æ–¹æ³•ï¼š func (c *Cron) AddFunc(spec string, cmd func()) (EntryID, error) { return c.AddJob(spec, FuncJob(cmd)) } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:5","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"çº¿ç¨‹å®‰å…¨ cronä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ goroutine æ¥æ‰§è¡Œè§¦å‘å›è°ƒã€‚å¦‚æœè¿™äº›å›è°ƒéœ€è¦å¹¶å‘è®¿é—®ä¸€äº›èµ„æºã€æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°åšåŒæ­¥ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:6","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"è‡ªå®šä¹‰æ—¶é—´æ ¼å¼ cronæ”¯æŒçµæ´»çš„æ—¶é—´æ ¼å¼ï¼Œå¦‚æœé»˜è®¤çš„æ ¼å¼ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰æ—¶é—´æ ¼å¼ã€‚æ—¶é—´è§„åˆ™å­—ç¬¦ä¸²éœ€è¦cron.Parserå¯¹è±¡æ¥è§£æã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹é»˜è®¤çš„è§£æå™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ é¦–å…ˆå®šä¹‰å„ä¸ªåŸŸï¼š // parser.go const ( Second ParseOption = 1 \u003c\u003c iota SecondOptional Minute Hour Dom Month Dow DowOptional Descriptor ) é™¤äº†Minute/Hour/Dom(Day of month)/Month/Dow(Day of week)å¤–ï¼Œè¿˜å¯ä»¥æ”¯æŒSecondã€‚ç›¸å¯¹é¡ºåºéƒ½æ˜¯å›ºå®šçš„ï¼š // parser.go var places = []ParseOption{ Second, Minute, Hour, Dom, Month, Dow, } var defaults = []string{ \"0\", \"0\", \"0\", \"*\", \"*\", \"*\", } é»˜è®¤çš„æ—¶é—´æ ¼å¼ä½¿ç”¨ 5 ä¸ªåŸŸã€‚ æˆ‘ä»¬å¯ä»¥è°ƒç”¨cron.NewParser()åˆ›å»ºè‡ªå·±çš„Parserå¯¹è±¡ï¼Œä»¥ä½æ ¼å¼ä¼ å…¥ä½¿ç”¨å“ªäº›åŸŸï¼Œä¾‹å¦‚ä¸‹é¢çš„Parserä½¿ç”¨ 6 ä¸ªåŸŸï¼Œæ”¯æŒSecondï¼ˆç§’ï¼‰ï¼š parser := cron.NewParser( cron.Second | cron.Minute | cron.Hour | cron.Dom | cron.Month | cron.Dow | cron.Descriptor, ) è°ƒç”¨cron.WithParser(parser)åˆ›å»ºä¸€ä¸ªé€‰é¡¹ä¼ å…¥æ„é€ å‡½æ•°cron.New()ï¼Œä½¿ç”¨æ—¶å°±å¯ä»¥æŒ‡å®šç§’äº†ï¼š c := cron.New(cron.WithParser(parser)) c.AddFunc(\"1 * * * * *\", func () { fmt.Println(\"every 1 second\") }) c.Start() è¿™é‡Œæ—¶é—´æ ¼å¼å¿…é¡»ä½¿ç”¨ 6 ä¸ªåŸŸï¼Œé¡ºåºä¸ä¸Šé¢çš„constå®šä¹‰ä¸€è‡´ã€‚ å› ä¸ºä¸Šé¢çš„æ—¶é—´æ ¼å¼å¤ªå¸¸è§äº†ï¼Œcronå®šä¹‰äº†ä¸€ä¸ªä¾¿æ·çš„å‡½æ•°ï¼š // option.go func WithSeconds() Option { return WithParser(NewParser( Second | Minute | Hour | Dom | Month | Dow | Descriptor, )) } æ³¨æ„Descriptorè¡¨ç¤ºå¯¹@every/@hourç­‰çš„æ”¯æŒã€‚æœ‰äº†WithSeconds()ï¼Œæˆ‘ä»¬ä¸ç”¨æ‰‹åŠ¨åˆ›å»ºParserå¯¹è±¡äº†ï¼š c := cron.New(cron.WithSeconds()) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:7","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"é€‰é¡¹ cronå¯¹è±¡åˆ›å»ºä½¿ç”¨äº†é€‰é¡¹æ¨¡å¼ï¼Œæˆ‘ä»¬å‰é¢å·²ç»ä»‹ç»äº† 3 ä¸ªé€‰é¡¹ï¼š WithLocationï¼šæŒ‡å®šæ—¶åŒºï¼› WithParserï¼šä½¿ç”¨è‡ªå®šä¹‰çš„è§£æå™¨ï¼› WithSecondsï¼šè®©æ—¶é—´æ ¼å¼æ”¯æŒç§’ï¼Œå®é™…ä¸Šå†…éƒ¨è°ƒç”¨äº†WithParserã€‚ cronè¿˜æä¾›äº†å¦å¤–ä¸¤ç§é€‰é¡¹ï¼š WithLoggerï¼šè‡ªå®šä¹‰Loggerï¼› WithChainï¼šJob åŒ…è£…å™¨ã€‚ WithLogger WithLoggerå¯ä»¥è®¾ç½®cronå†…éƒ¨ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„Loggerï¼š func main() { c := cron.New( cron.WithLogger( cron.VerbosePrintfLogger(log.New(os.Stdout, \"cron: \", log.LstdFlags)))) c.AddFunc(\"@every 1s\", func() { fmt.Println(\"hello world\") }) c.Start() time.Sleep(5 * time.Second) } ä¸Šé¢è°ƒç”¨cron.VerbosPrintfLogger()åŒ…è£…log.Loggerï¼Œè¿™ä¸ªloggerä¼šè¯¦ç»†è®°å½•cronå†…éƒ¨çš„è°ƒåº¦è¿‡ç¨‹ï¼š $ go run main.go cron: 2020/06/26 07:09:14 start cron: 2020/06/26 07:09:14 schedule, now=2020-06-26T07:09:14+08:00, entry=1, next=2020-06-26T07:09:15+08:00 cron: 2020/06/26 07:09:15 wake, now=2020-06-26T07:09:15+08:00 cron: 2020/06/26 07:09:15 run, now=2020-06-26T07:09:15+08:00, entry=1, next=2020-06-26T07:09:16+08:00 hello world cron: 2020/06/26 07:09:16 wake, now=2020-06-26T07:09:16+08:00 cron: 2020/06/26 07:09:16 run, now=2020-06-26T07:09:16+08:00, entry=1, next=2020-06-26T07:09:17+08:00 hello world cron: 2020/06/26 07:09:17 wake, now=2020-06-26T07:09:17+08:00 cron: 2020/06/26 07:09:17 run, now=2020-06-26T07:09:17+08:00, entry=1, next=2020-06-26T07:09:18+08:00 hello world cron: 2020/06/26 07:09:18 wake, now=2020-06-26T07:09:18+08:00 hello world cron: 2020/06/26 07:09:18 run, now=2020-06-26T07:09:18+08:00, entry=1, next=2020-06-26T07:09:19+08:00 cron: 2020/06/26 07:09:19 wake, now=2020-06-26T07:09:19+08:00 hello world cron: 2020/06/26 07:09:19 run, now=2020-06-26T07:09:19+08:00, entry=1, next=2020-06-26T07:09:20+08:0 æˆ‘ä»¬çœ‹çœ‹é»˜è®¤çš„Loggeræ˜¯ä»€ä¹ˆæ ·çš„ï¼š // logger.go var DefaultLogger Logger = PrintfLogger(log.New(os.Stdout, \"cron: \", log.LstdFlags)) func PrintfLogger(l interface{ Printf(string, ...interface{}) }) Logger { return printfLogger{l, false} } func VerbosePrintfLogger(l interface{ Printf(string, ...interface{}) }) Logger { return printfLogger{l, true} } type printfLogger struct { logger interface{ Printf(string, ...interface{}) } logInfo bool } WithChain Job åŒ…è£…å™¨å¯ä»¥åœ¨æ‰§è¡Œå®é™…çš„Jobå‰åæ·»åŠ ä¸€äº›é€»è¾‘ï¼š æ•è·panicï¼› å¦‚æœJobä¸Šæ¬¡è¿è¡Œè¿˜æœªç»“æŸï¼Œæ¨è¿Ÿæœ¬æ¬¡æ‰§è¡Œ; å¦‚æœJobä¸Šæ¬¡è¿è¡Œè¿˜æœªä»‹ç»ï¼Œè·³è¿‡æœ¬æ¬¡æ‰§è¡Œï¼› è®°å½•æ¯ä¸ªJobçš„æ‰§è¡Œæƒ…å†µã€‚ æˆ‘ä»¬å¯ä»¥å°†Chainç±»æ¯”ä¸º Web å¤„ç†å™¨çš„ä¸­é—´ä»¶ã€‚å®é™…ä¸Šå°±æ˜¯åœ¨Jobçš„æ‰§è¡Œé€»è¾‘å¤–åœ¨å°è£…ä¸€å±‚é€»è¾‘ã€‚æˆ‘ä»¬çš„å°è£…é€»è¾‘éœ€è¦å†™æˆä¸€ä¸ªå‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªJobç±»å‹ï¼Œè¿”å›å°è£…åçš„Jobã€‚cronä¸ºè¿™ç§å‡½æ•°å®šä¹‰äº†ä¸€ä¸ªç±»å‹JobWrapperï¼š // chain.go type JobWrapper func(Job) Job ç„¶åä½¿ç”¨ä¸€ä¸ªChainå¯¹è±¡å°†è¿™äº›JobWrapperç»„åˆåˆ°ä¸€èµ·ï¼š type Chain struct { wrappers []JobWrapper } func NewChain(c ...JobWrapper) Chain { return Chain{c} } è°ƒç”¨Chainå¯¹è±¡çš„Then(job)æ–¹æ³•åº”ç”¨è¿™äº›JobWrapperï¼Œè¿”å›æœ€ç»ˆçš„`Jobï¼š func (c Chain) Then(j Job) Job { for i := range c.wrappers { j = c.wrappers[len(c.wrappers)-i-1](j) } return j } æ³¨æ„åº”ç”¨JobWrapperçš„é¡ºåºã€‚ å†…ç½®JobWrapper cronå†…ç½®äº† 3 ä¸ªç”¨å¾—æ¯”è¾ƒå¤šçš„JobWrapperï¼š Recoverï¼šæ•è·å†…éƒ¨Jobäº§ç”Ÿçš„ panicï¼› DelayIfStillRunningï¼šè§¦å‘æ—¶ï¼Œå¦‚æœä¸Šä¸€æ¬¡ä»»åŠ¡è¿˜æœªæ‰§è¡Œå®Œæˆï¼ˆè€—æ—¶å¤ªé•¿ï¼‰ï¼Œåˆ™ç­‰å¾…ä¸Šä¸€æ¬¡ä»»åŠ¡å®Œæˆä¹‹åå†æ‰§è¡Œï¼› SkipIfStillRunningï¼šè§¦å‘æ—¶ï¼Œå¦‚æœä¸Šä¸€æ¬¡ä»»åŠ¡è¿˜æœªå®Œæˆï¼Œåˆ™è·³è¿‡æ­¤æ¬¡æ‰§è¡Œã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ã€‚ Recover å…ˆçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ï¼š type panicJob struct { count int } func (p *panicJob) Run() { p.count++ if p.count == 1 { panic(\"oooooooooooooops!!!\") } fmt.Println(\"hello world\") } func main() { c := cron.New() c.AddJob(\"@every 1s\", cron.NewChain(cron.Recover(cron.DefaultLogger)).Then(\u0026panicJob{})) c.Start() time.Sleep(5 * time.Second) } panicJobåœ¨ç¬¬ä¸€æ¬¡è§¦å‘æ—¶ï¼Œè§¦å‘äº†panicã€‚å› ä¸ºæœ‰cron.Recover()ä¿æŠ¤ï¼Œåç»­ä»»åŠ¡è¿˜èƒ½æ‰§è¡Œï¼š go run main.go cron: 2020/06/27 14:02:00 panic, error=oooooooooooooops!!!, stack=... goroutine 18 [running]: github.com/robfig/cron/v3.Recover.func1.1.1(0x514ee0, 0xc0000044a0) D:/code/golang/pkg/mod/github.com/robfig/cron/v3@v3.0.1/chain.go:45 +0xbc panic(0x4cf380, 0x513280) C:/Go/src/runtime/panic.go:969 +0x174 main.(*panicJob).Run(0xc0000140e8) D:/code/golang/src/github.com/darjun/go-daily-lib/cron/recover/main.go:17 +0xba github.com/robfig/cron/v3.Recover.func1.1() D:/code/golang/pkg/mod/github.com/robfig/cron/v3@v3.0.1/chain.go:53 +0x6f github.com/robfig/cron/v3.FuncJob.Run(0xc000070390) D:/code/golang/pkg/mod/github.com/robfig/cron/v3@v3.0.1/cron.go:136 +0x2c github.com/robfig/cron/v3.(*Cron).startJob.func1(0xc00005c0a0, 0x514d20, 0xc000070390) D:/code/golang/pkg/mod/github.com/robfig/cron/v3@v3.0.1/cron.go:312 +0x68 created by github.com/robfig/cron/v3.(*Cron).startJob D:","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:8","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go gophåº“ é“¾æ¥åœ°å€ï¼š github.com/melbahja/goph github.com/serialt/goph (æ–¹ä¾¿æŒ‡å®šç«¯å£) ","date":"2023-11-10","objectID":"/posts/go-goth/:0:0","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç‰¹æ€§ æ˜“äºä½¿ç”¨ï¼Œç®€åŒ– ssh apiã€‚ æ”¯æŒssh å¯†ç ã€ç§é’¥ï¼Œå¸¦å¯†ç çš„ç§é’¥ã€‚ æ”¯æŒä»æœ¬åœ°ä¸Šä¼ æ–‡ä»¶å’Œä»è¿œç¨‹ä¸‹è½½æ–‡ä»¶ã€‚ æ”¯æŒ ssh ä½¿ç”¨ ssh-agent è¿æ¥ä¼šè¯ã€‚ æ”¯æŒå¢åŠ ä¸»æœºåˆ° known_hosts æ–‡ä»¶ã€‚ ","date":"2023-11-10","objectID":"/posts/go-goth/:1:0","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å®‰è£… go get github.com/serialt/goph ","date":"2023-11-10","objectID":"/posts/go-goth/:2:0","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ä½¿ç”¨ç¤ºä¾‹ ","date":"2023-11-10","objectID":"/posts/go-goth/:3:0","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"1ã€ä½¿ç”¨æ‰§è¡Œå‘½ä»¤ package main import ( \"fmt\" \"log\" \"github.com/serialt/goph\" ) var Client *goph.Client func init() { auth, err := goph.Key(os.Getenv(\"HOME\")+\"/.ssh/id_rsa\", \"\") if err != nil { log.Fatalf(\"cat read the ssh private key: %v\", err) } client, err := goph.New(\"root\", \"10.10.16.10\", 22, auth) if err != nil { log.Fatalf(\"ssh link faild: %v\", err) } Client = client } func main() { result, err := Client.Run(\"date\") fmt.Printf(\"result: %v\\nerr: %v\", string(result), err) defer Client.Close() } ","date":"2023-11-10","objectID":"/posts/go-goth/:3:1","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"2ã€ä»å­—ç¬¦ä¸²ä¸­è¯»å–ç§é’¥ package main import ( \"fmt\" \"log\" \"github.com/serialt/goph\" ) var Client *goph.Client var sshkey = ` -----BEGIN OPENSSH PRIVATE KEY----- NeY6rItzuvwtiPa5etNiAAAAGnNlcmlhbHQgdHNlcmlhbHRAZ21haWwuY29tAQID NeY6rItzuvwtiPa5etNiAAAAGnNlcmlhbHQgdHNlcmlhbHRAZ21haWwuY29tAQID NeY6rItzuvwtiPa5etNiAAAAGnNlcmlhbHQgdHNlcmlhbHRAZ21haWwuY29tAQID AAAECptYaTKFA2Omsb67+FN2SPr3daBAA0IxpVwv5KYJ1QKWR98JYVP7/WAqffRO NeY6rItzuvwtiPa5etNiAAAAGnNlcmlhbHQgdHNlcmlhbHRAZ21haWwuY29tAQID -----END OPENSSH PRIVATE KEY----- ` func init() { auth, err := goph.RawKey(sshkey, \"\") if err != nil { log.Fatalf(\"cat read the ssh private key: %v\", err) } client, err := goph.New(\"root\", \"10.10.16.10\", 22, auth) if err != nil { log.Fatalf(\"ssh link faild: %v\", err) } Client = client } func main() { result, err := Client.Run(\"date\") fmt.Printf(\"result: %v\\nerr: %v\", string(result), err) defer Client.Close() } ","date":"2023-11-10","objectID":"/posts/go-goth/:3:2","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"3ã€å¯†é’¥å¸¦å¯†ç  auth, err := goph.Key(os.Getenv(\"HOME\")+\"/.ssh/id_rsa\", \"you_passphrase_here\") if err != nil { // handle error } client, err := goph.New(\"root\", \"192.1.1.3\", auth) ","date":"2023-11-10","objectID":"/posts/go-goth/:3:3","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"4ã€ä½¿ç”¨å¯†ç  auth, err := goph.UseAgent() if err != nil { // handle error } client, err := goph.New(\"root\", \"192.1.1.1\", auth) ","date":"2023-11-10","objectID":"/posts/go-goth/:3:4","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"5ã€ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ // upload local file to remote err := client.Upload(\"/path/to/local/file\", \"/path/to/remote/file\") // download remote file to local err := client.Download(\"/path/to/remote/file\", \"/path/to/local/file\") ","date":"2023-11-10","objectID":"/posts/go-goth/:3:5","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"6ã€æ‰§è¡Œshellå‘½ä»¤ // execute bash commands out, err := client.Run(\"bash -c 'printenv'\") // execute bash command whith timeout context, cancel := context.WithTimeout(ctx, time.Second) defer cancel() // will send SIGINT and return error after 1 second out, err := client.RunContext(ctx, \"sleep 5\") // execute bash command whith env variables out, err := client.Run(`env MYVAR=\"MY VALUE\" bash -c 'echo $MYVAR;'`) ","date":"2023-11-10","objectID":"/posts/go-goth/:3:6","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"7ã€ä½¿ç”¨goph cmd Goph.Cmd struct is like the Go standard os/exec.Cmd. // Get new `Goph.Cmd` cmd, err := client.Command(\"ls\", \"-alh\", \"/tmp\") // or with context: // cmd, err := client.CommandContext(ctx, \"ls\", \"-alh\", \"/tmp\") if err != nil { // handle the error! } // You can set env vars, but the server must be configured to `AcceptEnv line`. cmd.Env = []string{\"MY_VAR=MYVALUE\"} // Run you command. err = cmd.Run() ust like os/exec.Cmd you can run CombinedOutput, Output, Start, Wait, and ssh.Session methods like Signalâ€¦ ","date":"2023-11-10","objectID":"/posts/go-goth/:3:7","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"8ã€ä½¿ç”¨sftpæ“ä½œæ–‡ä»¶ç³»ç»Ÿ sftp, err := client.NewSftp() if err != nil { // handle the error! } file, err := sftp.Create(\"/tmp/remote_file\") file.Write([]byte(`Hello world`)) file.Close() For more file operations see SFTP Docs. ","date":"2023-11-10","objectID":"/posts/go-goth/:3:8","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å®˜æ–¹ç¤ºä¾‹ package main import ( \"bufio\" \"context\" \"errors\" \"flag\" \"fmt\" \"log\" \"net\" \"os\" osuser \"os/user\" \"path/filepath\" \"strings\" \"time\" \"github.com/pkg/sftp\" \"github.com/serialt/goph\" \"golang.org/x/crypto/ssh\" \"golang.org/x/crypto/ssh/terminal\" ) // // Run command and auth via password: // \u003e go run main.go --ip 192.168.122.102 --pass --cmd ls // // Run command and auth via private key: // \u003e go run main.go --ip 192.168.122.102 --cmd ls // Or: // \u003e go run main.go --ip 192.168.122.102 --key /path/to/private_key --cmd ls // // Run command and auth with private key and passphrase: // \u003e go run main.go --ip 192.168.122.102 --passphrase --cmd ls // // Run a command and interrupt it after 1 second: // \u003e go run main.go --ip 192.168.122.102 --cmd \"sleep 10\" --timeout=1s // // You can test with the interactive mode without passing --cmd flag. // var ( err error auth goph.Auth client *goph.Client addr string user string port uint key string cmd string pass bool passphrase bool timeout time.Duration agent bool sftpc *sftp.Client ) func init() { usr, err := osuser.Current() if err != nil { fmt.Println(\"couldn't determine current user. defaulting to 'root'\") usr.Username = \"root\" } flag.StringVar(\u0026addr, \"ip\", \"127.0.0.1\", \"machine ip address.\") flag.StringVar(\u0026user, \"user\", usr.Username, \"ssh user.\") flag.UintVar(\u0026port, \"port\", 22, \"ssh port number.\") flag.StringVar(\u0026key, \"key\", filepath.Join(os.Getenv(\"HOME\"), \".ssh\", \"id_rsa\"), \"private key path.\") flag.StringVar(\u0026cmd, \"cmd\", \"\", \"command to run.\") flag.BoolVar(\u0026pass, \"pass\", false, \"ask for ssh password instead of private key.\") flag.BoolVar(\u0026agent, \"agent\", false, \"use ssh agent for authentication (unix systems only).\") flag.BoolVar(\u0026passphrase, \"passphrase\", false, \"ask for private key passphrase.\") flag.DurationVar(\u0026timeout, \"timeout\", 0, \"interrupt a command with SIGINT after a given timeout (0 means no timeout)\") } func VerifyHost(host string, remote net.Addr, key ssh.PublicKey) error { // // If you want to connect to new hosts. // here your should check new connections public keys // if the key not trusted you shuld return an error // // hostFound: is host in known hosts file. // err: error if key not in known hosts file OR host in known hosts file but key changed! hostFound, err := goph.CheckKnownHost(host, remote, key, \"\") // Host in known hosts but key mismatch! // Maybe because of MAN IN THE MIDDLE ATTACK! if hostFound \u0026\u0026 err != nil { return err } // handshake because public key already exists. if hostFound \u0026\u0026 err == nil { return nil } // Ask user to check if he trust the host public key. if askIsHostTrusted(host, key) == false { // Make sure to return error on non trusted keys. return errors.New(\"you typed no, aborted!\") } // Add the new host to known hosts file. return goph.AddKnownHost(host, remote, key, \"\") } func main() { flag.Parse() var err error if agent || goph.HasAgent() { auth, err = goph.UseAgent() } else if pass { auth = goph.Password(askPass(\"Enter SSH Password: \")) } else { auth, err = goph.Key(key, getPassphrase(passphrase)) } if err != nil { panic(err) } client, err = goph.NewConn(\u0026goph.Config{ User: user, Addr: addr, Port: port, Auth: auth, Callback: VerifyHost, }) if err != nil { panic(err) } // Close client net connection defer client.Close() // If the cmd flag exists if cmd != \"\" { ctx := context.Background() // create a context with timeout, if supplied in the argumetns if timeout \u003e 0 { var cancel context.CancelFunc ctx, cancel = context.WithTimeout(ctx, timeout) defer cancel() } out, err := client.RunContext(ctx, cmd) fmt.Println(string(out), err) return } // else open interactive mode. playWithSSHJustForTestingThisProgram(client) } func askPass(msg string) string { fmt.Print(msg) pass, err := terminal.ReadPassword(0) if err != nil { panic(err) } fmt.Println(\"\") return strings.TrimSpace(string(pass)) } func getPassphrase(ask bool) string { if ask { return askPass(\"Enter Private Key Passphrase: \") } return \"\" } func askIsHostTrusted(host string, key ssh.Public","date":"2023-11-10","objectID":"/posts/go-goth/:4:0","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"é•œåƒåŒæ­¥ å‚è€ƒé“¾æ¥ï¼š https://lework.github.io/2020/04/13/skopeo/ https://blog.k8s.li/skopeo.html æ—¥å¸¸å·¥ä½œä¸­ï¼Œéœ€è¦å°†å„ç§é•œåƒæ¬åˆ°å¯¹åº”çš„ä»“åº“ä¸­ï¼Œdocker é€‚åˆäºæ„å»ºé•œåƒï¼Œå°†é•œåƒæ¨é€äºä»“åº“ä¸­ã€‚é•œåƒè¢«æ¨é€åˆ°ä»“åº“ä¸­åï¼Œå¦‚æœéœ€è¦å¯¹é•œåƒè¿›è¡Œæ¬è¿ï¼Œåœ¨ä»“åº“ä¸æä¾›è¿™ä¸ªåŠŸèƒ½çš„æƒ…å†µä¸‹ï¼ŒåŒæ­¥é•œåƒæ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚ skopeo æ˜¯çº¢å¸½å¼€æºçš„å®¹å™¨é•œåƒç®¡ç†å·¥å…·ã€‚ç›¸æ¯”äºdockerï¼Œå®ƒæœ‰ä¸€ä¸‹çš„ä¼˜ç‚¹ï¼š æ”¯æŒå¤šä¸ªå¹³å°ï¼šskopeo æ”¯æŒ Linuxï¼ŒMac å’Œ Windowsã€‚ æ— éœ€ docker æˆ–è€… podmanï¼šskopeo å¯ä»¥æ„å»ºä¸ºå•ä¸€çš„ cliï¼Œä¸ä¾èµ–äº docker æœåŠ¡æˆ–è€… podmanã€‚ æ”¯æŒå¤šä¸ª OCI é•œåƒä»“åº“é—´åŒæ­¥ï¼šæ”¯æŒ OCI çš„é•œåƒæ‰˜ç®¡æœåŠ¡ï¼Œéƒ½å¯ä»¥ç›¸äº’åŒæ­¥ã€‚ æ”¯æŒå¤šæ¶æ„é•œåƒåŒæ­¥ï¼šå¯ä»¥åŒæ­¥å¤šç§æ¶æ„çš„é•œåƒã€‚ é•œåƒéªŒç­¾ï¼šskopeo æ”¯æŒé•œåƒç­¾åï¼Œå¯ç¡®ä¿é•œåƒçš„å®Œæ•´æ€§å’Œå¯é æ€§ã€‚ ","date":"2023-11-08","objectID":"/posts/skopeo/:0:0","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"ä¸€ã€ç¼–è¯‘skopeo skopeo å®˜æ–¹å¹¶ä¸æä¾›ç¼–è¯‘å¥½çš„é™æ€äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¸¸è§çš„ç³»ç»Ÿæºä¸­å·²ç»åŒ…å«äº† skopeoï¼Œä½†ç”±äº skopeo çš„ç‰ˆæœ¬è¿­ä»£æ¯”è¾ƒå¿«ï¼Œæ–°çš„åŠŸèƒ½ä¹Ÿéšä¹‹å¢åŠ ï¼Œéƒ¨åˆ†æ“ä½œç³»ç»Ÿé‡Œæä¾›çš„å®‰è£…åŒ…ç‰ˆæœ¬å¯èƒ½æ¯”è¾ƒä½ï¼Œæ— æ³•é€‚ç”¨ï¼Œä¸” skopeo å¤§å¤šéƒ½æ˜¯é“¾æ¥äº†åŠ¨æ€åº“ï¼Œæ— æ³•é€šç”¨äºå¤šä¸ª linux å‘è¡Œç‰ˆï¼Œå› æ­¤å¯ä»¥å€ŸåŠ©dockerå®ç°skopeoçš„é™æ€ç¼–è¯‘ã€‚ åŸºäºgithub actionæ„å»ºskopeo: skopeo ","date":"2023-11-08","objectID":"/posts/skopeo/:1:0","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"ä¸‹è½½ skopeo æºç  # download source code git clone --depth=1 https://github.com/containers/skopeo.git ","date":"2023-11-08","objectID":"/posts/skopeo/:1:1","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"æ„å»ºbuildé•œåƒçš„Dockerfile å›½å†…æ„å»ºåˆ™éœ€è¦ä¿®æ”¹ alpine å’Œ go é•œåƒåœ°å€ï¼Œå¯ç›´è¿ github çš„å¯ä»¥å¿½ç•¥æ­¤æ­¥ FROM golang:1.19-alpine3.16 AS builder ENV LANG=C.UTF-8 ENV TZ=Asia/Shanghai ENV CGO_ENABLED=0 ENV GOPROXY=https://goproxy.cn,direct RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories RUN apk update --no-cache \u0026\u0026 apk add --no-cache ca-certificates ","date":"2023-11-08","objectID":"/posts/skopeo/:1:2","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"æ„å»º build é•œåƒ docker build -t skopeo-build . ","date":"2023-11-08","objectID":"/posts/skopeo/:1:3","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"æ„å»º skopeo é™æ€äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ cd skopeo/ # æ„å»º linux amd64 æ¶æ„ docker run --rm -t -v $PWD:/build skopeo-build sh -c \"apk update \u0026\u0026 apk add gpgme btrfs-progs-dev llvm13-dev gcc musl-dev \u0026\u0026 cd /build \u0026\u0026 CGO_ENABLE=0 GO111MODULE=on GOOS=linux GOARCH=amd64 go build -mod=vendor '-buildmode=pie' -ldflags '-extldflags -static' -gcflags '' -tags 'exclude_graphdriver_devicemapper exclude_graphdriver_btrfs containers_image_openpgp' -o ./bin/skopeo-linux-amd64 ./cmd/skopeo \" # æ„å»º linux arm64 æ¶æ„ docker run --rm -t -v $PWD:/build skopeo-build sh -c \"apk update \u0026\u0026 apk add gpgme btrfs-progs-dev llvm13-dev gcc musl-dev \u0026\u0026 cd /build \u0026\u0026 CGO_ENABLE=0 GO111MODULE=on GOOS=linux GOARCH=arm64 go build -mod=vendor '-buildmode=pie' -ldflags '-extldflags -static' -gcflags '' -tags 'exclude_graphdriver_devicemapper exclude_graphdriver_btrfs containers_image_openpgp' -o ./bin/skopeo-linux-arm64 ./cmd/skopeo \" ","date":"2023-11-08","objectID":"/posts/skopeo/:1:4","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"äºŒã€skopeo å‘½ä»¤ä½¿ç”¨ [root@tc ~]# skopeo -v skopeo version 1.11.1-dev [root@tc ~]# skopeo --help Various operations with container images and container image registries Usage: skopeo [flags] skopeo [command] Available Commands: copy Copy an IMAGE-NAME from one location to another delete Delete image IMAGE-NAME generate-sigstore-key Generate a sigstore public/private key pair help Help about any command inspect Inspect image IMAGE-NAME list-tags List tags in the transport/repository specified by the SOURCE-IMAGE login Login to a container registry logout Logout of a container registry manifest-digest Compute a manifest digest of a file standalone-sign Create a signature using local files standalone-verify Verify a signature using local files sync Synchronize one or more images from one location to another Flags: --command-timeout duration timeout for the command execution --debug enable debug output -h, --help help for skopeo --insecure-policy run the tool without any policy check --override-arch ARCH use ARCH instead of the architecture of the machine for choosing images --override-os OS use OS instead of the running OS for choosing images --override-variant VARIANT use VARIANT instead of the running architecture variant for choosing images --policy string Path to a trust policy file --registries.d DIR use registry configuration files in DIR (e.g. for container signature storage) --tmpdir string directory used to store temporary files -v, --version Version for Skopeo Use \"skopeo [command] --help\" for more information about a command. # ç™»å½•ä¸ç™»å‡º oci skopeo login -u username docker.io skopeo logout docker.io ä¸ä¸‹è½½é•œåƒæƒ…å†µä¸‹è·å–é•œåƒä¿¡æ¯ [root@tc ~]# skopeo inspect docker://docker.io/alpine { \"Name\": \"docker.io/library/alpine\", \"Digest\": \"sha256:eece025e432126ce23f223450a0326fbebde39cdf496a85d8c016293fc851978\", \"RepoTags\": [ \"20220316\", \"20220328\", \"20220715\", \"20221110\", \"20230208\", \"20230329\", \"20230901\", \"3\", \"3.17\", \"3.17.0\", \"3.17.0_rc1\", \"3.17.1\", \"3.17.2\", \"3.17.3\", \"3.17.4\", \"3.17.5\", \"3.18\", \"3.18.0\", \"3.18.2\", \"3.18.3\", \"3.18.4\", \"edge\", \"latest\" ], \"Created\": \"2023-09-28T21:19:27.801479409Z\", \"DockerVersion\": \"20.10.23\", \"Labels\": null, \"Architecture\": \"amd64\", \"Os\": \"linux\", \"Layers\": [ \"sha256:96526aa774ef0126ad0fe9e9a95764c5fc37f409ab9e97021e7b4775d82bf6fa\" ], \"LayersData\": [ { \"MIMEType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"Digest\": \"sha256:96526aa774ef0126ad0fe9e9a95764c5fc37f409ab9e97021e7b4775d82bf6fa\", \"Size\": 3401967, \"Annotations\": null } ], \"Env\": [ \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\" ] } docker://: æ˜¯ä½¿ç”¨ Docker Registry HTTP API V2 è¿›è¡Œè¿æ¥è¿œç«¯ docker.io: è¿œç¨‹ä»“åº“ alpine: é•œåƒåç§° è·å–æœ¬åœ°é•œåƒä¿¡æ¯ [root@tc ~]# skopeo inspect docker-daemon:alpine:3 { \"Name\": \"docker.io/library/alpine\", \"Digest\": \"sha256:844bc35fdf7a96e5b6bf5e76e20989a797cc75976fad73275061a36f448b92b9\", \"RepoTags\": [], \"Created\": \"2023-09-28T21:19:27.801479409Z\", \"DockerVersion\": \"20.10.23\", \"Labels\": null, \"Architecture\": \"amd64\", \"Os\": \"linux\", \"Layers\": [ \"sha256:cc2447e1835a40530975ab80bb1f872fbab0f2a0faecf2ab16fbbb89b3589438\" ], \"LayersData\": [ { \"MIMEType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"Digest\": \"sha256:cc2447e1835a40530975ab80bb1f872fbab0f2a0faecf2ab16fbbb89b3589438\", \"Size\": 7625728, \"Annotations\": null } ], \"Env\": [ \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\" ] } docker-daemon: dockerå®ˆæŠ¤é•œåƒçš„é•œåƒ alpine:3: æœ¬åœ°é•œåƒçš„åç§° ","date":"2023-11-08","objectID":"/posts/skopeo/:2:0","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"copyé•œåƒ # skopeo --insecure-policy copy docker://nginx:1.17.6 docker-archive:/tmp/nginx.tar Getting image source signatures Copying blob 8ec398bc0356 done Copying blob 465560073b6f done Copying blob f473f9fd0a8c done Copying config f7bb5701a3 done Writing manifest to image destination Storing signatures # ls -alh /tmp/nginx.tar -rw-r--r-- 1 root root 125M 4æœˆ 13 15:22 /tmp/nginx.tar --insecure-policy: ç”¨äºå¿½ç•¥å®‰å…¨ç­–ç•¥é…ç½®æ–‡ä»¶ docker://nginx:1.17.6: è¯¥å‘½ä»¤å°†ä¼šç›´æ¥é€šè¿‡ http ä¸‹è½½ç›®æ ‡é•œåƒ docker-archive: å­˜å‚¨ä¸º /tmp/nginx.tarï¼Œæ­¤æ–‡ä»¶å¯ä»¥ç›´æ¥é€šè¿‡ docker load å‘½ä»¤å¯¼å…¥ ç›¸åº”çš„ï¼Œå¯ä»¥å°†ä¸‹è½½çš„æ–‡ä»¶å¯¼å…¥åˆ°æœ¬åœ° # skopeo copy docker-archive:/tmp/nginx.tar docker-daemon:nginx:latest Getting image source signatures Copying blob 556c5fb0d91b done Copying blob 49434cc20e95 done Copying blob 75248c0d5438 done Copying config f7bb5701a3 done Writing manifest to image destination Storing signatures # docker images nginx REPOSITORY TAG IMAGE ID CREATED SIZE nginx latest f7bb5701a33c 3 months ago 126MB COPY # ä¹Ÿå¯ä»¥å°†é•œåƒä¸‹è½½åˆ°æŒ‡å®šç›®å½• # skopeo copy docker://busybox:latest dir:/tmp/busybox Getting image source signatures Copying blob 0669b0daf1fb done Copying config 83aa35aa1c done Writing manifest to image destination Storing signatures # ls -alh /tmp/busybox/ æ€»ç”¨é‡ 760K drwxr-xr-x 2 root root 186 4æœˆ 13 15:26 . drwxrwxrwt. 12 root root 4.0K 4æœˆ 13 15:25 .. -rw-r--r-- 1 root root 743K 4æœˆ 13 15:26 0669b0daf1fba90642d105f3bc2c94365c5282155a33cc65ac946347a90d90d1 -rw-r--r-- 1 root root 1.5K 4æœˆ 13 15:26 83aa35aa1c79e4b6957e018da6e322bfca92bf3b4696a211b42502543c242d6f -rw-r--r-- 1 root root 527 4æœˆ 13 15:26 manifest.json -rw-r--r-- 1 root root 33 4æœˆ 13 15:25 version #æˆ–è€…ä»æŒ‡å®šç›®å½•å¯¼å…¥åˆ°æœ¬åœ° # skopeo copy dir:/tmp/busybox docker-daemon:busybox:latest Getting image source signatures Copying blob 0669b0daf1fb done Copying config 83aa35aa1c done Writing manifest to image destination Storing signatures # docker images busybox REPOSITORY TAG IMAGE ID CREATED SIZE busybox latest 83aa35aa1c79 4 weeks ago 1.22MB ","date":"2023-11-08","objectID":"/posts/skopeo/:2:1","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"åˆ é™¤é•œåƒ skopeo delete docker://localhost:5000/nginx:latest ","date":"2023-11-08","objectID":"/posts/skopeo/:2:2","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"è®¤è¯æ–‡ä»¶ è®¤è¯æ–‡ä»¶é»˜è®¤å­˜æ”¾åœ¨ $HOME/.docker/config.json æ–‡ä»¶å†…å®¹ { \"auths\": { \"myregistrydomain.com:5000\": { \"auth\": \"dGVzdHVzZXI6dGVzdHxxxxxxxx\", \"email\": \"cc@local.com\" } } } ","date":"2023-11-08","objectID":"/posts/skopeo/:2:3","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"sync åœ¨ OCI é—´åŒæ­¥é•œåƒ ä½¿ç”¨ docke råœ¨ OCI é—´åŒæ­¥é•œåƒçš„æ—¶å€™ï¼Œéœ€è¦å…ˆæŠŠé•œåƒæ‹‰ä¸‹æ¥ï¼Œæ‰“ä¸Š tag ï¼Œç„¶ååœ¨æ¨é€åˆ°ç›®çš„ OCI ä¸Šã€‚åœ¨è¿™ä¸ªæ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œå³å ç”¨äº†å­˜å‚¨ï¼Œåˆå ç”¨äº†å¸¦å®½ï¼Œåœ¨åŒæ­¥å¤§çš„é•œåƒæˆ–è€…å¤§é‡çš„é•œåƒçš„æ—¶å€™ï¼Œå­˜å‚¨ä¼šä¸¥é‡å½±å“é•œåƒåœ¨ OCI é—´åŒæ­¥çš„æ•ˆç‡ã€‚skopeo æ­£å¥½å¯ä»¥è§£å†³è¿™ä¸ªç¼ºç‚¹ï¼Œskopeo åœ¨åŒæ­¥ OCI é•œåƒçš„è¿‡ç¨‹ä¸­ï¼Œåªå ç”¨å¸¦å®½ï¼Œä¸ä¼šæŠŠé•œåƒä¸‹è½½åˆ°æœ¬åœ°ã€‚ åŸºäº yaml æ–‡ä»¶çš„åŒæ­¥ # sync.yaml ghcr.io: images: kube-vip/kube-vip: - 'v0.6.0' - 'v0.4.4' k3d-io/k3d-tools: - '5.5.2' åŒæ­¥é•œåƒ skopeo --insecure-policy sync -a --src yaml --dest docker sync.yaml repo.local.com/serialt ","date":"2023-11-08","objectID":"/posts/skopeo/:2:4","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"ä¸‰ã€åŒæ­¥é•œåƒ ç›®å‰ï¼Œå¸¸ç”¨çš„ OCI ä»“åº“æœ‰ï¼šdocker.ioï¼Œquay.ioï¼Œgcr.ioï¼Œregistry.k8s.ioï¼Œghcr.io ç­‰ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œå› ä¸ºæŸäº›åŸå› ï¼Œè¿™äº› OCI ä»“åº“åœ¨å›½å†…æ— æ³•è®¿é—®ï¼Œè€Œä¸€äº›é¡¹ç›®åˆä¸¥é‡ä¾èµ–äºå­˜å‚¨åœ¨è¿™äº› OCI ä»“åº“çš„é•œåƒï¼Œè™½ç„¶æœ‰çƒ­å¿ƒçš„å¤§ä½¬ä»¬ä¼šæŠŠ gcr å’Œ ghcr ä¸Šå­˜å‚¨çš„é•œåƒåŒæ­¥åˆ° docker hub ä¸­ï¼Œä½†å› ä¸ºè¿™äº›è¢«æ¨é€åˆ° docker hub ä¸­çš„é•œåƒä¸æ˜¯å®˜æ–¹ç»´æŠ¤çš„ï¼Œå¯èƒ½ä¼šå­˜åœ¨æ¯”è¾ƒå¤§çš„é•œåƒçš„åŒæ­¥æ—¶é—´å·®ï¼ŒæŸäº›éœ€è¦çš„é•œåƒæ— æ³•åœ¨ docker hub ä¸Šæ‰¾åˆ°ï¼ŒåŒæ—¶ä¹Ÿå®¹æ˜“å¼•èµ·å®¹å™¨é•œåƒçš„ä¾›åº”é“¾å®‰å…¨é—®é¢˜ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ github action ä½¿ç”¨ skopeo è¿›è¡ŒåŒæ­¥é•œåƒã€‚ é¡¹ç›®åœ°å€ï¼šsync-image ","date":"2023-11-08","objectID":"/posts/skopeo/:3:0","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"1ã€å®‰è£…sync-image å’Œ skopeo wget https://github.com/serialt/skopeo/releases/download/v1.13.3/skopeo-linux-amd64 go install github.com/serialt/sync-image@latest ","date":"2023-11-08","objectID":"/posts/skopeo/:3:1","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"2ã€é…ç½®sync-image yaml é…ç½®æ–‡ä»¶ # config.yaml # é•œåƒåŒæ­¥çš„ä¸ªæ•° last: 10 # mcråŒæ­¥çš„ä¸ªæ•°ï¼Œmcrä¸­åŒ…å«å¤šä¸ª vscode å®¹å™¨å¼€å‘çš„é•œåƒ mcrLast: 50 autoSyncfile: sync.yaml # ä¸åŒæ­¥å¸¦æœ‰ä»¥ä¸‹å…³é”®å­—çš„é•œåƒçš„tag exclude: - 'alpha' - 'beta' - 'rc' - 'amd64' - 'ppc64le' - 'arm64' - 'arm' - 's390x' - 'SNAPSHOT' - 'snapshot' - 'debug' - 'master' - 'latest' - 'main' - 'sig' - 'sha' - 'mips' # éœ€è¦åŒæ­¥çš„é•œåƒ images: docker.elastic.co: - elasticsearch/elasticsearch - kibana/kibana - logstash/logstash - beats/filebeat - beats/heartbeat - beats/packetbeat - beats/auditbeat - beats/journalbeat - beats/metricbeat - apm/apm-server - app-search/app-search quay.io: - coreos/flannel - ceph/ceph - cephcsi/cephcsi - csiaddons/k8s-sidecar - csiaddons/volumereplication-operator - prometheus/prometheus - prometheus/alertmanager - prometheus/pushgateway - prometheus/blackbox-exporter - prometheus/node-exporter - prometheus-operator/prometheus-config-reloader - prometheus-operator/prometheus-operator - brancz/kube-rbac-proxy - jetstack/cert-manager-webhook - jetstack/cert-manager-controller - jetstack/cert-manager-cainjector k8s.gcr.io: - conformance - dns/k8s-dns-node-cache - metrics-server/metrics-server - kube-state-metrics/kube-state-metrics - prometheus-adapter/prometheus-adapter registry.k8s.io: - sig-storage/local-volume-provisioner - metrics-server/metrics-server - defaultbackend - ingress-nginx/controller - ingress-nginx/kube-webhook-certgen - sig-storage/nfs-subdir-external-provisioner - sig-storage/csi-node-driver-registrar - sig-storage/csi-provisioner - sig-storage/csi-resizer - sig-storage/csi-snapshotter - sig-storage/snapshot-controller - sig-storage/snapshot-validation-webhook - sig-storage/nfsplugin - sig-storage/csi-attacher - sig-storage/livenessprobe - defaultbackend-amd64 - defaultbackend-arm64 - pause - etcd - kube-proxy - kube-apiserver - kube-scheduler - kube-controller-manager - coredns/coredns - build-image/kube-cross gcr.io: - kaniko-project/executor ghcr.io: - k3d-io/k3d-tools - k3d-io/k3d-proxy - kube-vip/kube-vip mcr.microsoft.com: - devcontainers/base - devcontainers/go docker.io: - flannel/flannel - flannel/flannel-cni-plugin - calico/kube-controllers - serialt/rocky - serialt/alma - calico/cni - calico/pod2daemon-flexvol - calico/kube-controllers - calico/node - rancher/mirrored-flannelcni-flannel-cni-plugin - rancher/mirrored-flannelcni-flanne ","date":"2023-11-08","objectID":"/posts/skopeo/:3:2","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"3ã€ç”ŸæˆåŠ¨æ€åŒæ­¥çš„ yaml æ–‡ä»¶ sync-image -c config.yaml ","date":"2023-11-08","objectID":"/posts/skopeo/:3:3","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"4ã€åŒæ­¥é•œåƒ ä¾èµ–çš„ç¯å¢ƒå˜é‡ DEST_HUB_USERNAME DEST_HUB_PASSWORD MY_GITHUB_TOKEN åŒæ­¥çš„shellè„šæœ¬ hub=\"docker.io\" repo=\"$hub/${DEST_HUB_USERNAME}\" hub2=\"registry.cn-hangzhou.aliyuncs.com\" repo2=\"$hub2/${DEST_HUB_USERNAME}\" if [ -f sync.yaml ]; then echo \"[Start] sync.......\" sudo skopeo login -u ${DEST_HUB_USERNAME} -p ${DEST_HUB_PASSWORD} ${hub} \\ \u0026\u0026 sudo skopeo --insecure-policy sync -a --src yaml --dest docker sync.yaml ${repo} \\ \u0026\u0026 sudo skopeo --insecure-policy sync -a --src yaml --dest docker custom_sync.yaml ${repo} sleep 3 sudo skopeo login -u ${DEST_HUB_USERNAME} -p ${DEST_HUB_PASSWORD} ${hub2} \\ \u0026\u0026 sudo skopeo --insecure-policy sync -a --src yaml --dest docker sync.yaml ${repo2} \\ \u0026\u0026 sudo skopeo --insecure-policy sync -a --src yaml --dest docker custom_sync.yaml ${repo2} echo \"[End] done.\" else echo \"[Error]not found sync.yaml!\" fi ","date":"2023-11-08","objectID":"/posts/skopeo/:3:4","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"5ã€github action é…ç½®æ–‡ä»¶ name: sync on: push: branches: - master - main schedule: - cron: \"0 2 * * *\" # Allows you to run this workflow manually from the Actions tab workflow_dispatch: jobs: sync: runs-on: ubuntu-latest steps: - uses: actions/checkout@v4 - name: Set up Go uses: actions/setup-go@v4 with: go-version: '\u003e=1.21.0' - name: Install dependencies run: | export version=v1.10.0 \u0026\u0026 export arch=amd64 \u0026\u0026 sudo wget https://github.com/lework/skopeo-binary/releases/download/${version}/skopeo-linux-${arch} -O /usr/bin/skopeo \u0026\u0026 sudo chmod +x /usr/bin/skopeo skopeo --version go install github.com/serialt/sync-image@latest - name: generate_sync_yaml env: SRC_HUB_USERNAME: ${{ secrets.SRC_HUB_USERNAME }} DEST_HUB_USERNAME: ${{ secrets.DEST_HUB_USERNAME }} DEST_HUB_PASSWORD: ${{ secrets.DEST_HUB_PASSWORD }} MY_GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }} timeout-minutes: 10 run: | sync-image - name: sync image env: SRC_HUB_USERNAME: ${{ secrets.SRC_HUB_USERNAME }} DEST_HUB_USERNAME: ${{ secrets.DEST_HUB_USERNAME }} DEST_HUB_PASSWORD: ${{ secrets.DEST_HUB_PASSWORD }} run: | bash sync.sh ","date":"2023-11-08","objectID":"/posts/skopeo/:3:5","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["morseç¼–ç "],"content":"Morse Code äºŒå‰æ ‘è®°å¿†æ³• start E T I A N M S U R W D K G O H V F L P J B X C Y Z Q . - E T .. .- -. -- I A N M ... ..- .-. ..- -.. -.- --. --- S U R W D K G O .... ...- ..-. .-.. .--. .--- -... -..- -.-. -.-- --.. --.- H v F L P J B X C Y Z Q ","date":"2023-11-08","objectID":"/posts/morse-code/:1:0","tags":["morse","morse-code"],"title":"Morse Code","uri":"/posts/morse-code/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"æ“ä½œç³»ç»Ÿæˆ–è€…è½¯ä»¶æ¢æºåŠ é€Ÿ ","date":"2023-11-07","objectID":"/posts/mirror-cn/:0:0","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"1ã€æ“ä½œç³»ç»Ÿ ","date":"2023-11-07","objectID":"/posts/mirror-cn/:1:0","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"rocky # 8 base sed -e 's|^mirrorlist=|#mirrorlist=|g' \\ -e 's|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.ustc.edu.cn/rocky|g' \\ -i.bak /etc/yum.repos.d/Rocky*.repo # 8 epel sed -e 's|^metalink=|#metalink=|g' \\ -e 's|^#baseurl=https\\?://download.fedoraproject.org/pub/epel/|baseurl=https://mirrors.ustc.edu.cn/epel/|g' \\ -e 's|^#baseurl=https\\?://download.example/pub/epel/|baseurl=https://mirrors.ustc.edu.cn/epel/|g' \\ -i.bak /etc/yum.repos.d/epel*.repo # 9 base sed -e 's|^mirrorlist=|#mirrorlist=|g' \\ -e 's|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.ustc.edu.cn/rocky|g' \\ -i.bak /etc/yum.repos.d/rocky*.repo # 9 epel sed -e 's|^metalink=|#metalink=|g' \\ -e 's|^#baseurl=https\\?://download.fedoraproject.org/pub/epel/|baseurl=https://mirrors.ustc.edu.cn/epel/|g' \\ -e 's|^#baseurl=https\\?://download.example/pub/epel/|baseurl=https://mirrors.ustc.edu.cn/epel/|g' \\ -i.bak /etc/yum.repos.d/epel*.repo ","date":"2023-11-07","objectID":"/posts/mirror-cn/:1:1","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"ubuntu # http sed -e \"s@http://.*archive.ubuntu.com@http://mirrors.aliyun.com@g\" \\ -e \"s@http://.*security.ubuntu.com@http://mirrors.aliyun.com@g\" \\ -i.bak -i /etc/apt/sources.list # https sed -e \"s@http://.*archive.ubuntu.com@https://mirrors.aliyun.com@g\" \\ -e \"s@http://.*security.ubuntu.com@https://mirrors.aliyun.com@g\" \\ -i.bak -i /etc/apt/sources.list ","date":"2023-11-07","objectID":"/posts/mirror-cn/:1:2","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"debian # debian 12åŠä»¥ä¸Š sed -i 's/\\w*.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list.d/debian.sources sed -i \"s@http://mirrors.ustc.edu.cn@https://mirrors.ustc.edu.cn@g\" /etc/apt/sources.list.d/debian.sources # debian 12ä»¥ä¸‹ sed -i 's/\\w*.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list sed -i \"s@http://mirrors.ustc.edu.cn@https://mirrors.ustc.edu.cn@g\" /etc/apt/sources.list ","date":"2023-11-07","objectID":"/posts/mirror-cn/:1:3","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"alpine # alpine å®˜æ–¹æº https://dl-cdn.alpinelinux.org/alpine/v3.18/main https://dl-cdn.alpinelinux.org/alpine/v3.18/community # ustc sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories # edge æº echo \"https://mirrors.ustc.edu.cn/alpine/edge/main\" \u003e\u003e /etc/apk/repositories echo \"https://mirrors.ustc.edu.cn/alpine/edge/community\" \u003e\u003e /etc/apk/repositories echo \"https://mirrors.ustc.edu.cn/alpine/edge/testing\" \u003e\u003e /etc/apk/repositories ","date":"2023-11-07","objectID":"/posts/mirror-cn/:1:4","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"2ã€å¼€å‘è¯­è¨€ç±» go export GOPROXY=https://goproxy.cn,direct # aliyun export GOPROXY=https://mirrors.aliyun.com/goproxy/ python export PIP_MIRROR=mirrors.aliyun.com echo -e \"[global]\\nindex-url=https://${PIP_MIRROR}/pypi/simple\\n[install]\\ntrusted-host=${PIP_MIRROR}\" \u003e /etc/pip.conf # å‘½ä»¤é…ç½® pip3 install xxx -i https://mirrors.aliyun.com/pypi/simple/ npm # è®¾ç½®å…¨å±€ npm config set registry https://registry.npmmirror.com # cmd npm install -y --registry=https://registry.npmmirror.com # å®˜æ–¹åœ°å€ https://registry.npmjs.org/ # é˜¿é‡Œäº‘åœ°å€ https://registry.npmmirror.com # è…¾è®¯ http://mirrors.cloud.tencent.com/npm/ # åä¸º https://repo.huaweicloud.com/repository/npm/ # å—äº¬å¤§å­¦ https://repo.nju.edu.cn/repository/npm/ ","date":"2023-11-07","objectID":"/posts/mirror-cn/:2:0","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"3ã€å®¹å™¨ä»£ç† é…ç½®æ¨¡ç‰ˆ { \"insecure-registries\": [ \"repo.local.com\" ], \"exec-opts\": [ \"native.cgroupdriver=systemd\" ], \"registry-mirrors\": [ \"https://docker.mirrors.sjtug.sjtu.edu.cn\", \"https://docker.nju.edu.cn\", \"http://hub-mirror.c.163.com\" ], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"100m\", \"max-file\": \"3\" }, \"bip\":\"192.161.20.1/24\", \"dns\": [ \"119.29.29.29\", \"223.5.5.5\" ], \"data-root\": \"/var/lib/docker\", \"features\": { \"buildkit\": true } } docker registry # ä¸Šæµ·äº¤å¤§ https://docker.mirrors.sjtug.sjtu.edu.cn # å—äº¬å¤§å­¦ https://docker.nju.edu.cn # dockerproxy https://dockerproxy.com gcr.io # ä¸Šæµ·äº¤å¤§ https://gcr-io.mirrors.sjtug.sjtu.edu.cn # å—äº¬å¤§å­¦ https://gcr.nju.edu.cn # dockerproxy https://gcr.dockerproxy.com ghcr.io # å—äº¬å¤§å­¦ https://htghcr.nju.edu.cn # dockerproxy https://ghcr.dockerproxy.com nvcr.io # å—äº¬å¤§å­¦ https://nvcr.nju.edu.cn quay.io # å—äº¬å¤§å­¦ https://quay.nju.edu.cn # dockerproxy quay.dockerproxy.com registry.k8s.io # å—äº¬å¤§å­¦ k8s.mirror.nju.edu.cn # dockerproxy k8s.dockerproxy.com Microsoft Artifact Registry mcr.dockerproxy.com ","date":"2023-11-07","objectID":"/posts/mirror-cn/:3:0","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"req Goè¯­è¨€äººæ€§åŒ–HTTPè¯·æ±‚åº“ ç‰¹æ€§ è½»é‡çº§ ç®€å• å®¹æ˜“æ“ä½œJSONå’ŒXML å®¹æ˜“è°ƒè¯•å’Œæ—¥å¿—è®°å½• å®¹æ˜“ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ å®¹æ˜“ç®¡ç†Cookie å®¹æ˜“è®¾ç½®ä»£ç† å®¹æ˜“è®¾ç½®è¶…æ—¶ å®¹æ˜“è‡ªå®šä¹‰HTTPå®¢æˆ·ç«¯ å®‰è£… go get github.com/serialt/req æ¦‚è¦ req åŸºäºæ ‡å‡†åº“ net/http å®ç°äº†ä¸€ä¸ªå‹å¥½çš„API. Req å’Œ Resp æ˜¯ä¸¤ä¸ªæœ€é‡è¦çš„ç»“æ„ä½“, ä½ å¯ä»¥æŠŠ Req çœ‹ä½œå®¢æˆ·ç«¯ï¼Œ æŠŠResp çœ‹ä½œå­˜æ”¾è¯·æ±‚åŠå…¶å“åº”çš„å®¹å™¨ï¼Œå®ƒä»¬éƒ½æä¾›è®¸å¤šç®€æ´æ–¹ä¾¿çš„APIï¼Œè®©ä½ å¯ä»¥å¾ˆè½»æ¾åšå¾ˆå¤šå¾ˆå¤šäº‹æƒ…ã€‚ func (r *Req) Post(url string, v ...interface{}) (*Resp, error) å¤§å¤šæƒ…å†µä¸‹ï¼Œå‘èµ·è¯·æ±‚åªæœ‰urlæ˜¯å¿…é€‰å‚æ•°ï¼Œå…¶å®ƒéƒ½å¯é€‰ï¼Œæ¯”å¦‚è¯·æ±‚å¤´ã€è¯·æ±‚å‚æ•°ã€æ–‡ä»¶æˆ–è¯·æ±‚ä½“ç­‰ã€‚ åŒ…ä¸­å«ä¸€ä¸ªé»˜è®¤çš„ Req å¯¹è±¡, å®ƒæ‰€æœ‰çš„å…¬æœ‰æ–¹æ³•éƒ½è¢«reqåŒ…å¯¹åº”çš„å…¬æœ‰æ–¹æ³•åŒ…è£…äº†ï¼Œæ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ç›´æ¥å¯ä»¥æŠŠreqåŒ…çœ‹ä½œä¸€ä¸ªReqå¯¹è±¡æ¥ä½¿ç”¨ã€‚ // åˆ›å»ºReqå¯¹è±¡æ¥å‘èµ·è¯·æ±‚ r := req.New() r.Get(url) // ç›´æ¥ä½¿ç”¨reqåŒ…å‘èµ·è¯·æ±‚ req.Get(url) ä½ å¯ä»¥ä½¿ç”¨ req.New() æ–¹æ³•æ¥åˆ›å»º *Req ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å®¢æˆ·ç«¯ ä¾‹å­ åŸºç¡€ç”¨æ³• è®¾ç½®è¯·æ±‚å¤´ è®¾ç½®è¯·æ±‚å‚æ•° è®¾ç½®è¯·æ±‚ä½“ è°ƒè¯• è¾“å‡ºæ ¼å¼ ToJSON \u0026 ToXML è·å– *http.Response ä¸Šä¼  ä¸‹è½½ Cookie è®¾ç½®è¶…æ—¶ è®¾ç½®ä»£ç† è‡ªå®šä¹‰ http.Client ","date":"2023-10-09","objectID":"/posts/req/:0:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"åŸºç¡€ç”¨æ³• header := req.Header{ \"Accept\": \"application/json\", \"Authorization\": \"Basic YWRtaW46YWRtaW4=\", } param := req.Param{ \"name\": \"imroc\", \"cmd\": \"add\", } // åªæœ‰urlå¿…é€‰ï¼Œå…¶å®ƒå‚æ•°éƒ½æ˜¯å¯é€‰ r, err = req.Post(\"http://foo.bar/api\", header, param) if err != nil { log.Fatal(err) } r.ToJSON(\u0026foo) // å“åº”ä½“è½¬æˆå¯¹è±¡ log.Printf(\"%+v\", r) // æ‰“å°è¯¦ç»†ä¿¡æ¯ ","date":"2023-10-09","objectID":"/posts/req/:1:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è®¾ç½®è¯·æ±‚å¤´ ä½¿ç”¨ req.Header (å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª map[string]string) authHeader := req.Header{ \"Accept\": \"application/json\", \"Authorization\": \"Basic YWRtaW46YWRtaW4=\", } req.Get(\"https://www.baidu.com\", authHeader, req.Header{\"User-Agent\": \"V1.1\"}) ä½¿ç”¨ http.Header header := make(http.Header) header.Set(\"Accept\", \"application/json\") req.Get(\"https://www.baidu.com\", header) ä½ å¯ä»¥ä½¿ç”¨ struct æ¥è®¾ç½®è¯·æ±‚å¤´ï¼Œç”¨ HeaderFromStruct è¿™ä¸ªå‡½æ•°æ¥è§£æä½ çš„ struct type HeaderStruct struct { UserAgent string `json:\"User-Agent\"` Authorization string `json:\"Authorization\"` } func main(){ h := HeaderStruct{ \"V1.0.0\", \"roc\", } authHeader := req.HeaderFromStruct(h) req.Get(\"https://www.baidu.com\", authHeader, req.Header{\"User-Agent\": \"V1.1\"}) } æ³¨ï¼šè¯·ç»™ä½ çš„ struct åŠ ä¸Š json tag. ","date":"2023-10-09","objectID":"/posts/req/:2:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è®¾ç½®è¯·æ±‚å‚æ•° Use req.Param (å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª map[string]interface{}) param := req.Param{ \"id\": \"imroc\", \"pwd\": \"roc\", } req.Get(\"http://foo.bar/api\", param) // http://foo.bar/api?id=imroc\u0026pwd=roc req.Post(url, param) // è¯·æ±‚ä½“ =\u003e id=imroc\u0026pwd=roc ä½¿ç”¨ req.QueryParam å¼ºåˆ¶å°†è¯·æ±‚å‚æ•°æ‹¼åœ¨urlåé¢ (å®ƒå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ª map[string]interface{}) req.Post(\"http://foo.bar/api\", req.Param{\"name\": \"roc\", \"age\": \"22\"}, req.QueryParam{\"access_token\": \"fedledGF9Hg9ehTU\"}) /* POST /api?access_token=fedledGF9Hg9ehTU HTTP/1.1 Host: foo.bar User-Agent: Go-http-client/1.1 Content-Length: 15 Content-Type: application/x-www-form-urlencoded;charset=UTF-8 Accept-Encoding: gzip age=22\u0026name=roc */ ","date":"2023-10-09","objectID":"/posts/req/:3:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è®¾ç½®è¯·æ±‚ä½“ Put string, []byte and io.Reader as body directly. req.Post(url, \"id=roc\u0026cmd=query\") å°†å¯¹è±¡ä½œä¸ºJSONæˆ–XMLè¯·æ±‚ä½“ï¼ˆè‡ªåŠ¨æ·»åŠ  Content-Type è¯·æ±‚å¤´ï¼‰ req.Post(url, req.BodyJSON(\u0026foo)) req.Post(url, req.BodyXML(\u0026bar)) ","date":"2023-10-09","objectID":"/posts/req/:4:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è°ƒè¯• å°†å…¨å±€å˜é‡ req.Debug è®¾ç½®ä¸ºtrueï¼Œå°†ä¼šæŠŠæ‰€æœ‰è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯æ‰“å°åœ¨æ ‡å‡†è¾“å‡ºã€‚ req.Debug = true req.Post(\"http://localhost/test\" \"hi\") ","date":"2023-10-09","objectID":"/posts/req/:5:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è¾“å‡ºæ ¼å¼ æ‚¨å¯ä»¥ä½¿ç”¨æŒ‡å®šç±»å‹çš„è¾“å‡ºæ ¼å¼åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•è¯·æ±‚å’Œå“åº”çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨å¼€å‘é˜¶æ®µä½¿ç”¨ï¼…+væ ¼å¼ï¼Œå¯ä»¥è®©ä½ è§‚å¯Ÿè¯·æ±‚å’Œå“åº”çš„ç»†èŠ‚ä¿¡æ¯ã€‚ åœ¨ç”Ÿäº§é˜¶æ®µä½¿ç”¨ï¼…væˆ–ï¼…-vè¾“å‡ºæ ¼å¼ï¼Œåªè®°å½•æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚ ","date":"2023-10-09","objectID":"/posts/req/:6:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"%+v æˆ– %+s è¯¦ç»†è¾“å‡º r, _ := req.Post(url, header, param) log.Printf(\"%+v\", r) // è¾“å‡ºæ ¼å¼å’ŒDebugå¼€å¯æ—¶çš„æ ¼å¼ä¸€æ · ","date":"2023-10-09","objectID":"/posts/req/:6:1","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"%v æˆ– %s ç®€å•è¾“å‡ºï¼ˆé»˜è®¤æ ¼å¼ï¼‰ r, _ := req.Get(url, param) log.Printf(\"%v\\n\", r) // GET http://foo.bar/api?name=roc\u0026cmd=add {\"code\":\"0\",\"msg\":\"success\"} log.Prinln(r) // å’Œä¸Šé¢ä¸€æ · ","date":"2023-10-09","objectID":"/posts/req/:6:2","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"%-v æˆ– %-s ç®€å•è¾“å‡ºå¹¶ä¿æŒæ‰€æœ‰å†…å®¹åœ¨ä¸€è¡Œå†…ï¼ˆè¯·æ±‚ä½“æˆ–å“åº”ä½“å¯èƒ½åŒ…å«å¤šè¡Œï¼Œè¿™ç§æ ¼å¼ä¼šå°†æ‰€æœ‰æ¢è¡Œã€å›è½¦æ›¿æ¢æˆ\" \", è¿™åœ¨ä¼šè®©ä½ åœ¨æŸ¥æ—¥å¿—çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼‰ ","date":"2023-10-09","objectID":"/posts/req/:6:3","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"Flag ä½ å¯ä»¥è°ƒç”¨ SetFlags æ§åˆ¶è¾“å‡ºå†…å®¹ï¼Œå†³å®šå“ªäº›éƒ¨åˆ†èƒ½å¤Ÿè¢«è¾“å‡ºã€‚ const ( LreqHead = 1 \u003c\u003c iota // è¾“å‡ºè¯·æ±‚é¦–éƒ¨ï¼ˆåŒ…å«è¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´ï¼‰ LreqBody // è¾“å‡ºè¯·æ±‚ä½“ LrespHead // è¾“å‡ºå“åº”é¦–éƒ¨ï¼ˆåŒ…å«å“åº”è¡Œå’Œå“åº”å¤´ï¼‰ LrespBody // è¾“å‡ºå“åº”ä½“ Lcost // è¾“å‡ºè¯·æ±‚æ‰€æ¶ˆè€—æ‰æ—¶é•¿ LstdFlags = LreqHead | LreqBody | LrespHead | LrespBody ) req.SetFlags(req.LreqHead | req.LreqBody | req.LrespHead) ","date":"2023-10-09","objectID":"/posts/req/:6:4","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"ç›‘æ§è¯·æ±‚è€—æ—¶ req.SetFlags(req.LstdFlags | req.Lcost) // è¾“å‡ºæ ¼å¼æ˜¾ç¤ºè¯·æ±‚è€—æ—¶ r,_ := req.Get(url) log.Println(r) // http://foo.bar/api 3.260802ms {\"code\":0 \"msg\":\"success\"} if r.Cost() \u003e 3 * time.Second { // æ£€æŸ¥è€—æ—¶ log.Println(\"WARN: slow request:\", r) } ","date":"2023-10-09","objectID":"/posts/req/:6:5","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"ToJSON \u0026 ToXML r, _ := req.Get(url) r.ToJSON(\u0026foo) r, _ = req.Post(url, req.BodyXML(\u0026bar)) r.ToXML(\u0026baz) ","date":"2023-10-09","objectID":"/posts/req/:7:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è·å– *http.Response // func (r *Req) Response() *http.Response r, _ := req.Get(url) resp := r.Response() fmt.Println(resp.StatusCode) ","date":"2023-10-09","objectID":"/posts/req/:8:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"ä¸Šä¼  ä½¿ç”¨ req.File åŒ¹é…æ–‡ä»¶ req.Post(url, req.File(\"imroc.png\"), req.File(\"/Users/roc/Pictures/*.png\")) ä½¿ç”¨ req.FileUpload ç»†ç²’åº¦æ§åˆ¶ä¸Šä¼  file, _ := os.Open(\"imroc.png\") req.Post(url, req.FileUpload{ File: file, FieldName: \"file\", // FieldName æ˜¯è¡¨å•å­—æ®µå FileName: \"avatar.png\", // Filename æ˜¯è¦ä¸Šä¼ çš„æ–‡ä»¶çš„åç§°ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥çŒœæµ‹mimetypeï¼Œå¹¶å°†å…¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Š }) ä½¿ç”¨req.UploadProgressç›‘å¬ä¸Šä¼ è¿›åº¦ progress := func(current, total int64) { fmt.Println(float32(current)/float32(total)*100, \"%\") } req.Post(url, req.File(\"/Users/roc/Pictures/*.png\"), req.UploadProgress(progress)) fmt.Println(\"upload complete\") ","date":"2023-10-09","objectID":"/posts/req/:9:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"ä¸‹è½½ r, _ := req.Get(url) r.ToFile(\"imroc.png\") ä½¿ç”¨req.DownloadProgressç›‘å¬ä¸‹è½½è¿›åº¦ progress := func(current, total int64) { fmt.Println(float32(current)/float32(total)*100, \"%\") } r, _ := req.Get(url, req.DownloadProgress(progress)) r.ToFile(\"hello.mp4\") fmt.Println(\"download complete\") ","date":"2023-10-09","objectID":"/posts/req/:10:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"Cookie é»˜è®¤æƒ…å†µä¸‹ï¼Œåº•å±‚çš„ *http.Client ä¼šè‡ªåŠ¨ç®¡ç†ä½ çš„cookieï¼ˆå¦‚æœæœåŠ¡å™¨ç»™ä½ å‘äº†cookieï¼Œä¹‹åçš„è¯·æ±‚å®ƒä¼šè‡ªåŠ¨å¸¦ä¸Šcookieè¯·æ±‚å¤´ç»™æœåŠ¡å™¨ï¼‰, ä½ å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•å–æ¶ˆè‡ªåŠ¨ç®¡ç†ï¼š req.EnableCookie(false) ä½ è¿˜å¯ä»¥åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™è‡ªå·±ä¼ å…¥ *http.Cookie cookie := new(http.Cookie) // ...... req.Get(url, cookie) ","date":"2023-10-09","objectID":"/posts/req/:11:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è®¾ç½®è¶…æ—¶ req.SetTimeout(50 * time.Second) ","date":"2023-10-09","objectID":"/posts/req/:12:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è®¾ç½®ä»£ç† é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœç³»ç»Ÿç¯å¢ƒå˜é‡æœ‰ http_proxy æˆ– https_proxy ï¼Œreqä¼šè®²å¯¹åº”çš„åœ°å€ä½œä¸ºå¯¹åº”åè®®çš„ä»£ç†ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è®¾ç½®ä»£ç†ï¼Œæˆ–è€…å°†å…¶ç½®ä¸ºnilï¼Œå³å–æ¶ˆä»£ç†ã€‚ req.SetProxy(func(r *http.Request) (*url.URL, error) { if strings.Contains(r.URL.Hostname(), \"google\") { return url.Parse(\"http://my.vpn.com:23456\") } return nil, nil }) è®¾ç½®ç®€å•ä»£ç†ï¼ˆå°†æ‰€æœ‰è¯·æ±‚éƒ½è½¬å‘åˆ°æŒ‡å®šä»£ç†urlåœ°å€ä¸Šï¼‰ req.SetProxyUrl(\"http://my.proxy.com:23456\") ","date":"2023-10-09","objectID":"/posts/req/:13:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è‡ªå®šä¹‰HTTPå®¢æˆ·ç«¯ ä½¿ç”¨ SetClient æ”¹å˜åº•å±‚çš„ *http.Client req.SetClient(client) ç»™æŸä¸ªè¯·æ±‚åˆ¶å®šç‰¹å®šçš„ *http.Client client := \u0026http.Client{Timeout: 30 * time.Second} req.Get(url, client) æ”¹å˜åº•å±‚ *http.Client çš„æŸäº›å±æ€§ req.Client().Jar, _ = cookiejar.New(nil) trans, _ := req.Client().Transport.(*http.Transport) trans.MaxIdleConns = 20 trans.TLSHandshakeTimeout = 20 * time.Second trans.DisableKeepAlives = true trans.TLSClientConfig = \u0026tls.Config{InsecureSkipVerify: true} ","date":"2023-10-09","objectID":"/posts/req/:14:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go åŸç”Ÿhttpåº“ Goè¯­è¨€å†…ç½®çš„net/httpåŒ…ååˆ†çš„ä¼˜ç§€ï¼Œæä¾›äº†HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å®ç°ã€‚ ","date":"2023-10-09","objectID":"/posts/go-http/:0:0","tags":["Go","http"],"title":"Go Http","uri":"/posts/go-http/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ä¸€ã€net/httpä»‹ç» Goè¯­è¨€å†…ç½®çš„net/httpåŒ…æä¾›äº†HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å®ç°ã€‚ HTTPåè®® è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼ŒHyperText Transfer Protocol)æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œä¼ è¾“åè®®ï¼Œæ‰€æœ‰çš„WWWæ–‡ä»¶éƒ½å¿…é¡»éµå®ˆè¿™ä¸ªæ ‡å‡†ã€‚è®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚ ","date":"2023-10-09","objectID":"/posts/go-http/:1:0","tags":["Go","http"],"title":"Go Http","uri":"/posts/go-http/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"äºŒã€HTTPå®¢æˆ·ç«¯ Getã€Headã€Postå’ŒPostFormå‡½æ•°å‘å‡ºHTTP/HTTPSè¯·æ±‚ã€‚ resp, err := http.Get(\"http://example.com/\") ... resp, err := http.Post(\"http://example.com/upload\", \"image/jpeg\", \u0026buf) ... resp, err := http.PostForm(\"http://example.com/form\", url.Values{\"key\": {\"Value\"}, \"id\": {\"123\"}}) ç¨‹åºåœ¨ä½¿ç”¨å®Œresponseåå¿…é¡»å…³é—­å›å¤çš„ä¸»ä½“ã€‚ resp, err := http.Get(\"http://example.com/\") if err != nil { // handle error } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) // ... ","date":"2023-10-09","objectID":"/posts/go-http/:2:0","tags":["Go","http"],"title":"Go Http","uri":"/posts/go-http/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"GETè¯·æ±‚ç¤ºä¾‹ package main import ( \"fmt\" \"io\" \"net/http\" ) func main() { resp, err := http.Get(\"https://httpbin.org/uuid\") if err != nil { fmt.Printf(\"get failed, err:%v\\n\", err) return } defer resp.Body.Close() body, err := io.ReadAll(resp.Body) if err != nil { fmt.Printf(\"read from resp.Body failed, err:%v\\n\", err) return } fmt.Print(string(body)) } è‡ªå®šä¹‰è¯·æ±‚ package main import ( \"encoding/json\" \"fmt\" \"io\" \"net/http\" \"net/url\" ) type UUID struct { Uuid string `json:\"uuid\"` } func main() { apiURL := \"https://httpbin.org/uuid\" query := url.Values{} query.Add(\"q\", \"golang\") query.Add(\"page\", \"1\") ApiURL, _ := url.ParseRequestURI(apiURL) ApiURL.RawQuery = query.Encode() req, _ := http.NewRequest(\"GET\", ApiURL.String(), nil) req.Header.Add(\"Accept\", \"*/*\") client := \u0026http.Client{} resp, err := client.Do(req) if err != nil { return } defer resp.Body.Close() var uuid UUID body, err := io.ReadAll(resp.Body) if err != nil { fmt.Printf(\"read from resp.Body failed, err:%v\\n\", err) return } json.Unmarshal(body, \u0026uuid) fmt.Println(uuid.Uuid) } ","date":"2023-10-09","objectID":"/posts/go-http/:2:1","tags":["Go","http"],"title":"Go Http","uri":"/posts/go-http/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"POST è¯·æ±‚ç¤ºä¾‹ package main import ( \"encoding/json\" \"io\" \"net/http\" \"net/url\" ) type dockerToken struct { Token string `json:\"token\"` } func main() { apiUrl := \"https://hub.docker.com/v2/users/login\" data := url.Values{} data.Set(\"username\", \"username\") data.Set(\"password\", \"password\") resp, err := http.PostForm(apiUrl, data) if err != nil { return } defer resp.Body.Close() _data, _ := io.ReadAll(resp.Body) var tmpT dockerToken json.Unmarshal(_data, \u0026tmpT) } package main import ( \"bytes\" \"io\" \"net/http\" \"net/url\" \"strings\" \"log/slog\" ) func POST1() { apiURL := \"https://httpbin.org/post\" form := url.Values{} form.Add(\"ln\", \"ln222\") form.Add(\"ip\", \"1.1.1.1\") form.Add(\"ua\", \"ua123\") client := \u0026http.Client{} req, _ := http.NewRequest(\"POST\", apiURL, strings.NewReader(form.Encode())) req.Header.Set(\"User-Agent\", \"test\") req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\") // å‘é€è¯·æ±‚ resp, err := client.Do(req) if err != nil { slog.Error(\"POST request failed\", \"err\", err) return } defer resp.Body.Close() // è¯»å–å†…å®¹ body, err := io.ReadAll(resp.Body) if err != nil { slog.Error(\"POST request\", \"err\", err) } else { slog.Info(string(body)) } } func POSTJson() { apiURL := \"https://httpbin.org/post\" var jsonStr = []byte(`{\"title\":\"this is a title\", \"cate\": 1}`) client := \u0026http.Client{} req, _ := http.NewRequest(\"POST\", apiURL, bytes.NewBuffer(jsonStr)) req.Header.Set(\"User-Agent\", \"test\") req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\") // å‘é€è¯·æ±‚ resp, err := client.Do(req) if err != nil { slog.Error(\"POST request failed\", \"err\", err) return } defer resp.Body.Close() // è¯»å–å†…å®¹ body, err := io.ReadAll(resp.Body) if err != nil { slog.Error(\"POST request\", \"err\", err) } else { slog.Info(string(body)) } } func main() { // POST1() POSTJson() } ","date":"2023-10-09","objectID":"/posts/go-http/:2:2","tags":["Go","http"],"title":"Go Http","uri":"/posts/go-http/"},{"categories":["Kubernetes"],"content":"Dev in kubernetes â€‹ ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼ä¸­ï¼Œæ˜¯ä»£ç å­˜æ”¾åœ¨æœ¬åœ°ï¼Œä½¿ç”¨ IDE è¿›è¡Œç¼–è¾‘å’Œ debug ã€‚ä½†éšç€å®¹å™¨åŒ–ç«äº†ä¹‹åï¼Œå¾ˆå¤šå•ä¸€æœåŠ¡éƒ½è¿›è¡Œäº†æ‹†åˆ†ï¼Œå¾®æœåŠ¡åŒ–ã€‚åœ¨å¼€å‘é˜¶æ®µï¼Œéœ€è¦æœ¬åœ°åŒæ—¶å¯åŠ¨å¤šä¸ªæœåŠ¡ï¼Œè¿™ä½¿å¾—æœ¬åœ°å¼€å‘è°ƒè¯•å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚Okteto æ˜¯ä¸€ä¸ªé€šè¿‡åœ¨ Kubernetes ä¸­æ¥å¼€å‘å’Œæµ‹è¯•ä»£ç çš„åº”ç”¨ç¨‹åºå¼€å‘å·¥å…·ã€‚å¯ä»¥é€šè¿‡ Okteto åœ¨ Kubernetes ä¸­ä¸€é”®ä¸ºæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå¼€å‘ç¯å¢ƒï¼Œéå¸¸ç®€å•æ–¹ä¾¿ã€‚Google æ¨å‡ºçš„ Skaffold åªæ˜¯æŠŠ CICD é›†æˆåˆ°æœ¬åœ°ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒå›°éš¾ã€‚Okteto çš„å·¥ä½œåŸç†æ˜¯åœ¨ kubernetes ä¸­å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼ŒæŠŠæœ¬åœ°ä»£ç åŒæ­¥åˆ° pod ä¸­ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤è®©æœåŠ¡è¿è¡Œèµ·æ¥ï¼ŒOkteto å¯ä»¥è¿›è¡Œç«¯å£çš„è½¬å‘ï¼Œè½¬å‘podé‡ŒæœåŠ¡çš„ç«¯å£åˆ°æœ¬åœ°ï¼Œåœ¨è¿›è¡Œ debug çš„æ—¶å€™ï¼Œpodé‡Œå¯åŠ¨çš„ç«¯å£å¯ä»¥è¢« kubernetes å†…çš„å…¶ä»–æœåŠ¡æ‰€è®¿é—®ï¼Œæœ¬åœ°è½¬å‘çš„ç«¯å£å¯ä»¥è¢«æœ¬åœ°çš„å·¥å…·ï¼ˆä¾‹å¦‚ postman ï¼‰è®¿é—®ã€‚ oktetoå®˜ç½‘æ–‡æ¡£ï¼šhttps://www.okteto.com/docs Go é…ç½®æ–‡æ¡£ï¼šhttps://www.okteto.com/docs/samples/golang/ ç¤ºä¾‹ç¯å¢ƒï¼š vscode 1.82.1(éœ€è¦å®‰è£… Remote - Kubernetes æ’ä»¶ï¼Œæ’ä»¶codeï¼šokteto.remote-kubernetes) k3d mac ","date":"2023-09-26","objectID":"/posts/okteto/:0:0","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"å®‰è£…ä¸é…ç½® ä¸‹è½½oktetoï¼šhttps://github.com/okteto/okteto/releases [crab@Sugar ~]ğŸ³ wget https://ghproxy.com/https://github.com/okteto/okteto/releases/download/2.20.0/okteto-Darwin-arm64 [crab@Sugar ~]ğŸ³ chmod +x okteto-Darwin-arm64 [crab@Sugar ~]ğŸ³ sudo mv okteto-Darwin-arm64 /usr/local/bin/okteto ","date":"2023-09-26","objectID":"/posts/okteto/:1:0","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"ä¸‹è½½ç¤ºä¾‹ä»£ç  [crab@Sugar ~]ğŸ³ git clone https://github.com/okteto/go-getting-started go-okteto [crab@Sugar ~]ğŸ³ cd go-okteto ","date":"2023-09-26","objectID":"/posts/okteto/:1:1","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"é…ç½®port-forwardç«¯å£ éœ€è¦è½¬å‘ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æœåŠ¡çš„ç«¯å£ï¼Œå¦ä¸€ä¸ªæ˜¯debugä½¿ç”¨çš„ç«¯å£ okteto.yaml build: hello-world: image: serialt/go-hello-world:1.0.0 context: . deploy: - kubectl apply -f k8s.yml dev: hello-world: # è¢«æ›¿æ¢çš„æœåŠ¡å image: okteto/golang:1 command: bash sync: - .:/usr/src/app volumes: - /go - /root/.cache securityContext: capabilities: add: - SYS_PTRACE forward: - 2345:2345 - 8080:8080 # \u003c---- å¢åŠ 8080æœåŠ¡ç«¯å£è½¬å‘ è®¾ç½®okteto contextï¼Œokteto é»˜è®¤ä¼šä¼˜å…ˆä½¿ç”¨KUBECONFIGç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨ ~/.kube/configæ–‡ä»¶ [crab@Sugar go-okteto]ğŸ³ okteto context âœ“ Context 'k3d-mycluster' selected âœ“ Using dev @ k3d-mycluster ","date":"2023-09-26","objectID":"/posts/okteto/:1:2","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"å¯åŠ¨æœåŠ¡ [crab@Sugar go-okteto]ğŸ³ okteto up i Using dev @ k3d-mycluster as context i 'go-getting-started' was already deployed. To redeploy run 'okteto deploy' or 'okteto up --deploy' i Images were already built. To rebuild your images run 'okteto build' or 'okteto deploy --build' âœ“ Images successfully pulled âœ“ Files synchronized Context: k3d-mycluster Namespace: dev Name: hello-world Forward: 2345 -\u003e 2345 8080 -\u003e 8080 Welcome to your development container. Happy coding! dev:hello-world app\u003e dev:hello-world app\u003e ls Dockerfile LICENSE Makefile README.md bashrc go.mod k8s.yml main.go okteto.yml ","date":"2023-09-26","objectID":"/posts/okteto/:1:3","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"è¿œç¨‹å¼€å‘ # oktetoç»ˆç«¯ dev:hello-world app\u003e go run main.go Starting hello-world server... # ç»ˆç«¯æµ‹è¯• [crab@Sugar ~]ğŸ³ curl 127.0.0.1:8080 Hello world! ","date":"2023-09-26","objectID":"/posts/okteto/:1:4","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"è¿œç¨‹è°ƒè¯• # oktetoç»ˆç«¯, æ‰§è¡Œdlvå‘½ä»¤ dev:hello-world app\u003e dlv debug --headless --listen=:2345 --log --api-version=2 API server listening at: [::]:2345 2023-09-26T13:40:51Z warning layer=rpc Listening for remote connections (connections are not authenticated nor encrypted) 2023-09-26T13:40:51Z info layer=debugger launching process with args: [./__debug_bin3213431902] 2023-09-26T13:40:51Z debug layer=debugger Adding target 575 \"/usr/src/app/__debug_bin3213431902\" # main.go æ‰“ä¸Šdebugæ ‡è®° func helloServer(w http.ResponseWriter, r *http.Request) { fmt.Fprint(w, \"Hello world from Okteto!, k3d is great! \") fmt.Println(\"okteto ccccccc\") # æ ‡è®°æ­¤è¡Œ } åœ¨vscode debugä¸­ç‚¹å‡»å¼€å§‹debug ä½¿ç”¨å‘½ä»¤è¯·æ±‚ http://127.0.0.1:8080ï¼Œå³å¯debugåˆ°æ ‡è®°ç‚¹ [sugar@Sugar go-okteto]ğŸ³ curl http://127.0.0.1:8080 Hello world from Okteto!, k3d is great! ","date":"2023-09-26","objectID":"/posts/okteto/:1:5","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["vscode"],"content":"Debug shell 1ã€å®‰è£…æ’ä»¶ å®‰è£…bashdbæ’ä»¶ rogalmic.bash-debug 2ã€å¢åŠ ä¸€ä¸ªvscode launch.jsoné…ç½®æ–‡ä»¶ Select Debug -\u003e Add Configuration to add custom debug configuration ç¤ºä¾‹ï¼š { \"configurations\": [ { \"type\": \"bashdb\", \"request\": \"launch\", \"name\": \"Bash-Debug\", \"cwd\": \"${workspaceFolder}\", \"program\": \"${workspaceFolder}/ccc.sh\", \"args\": [] }, ] } å°±å¯ä»¥åƒdebugå…¶ä»–è¯­è¨€ä¸€æ ·è¿›è¡Œè°ƒè¯•shellè„šæœ¬ ","date":"2023-09-24","objectID":"/posts/debug-shell-in-vscode/:0:0","tags":["shell"],"title":"Debug Shell in VSCode","uri":"/posts/debug-shell-in-vscode/"},{"categories":["mirror-web"],"content":"æ¸…åé•œåƒç½‘é¡µæ­å»ºé•œåƒç«™ tuna mirror-webåœ°å€ï¼šhttps://github.com/tuna/mirror-web.git tuna mirror-webåŸºäºjekyllå¼€å‘ï¼Œç”±äºrubyç¯å¢ƒå®‰è£…å¤æ‚ï¼Œå› æ­¤é‡‡ç”¨dockerç¼–è¯‘ï¼Œä½†åœ¨buildé•œåƒçš„æ—¶å€™ï¼Œå‡ºç°å®‰è£…åŒ…ä¾èµ–å®‰è£…å¤±è´¥ï¼Œåœ¨å¤šæ¬¡æµ‹è¯•åï¼Œæ— æ³•buildæˆé•œåƒã€‚å‰æ®µæ—¶é—´ï¼Œåœ¨æŸ¥çœ‹mirror-webæ®µissuesæ—¶ï¼Œæœ‰äººè¯¢é—®mirror-webæ®µREADME.mdæ–‡æ¡£çš„ä¸‹ä¸€æ­¥ï¼Œå®˜æ–¹ç»™äº†ä¸€ç‚¹æç¤ºï¼Œæœ‰å…³äºåŸºäºnginxçš„ç¬¬ä¸‰æ–¹æ¨¡å—æ¥å®ç°ç›®å½•ç¬¬æ¸²æŸ“çš„æç¤ºè¯´æ˜ï¼Œå†æ¬¡å°è¯•åï¼Œç»å†å„ç§å›°éš¾å’ŒæŠ˜ç£¨ï¼Œç»ˆäºæ‘¸ç´¢å‡ºã€‚ ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:0","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"1ã€ä¸‹è½½mirror-webçš„jekyllç¼–è¯‘ç¯å¢ƒ tunaçš„ç¼–è¯‘é•œåƒï¼štunathu/mirror-web åœ¨ä¸‹è½½tunathu/mirror-webæ—¶å‘ç”Ÿäº†ä¸€ä¸ªå°é—®é¢˜ï¼Œç”±äºåœ¨å›½å†…ä½¿ç”¨çš„dockeré•œåƒåŠ é€Ÿï¼Œä¸‹è½½çš„é•œåƒæ˜¯æ—§ç‰ˆæœ¬çš„ï¼Œä½†å¢ƒå¤–çš„æœåŠ¡å™¨ä¸‹è½½çš„é•œåƒæ˜¯æœ€æ–°çš„ï¼Œåœ¨è¸©å‘åæœæ–­æ¨åˆ°è‡ªå·±çš„dockerhubä¸Šï¼Œæ–°çš„ä¸‹è½½åœ°å€ï¼šserialt/tuna-mirror-webã€‚ ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:1","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"2ã€ä¸‹è½½githubä»“åº“ git clone https://github.com/tuna/mirror-web.git /opt/mirror-web ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:2","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"3ã€ä¸‹è½½é¢å¤–èµ„æºå’Œç¼–è¯‘ cd /opt/mirror-web wget https://mirrors.tuna.tsinghua.edu.cn/static/tunasync.json -O static/tunasync.json wget https://mirrors.tuna.tsinghua.edu.cn/static/tunet.json -O static/tunet.json mkdir -p static/status wget https://mirrors.tuna.tsinghua.edu.cn/static/status/isoinfo.json -O static/status/isoinfo.json docker run -it -v /opt/mirror-web/:/data serialt/tuna-mirror-web:20211006 ç¼–è¯‘çš„åé™æ€æ–‡ä»¶åœ¨_siteé‡Œ ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:3","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"4ã€ç¼–è¯‘nginx éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å— modules/ngx_http_js_module.so modules/ngx_http_fancyindex_module.so [root@serialt nginx]# ll æ€»ç”¨é‡ 1068 drwxr-xr-x 9 sonar sonar 186 10æœˆ 5 22:27 nginx-1.20.1 -rw-r--r-- 1 root root 1061461 5æœˆ 25 23:34 nginx-1.20.1.tar.gz drwxrwxr-x 3 root root 217 10æœˆ 27 2020 ngx-fancyindex-0.5.1 -rw-r--r-- 1 root root 25148 10æœˆ 27 2020 ngx-fancyindex-0.5.1.tar.xz drwxr-xr-x 10 root root 228 10æœˆ 6 15:49 njs # njsä¸‹è½½ git clone https://github.com/nginx/njs # ngx-fancyindex ä¸‹è½½ wget https://github.com/aperezdc/ngx-fancyindex/releases/download/v0.5.1/ngx-fancyindex-0.5.1.tar.xz ç¼–è¯‘ï¼š [root@serialt nginx]# ls nginx-1.20.1 nginx-1.20.1.tar.gz ngx-fancyindex-0.5.1 ngx-fancyindex-0.5.1.tar.xz njs [root@serialt nginx]# cd nginx-1.20.1/ [root@serialt nginx-1.20.1]# ./configure --prefix=/usr/local/nginx --with-pcre --with-http_auth_request_module --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-mail --with-mail_ssl_module --with-stream --with-stream_ssl_module --with-stream_realip_module --add-dynamic-module=/root/nginx/ngx-fancyindex-0.5.1 --add-dynamic-module=/root/nginx/njs/nginx # add m 3997 [2022-02-25 00:49:21] [root] [10.5.0.10] ./configure --with-compat --add-dynamic-module=/root/github/tuna-mirror-web/njs-0.6.2/nginx 3998 [2022-02-25 00:49:31] [root] [10.5.0.10] make modules nginxé…ç½®æ–‡ä»¶å†…å®¹ [root@serialt mirrors]# cat /usr/local/nginx/conf/nginx.conf #user nobody; worker_processes 1; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; load_module modules/ngx_http_js_module.so; load_module modules/ngx_http_fancyindex_module.so; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; map $http_user_agent $isbrowser { default 0; \"~*validation server\" 0; \"~*mozilla\" 1; } js_path /opt/mirror-web/_site/static/njs; js_include /opt/mirror-web/_site/static/njs/all.njs; #js_path /opt/mirror-web/static/njs; #js_include /opt/mirror-web/static/njs/all.njs; server { listen 8007; server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; #root /opt/mirror-web/_site; fancyindex_header /fancy-index/before; fancyindex_footer /fancy-index/after; fancyindex_exact_size off; fancyindex_time_format \"%d %b %Y %H:%M:%S +0000\"; fancyindex_name_length 256; error_page 404 /404.html; location /fancy-index { internal; root /opt/mirror-web/_site; subrequest_output_buffer_size 100k; location = /fancy-index/before { js_content fancyIndexBeforeRender; } location = /fancy-index/after { js_content fancyIndexAfterRender; } } location / { root /opt/mirror-web/_site; index index.html index.htm; #try_files /_site/$uri $uri/ /_site/$uri; fancyindex on; } # location / { # root html; # index index.html index.htm; # } #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } } [root@serialt mirrors]# ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:4","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"5ã€é•œåƒèµ„æºæš´éœ² æ–¹æ³•1ï¼šä»¥è½¯é“¾æ¥å½¢å¼å­˜æ”¾åœ¨/opt/mirror-web/_siteä¸­ [root@serialt _site]# pwd /opt/mirror-web/_site [root@serialt _site]# ll æ€»ç”¨é‡ 160 -rw-r--r-- 1 root root 16415 10æœˆ 6 15:37 404.html drwxr-xr-x 2 root root 6 10æœˆ 6 17:14 cc drwxr-xr-x 2 root root 19 10æœˆ 6 17:14 centos drwxr-xr-x 2 root root 94 10æœˆ 6 09:25 fancy-index -rw-r--r-- 1 root root 36650 10æœˆ 6 15:37 feed.xml drwxr-xr-x 103 root root 4096 10æœˆ 6 09:25 help -rw-r--r-- 1 root root 27679 10æœˆ 6 15:37 index.html -rw-r--r-- 1 root root 20728 10æœˆ 6 15:37 legacy_index.html -rw-r--r-- 1 root root 18092 10æœˆ 6 15:37 LICENSE drwxr-xr-x 47 root root 4096 10æœˆ 6 09:25 news -rw-r--r-- 1 root root 58 10æœˆ 6 15:37 robots.txt -rw-r--r-- 1 root root 19134 10æœˆ 6 15:37 sitemap.xml drwxr-xr-x 8 root root 115 10æœˆ 6 15:37 static drwxr-xr-x 2 root root 24 10æœˆ 6 09:25 status æ–¹æ³•äºŒï¼šæŠŠ/opt/mirror-web/_siteé‡Œçš„æ–‡ä»¶ä»¥è½¯é“¾æ¥çš„æ–¹å¼é“¾æ¥åˆ°é•œåƒçš„è·Ÿç›®å½•ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰ ln -snf /opt/mirror-web/_site/* /opt/imau ç›®å½•æè¿°æ–‡ä»¶ï¼š_data/options.yml ç«™ç‚¹èµ„æºæ˜¾ç¤ºæ§åˆ¶ï¼šstatic/tunasync.json tunasync.json [ { \"name\": \"ant\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"book\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"centos\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"dev\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"frp\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"git\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"go\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"grafana\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"iso\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"jdk\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"jmeter\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"kubernetes\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"mac\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"monitor\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"node\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"root-ca\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"other\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"printer\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"prometheus\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"pycharm\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"python\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"repo\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"script\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"test\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"tool\", \"is_master\": true, \"status\": \"success\" } ] \"last_update\": \"2022-01-11 16:39:37 +0800\", \"last_update_ts\": 1641890377, \"last_started\": \"2022-01-11 16:39:21 +0800\", \"last_started_ts\": 1641890361, \"last_ended\": \"2022-01-11 16:39:37 +0800\", \"last_ended_ts\": 1641890377, \"next_schedule\": \"2022-01-11 22:39:37 +0800\", \"next_schedule_ts\": 1641911977, \"upstream\": \"rsync://msync.centos.org/CentOS/\", - status: 'success' last_update: '-' name: \"AUR\" url: 'https://aur.tuna.tsinghua.edu.cn/' upstream: 'https://aur.archlinux.org/' is_master: true options.yml # Content Related mirror_desc: - name: git desc: git äºŒè¿›åˆ¶ç¼–è¯‘ç‰ˆæœ¬ - name: go desc: golang å¼€å‘ç¯å¢ƒ - name: grafana desc: grafana çš„å®‰è£…åŒ… - name: helm desc: helm çš„äºŒè¿›åˆ¶å‘è¡ŒåŒ… - name: ios desc: é•œåƒæ–‡ä»¶ï¼Œå¦‚centos, ubuntu, rockyç­‰ - name: jdk desc: java å¼€å‘ç¯å¢ƒå®‰è£…åŒ… new_mirrors: - hugging-face-models - endeavouros - ubuntukylin - putty - postmarketOS - postmarketOS-images - obs-studio - stellarium unlisted_mirrors: - status: 'success' last_update: '-' name: \"AUR\" url: 'https://aur.tuna.tsinghua.edu.cn/' upstream: 'https://aur.archlinux.org/' is_master: true - link_to: 'osdn' name: \"manjaro-cd\" url: '/osdn/storage/g/m/ma/manjaro/' - link_to: 'osdn' name: \"manjaro-arm-cd\" url: '/osdn/storage/g/m/ma/manjaro-arm/' - link_to: 'osdn' name: \"mxlinux-isos\" url: '/osdn/storage/g/m/mx/mx-linux/ISOs/' - link_to: 'osdn' name: \"garuda-linux\" url: '/osdn/storage/g/g/ga/garuda-linux/' - link_to: 'osdn' name: \"linuxlite-cd\" url: '/osdn/storage/g/l/li/linuxlite/' - link_to: 'github-release' name: \"prometheus\" url: '/github-rele","date":"2023-09-24","objectID":"/posts/tuna-web/:1:5","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"6ã€dockeré•œåƒä½¿ç”¨ é™æ€æ–‡ä»¶ç¼–è¯‘ æ„å»º Jekyll çš„ docker é•œåƒç¯å¢ƒå¤æ‚ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨å®˜æ–¹æˆ–è€…å·²ç»å­˜åœ¨çš„é•œåƒtunathu/mirror-webæˆ–è€…serialt/tuna-mirror-web [root@tc ~]# docker run -it -v /path/to/mirror-web/:/data serialt/tuna-mirror-web ä¸€äº›åŠ¨æ€æ•°æ®å·²ç»ä¸‹è½½ï¼Œè‹¥éœ€è¦æœ€æ–°çš„ï¼Œå¯ä»¥å°±è¡Œä»¥ä¸‹æ“ä½œ,ç„¶ååœ¨æ„å»º ä¸‹è½½æœ€æ–°çš„åŠ¨æ€æ•°æ®æ–‡ä»¶ wget https://mirrors.tuna.tsinghua.edu.cn/static/tunasync.json -O static/tunasync.json wget https://mirrors.tuna.tsinghua.edu.cn/static/tunet.json -O static/tunet.json mkdir -p static/status wget https://mirrors.tuna.tsinghua.edu.cn/static/status/isoinfo.json -O static/status/isoinfo.json è¿è¡ŒæœåŠ¡ dockeré•œåƒç½‘é¡µæ ¹ç›®å½•: /opt/mirror-web é•œåƒç«™èµ„æºæ ¹ç›®å½•: /opt/mirror å¯åŠ¨æœåŠ¡ docker run -tid -v /opt/tuna-mirror-web/_site:/opt/mirror-web -v /opt/mirror:/opt/mirror -p 8099:80 --name=tuna-mirror-nginx serialt/tuna-mirror-web-nginx:7b0c89d version: \"3\" networks: tuna-mirror-nginx: external: false services: tuna-mirror-nginx: image: serialt/tuna-mirror-web-nginx:latest container_name: mirror-nginx hostname: mirror-nginx restart: always networks: - tuna-mirror-nginx volumes: - \"/etc/localtime:/etc/localtime:ro\" - \"/opt/mirror-web/_site:/opt/mirror-web\" - \"/opt/mirror:/opt/mirror\" ports: - \"80:80\" dns: - 223.5.5.5 - 223.6.6.6 ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:6","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"æ–°é•œåƒç«™ç‰ˆæœ¬å‘å¸ƒ docker run -it --rm -v /opt/tuna-mirror-web:/data serialt/tuna-mirror-web docker restart tuna-mirror-nginx ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:7","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"ç¼–å†™è¯´æ˜ _data/options.yml: æ˜¯æ˜¾ç¤ºåœ¨é•œåƒç«™ä¸»é¡µå¯¹å„ä¸ªç›®å½•çš„è¯´æ˜ static/tunasync.json: æ˜¯å¯¹å½“å‰repoçš„åŒæ­¥ä¿¡æ¯çš„æè¿°ï¼Œå¯ä»¥è‡ªè¡Œç¼–è¾‘ï¼Œä¹Ÿå¯ä»¥ä»tunaä¸Šä¸‹è½½ help: helpç›®å½•é‡Œå­˜æœ‰å„ä¸ªrepoçš„å¸®åŠ©ä¿¡æ¯ï¼Œåœ¨ä¸»é¡µä¸Šä¼šæ˜¾ç¤ºæœ‰ä¸ª\"?\" news: é•œåƒç«™çš„æ–°é—»ä¿¡æ¯ ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:8","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"help è¯´æ˜ permalink æ˜¯è¡¨ç¤ºhelpçš„é¦–é¡µçš„è·¯å¾„ï¼Œå¿…é¡»è¦æœ‰ --- layout: help category: help mirrorid: app permalink: /help/app/ --- ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:9","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["Kubernetes"],"content":"helm oci ","date":"2023-09-24","objectID":"/posts/helm-migrate-oci/:1:0","tags":["helm"],"title":"Helm Migrate OCI","uri":"/posts/helm-migrate-oci/"},{"categories":["Kubernetes"],"content":"ç¼˜ç”± Helm 3.8 ç‰ˆæœ¬å¼€å§‹ï¼Œæ”¯æŒä½¿ç”¨ociè¿›è¡Œå­˜å‚¨chartã€‚é•œåƒå­˜å‚¨å¸¸ç”¨çš„Harboråœ¨v1.6ç‰ˆæœ¬å¼€å§‹æ”¯æŒHelm Chartä»“åº“åŠŸèƒ½ï¼Œ chartä»“åº“ç”±chartmuseumä»¥æ’ä»¶çš„æ–¹å¼æä¾›ã€‚éšç€å…¼å®¹OCIè§„èŒƒçš„Helm Chartåœ¨ç¤¾åŒºä¸Šè¢«æ›´å¹¿æ³›åœ°æ¥å—ï¼ŒHelm Chartèƒ½ä»¥Artifactçš„å½¢å¼åœ¨Harborä¸­å­˜å‚¨å’Œç®¡ç†ï¼Œä¸å†ä¾èµ–ChartMuseumï¼Œå› æ­¤Harboråœ¨v2.8.0ç‰ˆæœ¬ä¸­ï¼Œç§»é™¤å¯¹ChartMuseumçš„æ”¯æŒã€‚ ","date":"2023-09-24","objectID":"/posts/helm-migrate-oci/:1:1","tags":["helm"],"title":"Helm Migrate OCI","uri":"/posts/helm-migrate-oci/"},{"categories":["Kubernetes"],"content":"registry ä»“åº“ä½¿ç”¨ åŸºæœ¬ä½¿ç”¨ ### registry # ç™»å½• helm registry login -u serialt docker.io # æ³¨é”€ helm registry logout docker.io # pull chart helm fetch oci://docker.io/serialt/loki-stack --version=2.9.11 # push chart helm push loki-stack-2.9.11.tgz oci://docker.io/serialt ociæ”¯æŒçš„å…¶ä»–å‘½ä»¤ helm pull helm show helm template helm install helm upgrade $ helm pull oci://localhost:5000/helm-charts/mychart --version 0.1.0 Pulled: localhost:5000/helm-charts/mychart:0.1.0 Digest: sha256:0be7ec9fb7b962b46d81e4bb74fdcdb7089d965d3baca9f85d64948b05b402ff $ helm show all oci://localhost:5000/helm-charts/mychart --version 0.1.0 apiVersion: v2 appVersion: 1.16.0 description: A Helm chart for Kubernetes name: mychart ... $ helm template myrelease oci://localhost:5000/helm-charts/mychart --version 0.1.0 --- # Source: mychart/templates/serviceaccount.yaml apiVersion: v1 kind: ServiceAccount ... $ helm install myrelease oci://localhost:5000/helm-charts/mychart --version 0.1.0 NAME: myrelease LAST DEPLOYED: Wed Oct 27 15:11:40 2021 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: ... $ helm upgrade myrelease oci://localhost:5000/helm-charts/mychart --version 0.2.0 Release \"myrelease\" has been upgraded. Happy Helming! NAME: myrelease LAST DEPLOYED: Wed Oct 27 15:12:05 2021 NAMESPACE: default STATUS: deployed REVISION: 2 NOTES: ... ","date":"2023-09-24","objectID":"/posts/helm-migrate-oci/:1:2","tags":["helm"],"title":"Helm Migrate OCI","uri":"/posts/helm-migrate-oci/"},{"categories":["Kubernetes"],"content":"è¿ç§» chart repo åˆ° oci ä»“åº“ åŸºäº github action é•œåƒ helm repo ä»“åº“åˆ° docker hubï¼Œä»¥åŠ é€Ÿ helm repo åˆ°è®¿é—®ã€‚ migrate-chart ","date":"2023-09-24","objectID":"/posts/helm-migrate-oci/:1:3","tags":["helm"],"title":"Helm Migrate OCI","uri":"/posts/helm-migrate-oci/"}]