[{"categories":["DevOps"],"content":"Gorm gen å‚è€ƒé“¾æ¥ï¼š https://nickxu.me/2023/03/29/GORM%E7%9A%84GEN%E6%A8%A1%E5%BC%8F%E5%88%9D%E4%B8%8A%E6%89%8B/ https://www.liwenzhou.com/posts/Go/gen/ ç¤ºä¾‹ä»£ç ï¼š https://github.com/serialt/genc Genæ˜¯ä¸€ä¸ªåŸºäºGORMçš„å®‰å…¨ORMæ¡†æ¶ï¼Œå…¶ä¸»è¦é€šè¿‡ä»£ç ç”Ÿæˆæ–¹å¼å®ç°GORMä»£ç å°è£…ã€‚ä½¿ç”¨Genæ¡†æ¶èƒ½å¤Ÿè‡ªåŠ¨ç”ŸæˆModelç»“æ„ä½“å’Œç±»å‹å®‰å…¨çš„CRUDä»£ç ï¼Œæå¤§æå‡CRUDæ•ˆç‡ã€‚ ","date":"2023-11-28","objectID":"/posts/2023-11-28-gorm-gen/:0:0","tags":["gorm","gorm-gen"],"title":"Gorm gen","uri":"/posts/2023-11-28-gorm-gen/"},{"categories":["DevOps"],"content":"Genä»‹ç» Genæ˜¯ç”±å­—èŠ‚è·³åŠ¨æ— æ’å®éªŒå®¤ä¸GORMä½œè€…è”åˆç ”å‘çš„ä¸€ä¸ªåŸºäºGORMçš„å®‰å…¨ORMæ¡†æ¶ï¼Œä¸»è¦é€šè¿‡ä»£ç ç”Ÿæˆæ–¹å¼å®ç°GORMä»£ç å°è£…ã€‚ Genæ¡†æ¶åœ¨GORMæ¡†æ¶çš„åŸºç¡€ä¸Šæä¾›äº†ä»¥ä¸‹èƒ½åŠ›ï¼š åŸºäºåŸå§‹SQLè¯­å¥ç”Ÿæˆå¯é‡ç”¨çš„CRUD API ç”Ÿæˆä¸ä½¿ç”¨interface{}çš„100%å®‰å…¨çš„DAO API ä¾æ®æ•°æ®åº“ç”Ÿæˆéµå¾ªGORMçº¦å®šçš„ç»“æ„ä½“Model æ”¯æŒGORMçš„æ‰€æœ‰ç‰¹æ€§ ç®€å•æ¥è¯´ï¼Œä½¿ç”¨Genæ¡†æ¶åæˆ‘ä»¬æ— éœ€æ‰‹åŠ¨å®šä¹‰ç»“æ„ä½“Modelï¼ŒåŒæ—¶Genæ¡†æ¶ä¹Ÿèƒ½å¸®æˆ‘ä»¬ç”Ÿæˆç±»å‹å®‰å…¨çš„CRUDä»£ç ã€‚ æ›´å¤šè¯¦ç»†ä»‹ç»è¯·æŸ¥çœ‹Genå®˜æ–¹æ–‡æ¡£ã€‚ æ­¤å¤–ï¼ŒFacebookå¼€æºçš„entä¹Ÿæ˜¯ç¤¾åŒºä¸­å¸¸ç”¨çš„ç±»ä¼¼æ¡†æ¶ï¼Œå¤§å®¶å¯æŒ‰éœ€é€‰æ‹©ä½¿ç”¨ã€‚ ","date":"2023-11-28","objectID":"/posts/2023-11-28-gorm-gen/:1:0","tags":["gorm","gorm-gen"],"title":"Gorm gen","uri":"/posts/2023-11-28-gorm-gen/"},{"categories":["DevOps"],"content":"Gen ä½¿ç”¨ go get grom.io/gen åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º modelæ–‡ä»¶å¤¹ï¼Œç„¶ååˆ›å»º model.go package model type Student struct { Id int Name string TeacherID int } type Teacher struct { Id int Name string // has many Student []Student } ç„¶åä½¿ç”¨go ç”Ÿæˆä»£ç  åˆ›å»ºcmd/gen/generate.go package main import ( \"github.com/root/genc/model\" \"gorm.io/gen\" ) //// Dynamic SQL //type Querier interface { // // SELECT * FROM @@table WHERE name = @name{{if role !=\"\"}} AND role = @role{{end}} // FilterWithNameAndRole(name, role string) ([]gen.T, error) //} func main() { g := gen.NewGenerator(gen.Config{ OutPath: \"../../query\", Mode: gen.WithoutContext | gen.WithDefaultQuery | gen.WithQueryInterface, // generate mode }) // gormdb, _ := gorm.Open(mysql.Open(\"root:@(127.0.0.1:3306)/demo?charset=utf8mb4\u0026parseTime=True\u0026loc=Local\")) //g.UseDB(gormdb) // reuse your gorm db // Generate basic type-safe DAO API for struct `model.User` following conventions g.ApplyBasic(model.Student{}, model.Teacher{}) // Generate Type Safe API with Dynamic SQL defined on Querier interface for `model.User` and `model.Company` //g.ApplyInterface(func(Querier) {}, model.User{}, model.Company{}) // Generate the code g.Execute() } è¿è¡Œå‘½ä»¤ go run cmd/gen/generate.go [root@Sugar genc]ğŸ³ go run cmd/gen/generate.go 2023/11/28 01:10:21 Start generating code. 2023/11/28 01:10:21 generate query file: /Users/root/github/genc/query/students.gen.go 2023/11/28 01:10:21 generate query file: /Users/root/github/genc/query/teachers.gen.go 2023/11/28 01:10:21 generate query file: /Users/root/github/genc/query/gen.go 2023/11/28 01:10:21 Generate code done. server mainæ–‡ä»¶ cmd/sugar/sugar.go package main import ( \"fmt\" \"github.com/glebarez/sqlite\" \"github.com/root/genc/model\" \"github.com/root/genc/query\" \"gorm.io/gorm\" \"gorm.io/gorm/schema\" ) func main() { // dsn := \"root:12345678@tcp(127.0.0.1:3306)/gorm_learning?charset=utf8mb4\u0026parseTime=True\u0026loc=Local\" db, err := gorm.Open(sqlite.Open(\"test.db\"), \u0026gorm.Config{ DisableForeignKeyConstraintWhenMigrating: true, NamingStrategy: schema.NamingStrategy{ SingularTable: true, // è®¾ç½®åˆ›å»ºè¡¨åæ—¶ä¸ä½¿ç”¨å¤æ•° }, }) if err != nil { panic(err) } err = db.AutoMigrate(\u0026model.Student{}, \u0026model.Teacher{}) if err != nil { panic(err) } query.SetDefault(db) // å¢ student1 := model.Student{Name: \"student1\"} student2 := model.Student{Name: \"student2\"} student3 := model.Student{Name: \"student3\"} _ = query.Student.Create(\u0026student1, \u0026student2, \u0026student3) teacher1 := model.Teacher{Name: \"teacher1\"} _ = query.Teacher.Create(\u0026teacher1) // åˆ  _, _ = query.Student.Where(query.Student.Id.Eq(3)).Delete() // æ”¹ _, _ = query.Student.Where(query.Student.Id.Eq(2)).Update(query.Student.Name, \"student2_new\") // æŸ¥ student, _ := query.Student.Where(query.Student.Id.Eq(1)).Take() teacher, _ := query.Teacher.Where(query.Teacher.Id.Eq(1)).Take() fmt.Println(student) // {1 student1 0} fmt.Println(teacher) // {1 teacher1 []} // å…³è” _ = query.Teacher.Student.Model(\u0026teacher1).Append(\u0026student1, \u0026student2) teacher, _ = query.Teacher.Preload(query.Teacher.Student).Where(query.Teacher.Id.Eq(1)).Take() fmt.Println(teacher) // {1 teacher1 [{1 student1 1} {2 student2_new 1}]} fmt.Println(query.Student.TableName()) fmt.Println(query.Teacher.TableName()) } è¿è¡Œä¸»æœåŠ¡ [root@Sugar genc]ğŸ³ go run cmd/sugar/main.go \u0026{1 student1 1} \u0026{1 teacher1 []} \u0026{1 teacher1 [{1 student1 1} {2 student2_new 1}]} student teacher æ›´æ–°å­—æ®µä½¿ç”¨å¯¹æ¯” GLOBAL_DB.Model(\u0026Student{}).Where(\"ID = ?\", 2).Update(\"Name\", \"student2_new\") query.Student.Where(query.Student.Id.Eq(2)).Update(query.Student.Name, \"student2_new\") ","date":"2023-11-28","objectID":"/posts/2023-11-28-gorm-gen/:2:0","tags":["gorm","gorm-gen"],"title":"Gorm gen","uri":"/posts/2023-11-28-gorm-gen/"},{"categories":["DevOps"],"content":"Shell handbok ","date":"2023-11-24","objectID":"/posts/2023-11-24-shell-handbook/:0:0","tags":["shell","shell-handbook"],"title":"Shell handbook","uri":"/posts/2023-11-24-shell-handbook/"},{"categories":["DevOps"],"content":"ä¸€ã€ç‰¹æ®Šç¬¦å· å‚è€ƒé“¾æ¥: https://blog.csdn.net/jiezi2016/article/details/79649382 https://blog.csdn.net/wangzhaotongalex/article/details/73321766 ä»‹ç»ä¸‹Shellä¸­çš„${}ã€##å’Œ%%ä½¿ç”¨èŒƒä¾‹ï¼Œæœ¬æ–‡ç»™å‡ºäº†ä¸åŒæƒ…å†µä¸‹å¾—åˆ°çš„ç»“æœã€‚ å‡è®¾å®šä¹‰äº†ä¸€ä¸ªå˜é‡ä¸ºï¼š ä»£ç å¦‚ä¸‹: file=/dir1/dir2/dir3/my.file.txt å¯ä»¥ç”¨${ }åˆ†åˆ«æ›¿æ¢å¾—åˆ°ä¸åŒçš„å€¼ï¼š ${file#*/}ï¼šåˆ æ‰ç¬¬ä¸€ä¸ª / åŠå…¶å·¦è¾¹çš„å­—ç¬¦ä¸²ï¼šdir1/dir2/dir3/my.file.txt ${file##*/}ï¼šåˆ æ‰æœ€åä¸€ä¸ª / åŠå…¶å·¦è¾¹çš„å­—ç¬¦ä¸²ï¼šmy.file.txt ${file#*.}ï¼šåˆ æ‰ç¬¬ä¸€ä¸ª . åŠå…¶å·¦è¾¹çš„å­—ç¬¦ä¸²ï¼šfile.txt ${file##*.}ï¼šåˆ æ‰æœ€åä¸€ä¸ª . åŠå…¶å·¦è¾¹çš„å­—ç¬¦ä¸²ï¼štxt ${file%/*}ï¼šåˆ æ‰æœ€åä¸€ä¸ª / åŠå…¶å³è¾¹çš„å­—ç¬¦ä¸²ï¼š/dir1/dir2/dir3 ${file%%/*}ï¼šåˆ æ‰ç¬¬ä¸€ä¸ª / åŠå…¶å³è¾¹çš„å­—ç¬¦ä¸²ï¼š(ç©ºå€¼) ${file%.*}ï¼šåˆ æ‰æœ€åä¸€ä¸ª . åŠå…¶å³è¾¹çš„å­—ç¬¦ä¸²ï¼š/dir1/dir2/dir3/my.file ${file%%.*}ï¼šåˆ æ‰ç¬¬ä¸€ä¸ª . åŠå…¶å³è¾¹çš„å­—ç¬¦ä¸²ï¼š/dir1/dir2/dir3/my è®°å¿†çš„æ–¹æ³•ä¸ºï¼š # æ˜¯ å»æ‰å·¦è¾¹ï¼ˆé”®ç›˜ä¸Š#åœ¨ $ çš„å·¦è¾¹ï¼‰ %æ˜¯å»æ‰å³è¾¹ï¼ˆé”®ç›˜ä¸Š% åœ¨$ çš„å³è¾¹ï¼‰ å•ä¸€ç¬¦å·æ˜¯æœ€å°åŒ¹é…ï¼›ä¸¤ä¸ªç¬¦å·æ˜¯æœ€å¤§åŒ¹é… ${file:0:5}ï¼šæå–æœ€å·¦è¾¹çš„ 5 ä¸ªå­—èŠ‚ï¼š/dir1 ${file:5:5}ï¼šæå–ç¬¬ 5 ä¸ªå­—èŠ‚å³è¾¹çš„è¿ç»­5ä¸ªå­—èŠ‚ï¼š/dir2 ä¹Ÿå¯ä»¥å¯¹å˜é‡å€¼é‡Œçš„å­—ç¬¦ä¸²ä½œæ›¿æ¢ï¼š ${file/dir/path}ï¼šå°†ç¬¬ä¸€ä¸ªdir æ›¿æ¢ä¸ºpathï¼š/path1/dir2/dir3/my.file.txt ${file//dir/path}ï¼šå°†å…¨éƒ¨dir æ›¿æ¢ä¸º pathï¼š/path1/path2/path3/my.file.txt $*ä¸$@ $*å’Œ$@éƒ½è¡¨ç¤ºä¼ é€’ç»™å‡½æ•°æˆ–è„šæœ¬çš„æ‰€æœ‰å‚æ•°ï¼Œä¸è¢«åŒå¼•å·â€œâ€åŒ…å«æ—¶ï¼Œéƒ½ä»¥$1 $2 â€¦$nçš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚ å½“å®ƒä»¬è¢«åŒå¼•å·â€œâ€åŒ…å«æ—¶ï¼Œâ€œ$*â€ä¼šå°†æ‰€æœ‰çš„å‚æ•°ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä»¥â€œ$1 $2 â€¦$nâ€çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ï¼›â€œ$@â€ä¼šå°†å„ä¸ªå‚æ•°åˆ†å¼€ï¼Œä»¥â€œ$1â€ â€œ$2â€â€¦â€$nâ€çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚ ","date":"2023-11-24","objectID":"/posts/2023-11-24-shell-handbook/:1:0","tags":["shell","shell-handbook"],"title":"Shell handbook","uri":"/posts/2023-11-24-shell-handbook/"},{"categories":["DevOps"],"content":"äºŒã€é‡å®šå‘ä¸å˜é‡ cat \u003e\u003etest.txt \u003c\u003c EOF 1ã€å®‰è£…kvm 2ã€å¸è½½kvm 3ã€å®‰è£…python EOF $0 shellè„šæœ¬çš„åå­— $n ç¬¬nä¸ªå‚æ•° $# è·å–å‚æ•°çš„ä¸ªæ•° $* æ‰€æœ‰å‚æ•° $@ æ‰€æœ‰å‚æ•° ä¸¤è€…åŒºåˆ«ï¼š \"$*\"ä¼šæŠŠæ‰€æœ‰ä½ç½®å‚æ•°å½“æˆä¸€ä¸ªæ•´ä½“ï¼ˆæˆ–è€…è¯´å½“æˆä¸€ä¸ªå•è¯ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ä½ç½®å‚æ•°ï¼Œåˆ™\"$*\"ä¸ºç©ºï¼Œå¦‚æœæœ‰ä¸¤ä¸ªä½ç½®å‚æ•°å¹¶ä¸”IFSä¸ºç©ºæ ¼æ—¶ï¼Œ\"$*\"ç›¸å½“äº\"$1 $2\" \"$@\" ä¼šæŠŠæ‰€æœ‰ä½ç½®å‚æ•°å½“æˆä¸€ä¸ªå•ç‹¬çš„å­—æ®µï¼Œå¦‚æœæ²¡æœ‰ä½ç½®å‚æ•°ï¼ˆ$#ä¸º0ï¼‰ï¼Œåˆ™\"$@\"å±•å¼€ä¸ºç©ºï¼ˆä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ç©ºåˆ—è¡¨ï¼‰ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªä½ç½®å‚æ•°ï¼Œåˆ™\"$@\"ç›¸å½“äº\"$1\"ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ™\"$@\"ç›¸å½“äº\"$1\" \"$2\"ç­‰ç­‰ $? ç”¨äºè®°å½•ä¸Šä¸€æ¡å‘½ä»¤çš„æ‰§è¡ŒçŠ¶æ€ 0---255 0ï¼šæ‰§è¡ŒæˆåŠŸ $$ è·å–å½“å‰æ‰§è¡ŒShellè„šæœ¬çš„è¿›ç¨‹å·ï¼ˆPIDï¼‰ $! è·å–ä¸Šä¸€ä¸ªåœ¨åå°å·¥ä½œçš„è¿›ç¨‹çš„è¿›ç¨‹å· $_ è·å–åœ¨æ­¤ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬çš„æœ€åä¸€ä¸ªå‚æ•° ç‰¹æ®Šæ‰©å±•å˜é‡ å¯ä»¥man bash å‘½ä»¤ï¼Œç„¶åæœç´¢\"Parameter Expansion\"æ¥æŸ¥æ‰¾ç›¸å…³çš„å†…å®¹å¸®åŠ© ${parameter:-word} å¦‚æœparameterçš„å˜é‡å€¼ä¸ºç©ºæˆ–æ²¡èµ‹å€¼ï¼Œåˆ™è¿”å›wordå­—ç¬¦ä¸²å¹¶ä»£æ›¿å˜é‡çš„å€¼ï¼ˆå˜é‡æ²¡å®šä¹‰ï¼Œè¿”å›å¤‡ç”¨çš„å€¼ï¼Œé˜²æ­¢å˜é‡ä¸ºç©ºæˆ–æ²¡å®šä¹‰æŠ¥é”™ï¼‰ ${parameter:=word} å¦‚æœparameterçš„å˜é‡å€¼ä¸ºç©ºæˆ–æ²¡èµ‹å€¼ï¼Œã€‚ã€‚ã€‚åŒä¸Šï¼Œï¼ˆå˜é‡æ²¡å®šä¹‰ä¸ºé˜²æ­¢å‡ºé”™ï¼Œæ‰¾çš„å¤‡èƒå˜é‡ï¼‰ ${parameter:?word} å¦‚æœparameterçš„å˜é‡å€¼ä¸ºç©ºæˆ–è€…æ²¡èµ‹å€¼ï¼Œwordå­—ç¬¦ä¸²å°±ä½œä¸ºæ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œå¦åˆ™å‡ºä¹¦å˜é‡çš„å€¼ï¼ˆæ•æ‰ç”±äºå˜é‡æœªå®šä¹‰å¯¼è‡´çš„é”™è¯¯ï¼Œå¹¶é€€å‡ºï¼‰ ${parameter:+word} è‹¥æœparameterçš„å˜é‡å€¼ä¸ºç©ºæˆ–è€…æœªèµ‹å€¼ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œå¦åˆ™wordå­—ç¬¦ä¸²å°†ä»£æ›¿å˜é‡çš„å€¼ã€‚ ","date":"2023-11-24","objectID":"/posts/2023-11-24-shell-handbook/:2:0","tags":["shell","shell-handbook"],"title":"Shell handbook","uri":"/posts/2023-11-24-shell-handbook/"},{"categories":["DevOps"],"content":"ä¸‰ã€åˆ¤æ–­ æ¡ä»¶åˆ¤æ–­ -z åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºä¸² -n å­—ç¬¦æ®µé•¿åº¦æ˜¯å¦éé›¶çš„ å¦‚æœç»“æœä¸ºçœŸå€¼ è¿”å›å€¼ä¸º0 å¦‚æœç»“æœä¸ºå‡å€¼ -eq ç­‰äº -gt å¤§äº -lt å°äº -ge å¤§äºç­‰äº -le å°äºç­‰äº -ne ä¸ç­‰äº æ ¹æ®æ–‡ä»¶ç±»å‹åˆ¤æ–­ -d æ–‡ä»¶å­˜åœ¨ä¸”å¿…é¡»æ˜¯ç›®å½• -e æ–‡ä»¶å­˜åœ¨ï¼Œä¸åˆ¤æ–­æ–‡ä»¶ç±»å‹ -f æ–‡ä»¶å­˜åœ¨ä¸”æ˜¯æ ‡å‡†æ™®é€šæ–‡ä»¶ -h æ–‡ä»¶å­˜åœ¨ä¸”æ˜¯è½¯è¿æ¥ï¼ŒåŒ -L -r æ–‡ä»¶å­˜åœ¨ä¸”å¯è¯» -w æ–‡ä»¶å­˜åœ¨ä¸”å¯å†™ -x æ–‡ä»¶å­˜åœ¨ä¸”å¯æ‰§è¡Œ -s æ–‡ä»¶å­˜åœ¨ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå­—ç¬¦ åŒç›®è¡¨è¾¾å¼ å•ç›®è¡¨è¾¾å¼ï¼Œ æ‰€æœ‰çš„å•ç›®è¡¨è¾¾å¼éƒ½å¯ä»¥ä½¿ç”¨!è¡¨ç¤ºå–å [ ! -f file_name ] ifæ ‡å‡†å†™æ³• if æ¡ä»¶; then æ“ä½œè¯­å¥ æ“ä½œè¯­å¥ .... else æ“ä½œè¯­å¥ æ“ä½œè¯­å¥ fi [ file1 -ef file2 ] ä¸¤ä¸ªæ–‡ä»¶æœ‰ç›¸åŒçš„è®¾å¤‡ç¼–å·å’Œinodeç¼–å· (åˆ¤æ–­ç¡¬é“¾æ¥) if [ 'a' != 'b'];then echo 'a' fi ä»¥ä¸Šå¯ä»¥ç®€å†™ä¸º: [ 'a' != 'b' ] \u0026\u0026 echo 'a' case è¯­æ³• read -p \"Enter string: \" str_01 case $str_01 in linux|Linux) echo \"CentOS\" ;; windows|Windows) echo \"Microsoft\" ;; *) echo \"Other\" ;; esac for å¾ªç¯ # æ™®é€šå¾ªç¯ sum=0 for i in `seq 100`; do let sum=$sum+$i done echo $sum # ç±»Cå†™æ³• for ((i=1;i\u003c8;i++));do cmd1 done whileå¾ªç¯ while æ¡ä»¶; do æ“ä½œè¯­å¥ æ“ä½œè¯­å¥ å­˜åœ¨ä¸€æ¡å¯ä»¥æ”¹å˜æ¡ä»¶çœŸå‡çš„è¯­å¥ done untilå¾ªç¯ å½“æ¡ä»¶ä¸ºå‡æ—¶æ‰å¾ªç¯ until æ¡ä»¶æµ‹è¯• ;do cmd1 done æ•°ç»„ä¸å¾ªç¯ # ca.crt /etc/openvpn/easy-rsa/pki # server.crt /etc/openvpn/easy-rsa/pki/issued # user.crt /etc/openvpn/easy-rsa/pki/issued # user.key /etc/openvpn/easy-rsa/pki/private # ca.key /etc/openvpn/easy-rsa/pki/private # ta.key /etc/openvpn/easy-rsa # å®šä¹‰ç”¨æˆ· accounts=( client2,ç”¨æˆ·2 client3,ç”¨æˆ·3 client4,ç”¨æˆ·4 ) OPENVPN_DIR=\"/etc/openvpn\" EASY_RSA_DIR=\"/etc/openvpn/easy-rsa\" # åˆ†é…å¥½çš„è¯ä¹¦ OVPN_DIR=\"/tmp/openvpn\" # åˆ›å»ºkey # $1 ç”¨æˆ·è¯ä¹¦å create_key(){ [[ ! -f ${EASY_RSA_DIR}/easyrsa ]] \u0026\u0026 exit 55 cd ${EASY_RSA_DIR}/ \u0026\u0026 ./easyrsa build-client-full $1 nopass } # $1 ç”¨æˆ·å create_ovpn(){ [[ ! -f ${OVPN_DIR} ]] \u0026\u0026 mkdir -p ${OVPN_DIR} cat \u003e ${OVPN_DIR}/$1.ovpn \u003c\u003c EOF client dev tun proto tcp remote vpn.local.com 50000 resolv-retry infinite nobind persist-key persist-tun remote-cert-tls server cipher AES-256-CBC comp-lzo verb 3 EOF } # $1 ç”¨æˆ·å insert_file(){ ca=`cat ${EASY_RSA_DIR}/pki/ca.crt` user_crt=`cat ${EASY_RSA_DIR}/pki/issued/$1.crt` user_key=`cat ${EASY_RSA_DIR}/pki/private/$1.key` ta=`cat ${EASY_RSA_DIR}/ta.key` cat \u003e\u003e ${OVPN_DIR}/$1.ovpn \u003c\u003c EOF \u003cca\u003e ${ca} \u003c/ca\u003e \u003ccert\u003e ${user_crt} \u003c/cert\u003e \u003ckey\u003e ${user_key} \u003c/key\u003e key-direction 1 \u003ctls-auth\u003e ${ta} \u003c/tls-auth\u003e EOF } ## main for aobj in ${accounts[@]} do arr=(${aobj//,/ }) actName=${arr[0]} chineseName=${arr[1]} create_ovpn ${actName} create_key ${actName} insert_file ${actName} done ","date":"2023-11-24","objectID":"/posts/2023-11-24-shell-handbook/:3:0","tags":["shell","shell-handbook"],"title":"Shell handbook","uri":"/posts/2023-11-24-shell-handbook/"},{"categories":["DevOps"],"content":"å››ã€é«˜çº§è¯­æ³• å¯é€‰å‚æ•° while getopts \"ğŸ…°ï¸b:c:\" opt do case $opt in a) echo \"å‚æ•°açš„å€¼$OPTARG\" ;; b) echo \"å‚æ•°bçš„å€¼$OPTARG\" ;; c) echo \"å‚æ•°cçš„å€¼$OPTARG\" ;; ?) echo \"æœªçŸ¥å‚æ•°\" exit 1;; esac done ","date":"2023-11-24","objectID":"/posts/2023-11-24-shell-handbook/:4:0","tags":["shell","shell-handbook"],"title":"Shell handbook","uri":"/posts/2023-11-24-shell-handbook/"},{"categories":["DevOps"],"content":"sed d åˆ é™¤ç¬¦åˆæ¡ä»¶çš„è¡Œ # sed '1,2d' /etc/inittab åˆ é™¤æ–‡ä»¶ä¸­åŒ…å«ootçš„è¡Œ # sed '/oot/d' /etc/fstab åˆ é™¤ç¬¬1è¡ŒåŠå…¶å2è¡Œ # sed '1,+2d' /etc/fstab åˆ é™¤ç¬¬1è¡Œ # sed '1d' /etc/fstab åˆ é™¤ä»¥/å¼€å¤´çš„è¡Œ # sed '/^\\//d' /etc/fstab a \\string åœ¨ç¬¦åˆæ¡ä»¶çš„è¡Œåè¿½åŠ æ–°è¡Œï¼Œstringä¸ºè¿½åŠ çš„å†…å®¹ åœ¨ä»¥/å¼€å¤´çš„è¡Œåé¢è¿½åŠ # hello world # sed '/^\\//a \\# hello world' /etc/fstab åœ¨ä»¥/å¼€å¤´çš„è¡Œåé¢è¿½åŠ ä¸¤è¡Œå†…å®¹ï¼Œåˆ†åˆ«ä¸º# hello worl # hello linux # sed '/^\\//a \\# hello world\\n# hello linux' /etc/fstab i \\string åœ¨ç¬¦åˆæ¡ä»¶çš„è¡Œå‰æ·»åŠ æ–°è¡Œï¼Œstringä¸ºè¿½åŠ çš„å†…å®¹ åœ¨æ–‡ä»¶ç¬¬1è¡Œæ·»åŠ # hello world # sed '1i \\# hello world' /etc/fstab c \\string æ›¿æ¢æŒ‡å®šè¡Œçš„å†…å®¹ å°†æ–‡ä»¶ä¸­æœ€åä¸€è¡Œå†…å®¹æ›¿æ¢ä¸ºEnd Of File # sed '$c \\End Of File' /1.txt # sed '7c \\SELINUX=disabled' /etc/sysconfig/selinux ","date":"2023-11-24","objectID":"/posts/2023-11-24-shell-handbook/:4:1","tags":["shell","shell-handbook"],"title":"Shell handbook","uri":"/posts/2023-11-24-shell-handbook/"},{"categories":["DevOps"],"content":"awk # awk -F: '/^r/{print $1}' /etc/passwd ","date":"2023-11-24","objectID":"/posts/2023-11-24-shell-handbook/:4:2","tags":["shell","shell-handbook"],"title":"Shell handbook","uri":"/posts/2023-11-24-shell-handbook/"},{"categories":["DevOps"],"content":"switch-caseè¯­æ³• shell è¯­æ³• case å˜é‡ in å–å€¼1) æ“ä½œè¯­å¥ æ“ä½œè¯­å¥ ;; å–å€¼2) æ“ä½œè¯­å¥ æ“ä½œè¯­å¥ ;; å–å€¼3) æ“ä½œè¯­å¥ æ“ä½œè¯­å¥ ;; *) æ“ä½œè¯­å¥ æ“ä½œè¯­å¥ ;; esac # example read -p \"Enter string: \" str_01 case $str_01 in linux|Linux) echo \"CentOS\" ;; windows|Windows) echo \"Microsoft\" ;; *) echo \"Other\" ;; esac go func testSwitch3() { switch n := 7; n { case 1, 3, 5, 7, 9: fmt.Println(\"å¥‡æ•°\") case 2, 4, 6, 8: fmt.Println(\"å¶æ•°\") default: fmt.Println(n) } } func switchDemo1() { finger := 3 switch finger { case 1: fmt.Println(\"å¤§æ‹‡æŒ‡\") case 4: fmt.Println(\"æ— åæŒ‡\") case 5: fmt.Println(\"å°æ‹‡æŒ‡\") default: fmt.Println(\"æ— æ•ˆçš„è¾“å…¥ï¼\") } } python 3.10åŠä»¥å match term: case pattern-1: action-1 case pattern-2: action-2 case pattern-3: action-3 case _: action-default lang = input(\"What's the programming language you want to learn? \") match lang: case \"Python\": print(\"You can become a Data Scientist\") case \"go\": print(\"You can become a Blockchain developer\") case \"Java\": print(\"You can become a mobile app developer\") case _: print(\"The language doesn't matter, what matters is solving problems.\") ","date":"2023-11-24","objectID":"/posts/2023-11-24-switch-case/:0:0","tags":["switch","case","switch-case"],"title":"switch-case handbook","uri":"/posts/2023-11-24-switch-case/"},{"categories":["DevOps"],"content":"Ansible Module å‚è€ƒé“¾æ¥ï¼šhttps://ansible.leops.cn/dev/modules/ 1ã€è‡ªå®šä¹‰æ¨¡å—å¼€å‘ è¯¥æ¨¡å—çš„ç›®çš„æ˜¯åœ¨è¿œç¨‹ä¸»æœºä¸Šå°†è¿œç¨‹æºæ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹ç›®æ ‡æ–‡ä»¶ #!/usr/bin/python # -*- coding: utf-8 -*- # Copyright: (c) 2020, lework # GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt) ANSIBLE_METADATA = {'metadata_version': '1.0', 'status': ['preview'], 'supported_by': 'community'} DOCUMENTATION = ''' --- module: remote_copy short_description: Copy a file on the remote host version_added: \"2.9\" description: - The remote_copy module copies a file on the remote host from a given source to a provided destination. options: source: description: - Path to a file on the source file on the remote host required: true dest: description: - Path to the destination on the remote host for the copy required: true author: - \"Lework\" ''' EXAMPLES = ''' # Example from Ansible Playbooks - name: backup a config file remote_copy: source: /tmp/foo dest: /tmp/bar ''' RETURN = ''' source: description: Path to a file on the source file on the remote host type: str returned: success sample: \"/path/to/file.name\" dest: description: Path to the destination on the remote host for the copy type: string returned: success sample: \"/path/to/destination.file\" ''' import os import shutil from ansible.module_utils.basic import AnsibleModule def main(): module_args = dict( source=dict(required=True, type='str'), dest=dict(required=True, type='str') ) result = dict( changed=False, source='', dest='' ) module = AnsibleModule( argument_spec=module_args, supports_check_mode=True ) if module.check_mode: module.exit_json(**result) if not os.path.isfile(module.params['source']): module.fail_json(msg='The '+ module.params['source'] +' file was not found', **result) try: shutil.copy(module.params['source'], module.params['dest']) except Exception as e: module.fail_json(msg=e, **result) result['source'] = module.params['source'] result['dest'] = module.params['dest'] if os.path.isfile(module.params['dest']): result['changed'] = True remote_facts = {'rc_source': module.params['source'], 'rc_dest': module.params['dest'] } result['ansible_facts'] = remote_facts module.exit_json(**result) if __name__ == '__main__': main() ","date":"2023-11-22","objectID":"/posts/2023-11-22-python-ansible-module/:0:0","tags":["python-ansible","ansible-module"],"title":"Python ansible module","uri":"/posts/2023-11-22-python-ansible-module/"},{"categories":["DevOps"],"content":"Python åŸºç¡€ ","date":"2023-11-22","objectID":"/posts/2023-11-22-python-basic/:0:0","tags":["python","python-basic"],"title":"Python basic","uri":"/posts/2023-11-22-python-basic/"},{"categories":["DevOps"],"content":"ä¸€ã€åŸºç¡€è¯­æ³• ","date":"2023-11-22","objectID":"/posts/2023-11-22-python-basic/:1:0","tags":["python","python-basic"],"title":"Python basic","uri":"/posts/2023-11-22-python-basic/"},{"categories":["DevOps"],"content":"1ã€è¾“å‡ºè¯­å¥çš„ä½¿ç”¨ 1ï¼‰å¼•å·çš„ä½¿ç”¨ \u003e\u003e\u003e print ('hello world') hello world \u003e\u003e\u003e print (\"hello world\") hello world \u003e\u003e\u003e 2ï¼‰ä¸‰å¼•å·: è¾“å‡ºå¤šè¡Œå†…å®¹ \u003e\u003e\u003e print (\"\"\"abc ... cdc ... ddd ... ccc ... fff\"\"\") abc cdc ddd ccc fff æ³¨é‡Šç¬¦ï¼š# python2ä¸python3çš„åŒºåˆ« printè¯­æ³•ä¸åŒï¼Œpython3éœ€è¦åŠ () python2é»˜è®¤ä½¿ç”¨çš„å­—ç¬¦é›†ASCIIç , # encoding: utf8ã€‚python3é»˜è®¤ä½¿ç”¨çš„å­—ç¬¦é›†Unicode 2ï¼‰è¾“å‡ºå˜é‡ username = \"root\" password = \"redhat\" print(username) print(\"my name is \", username, \"my password is\", password) print(\"my name is \" + username + \"my password is \" + password) #åªé€‚ç”¨äºå­—ç¬¦ä¸² 3ï¼‰æ ¼å¼åŒ–è¾“å‡º \u003e\u003e\u003e username = \"root\" \u003e\u003e\u003e password = \"redhat\" \u003e\u003e\u003e print(\"my name is %s\" % username ) my name is root \u003e\u003e\u003e print(\"my name is '%s'\" % username) my name is 'root' \u003e\u003e\u003e print(\"my name is %s, my password is %s\" % (username, password)) my name is root, my password is redhat å¸¸ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ %s å­—ç¬¦ä¸² é€šç”¨ %d æ•°å­—ï¼Œæ•´æ•° number_01 = 123 number_02 = \"456\" number_03 = 3.9415 print(\"It is %d\" % number_01) print(\"It is %d\" % number_03) %f æµ®ç‚¹æ•°ï¼Œå°æ•° number_01 = 123 number_02 = 3.948915 number_03 = 3.9489151111111111 print(\"It is %f\" % number_01) print(\"It is %f\" % number_02) print(\"It is %f\" % number_03) print(\"It is %.2f\" % number_02) %% è¾“å‡º%æœ¬èº« number = 50 # This is 50% print(\"This is %d%%\" % number) username = \"root\" password = \"redhat\" sql_01 = \"select * from tb01 where username='%s' and password='%s'\" % (username, password) print(sql_01) ","date":"2023-11-22","objectID":"/posts/2023-11-22-python-basic/:1:1","tags":["python","python-basic"],"title":"Python basic","uri":"/posts/2023-11-22-python-basic/"},{"categories":["DevOps"],"content":"2ã€å˜é‡å®šä¹‰ å˜é‡åç§°è§„èŒƒï¼š å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿_ åªèƒ½ä»¥å­—æ¯ã€ä¸‹åˆ’çº¿_å¼€å¤´ ä¸èƒ½ä¸pythonå…³é”®å­—å†²çªã€‚ï¼ˆprint if for while else ï¼‰ #äº¤äº’å¼å˜é‡èµ‹å€¼ username = input(\"è¾“å…¥ç”¨æˆ·åï¼š \") #æ³¨æ„ï¼š #è¿”å›çš„ç»“æœæ˜¯å­—ç¬¦ä¸² print(\"ç”¨æˆ·åï¼š %s\" % username) åˆ é™¤å˜é‡ name = \"Martin\" print(name) del name print(name) pythonå˜é‡ä¸å…¶ä»–è¯­è¨€ä¸åŒä¹‹å¤„ å¼±ç±»å‹ åœ°å€å¼•ç”¨ç±»å‹ number_01 = 10 number_02 = 10 print(id(number_01)) print(id(number_02)) number_01 = 100 number_02 = number_01 print(id(number_01)) print(id(number_02)) å†…ç½®å‡½æ•° id() è¿”å›å˜é‡çš„å†…å­˜åœ°å€ type() è¿”å›å˜é‡çš„ç±»å‹ å†…å­˜ä½¿ç”¨æœºåˆ¶ æ¯ä¸ªå˜é‡å®šä¹‰åï¼Œä¼šåœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€æ®µç©ºé—´ï¼Œè¿™æ®µç©ºé—´å¯¹åº”å­˜åœ¨ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå˜é‡è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå¼•ç”¨è®¡æ•°å™¨ä¼šè‡ªåŠ¨å¢åŠ ï¼›å½“pythonè§£é‡Šå™¨æ£€æµ‹åˆ°ä¸€æ®µå†…å­˜çš„å¼•ç”¨è®¡æ•°å™¨ä¸º0åï¼Œä¼šè‡ªåŠ¨æ¸…ç†è¯¥å†…å­˜ ","date":"2023-11-22","objectID":"/posts/2023-11-22-python-basic/:1:2","tags":["python","python-basic"],"title":"Python basic","uri":"/posts/2023-11-22-python-basic/"},{"categories":["DevOps"],"content":"3ã€å˜é‡çš„ç±»å‹ æ•°å­— å­—ç¬¦ä¸² åˆ—è¡¨ å…ƒç»„ å­—å…¸ é›†åˆ Bytes ","date":"2023-11-22","objectID":"/posts/2023-11-22-python-basic/:1:3","tags":["python","python-basic"],"title":"Python basic","uri":"/posts/2023-11-22-python-basic/"},{"categories":["DevOps"],"content":"4ã€è¿ç®— #æ•°å­¦è¿ç®—ç¬¦ \u003e\u003e\u003e a = 10 \u003e\u003e\u003e b = 4 \u003e\u003e\u003e a + b 14 \u003e\u003e\u003e a - b 6 \u003e\u003e\u003e a * b 40 \u003e\u003e\u003e a ** b 10000 \u003e\u003e\u003e \u003e\u003e\u003e a / b 2.5 \u003e\u003e\u003e a // b 2 \u003e\u003e\u003e a % b 2 \u003e\u003e\u003e a = 10 \u003e\u003e\u003e a = a + 1 \u003e\u003e\u003e a 11 \u003e\u003e\u003e a += 1 \u003e\u003e\u003e a 12 \u003e\u003e\u003e #æ¯”è¾ƒè¿ç®—ç¬¦ ==, !=, \u003e, \u003e=, \u003c=, \u003c é€»è¾‘è¿ç®—ç¬¦ and, or, not \u003e\u003e\u003e a = 10 \u003e\u003e\u003e \u003e\u003e\u003e \u003e\u003e\u003e a \u003e 20 and 1 \u003c 2 False \u003e\u003e\u003e \u003e\u003e\u003e a \u003e 20 or 1 \u003c 2 True \u003e\u003e\u003e \u003e\u003e\u003e not a \u003e 20 True \u003e\u003e\u003e æ•°åˆ¶è½¬æ¢ \u003e\u003e\u003e a = 10 \u003e\u003e\u003e bin(a) '0b1010' \u003e\u003e\u003e oct(a) '0o12' \u003e\u003e\u003e hex(a) '0xa' \u003e\u003e\u003e #ç”Ÿæˆéšæœºæ•°çš„æ¨¡å— \u003e\u003e\u003e import random \u003e\u003e\u003e random.randint(0, 10) 7 \u003e\u003e\u003e random.randint(0, 10) 9 \u003e\u003e\u003e random.randint(0, 10) 2 \u003e\u003e\u003e random.randint(0, 10) 3 \u003e\u003e\u003e random.randint(0, 10) 6 ç¤ºä¾‹ï¼šå››åˆ™è¿ç®— number_01 = int(input(\"è¾“å…¥ç¬¬1ä¸ªæ•°å­—ï¼š \")) number_02 = int(input(\"è¾“å…¥ç¬¬2ä¸ªæ•°å­—ï¼š \")) print(\"%s + %s = %s\" % (number_01, number_02, number_01 + number_02)) print(\"%s - %s = %s\" % (number_01, number_02, number_01 - number_02)) print(\"%s * %s = %s\" % (number_01, number_02, number_01 * number_02)) print(\"%s / %s = %s\" % (number_01, number_02, number_01 / number_02)) print(\"%s // %s = %s\" % (number_01, number_02, number_01 // number_02)) ","date":"2023-11-22","objectID":"/posts/2023-11-22-python-basic/:1:4","tags":["python","python-basic"],"title":"Python basic","uri":"/posts/2023-11-22-python-basic/"},{"categories":["DevOps"],"content":"5ã€é€»è¾‘æ§åˆ¶è¯­å¥ åŒçº§ä»£ç è¦æœ‰ç›¸åŒç¼©è¿›ï¼Œé»˜è®¤4ä¸ªç©ºæ ¼ æ¡ä»¶åˆ¤æ–­ â€” if if æ¡ä»¶: æ“ä½œè¯­å¥ æ“ä½œè¯­å¥ if 1 \u003c 2: print(\"AAA\") print(\"BBB\") # åªè¦æ•°å­—ä¸ç­‰äº0ï¼Œæ¡ä»¶ä¸ºçœŸ number = 10 if number: print(\"AAA\") print(\"BBB\") number = 10 if not number: print(\"AAA\") print(\"BBB\") # True, False é¦–å­—æ¯å…¨æ˜¯å¤§å†™ if True: print(\"AAA\") if â€¦. else number = 100 if number \u003c 20: print(\"AAAA\") else: print(\"BBBB\") if â€¦ elif â€¦ elif â€¦. else number = int(input(\"Enter number: \")) if number \u003e 10: print(\"AAA\") elif number \u003e 30: print(\"BBBB\") elif number \u003e 40: print(\"CCCC\") else: print(\"DDDD\") åµŒå¥—if age = int(input(\"è¾“å…¥ä½ çš„å¹´é¾„ï¼š \")) if age \u003c= 18: gender = input(\"è¾“å…¥ä½ çš„æ€§åˆ«ï¼š \") if gender == \"M\": print(\"å‡†å¤‡å…¥é˜Ÿ\") else: print(\"ç¡å§\") else: print(\"å›å®¶æ´—æ´—ç¡å§\") å¾ªç¯ for while forå¾ªç¯ï¼š for å˜é‡ in å–å€¼: æ“ä½œè¯­å¥ æ“ä½œè¯­å¥ for i in range(5): print(\"ç¬¬%sæ¬¡å¾ªç¯å¼€å§‹\" % i) print(\"ç¬¬%sæ¬¡å¾ªç¯ç»“æŸ\" % i) print(\"-----------------\") ä¸­æ–­å¾ªç¯ï¼š #break ä¸­æ–­æ•´ä½“å¾ªç¯ for i in range(5): print(\"ç¬¬%sæ¬¡å¾ªç¯å¼€å§‹\" % i) if i == 3: break print(\"ç¬¬%sæ¬¡å¾ªç¯ç»“æŸ\" % i) print(\"-----------------\") continue ä¸­æ–­æœ¬æ¬¡å¾ªç¯ for i in range(5): print(\"ç¬¬%sæ¬¡å¾ªç¯å¼€å§‹\" % i) if i == 3: continue print(\"ç¬¬%sæ¬¡å¾ªç¯ç»“æŸ\" % i) print(\"-----------------\") ç¤ºä¾‹ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ— length=int(input(\"input length:\")) i=0 j=1 tmp=1 for n in range(length): print( tmp,\" \",end=) tmp = i + j i = j j = tmp print() whileå¾ªç¯ while æ¡ä»¶: æ“ä½œè¯­å¥ æ“ä½œè¯­å¥ i = 1 while i \u003c= 4: print(\"ç¬¬%sæ¬¡å¾ªç¯å¼€å§‹\" % i) print(\"ç¬¬%sæ¬¡å¾ªç¯ç»“æŸ\" % i) print(\"-----------------\") i += 1 while True: æ“ä½œè¯­å¥ æ“ä½œè¯­å¥ ç¤ºä¾‹ï¼š å®ç°æ•°åˆ¶è½¬æ¢ import sys number = int(input(\"è¾“å…¥æ•°å­—ï¼š \")) menu = \"\"\" 1ã€äºŒè¿›åˆ¶ 2ã€å…«è¿›åˆ¶ 3ã€åå…­è¿›åˆ¶ 4ã€é€€å‡º è¾“å…¥ä½ çš„é€‰æ‹©ï¼šd \"\"\" ''' å¾ªç¯åˆ¤æ–­ç”¨æˆ·çš„é€‰æ‹©ï¼Œæ ¹æ®ä¸åŒçš„é€‰æ‹©åšä¸åŒçš„å“åº” ''' while True: choice = int(input(menu)) if choice == 1: print(\"æ•°å­—%sçš„äºŒè¿›åˆ¶å½¢å¼ï¼š%s\" % (number, bin(number))) elif choice == 2: print(\"æ•°å­—%sçš„å…«è¿›åˆ¶å½¢å¼ï¼š%s\" % (number, oct(number))) elif choice == 3: print(\"æ•°å­—%sçš„åå…­è¿›åˆ¶å½¢å¼ï¼š%s\" % (number, hex(number))) else: print(\"è°¢è°¢\") sys.exit() pass: å ä½ç¬¦ #!/usr/bin/python import time for i in range(5): print i if i == 1: pass ---- ä»£ç æ¡© ifä¹‹é—´ä¸èƒ½ç©ºä»£ç å¯ä»¥ç”¨passå ä½ if i == 2: continue if i == 3: break print \"#\"*10 else: print \"END\" for j in range(2): print \"---\u003e\",j [root@server python]# python dic.py 0 ########## 1 ########## 2 3 ---\u003e 0 ---\u003e 1 ç»“æŸæ‰§è¡Œ [root@server python]# cat dic.py #!/usr/bin/python for i in range(10): print i if i == 5: exit() [root@server python]# python dic.py 0 1 2 3 4 5 switchè¯­å¥ switchè¯­å¥ç”¨äºç¼–å†™å¤šåˆ†æ”¯ç»“æ„çš„ç¨‹åº,ç±»ä¼¼ä¸ifâ€¦ elifâ€¦ elseè¯­å¥ switchè¯­å¥è¡¨è¾¾çš„åˆ†æ”¯ç»“æ„æ¯”ifâ€¦ elifâ€¦ elseè¯­å¥è¡¨è¾¾çš„æ›´æ¸…æ™°,ä»£ç å¯è¯»æ€§æ›´é«˜ï¼Œä½†æ˜¯pythonå¹¶æ²¡æœ‰æä¾›switchè¯­å¥ pythonå¯ä»¥é€šè¿‡å­—å…¸å®ç°switchè¯­å¥çš„åŠŸèƒ½ å®ç°æ–¹æ³•åˆ†ä¸ºä¸¤æ­¥ é¦–å…ˆï¼šå®šä¹‰ä¸€ä¸ªå­—å…¸ï¼Œå…¶æ¬¡,è°ƒç”¨å­—å…¸çš„get()è·å–ç›¸åº”çš„è¡¨è¾¾å¼xxxxxxxxxx [root@www python]# cat test.py #!/usr/bin/bash #coding:utf8 from __future__ import division def jia(x,y): return x+y def jian(x,y): return x-y def cheng(x,y): return x*y def chu(x,y): return x/y def operator(x,o,y): if o == \"+\": print jia(x,y) elif o == \"-\": print jian(x,y) elif o == \"*\": print cheng(x,y) elif o == \"/\": print chu(x,y) else: pass operator(2,\"/\",4) #!/usr/bin/bash #coding:utf8 from __future__ import division def jia(x,y): return x+y def jian(x,y): return x-y def cheng(x,y): return x*y def chu(x,y): return x/y operator = {\"+\":jia,\"-\":jian,\"*\":cheng,\"/\":chu} print operator [\"/\"](3,2) ç¤ºä¾‹ï¼š å†™ä¸€ä¸ªå–æ°´æœçš„èœå•(æœ‰èœå•),å†å°†ä»–è½¬æ¢ä¸ºswitchæ ¼å¼ menu=\"\"\" 1ã€apple 2ã€banala 3ã€orange \"\"\" fuirt={1:['apple',5],2:['banala',3],3:['orange',7]} print(fuirt[1]) while True: print(menu) tmp=int(input(\"è¯·è¾“å…¥è¦æŸ¥è¯¢ä»·æ ¼çš„æ°´æœ:\")) print(\"%sçš„ä»·æ ¼æ˜¯ %s å…ƒ/æ–¤\"%(fuirt[tmp][0],fuirt[tmp][1])) ","date":"2023-11-22","objectID":"/posts/2023-11-22-python-basic/:1:5","tags":["python","python-basic"],"title":"Python basic","uri":"/posts/2023-11-22-python-basic/"},{"categories":["DevOps"],"content":"å…­ã€å‡½æ•° 1ã€æ ¼å¼ æœªå®šä¹‰è¿”å›å€¼ \u003e\u003e\u003e def fun(): ... print (\"a\") \u003e\u003e\u003e var=fun() a \u003e\u003e\u003e print (var) None å®šä¹‰è¿”å›å€¼ \u003e\u003e\u003e def fun(): ... return \"ok\" ... ... \u003e\u003e\u003e var=fun() \u003e\u003e\u003e print (var) ok 2ã€é»˜è®¤å€¼ #!/usr/bin/python # -*- coding: UTF-8 -*- #å¯å†™å‡½æ•°è¯´æ˜ def printinfo( name, age = 35 ): \"æ‰“å°ä»»ä½•ä¼ å…¥çš„å­—ç¬¦ä¸²\" print \"Name: \", name print \"Age \", age return #è°ƒç”¨printinfoå‡½æ•° printinfo( age=50, name=\"miki\" ) printinfo( name=\"miki\" ) 3ã€ä¸å®šé•¿å‚æ•° #!/usr/bin/python # -*- coding: UTF-8 -*- # å¯å†™å‡½æ•°è¯´æ˜ def printinfo( arg1, *vartuple ): \"æ‰“å°ä»»ä½•ä¼ å…¥çš„å‚æ•°\" print \"è¾“å‡º: \" print arg1 for var in vartuple: print var return # è°ƒç”¨printinfo å‡½æ•° printinfo( 10 ) printinfo( 70, 60, 50 ) ","date":"2023-11-22","objectID":"/posts/2023-11-22-python-basic/:1:6","tags":["python","python-basic"],"title":"Python basic","uri":"/posts/2023-11-22-python-basic/"},{"categories":["DevOps"],"content":"ä¸ƒã€æ¨¡å— æœç´¢è·¯å¾„æ˜¯ä¸€ä¸ªè§£é‡Šå™¨ä¼šå…ˆè¿›è¡Œæœç´¢çš„æ‰€æœ‰ç›®å½•çš„åˆ—è¡¨ã€‚å¦‚æƒ³è¦å¯¼å…¥æ¨¡å— support.pyï¼Œéœ€è¦æŠŠå‘½ä»¤æ”¾åœ¨è„šæœ¬çš„é¡¶ç«¯ï¼š # support.py def print_func( par ): print \"Hello : \", par return # test.py #!/usr/bin/python # -*- coding: UTF-8 -*- # å¯¼å…¥æ¨¡å— import support # ç°åœ¨å¯ä»¥è°ƒç”¨æ¨¡å—é‡ŒåŒ…å«çš„å‡½æ•°äº† support.print_func(\"sugar\") Python çš„ from è¯­å¥è®©ä½ ä»æ¨¡å—ä¸­å¯¼å…¥ä¸€ä¸ªæŒ‡å®šçš„éƒ¨åˆ†åˆ°å½“å‰å‘½åç©ºé—´ä¸­ã€‚è¯­æ³•å¦‚ä¸‹ï¼š ","date":"2023-11-22","objectID":"/posts/2023-11-22-python-basic/:1:7","tags":["python","python-basic"],"title":"Python basic","uri":"/posts/2023-11-22-python-basic/"},{"categories":["DevOps"],"content":"å…«ã€é¢å‘å¯¹è±¡ å®šä¹‰ç±»ä¸å®ä¾‹åŒ– class Ren: name = \"äºº\" def run(self): print(\"è·‘æ­¥\") cmd = Ren() print(cmd) ç§æœ‰å±æ€§ä¸æ–¹æ³• åœ¨å±æ€§æˆ–è€…æ–¹æ³•å‰åŠ __çš„ï¼Œå³è¡¨ç¤ºè¯¥æ–¹æ³•å’Œå±æ€§ä¸ºç§æœ‰ç±»å¤–ä¸å¯è°ƒç”¨ #!/usr/bin/python # -*- coding: UTF-8 -*- class Employee: 'æ‰€æœ‰å‘˜å·¥çš„åŸºç±»' empCount = 0 def __init__(self, name, salary): self.name = name self.salary = salary Employee.empCount += 1 def displayCount(self): print \"Total Employee %d\" % Employee.empCount def displayEmployee(self): print \"Name : \", self.name, \", Salary: \", self.salary ç±»çš„ç»§æ‰¿ #!/usr/bin/python # -*- coding: UTF-8 -*- class Parent: # å®šä¹‰çˆ¶ç±» parentAttr = 100 def __init__(self): print \"è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°\" def parentMethod(self): print 'è°ƒç”¨çˆ¶ç±»æ–¹æ³•' def setAttr(self, attr): Parent.parentAttr = attr def getAttr(self): print \"çˆ¶ç±»å±æ€§ :\", Parent.parentAttr class Child(Parent): # å®šä¹‰å­ç±» def __init__(self): print \"è°ƒç”¨å­ç±»æ„é€ æ–¹æ³•\" def childMethod(self): print 'è°ƒç”¨å­ç±»æ–¹æ³•' c = Child() # å®ä¾‹åŒ–å­ç±» c.childMethod() # è°ƒç”¨å­ç±»çš„æ–¹æ³• c.parentMethod() # è°ƒç”¨çˆ¶ç±»æ–¹æ³• c.setAttr(200) # å†æ¬¡è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³• - è®¾ç½®å±æ€§å€¼ c.getAttr() # å†æ¬¡è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³• - è·å–å±æ€§å€¼ æ–¹æ³•é‡å†™ #!/usr/bin/python # -*- coding: UTF-8 -*- class Parent: # å®šä¹‰çˆ¶ç±» def myMethod(self): print 'è°ƒç”¨çˆ¶ç±»æ–¹æ³•' class Child(Parent): # å®šä¹‰å­ç±» def myMethod(self): print 'è°ƒç”¨å­ç±»æ–¹æ³•' c = Child() # å­ç±»å®ä¾‹ c.myMethod() # å­ç±»è°ƒç”¨é‡å†™æ–¹æ³• ","date":"2023-11-22","objectID":"/posts/2023-11-22-python-basic/:1:8","tags":["python","python-basic"],"title":"Python basic","uri":"/posts/2023-11-22-python-basic/"},{"categories":["DevOps"],"content":"Terraform handbook å‚è€ƒé“¾æ¥ï¼šhttps://blog.gmem.cc/terraform ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:0:0","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"ä¸€ã€ç®€ä»‹ Terraformç”¨äºå®ç°åŸºç¡€è®¾æ–½å³ä»£ç ï¼ˆinfrastructure as codeï¼‰â€”â€” é€šè¿‡ä»£ç ï¼ˆé…ç½®æ–‡ä»¶ï¼‰æ¥æè¿°åŸºç¡€è®¾æ–½çš„æ‹“æ‰‘ç»“æ„ï¼Œå¹¶ç¡®ä¿äº‘ä¸Šèµ„æºå’Œæ­¤ç»“æ„å®Œå…¨å¯¹åº”ã€‚Terraformæœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨Terraform CLIã€‚ Terraform CLIä¸»è¦åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š å‘½ä»¤è¡Œå‰ç«¯ Terraform Languageï¼ˆä»¥ä¸‹ç®€ç§°TLï¼Œè¡ç”Ÿè‡ªHashiCorpé…ç½®è¯­è¨€HCLï¼‰ç¼–å†™çš„ã€æè¿°åŸºç¡€è®¾æ–½æ‹“æ‰‘ç»“æ„çš„é…ç½®æ–‡ä»¶ã€‚é…ç½®æ–‡ä»¶çš„ç»„ç»‡æ–¹å¼æ˜¯æ¨¡å—ã€‚æœ¬æ–‡ä½¿ç”¨æœ¯è¯­â€œé…ç½®â€ï¼ˆConfigurationï¼‰æ¥è¡¨ç¤ºä¸€æ•´å¥—æè¿°åŸºç¡€è®¾æ–½çš„Terraformé…ç½®æ–‡ä»¶ é’ˆå¯¹å„ç§äº‘æœåŠ¡å•†çš„é©±åŠ¨ï¼ˆProviderï¼‰ï¼Œå®ç°äº‘èµ„æºçš„åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ äº‘ä¸Šèµ„æºä¸å•å•åŒ…æ‹¬åŸºç¡€çš„IaaSèµ„æºï¼Œè¿˜å¯ä»¥æ˜¯DNSæ¡ç›®ã€SaaSèµ„æºã€‚äº‹å®ä¸Šï¼Œé€šè¿‡å¼€å‘Providerï¼Œä½ å¯ä»¥ç”¨Terraformç®¡ç†ä»»ä½•èµ„æºã€‚ Terraformä¼šæ£€æŸ¥é…ç½®æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ã€‚è®¡åˆ’æè¿°äº†é‚£äº›èµ„æºéœ€è¦è¢«åˆ›å»ºã€ä¿®æ”¹æˆ–åˆ é™¤ï¼Œä»¥åŠè¿™äº›èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚Terraformä¼šå°½å¯èƒ½å¹¶è¡Œçš„å¯¹èµ„æºè¿›è¡Œå˜æ›´ã€‚å½“ä½ æ›´æ–°äº†é…ç½®æ–‡ä»¶åï¼ŒTerraformä¼šç”Ÿæˆå¢é‡çš„æ‰§è¡Œè®¡åˆ’ã€‚ ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:1:0","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"äºŒã€å‘½ä»¤è¡Œ ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:2:0","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"1ã€å®‰è£…å‘½ä»¤è¡Œ ç›´æ¥åˆ°https://www.terraform.io/downloads.htmlä¸‹è½½ï¼Œå­˜æ”¾åˆ°$PATHä¸‹å³å¯ã€‚ ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:2:1","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"2ã€åŸºæœ¬ç‰¹æ€§ 1ï¼‰åˆ‡æ¢å·¥ä½œç›®å½• ä½¿ç”¨é€‰é¡¹ -chdir=DIR 2ï¼‰Shellè‡ªåŠ¨è¡¥å…¨ ä½¿ç”¨ terraform -install-autocompleteå®‰è£…è‡ªåŠ¨å®Œæˆè„šæœ¬ï¼Œä½¿ç”¨ terraform -uninstall-autocompleteåˆ é™¤è‡ªåŠ¨å®Œæˆè„šæœ¬ã€‚ ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:2:2","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"3ã€èµ„æºåœ°å€ å¾ˆå¤šå­å‘½ä»¤æ¥å—èµ„æºåœ°å€å‚æ•°ï¼Œä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š # èµ„æºç±»å‹.èµ„æºå aws_instance.foo # èµ„æºç±»å‹.èµ„æºåˆ—è¡¨å[ç´¢å¼•] aws_instance.bar[1] # å­æ¨¡å—fooçš„å­æ¨¡å—barä¸­çš„ module.foo.module.bar.aws_instance.baz ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:2:3","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"4ã€é…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶çš„è·¯å¾„å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ TF_CLI_CONFIG_FILEè®¾ç½®ã€‚éWindowsç³»ç»Ÿä¸­ï¼Œ $HOME/.terraformrcä¸ºé»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ã€‚é…ç½®æ–‡ä»¶è¯­æ³•ç±»ä¼¼äºTFæ–‡ä»¶ï¼š # providerç¼“å­˜ç›®å½• plugin_cache_dir = \"$HOME/.terraform.d/plugin-cache\" # disable_checkpoint = true # å­˜æ”¾å‡­è¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¨¡å—ä»“åº“ã€æ”¯æŒè¿œç¨‹æ“ä½œçš„ç³»ç»Ÿçš„å‡­è¯ credentials \"app.terraform.io\" { token = \"xxxxxx.atlasv1.zzzzzzzzzzzzz\" } # æ”¹å˜é»˜è®¤å®‰è£…é€»è¾‘ provider_installation { # ä¸ºexample.comæä¾›æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿé•œåƒï¼Œè¿™æ ·å®‰è£…example.com/*/*çš„provideræ—¶å°±ä¸ä¼šå»ç½‘ç»œä¸Šè¯·æ±‚ # é»˜è®¤è·¯å¾„æ˜¯ï¼š # ~/.terraform.d/plugins/${host_name}/${namespace}/${type}/${version}/${target} # ä¾‹å¦‚ï¼š # ~/.terraform.d/plugins/hashicorp.com/edu/hashicups/0.3.1/linux_amd64/terraform-provider-hashicups_v0.3.1 filesystem_mirror { path = \"/usr/share/terraform/providers\" include = [\"example.com/*/*\"] } direct { exclude = [\"example.com/*/*\"] } # Terraformä¼šåœ¨terraform initçš„æ—¶å€™ï¼Œæ ¡éªŒProviderçš„ç‰ˆæœ¬å’Œchecksumã€‚Providerä»Registryæˆ–è€…æœ¬åœ° # ç›®å½•ä¸‹è½½Providerã€‚å½“æˆ‘ä»¬å¼€å‘Providerçš„æ—¶å€™ï¼Œå¸¸å¸¸éœ€è¦æ–¹ä¾¿çš„æµ‹è¯•ä¸´æ—¶Providerç‰ˆæœ¬ï¼Œè¿™ç§Providerè¿˜ # æ²¡æœ‰å…³è”ç‰ˆæœ¬å·ï¼Œä¹Ÿæ²¡æœ‰åœ¨Registryä¸­æ³¨å†ŒChencksum # ä¸ºäº†ç®€åŒ–å¼€å‘ï¼Œå¯ä»¥é…ç½®dev_overridesï¼Œå®ƒèƒ½è¦†ç›–æ‰€æœ‰é…ç½®çš„å®‰è£…æ–¹æ³• dev_overrides { \"hashicorp.com/edu/hashicups-pf\" = \"$(go env GOBIN)\" } } ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:2:4","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"5ã€init é…ç½®å·¥ä½œç›®å½•ï¼Œä¸ºä½¿ç”¨å…¶å®ƒå‘½ä»¤åšå¥½å‡†å¤‡ã€‚ Terraformå‘½ä»¤éœ€è¦åœ¨ä¸€ä¸ªç¼–å†™äº†Terraformé…ç½®æ–‡ä»¶çš„ç›®å½•ï¼ˆé…ç½®æ ¹ç›®å½•ï¼‰ä¸‹æ‰§è¡Œï¼Œå®ƒä¼šåœ¨æ­¤ç›®å½•ä¸‹å­˜å‚¨è®¾ç½®ã€ç¼“å­˜æ’ä»¶/æ¨¡å—ï¼Œä»¥åŠï¼ˆé»˜è®¤ä½¿ç”¨Localåç«¯æ—¶ï¼‰å­˜å‚¨çŠ¶æ€æ•°æ®ã€‚æ­¤ç›®å½•å¿…é¡»è¿›è¡Œåˆå§‹åŒ–ã€‚ åˆå§‹åŒ–åï¼Œä¼šç”Ÿæˆä»¥ä¸‹é¢å¤–ç›®å½•/æ–‡ä»¶ï¼š .terraformç›®å½•ï¼Œç”¨äºç¼“å­˜providerå’Œæ¨¡å— å¦‚æœä½¿ç”¨Localåç«¯ï¼Œä¿å­˜çŠ¶æ€çš„terraform.tfstateæ–‡ä»¶ã€‚å¦‚æœä½¿ç”¨å¤šå·¥ä½œåŒºï¼Œåˆ™æ˜¯terraform.tfstate.dç›®å½•ã€‚ å¯¹é…ç½®çš„æŸäº›å˜æ›´ï¼Œéœ€è¦é‡æ–°è¿è¡Œåˆå§‹åŒ–ï¼ŒåŒ…æ‹¬provideréœ€æ±‚çš„å˜æ›´ã€æ¨¡å—æº/ç‰ˆæœ¬çº¦æŸçš„å˜æ›´ã€åç«¯é…ç½®çš„å˜æ›´ã€‚éœ€è¦é‡æ–°åˆå§‹åŒ–æ—¶ï¼Œå…¶å®ƒå‘½ä»¤å¯èƒ½ä¼šæ— æ³•æ‰§è¡Œå¹¶æç¤ºä½ è¿›è¡Œåˆå§‹åŒ–ã€‚ å‘½ä»¤ terraform getå¯ä»¥ä»…ä»…ä¸‹è½½ä¾èµ–çš„æ¨¡å—ï¼Œè€Œä¸æ‰§è¡Œå…¶å®ƒinitå­ä»»åŠ¡ã€‚ è¿è¡Œ terraform init -upgradeä¼šå¼ºåˆ¶æ‹‰å–æœ€æ–°çš„ã€åŒ¹é…çº¦æŸçš„ç‰ˆæœ¬å¹¶æ›´æ–°ä¾èµ–é”æ–‡ä»¶ã€‚ ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:2:5","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"6ã€validate æ ¡éªŒé…ç½®æ˜¯å¦åˆæ³•ã€‚ ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:2:6","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"7ã€plan æ˜¾ç¤ºæ‰§è¡Œè®¡åˆ’ï¼Œå³å½“å‰é…ç½®å°†è¯·æ±‚ï¼ˆç»“åˆstateï¼‰å“ªäº›å˜æ›´ã€‚Terraformçš„æ ¸å¿ƒåŠŸèƒ½æ—¶åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤åŸºç¡€è®¾æ–½å¯¹è±¡ï¼Œä½¿åŸºç¡€è®¾æ–½çš„çŠ¶æ€å’Œå½“å‰é…ç½®åŒ¹é…ã€‚å½“æˆ‘ä»¬è¯´è¿è¡ŒTerraformæ—¶ï¼Œä¸»è¦æ˜¯æŒ‡plan/apply/destroyè¿™å‡ ä¸ªå‘½ä»¤ã€‚ terraform planå‘½ä»¤è¯„ä¼°å½“å‰é…ç½®ï¼Œç¡®å®šå…¶å£°æ˜çš„æ‰€æœ‰èµ„æºçš„æœŸæœ›çŠ¶æ€ã€‚ç„¶åæ¯”è¾ƒæ­¤æœŸæœ›çŠ¶æ€å’ŒçœŸå®åŸºç¡€è®¾æ–½çš„å½“å‰çŠ¶æ€ã€‚å®ƒä½¿ç”¨stateæ¥ç¡®å®šå“ªäº›çœŸå®åŸºç¡€è®¾æ–½å¯¹è±¡å’Œå£°æ˜èµ„æºçš„å¯¹åº”å…³ç³»ï¼Œå¹¶ä¸”ä½¿ç”¨providerçš„APIæŸ¥è¯¢æ¯ä¸ªèµ„æºçš„å½“å‰çŠ¶æ€ã€‚å½“ç¡®å®šåˆ°è¾¾æœŸæœ›çŠ¶æ€éœ€è¦æ‰§è¡Œå“ªäº›å˜æ›´åï¼ŒTerraformå°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ï¼Œå®ƒå¹¶ä¸ä¼šæ‰§è¡Œä»»ä½•å®é™…çš„å˜æ›´æ“ä½œã€‚ è®¡åˆ’æ¨¡å¼ planå‘½ä»¤æ”¯æŒä¸¤ç§å¤‡é€‰çš„å·¥ä½œæ¨¡å¼ï¼š é”€æ¯æ¨¡å¼ï¼šåˆ›å»ºä¸€ä¸ªè®¡åˆ’ï¼Œå…¶ç›®æ ‡æ˜¯é”€æ¯æ‰€æœ‰å½“å‰å­˜åœ¨äºé…ç½®ä¸­çš„è¿œç¨‹å¯¹è±¡ï¼Œç•™ä¸‹ä¸€ä¸ªç©ºç™½çš„stateã€‚å¯¹åº”é€‰é¡¹ -destroy ä»…åˆ·æ–°æ¨¡å¼ï¼šåˆ›å»ºä¸€ä¸ªè®¡åˆ’ï¼Œå…¶ç›®æ ‡ä»…ä»…æ˜¯æ›´æ–°stateå’Œæ ¹æ¨¡å—çš„è¾“å‡ºå€¼ï¼Œä»¥ä¾¿å’Œä»Terraformä¹‹å¤–å¯¹åŸºç¡€è®¾æ–½å¯¹è±¡çš„å˜æ›´åŒ¹é…ã€‚å¯¹åº”é€‰é¡¹ -refresh-only æŒ‡å®šè¾“å…¥å˜é‡ ä½¿ç”¨é€‰é¡¹ -var â€˜NAME=VALUEâ€™å¯ä»¥æŒ‡å®šè¾“å…¥å˜é‡ï¼Œè¯¥é€‰é¡¹å¯ä»¥ä½¿ç”¨å¤šæ¬¡ã€‚ ä½¿ç”¨é€‰é¡¹ -var-file=FILENAMEå¯ä»¥ä»æ–‡ä»¶è¯»å–è¾“å…¥å˜é‡ï¼ŒæŸäº›æ–‡ä»¶ä¼šè‡ªåŠ¨è¯»å– ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:2:7","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"8ã€apply åº”ç”¨æ‰§è¡Œè®¡åˆ’ï¼Œåˆ›å»ºã€æ›´æ–°è®¾æ–½å¯¹è±¡ã€‚ applyä¼šåšplançš„ä»»ä½•äº‹æƒ…ï¼Œå¹¶åœ¨å…¶åŸºç¡€ä¸Šï¼Œç›´æ¥æ‰§è¡Œå˜æ›´æ“ä½œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œapplyå³å¸­çš„æ‰§è¡Œä¸€æ¬¡planï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å·²ä¿å­˜çš„plan å‘½ä»¤æ ¼å¼ï¼š terraform apply [options] [plan file] è‡ªåŠ¨ç¡®è®¤ é€‰é¡¹ -auto-approveå¯ä»¥è‡ªåŠ¨ç¡®è®¤å¹¶æ‰§è¡Œæ‰€éœ€æ“ä½œï¼Œä¸éœ€è¦äººå·¥ç¡®è®¤ã€‚ ä½¿ç”¨å·²æœ‰è®¡åˆ’ å¦‚æœæŒ‡å®šplan fileå‚æ•°ï¼Œåˆ™è¯»å–å…ˆå‰ä¿å­˜çš„è®¡åˆ’å¹¶æ‰§è¡Œã€‚ è®¡åˆ’æ¨¡å¼ æ”¯æŒplanå‘½ä»¤ä¸­å…³äºè®¡åˆ’æ¨¡å¼çš„é€‰é¡¹ã€‚ ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:2:8","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"ä¸‰ã€TFè¯­è¨€ ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:3:0","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"1ã€å— é…ç½®æ–‡ä»¶ç”±è‹¥å¹²å—ï¼ˆBlockï¼‰ç»„æˆï¼Œå—çš„è¯­æ³•å¦‚ä¸‹ï¼š # Block header, which identifies a block \u003cBLOCK TYPE\u003e \"\u003cBLOCK LABEL\u003e\" \"\u003cBLOCK LABEL\u003e\" \"...\" { # Block body \u003cIDENTIFIER\u003e = \u003cEXPRESSION\u003e # Argument } å—æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒçš„ä½œç”¨å–å†³äºå—çš„ç±»å‹ã€‚å—å¸¸å¸¸ç”¨æ¥æè¿°æŸä¸ªèµ„æºçš„é…ç½®ã€‚ å–å†³äºå—çš„ç±»å‹ï¼Œæ ‡ç­¾çš„æ•°é‡å¯ä»¥æ˜¯0-Nä¸ªã€‚å¯¹äºresourceå—ï¼Œæ ‡ç­¾æ•°é‡ä¸ºä¸¤ä¸ªã€‚æŸäº›ç‰¹æ®Šçš„å—ï¼Œå¯èƒ½æ”¯æŒä»»æ„æ•°é‡çš„æ ‡ç­¾ã€‚æŸäº›å†…åµŒçš„å—ï¼Œä¾‹å¦‚network_interfaceï¼Œåˆ™ä¸æ”¯æŒæ ‡ç­¾ã€‚ å—ä½“ä¸­å¯ä»¥åŒ…å«è‹¥å¹²å‚æ•°ï¼ˆArgumentï¼‰ï¼Œæˆ–è€…å…¶å®ƒå†…åµŒçš„å—ã€‚å‚æ•°ç”¨äºå°†ä¸€ä¸ªè¡¨è¾¾å¼åˆ†é…åˆ°ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå¸¸å¸¸å¯¹åº”æŸä¸ªèµ„æºçš„ä¸€æ¡å±æ€§ã€‚è¡¨è¾¾å¼å¯ä»¥æ˜¯å­—é¢å€¼ï¼Œæˆ–è€…å¼•ç”¨å…¶å®ƒçš„å€¼ï¼Œæ­£æ˜¯è¿™ç§å¼•ç”¨è®©Terraformèƒ½å¤Ÿè¯†åˆ«èµ„æºä¾èµ–å…³ç³»ã€‚ ç›´æ¥ä½äºé…ç½®æ–‡ä»¶æœ€å¤–å±‚çš„å—ï¼Œå«åšé¡¶çº§å—ï¼ˆTop-level Blockï¼‰ï¼ŒTerraformæ”¯æŒæœ‰é™ç§ç±»çš„é¡¶çº§å—ã€‚å¤§éƒ¨åˆ†Terraformç‰¹æ€§ï¼Œä¾‹å¦‚resourceï¼ŒåŸºäºé¡¶çº§å—å®ç°ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š resource \"aws_vpc\" \"main\" { cidr_block = var.base_cidr_block } ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:3:1","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"2ã€æ•°æ®ç±»å‹ ç±»å‹ è¯´æ˜ string Unicodeå­—ç¬¦åºåˆ—ï¼ŒåŸºæœ¬å½¢å¼ â€œhelloâ€ number æ•°å­—ï¼Œå½¢å¼ 6.02 bool trueæˆ– false list/tuple ä¸€ç³»åˆ—çš„å€¼ï¼Œå½¢å¼ [â€œus-west-1aâ€, â€œus-west-1câ€] map/object é”®å€¼å¯¹ï¼Œå½¢å¼ {name = â€œMabelâ€, age = 52} ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:3:2","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"3ã€ç©ºå€¼ ç©ºå€¼ä½¿ç”¨ nullè¡¨ç¤ºã€‚ 4ã€å­—ç¬¦ä¸²å’Œæ¨¡æ¿ è½¬ä¹‰å­—ç¬¦ \\n æ¢è¡Œ \\r å›è½¦ \\t åˆ¶è¡¨ \\\" å¼•å· \\\\ åæ–œæ  \\uNNNN Unicodeå­—ç¬¦ \\UNNNNNNNN Unicodeå­—ç¬¦ æ³¨æ„ï¼Œåœ¨Heredocä¸­åæ–œæ ä¸ç”¨äºè½¬ä¹‰ï¼Œå¯ä»¥ä½¿ç”¨ï¼š $${ å­—ç¬¦ä¸²æ’å€¼æ ‡è®°${ %%{ æ¨¡æ¿æŒ‡ä»¤æ ‡è®°%{ æ”¯æŒunixé£æ ¼çš„å­—ç¬¦ä¸² block { value = \u003c\u003cEOT hello world EOT } block { value = \u003c\u003c-EOT hello world EOT } è¦å°†å¯¹è±¡è½¬æ¢ä¸ºJSONæˆ–YAMLï¼Œå¯ä»¥è°ƒç”¨å‡½æ•°ï¼š example = jsonencode({ a = 1 b = \"hello\" }) ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:3:3","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"5ã€æ“ä½œç¬¦ é€»è¾‘æ“ä½œç¬¦ï¼š ! \u0026\u0026 || ç®—æ•°æ“ä½œç¬¦ï¼š * / % + - æ¯”è¾ƒæ“ä½œç¬¦ï¼š \u003e, \u003e=, \u003c, \u003c= ==, != æ¡ä»¶è¡¨è¾¾å¼ condition ? true_val : false_val var.a != \"\" ? var.a : \"default-a\" forè¡¨è¾¾å¼ ä½¿ç”¨forè¡¨è¾¾å¼å¯ä»¥é€šè¿‡è½¬æ¢ä¸€ç§å¤æ‚ç±»å‹è¾“å‡ºï¼Œç”Ÿæˆå¦ä¸€ä¸ªå¤æ‚ç±»å‹ç»“æœã€‚è¾“å…¥ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¯ä»¥å¯¹åº”ç»“æœçš„0-1ä¸ªå…ƒç´ ã€‚ä»»ä½•è¡¨è¾¾å¼å¯ä»¥ç”¨äºè½¬æ¢ï¼Œä¸‹é¢æ˜¯ä½¿ç”¨upperå‡½æ•°å°†åˆ—è¡¨è½¬æ¢ä¸ºå¤§å†™ï¼š [for s in var.list : upper(s)] è¾“å…¥ç±»å‹ ä½œä¸ºforè¡¨è¾¾å¼çš„è¾“å…¥çš„ç±»å‹å¯ä»¥æ˜¯list / set / tuple / map / objectã€‚å¯ä»¥ä¸ºforå£°æ˜ä¸¤ä¸ªä¸´æ—¶ç¬¦å·ï¼Œå‰ä¸€ä¸ªè¡¨ç¤ºindexæˆ–keyï¼š [for k, v in var.map : length(k) + length(v)] ç»“æœç±»å‹ ç»“æœçš„ç±»å‹å–å†³äºåŒ…å›´forè¡¨è¾¾å¼çš„å®šç•Œç¬¦ï¼š [] è¡¨ç¤ºç”Ÿæˆçš„ç»“æœæ˜¯å…ƒç»„ {} è¡¨ç¤ºç”Ÿæˆçš„ç»“æœæ˜¯objectï¼Œä½ å¿…é¡»ä½¿ç”¨ =\u003eç¬¦å·ï¼š {for s in var.list : s =\u003e upper(s)} è¾“å…¥è¿‡æ»¤ åŒ…å«ä¸€ä¸ªå¯é€‰çš„ifå­å¥å¯ä»¥å¯¹è¾“å…¥å…ƒç´ è¿›è¡Œè¿‡æ»¤ï¼š [for s in var.list : upper(s) if s != \"\"] ç¤ºä¾‹ï¼š variable \"users\" { type = map(object({ is_admin = boolean })) } locals { admin_users = { for name, user in var.users : name =\u003e user if user.is_admin } } splatè¡¨è¾¾å¼ splatè¡¨è¾¾å¼æä¾›äº†æ›´ç®€å•è¯­æ³•ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä»£æ›¿forè¡¨è¾¾å¼ï¼š [for o in var.list : o.id] # ç­‰ä»·äº var.list[*].id [for o in var.list : o.interfaces[0].name] # ç­‰ä»·äº var.list[*].interfaces[0].name å¯é€‰objectå±æ€§ variable \"with_optional_attribute\" { type = object({ a = string # å¿…é¡»å±æ€§ b = optional(string) # å¯é€‰å±æ€§ }) } ç‰ˆæœ¬çº¦æŸ ç‰ˆæœ¬çº¦æŸæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²å€¼ï¼Œåœ¨å¼•ç”¨moduleã€ä½¿ç”¨provideræ—¶ï¼Œæˆ–è€…é€šè¿‡terraformå—çš„required_versionæ—¶ï¼Œéœ€è¦ç”¨åˆ°ç‰ˆæœ¬çº¦æŸï¼š # ç‰ˆæœ¬èŒƒå›´åŒºé—´ version = \"\u003e= 1.2.0, \u003c 2.0.0\" # æ“ä½œç¬¦ = ç­‰ä»·äºæ— æ“ä½œç¬¦ï¼Œé™å®šç‰¹å®šç‰ˆæœ¬ != æ’é™¤ç‰¹å®šç‰ˆæœ¬ \u003e \u003e= \u003c \u003c= é™åˆ¶ç‰ˆæœ¬èŒƒå›´ ~\u003e å…è®¸æœ€å³ä¾§çš„ç‰ˆæœ¬å·ç‰‡æ®µçš„å˜åŒ– depends_on è¯¥å…ƒå‚æ•°ç”¨äºå¤„ç†éšå«çš„èµ„æº/æ¨¡å—ä¾èµ–ï¼Œè¿™äº›ä¾èµ–æ— æ³•é€šè¿‡åˆ†æTerraformé…ç½®æ–‡ä»¶å¾—åˆ°ã€‚ä»0.13ç‰ˆæœ¬å¼€å§‹ï¼Œè¯¥å…ƒå‚æ•°å¯ç”¨äºæ¨¡å—ã€‚ä¹‹å‰çš„ç‰ˆæœ¬ä»…ä»…ç”¨äºèµ„æºã€‚ depends_onçš„å€¼æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶å…ƒç´ å…·å¿…é¡»æ˜¯å…¶å®ƒèµ„æºçš„å¼•ç”¨ï¼Œä¸æ”¯æŒä»»æ„è¡¨è¾¾å¼ã€‚ depends_onåº”å½“ä»…ä»…ç”¨ä½œæœ€åæ‰‹æ®µï¼Œé¿å…æ»¥ç”¨ã€‚ resource \"aws_iam_role\" \"example\" { name = \"example\" assume_role_policy = \"...\" } # è¿™ä¸ªç­–ç•¥å…è®¸è¿è¡Œåœ¨EC2ä¸­çš„å®ä¾‹è®¿é—®S3 API resource \"aws_iam_role_policy\" \"example\" { name = \"example\" role = aws_iam_role.example.name policy = jsonencode({ \"Statement\" = [{ \"Action\" = \"s3:*\", \"Effect\" = \"Allow\", }], }) } resource \"aws_iam_instance_profile\" \"example\" { # è¿™æ˜¯å¯ä»¥è‡ªåŠ¨åˆ†æå‡ºçš„ä¾èµ– role = aws_iam_role.example.name } resource \"aws_instance\" \"example\" { ami = \"ami-a1b2c3d4\" instance_type = \"t2.micro\" # è¿™æ˜¯å¯ä»¥è‡ªåŠ¨åˆ†æå‡ºçš„ä¾èµ–ï¼ŒåŒ…æ‹¬ä¼ é€’æ€§ä¾èµ– iam_instance_profile = aws_iam_instance_profile.example # å¦‚æœè¿™ä¸ªå®ä¾‹ä¸­çš„ç¨‹åºéœ€è¦è®¿é—®S3æ¥å£ï¼Œæˆ‘ä»¬éœ€è¦ç”¨å…ƒå‚æ•°æ˜¾å¼çš„å£°æ˜ä¾èµ– # ä»è€Œåˆ†é…ç­–ç•¥ depends_on = [ aws_iam_role_policy.example, ] } count é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªresourceå—ä»£è¡¨å•ä¸ªäº‘ä¸ŠåŸºç¡€è®¾æ–½å¯¹è±¡ã€‚å¦‚æœä½ æƒ³ç”¨ä¸€ä¸ªresourceå—ç”Ÿæˆå¤šä¸ªç±»ä¼¼çš„èµ„æºï¼Œå¯ä»¥ç”¨countæˆ–for_eachå‚æ•°ã€‚ è®¾ç½®äº†æ­¤å…ƒå‚æ•°çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¯ä»¥è®¿é—®åä¸º countçš„å˜é‡ï¼Œå®ƒå…·æœ‰å±æ€§ indexï¼Œä¸ºä»0å¼€å§‹è®¡æ•°çš„èµ„æºå®ä¾‹ç´¢å¼•ã€‚ ç¤ºä¾‹ï¼š resource \"aws_instance\" \"server\" { # åˆ›å»º4ä¸ªç±»ä¼¼çš„å®ä¾‹ count = 4 ami = \"ami-a1b2c3d4\" instance_type = \"t2.micro\" tags = { # å®ä¾‹çš„ç´¢å¼•ä½œä¸ºtagçš„ä¸€éƒ¨åˆ† Name = \"Server ${count.index}\" } } ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:3:4","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"for_each å¦‚æœèµ„æºçš„è§„æ ¼å‡ ä¹å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥ç”¨countï¼Œå¦åˆ™ï¼Œéœ€è¦ä½¿ç”¨æ›´åŠ çµæ´»çš„for_eachå…ƒå‚æ•°ã€‚ for_eachçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªæ˜ å°„æˆ–set(string)ï¼Œä½ å¯ä»¥åœ¨ä¸Šä¸‹æ–‡ä¸­è®¿é—® eachå¯¹è±¡ï¼Œ å®ƒå…·æœ‰ keyå’Œ valueä¸¤ä¸ªå±æ€§ï¼Œå¦‚æœfor_eachçš„å€¼æ˜¯é›†åˆï¼Œåˆ™keyå’Œvalueç›¸ç­‰ã€‚ç¤ºä¾‹ï¼š resource \"azurerm_resource_group\" \"rg\" { for_each = { a_group = \"eastus\" another_group = \"westus2\" } # å¯¹äºæ¯ä¸ªé”®å€¼å¯¹éƒ½ä¼šç”Ÿæˆazurerm_resource_groupèµ„æº name = each.key location = each.value } resource \"aws_iam_user\" \"the-accounts\" { # æ•°ç»„è½¬æ¢ä¸ºé›†åˆ for_each = toset( [\"Todd\", \"James\", \"Alice\", \"Dottie\"] ) name = each.key } variable \"vpcs\" { # è¿™é‡Œå®šä¹‰äº†mapç±»å‹çš„å˜é‡ï¼Œå¹¶ä¸”é™å®šäº†mapå…·æœ‰çš„é”® type = map(object({ cidr_block = string })) } # åˆ›å»ºå¤šä¸ªVPCèµ„æº resource \"aws_vpc\" \"example\" { for_each = var.vpcs cidr_block = each.value.cidr_block } # ä¸Šè¿°èµ„æºä½œä¸ºä¸‹é¢é‚£ä¸ªfor_eachçš„å€¼ # åˆ›å»ºå¯¹åº”æ•°é‡çš„ç½‘å…³èµ„æº resource \"aws_internet_gateway\" \"example\" { # ä¸ºæ¯ä¸ªVPCåˆ›å»ºä¸€ä¸ªç½‘å…³ # èµ„æºä½œä¸ºå€¼ for_each = aws_vpc.example # æ˜ å°„çš„å€¼ï¼Œåœ¨è¿™é‡Œæ˜¯å®Œæ•´çš„VPCå¯¹è±¡ vpc_id = each.value.id } # è¾“å‡ºæ‰€æœ‰VPC ID output \"vpc_ids\" { value = { for k, v in aws_vpc.example : k =\u003e v.id } # æ˜¾å¼ä¾èµ–ç½‘å…³èµ„æºï¼Œç¡®ä¿ç½‘å…³åˆ›å»ºåï¼Œè¾“å‡ºæ‰å¯ç”¨ depends_on = [aws_internet_gateway.example] } ","date":"2023-11-22","objectID":"/posts/2023-11-22-terraform-handbook/:3:5","tags":["tf","terraform"],"title":"Terraform handbook","uri":"/posts/2023-11-22-terraform-handbook/"},{"categories":["DevOps"],"content":"Timezone å‚è€ƒé“¾æ¥ï¼š https://bbs.huaweicloud.com/blogs/detail/243151 http://www.timeofdate.com/timezone/abbr/all ","date":"2023-11-20","objectID":"/posts/2023-11-20-timezone/:0:0","tags":["timezone","tz"],"title":"Timezone","uri":"/posts/2023-11-20-timezone/"},{"categories":["DevOps"],"content":"ä¸€ã€è®¾ç½®æ—¶åŒº timedatectl set-timezone Asia/Shanghai ","date":"2023-11-20","objectID":"/posts/2023-11-20-timezone/:1:0","tags":["timezone","tz"],"title":"Timezone","uri":"/posts/2023-11-20-timezone/"},{"categories":["DevOps"],"content":"äºŒã€æ—¶åŒºè¯¦ç»† ","date":"2023-11-20","objectID":"/posts/2023-11-20-timezone/:2:0","tags":["timezone","tz"],"title":"Timezone","uri":"/posts/2023-11-20-timezone/"},{"categories":["DevOps"],"content":"1ã€æ¦‚å¿µ â€‹ åœ¨ä»¥å‰å…¨çƒå›½å®¶éƒ½å¤„äºå†œä¸šç¤¾ä¼šçš„æ—¶å€™ï¼Œäººä»¬é€šè¿‡æ¯å¤©è§‚å¯Ÿå¤ªé˜³çš„ä½ç½®æ¥å†³å®šæ—¶é—´ï¼Œè¿™å°±ä½¿å¾—ä¸åŒç»åº¦çš„åœ°æ–¹æœ‰ä¸åŒçš„æ—¶é—´ã€‚å½“æ—¶äººä»¬æ—…è¡Œä¸»è¦é èµ°å’Œé©¬åŒ¹ï¼Œä¸åŒåœ°æ–¹æ—¶é—´ä¸ä¸€è‡´çš„é—®é¢˜æ²¡æœ‰é‚£ä¹ˆçªå‡ºã€‚ä½†æ˜¯åˆ°äº†åä¹ä¸–çºªéšç€ç«è½¦çš„å‘æ˜ï¼Œäººä»¬ä¸€å¤©æ—…è¡Œçš„è·ç¦»ä¸€ä¸‹å­å»¶é•¿äº†å¾ˆå¤šï¼Œåˆ°ä¸åŒçš„åœ°æ–¹å› æ­¤è¿«åˆ‡éœ€è¦ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•æŠŠå„ä¸ªåœ°æ–¹çš„æ—¶é—´ç»Ÿä¸€èµ·æ¥ã€‚1853å¹´8æœˆ12æ—¥ï¼Œç¾å›½ä¸œéƒ¨ç½—å¾·å²›å·ï¼Œä¸¤è¾†ç«è½¦è¿å¤´ç›¸æ’ï¼Œ14äººå› æ­¤æ­»äº¡ã€‚äº‹æ•…çš„åŸå› åœ¨ä»Šå¤©çœ‹æ¥éš¾ä»¥ç½®ä¿¡â€”â€”ä¸¤è½¦å·¥ç¨‹å¸ˆçš„æ‰‹è¡¨å·®äº†2åˆ†é’Ÿã€‚ 1863å¹´ï¼Œé¦–æ¬¡ä½¿ç”¨æ—¶åŒºçš„æ¦‚å¿µã€‚æ—¶åŒºé€šè¿‡è®¾ç«‹ä¸€ä¸ªåŒºåŸŸçš„æ ‡å‡†æ—¶é—´éƒ¨åˆ†åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ 1870å¹´ä»£åŠ æ‹¿å¤§é“è·¯å·¥ç¨‹å¸ˆå¼—è±æ˜é¦–æ¬¡æå‡ºå…¨ä¸–ç•ŒæŒ‰ç»Ÿä¸€æ ‡å‡†åˆ’åˆ†æ—¶åŒºã€‚ 1883å¹´11æœˆ18æ—¥ï¼Œç¾å›½é“è·¯éƒ¨é—¨æ­£å¼å®æ–½äº”ä¸ªæ—¶åŒºã€‚ 1884å¹´åç››é¡¿å­åˆçº¿å›½é™…ä¼šè®®æ­£å¼é€šè¿‡é‡‡çº³è¿™ç§æ—¶åŒºåˆ’åˆ†ï¼Œç§°ä¸ºä¸–ç•Œæ ‡å‡†æ—¶åˆ¶åº¦ã€‚å› æ­¤ï¼Œä¸–ç•Œæ ‡å‡†æ—¶åŒºçš„è¯ç”ŸåŒå…¶å®ƒå…¨çƒæ ‡å‡†ä¸€æ ·ä¹Ÿæ˜¯æœ‰ä¸€ä¸ªç¼“æ…¢çš„å‘å±•è¿‡ç¨‹ã€‚ ","date":"2023-11-20","objectID":"/posts/2023-11-20-timezone/:2:1","tags":["timezone","tz"],"title":"Timezone","uri":"/posts/2023-11-20-timezone/"},{"categories":["DevOps"],"content":"2ã€é€šç”¨åè¯è§£é‡Š æ—¶åŒº ï¼šæ—¶åŒºæ˜¯åœ°çƒä¸Šçš„åŒºåŸŸä½¿ç”¨åŒä¸€ä¸ªæ—¶é—´å®šä¹‰ã€‚ä»¥å‰ï¼Œäººä»¬é€šè¿‡è§‚å¯Ÿå¤ªé˜³çš„ä½ç½®ï¼ˆæ—¶è§’ï¼‰å†³å®šæ—¶é—´ï¼Œè¿™å°±ä½¿å¾—ä¸åŒç»åº¦çš„åœ°æ–¹çš„æ—¶é—´æœ‰æ‰€ä¸åŒï¼ˆåœ°æ–¹æ—¶ï¼‰ã€‚1863å¹´ï¼Œé¦–æ¬¡ä½¿ç”¨æ—¶åŒºçš„æ¦‚å¿µã€‚æ—¶åŒºé€šè¿‡è®¾ç«‹ä¸€ä¸ªåŒºåŸŸçš„æ ‡å‡†æ—¶é—´éƒ¨åˆ†åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä¸–ç•Œå„ä¸ªå›½å®¶ä½äºåœ°çƒä¸åŒä½ç½®ä¸Šï¼Œå› æ­¤ä¸åŒå›½å®¶ï¼Œç‰¹åˆ«æ˜¯ä¸œè¥¿è·¨åº¦å¤§çš„å›½å®¶æ—¥å‡ºã€æ—¥è½æ—¶é—´å¿…å®šæœ‰æ‰€åå·®ã€‚è¿™äº›åå·®å°±æ˜¯æ‰€è°“çš„æ—¶å·®ã€‚ æ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´ï¼š GMTï¼ˆGreenwich Mean Timeï¼‰æ˜¯æŒ‡ä½äºè‹±å›½ä¼¦æ•¦éƒŠåŒºçš„çš‡å®¶æ ¼æ—å°¼æ²»å¤©æ–‡å°çš„æ ‡å‡†æ—¶é—´ï¼Œå› ä¸ºæœ¬åˆå­åˆçº¿è¢«å®šä¹‰ä¸ºåœ¨é‚£é‡Œé€šè¿‡çš„ç»çº¿ã€‚ç”±äºåœ°çƒåœ¨å®ƒçš„æ¤­åœ†è½¨é“é‡Œçš„è¿åŠ¨é€Ÿåº¦ä¸å‡åŒ€ï¼Œåœ°çƒæ¯å¤©çš„è‡ªè½¬æ˜¯æœ‰äº›ä¸è§„åˆ™çš„ï¼Œè€Œä¸”æ­£åœ¨ç¼“æ…¢å‡é€Ÿã€‚æ‰€ä»¥ï¼Œæ ¼æ—å°¼æ²»æ—¶é—´å·²ç»ä¸å†è¢«ä½œä¸ºæ ‡å‡†æ—¶é—´ä½¿ç”¨ã€‚ ä¸–ç•Œåè°ƒæ—¶é—´ ï¼šUTCï¼ˆCoordinated Universal Timeï¼‰æ˜¯ç»è¿‡å¹³å‡å¤ªé˜³æ—¶(ä»¥æ ¼æ—å¨æ²»æ—¶é—´GMTä¸ºå‡†)ã€åœ°è½´è¿åŠ¨ä¿®æ­£åçš„æ–°æ—¶æ ‡ä»¥åŠä»¥ã€Œç§’ã€ä¸ºå•ä½çš„å›½é™…åŸå­æ—¶æ‰€ç»¼åˆç²¾ç®—è€Œæˆçš„æ—¶é—´ã€‚UTCæ¯”GMTæ¥å¾—æ›´åŠ ç²¾å‡†ã€‚å¯¹äºç°è¡Œè¡¨æ¬¾æ¥è¯´ï¼ŒGMTä¸UTCçš„åŠŸèƒ½ä¸ç²¾ç¡®åº¦æ˜¯æ²¡æœ‰å·®åˆ«çš„ã€‚ å¤æ—¥èŠ‚çº¦æ—¶é—´ ï¼šDSTï¼ˆDaylight Saving Timeï¼‰åˆç§°æ—¥å…‰èŠ‚çº¦æ—¶åˆ¶ï¼Œåœ¨è‹±å›½ç§°ä¸ºå¤ä»¤æ—¶é—´(Summer Time)ã€‚æ˜¯ä¸€ç§ä¸ºèŠ‚çº¦èƒ½æºè€Œäººä¸ºè§„å®šåœ°æ–¹æ—¶é—´çš„åˆ¶åº¦ï¼Œåœ¨è¿™ä¸€åˆ¶åº¦å®è¡ŒæœŸé—´æ‰€é‡‡ç”¨çš„ç»Ÿä¸€æ—¶é—´ç§°ä¸ºâ€œå¤ä»¤æ—¶é—´â€ã€‚ä¸€èˆ¬åœ¨å¤©äº®è¾ƒæ—©çš„å¤å­£äººä¸ºå°†æ—¶é—´è°ƒå¿«ä¸€å°æ—¶ï¼Œå¯ä»¥ä½¿äººæ—©èµ·æ—©ç¡ï¼Œå‡å°‘ç…§æ˜é‡ï¼Œä»¥å……åˆ†åˆ©ç”¨å…‰ç…§èµ„æºï¼Œä»è€ŒèŠ‚çº¦ç…§æ˜ç”¨ç”µã€‚å„ä¸ªé‡‡çº³å¤æ—¶åˆ¶çš„å›½å®¶è§„å®šä¸åŒã€‚ æ—¶åŒºè¡¨ç¤ºæ³• å¦‚æœæ—¶é—´æ˜¯ä»¥åè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰è¡¨ç¤ºï¼Œåˆ™åœ¨æ—¶é—´åé¢ç›´æ¥åŠ ä¸Šä¸€ä¸ªâ€œZâ€ï¼ˆä¸åŠ ç©ºæ ¼ï¼‰ã€‚â€œZâ€æ˜¯åè°ƒä¸–ç•Œæ—¶ä¸­0æ—¶åŒºçš„æ ‡å¿—ã€‚å› æ­¤ï¼Œâ€œ09:30 UTCâ€å°±å†™ä½œâ€œ09:30Zâ€æˆ–æ˜¯â€œ0930Zâ€ã€‚â€œ14:45:15 UTCâ€åˆ™ä¸ºâ€œ14:45:15Zâ€æˆ–â€œ144515Zâ€ã€‚UTCæ—¶é—´ä¹Ÿè¢«å«åšç¥–é²æ—¶é—´ï¼Œå› ä¸ºåœ¨åŒ—çº¦éŸ³æ ‡å­—æ¯ä¸­ç”¨â€œZuluâ€è¡¨ç¤ºâ€œZâ€ã€‚ UTCåç§»é‡ ï¼šUTCåç§»é‡æ˜¯åè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰å’Œç‰¹å®šåœ°ç‚¹çš„æ—¥æœŸä¸æ—¶é—´å·®å¼‚ï¼Œå…¶å•ä½ä¸ºå°æ—¶å’Œåˆ†é’Ÿã€‚å®ƒé€šå¸¸ä»¥ Â±[hh]:[mm]ã€Â±[hh][mm]ã€æˆ– Â±[hh]çš„æ ¼å¼æ˜¾ç¤ºã€‚æ‰€ä»¥ï¼Œå¦‚æœè¢«æè¿°çš„æ—¶é—´æ¯”UTCæ—©ä¸€å°æ—¶ï¼ˆä¾‹å¦‚æŸæ—çš„å†¬å­£æ—¶é—´ï¼‰ï¼ŒUTCçš„åç§»é‡å°†æ˜¯â€+01:00â€ã€â€+0100â€ã€æˆ–ç®€å•æ˜¾ç¤ºä¸ºâ€+01â€ã€‚ ","date":"2023-11-20","objectID":"/posts/2023-11-20-timezone/:2:2","tags":["timezone","tz"],"title":"Timezone","uri":"/posts/2023-11-20-timezone/"},{"categories":["DevOps"],"content":"3ã€linuxæ—¶åŒºå­˜å‚¨ä½ç½® ä¸ºäº†é¿å…å› å›½å®¶æˆ–åœ°åŒºé—®é¢˜ï¼Œä¸€èˆ¬æ—¶åŒºè®¾ç½®æ˜¯ä»¥åŸå¸‚ä¸ºæ ‡å‡† [root@sugar2 Asia]# pwd /usr/share/zoneinfo/Asia [root@sugar2 Asia]# ls Aden Baku Colombo Ho_Chi_Minh Kashgar Magadan Pyongyang Singapore Ujung_Pandang Almaty Bangkok Dacca Hong_Kong Kathmandu Makassar Qatar Srednekolymsk Ulaanbaatar Amman Barnaul Damascus Hovd Katmandu Manila Qostanay Taipei Ulan_Bator Anadyr Beirut Dhaka Irkutsk Khandyga Muscat Qyzylorda Tashkent Urumqi Aqtau Bishkek Dili Istanbul Kolkata Nicosia Rangoon Tbilisi Ust-Nera Aqtobe Brunei Dubai Jakarta Krasnoyarsk Novokuznetsk Riyadh Tehran Vientiane Ashgabat Calcutta Dushanbe Jayapura Kuala_Lumpur Novosibirsk Saigon Tel_Aviv Vladivostok Ashkhabad Chita Famagusta Jerusalem Kuching Omsk Sakhalin Thimbu Yakutsk Atyrau Choibalsan Gaza Kabul Kuwait Oral Samarkand Thimphu Yangon Baghdad Chongqing Harbin Kamchatka Macao Phnom_Penh Seoul Tokyo Yekaterinburg Bahrain Chungking Hebron Karachi Macau Pontianak Shanghai Tomsk Yerevan ","date":"2023-11-20","objectID":"/posts/2023-11-20-timezone/:2:3","tags":["timezone","tz"],"title":"Timezone","uri":"/posts/2023-11-20-timezone/"},{"categories":["DevOps"],"content":"ä¸‰ã€æ—¶åŒºç®€å†™ UTC GMT SGT æ–°åŠ å¡æ—¶é—´ Singaporeï¼ˆCSTæ—¶é—´æœ‰å¤šä¸ªåœ°åŒºç›¸åŒçš„åå­—ï¼‰ HKT é¦™æ¸¯æ—¶é—´ Hongkong Asia/Hong_Kong ","date":"2023-11-20","objectID":"/posts/2023-11-20-timezone/:3:0","tags":["timezone","tz"],"title":"Timezone","uri":"/posts/2023-11-20-timezone/"},{"categories":["Other"],"content":"ç”µè„‘ä¸€é”®æ¢å¤ï¼š Dellï¼š F12 â€“\u003e Supportassist OS Recovery MSIï¼šF3 Huawei: F10 Mac: é•¿æŒ‰ç”µæºé”®ç›´åˆ°Optionå‡ºç°ï¼ˆmç³»åˆ—macï¼‰ ","date":"2023-11-20","objectID":"/posts/2023-11-20-pc/:0:0","tags":["recovery","pc"],"title":"Recovery","uri":"/posts/2023-11-20-pc/"},{"categories":["Other"],"content":"ventoy ","date":"2023-11-20","objectID":"/posts/2023-11-20-pc/:1:0","tags":["recovery","pc"],"title":"Recovery","uri":"/posts/2023-11-20-pc/"},{"categories":["Other"],"content":"1ã€ä½¿ç”¨è¯´æ˜ ventoyä¸‹è½½é“¾æ¥ï¼š å®˜æ–¹ï¼šhttps://www.ventoy.net/cn/download.html å›½å†…é•œåƒï¼šhttps://mirror.nju.edu.cn/github-release/ventoy/Ventoy/ ä¸‹è½½è§£å‹åæ‰§è¡ŒVentoy2Disk https://www.ventoy.net/cn/doc_secure.html ","date":"2023-11-20","objectID":"/posts/2023-11-20-pc/:1:1","tags":["recovery","pc"],"title":"Recovery","uri":"/posts/2023-11-20-pc/"},{"categories":["DevOps"],"content":"Gitä½¿ç”¨è§„èŒƒ ä¸€ã€commit \u003ctype\u003e(scope): \u003csubject\u003e Header \u003cBLANK LINE\u003e \u003cbody\u003e Body \u003cBALNK LINE\u003e \u003cfooter\u003e Footer commit messageåŒ…å«Headerã€Bodyã€Footerä¸‰ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸­Headeræ˜¯å¿…é¡»çš„ Header ç”¨äºè¯´æ˜commitçš„ç±»å‹ featï¼šæ–°åŠŸèƒ½ fixï¼šBUGä¿®å¤ docsï¼šå¯¹æ–‡æ¡£æˆ–è¯´æ˜çš„æ”¹å˜ revertï¼šrevertä¹‹å‰çš„commit ","date":"2023-11-19","objectID":"/posts/2023-11-19-git-to-use/:0:0","tags":["git-branch","branch","dev"],"title":"Git-to-use","uri":"/posts/2023-11-19-git-to-use/"},{"categories":["DevOps"],"content":"äºŒã€åˆ†æ”¯å‘½åè§„èŒƒ masterï¼šé•¿æœŸåˆ†æ”¯ï¼Œä¸ç”Ÿäº§ç¯å¢ƒå‘å¸ƒçš„ä»£ç ä¿æŒåŒæ­¥ï¼Œæ¯ä¸ªcommitå°±æ˜¯ä¸€ä¸ªå‘å¸ƒç‰ˆæœ¬ developï¼šé•¿æœŸåˆ†æ”¯ï¼Œç”¨äºæ±‡æ€»å„åˆ†æ”¯ä»£ç  release-*ï¼šçŸ­æœŸåˆ†æ”¯ï¼Œæ¯ä¸ªç‰ˆæœ¬çš„æµ‹è¯•é˜¶æ®µå’Œå‘å¸ƒé˜¶æ®µæ—¶ä½¿ç”¨çš„åˆ†æ”¯ hotfix-*ï¼šçŸ­æœŸåˆ†æ”¯ï¼Œç”¨äºç”Ÿäº§ç¯å¢ƒå‘ç”Ÿé—®é¢˜æ—¶ï¼Œç”¨æ¥è§£å†³é—®é¢˜è€Œæ‹‰å–çš„åˆ†æ”¯ï¼Œè¿›è¡Œä¿®æ”¹bug feature-*ï¼šçŸ­æœŸåˆ†æ”¯ï¼Œç”¨äºå¼€å‘æ–°åŠŸèƒ½ æ ¼å¼ä¸ºï¼š release-6.5.0 hotfix-6.5.0 feature-6.5.0 feature-somesymbol ","date":"2023-11-19","objectID":"/posts/2023-11-19-git-to-use/:0:1","tags":["git-branch","branch","dev"],"title":"Git-to-use","uri":"/posts/2023-11-19-git-to-use/"},{"categories":["DevOps"],"content":"ä¸‰ã€ä¿æŠ¤åˆ†æ”¯ 1ã€masterå’Œdevelopä¸ºä¿æŠ¤åˆ†æ”¯ï¼ˆprotect branchï¼‰åªæœ‰ç®¡ç†å‘˜æœ‰æƒæ“ä½œã€‚ masteråˆ†æ”¯çš„æ¯ä¸€ä¸ªcommitå¯¹åº”ä¸€ä¸ªtagï¼ˆå‘å¸ƒçš„ç‰ˆæœ¬ï¼‰ 2ã€release-*åˆ†æ”¯æ—¶åœ¨developåˆå¹¶featureåˆ†æ”¯åï¼Œæ‹‰å‡ºçš„æ–°åˆ†æ”¯ï¼Œreleaseåˆ†æ”¯ä¸€å®šæ˜¯è¦ä»developæ‹‰å‡ºçš„æ–°åˆ†æ”¯ï¼Œç”¨æˆ·æµ‹è¯•ä»¥åŠpreä¸Šçº¿ï¼ŒæœŸé—´äº§ç”Ÿçš„bugéƒ½åœ¨releaseåˆ†æ”¯ä¸Šæäº¤ï¼Œåœ¨preä¸Šæµ‹è¯•é€šè¿‡åå†å‘å¸ƒç”Ÿäº§ç¯å¢ƒï¼Œç„¶åå†å°†releaseåˆ†æ”¯åˆå¹¶åˆ°developå’Œmasteråˆ†æ”¯ï¼Œå¹¶åœ¨masterä¸Šæ–°å»ºtag 3ã€hotfixåˆ†æ”¯æ˜¯ç”Ÿäº§ç¯å¢ƒå‘ç”Ÿé—®é¢˜ï¼Œä»masterçš„commitæˆ–tagä¸­æ‹‰å‡ºçš„åˆ†æ”¯ï¼Œç»è¿‡æµ‹è¯•å’Œå‘å¸ƒååˆ†åˆ«åˆåˆ°developå’Œmasteråˆ†æ”¯ã€‚ ","date":"2023-11-19","objectID":"/posts/2023-11-19-git-to-use/:0:2","tags":["git-branch","branch","dev"],"title":"Git-to-use","uri":"/posts/2023-11-19-git-to-use/"},{"categories":["DevOps"],"content":"SVN ","date":"2023-11-18","objectID":"/posts/2023-11-18-svn/:1:0","tags":["svn","vcs","dev"],"title":"svn","uri":"/posts/2023-11-18-svn/"},{"categories":["DevOps"],"content":"ä»‹ç»ï¼š ä»£ç ç‰ˆæœ¬ç®¡ç†å·¥å…· èƒ½è®°ä½æœ¬ç‰ˆä¿®æ”¹çš„æƒ…å†µ æŸ¥çœ‹æ‰€æœ‰çš„ä¿®æ”¹è®°å½• æ¢å¤åˆ°ä»»ä½•å†å²ç‰ˆæœ¬ æ¢å¤å·²ç»åˆ é™¤çš„æ–‡ä»¶ svnä¸gitç›¸æ¯”çš„ä¼˜åŠ¿: ä½¿ç”¨ç®€å•ã€ä¸Šæ‰‹å¿« ç›®å½•æƒé™æ§åˆ¶ï¼Œä¼ä¸šå®‰å…¨å¿…å¤‡ å­ç›®å½•checkoutï¼Œå‡å°‘ä¸å¿…è¦çš„æ–‡ä»¶æ£€å‡º ç¼ºç‚¹ï¼š svcæ˜¯é›†ä¸­åˆ°ç‰ˆæœ¬åº“æ§åˆ¶ï¼Œéœ€è¦ä¾èµ–äºä¸­å¤®ç‰ˆæœ¬æ§åˆ¶æœåŠ¡ï¼Œgitæ˜¯åˆ†å¸ƒå¼çš„ï¼Œå¯ä»¥ç‹¬ç«‹å·¥ä½œ ä¸»è¦åº”ç”¨: å¼€å‘äººå‘˜ä»£ç ç‰ˆæœ¬ç®¡ç† é‡è¦æ–‡ä»¶çš„å­˜å‚¨ å…³ç³»å†…éƒ¨æ–‡ä»¶å…±äº« windowså®¢æˆ·ç«¯ï¼šTortoiseSVN ","date":"2023-11-18","objectID":"/posts/2023-11-18-svn/:1:1","tags":["svn","vcs","dev"],"title":"svn","uri":"/posts/2023-11-18-svn/"},{"categories":["DevOps"],"content":"å®‰è£… åŸºäºcentos7 1ã€å®‰è£…svn [root@localhost ~]# yum -y install svn 2ã€åˆ›å»ºsvnç‰ˆæœ¬åº“ åˆ›å»ºç‰ˆæœ¬åº“ç›®å½• [root@localhost /]# mkdir -p /svn/repos [root@localhost /]# svnadmin create /svn/repos 3ã€é…ç½®svn [root@localhost repos]# ll total 8 drwxr-xr-x 2 root root 54 Jun 13 21:47 conf drwxr-sr-x 6 root root 233 Jun 13 21:47 db -r--r--r-- 1 root root 2 Jun 13 21:47 format drwxr-xr-x 2 root root 231 Jun 13 21:47 hooks drwxr-xr-x 2 root root 41 Jun 13 21:47 locks -rw-r--r-- 1 root root 229 Jun 13 21:47 README.txt 1ï¼‰confç›®å½• [root@localhost conf]# ll total 12 -rw-r--r-- 1 root root 1080 Jun 13 21:47 authz -rw-r--r-- 1 root root 309 Jun 13 21:47 passwd -rw-r--r-- 1 root root 3090 Jun 13 21:47 svnserve.conf authzï¼šè´Ÿè´£è´¦å·æƒé™çš„ç®¡ç†ï¼Œæ§åˆ¶è´¦å·æ˜¯å¦è¯»å†™æƒé™ passwdï¼šè´Ÿè´£è´¦å·å’Œå¯†ç çš„ç”¨æˆ·åå•ç®¡ç† svnserve.confï¼šsvnæœåŠ¡å™¨é…ç½®æ–‡ä»¶ 2ï¼‰authzé…ç½®æ–‡ä»¶ [root@localhost conf]# vim authz [repos:/] # / è¡¨ç¤ºæ ¹ç›®å½• ï¼Œæ—¢/svn/repos cccc = rw # rwè¡¨ç¤ºseialtç”¨æˆ·æ‹¥æœ‰è¯»å†™æƒé™ abc = rw # ç»„è®¾ç½® [groups] # harry_and_sally = harry,sally # harry_sally_and_joe = harry,sally,\u0026joe iso = zhang,wang test = li # [/foo/bar] # harry = rw # \u0026joe = r # * = [repos:/iso] jk = rw [repos:/data] @iso = rw # [repository:/baz/fuz] # @harry_and_sally = rw # * = r [repos:/] cccc = rw abc = rw 3ï¼‰passwdæ–‡ä»¶ [root@localhost conf]# vim passwd [users] # harry = harryssecret # sally = sallyssecret cccc = 123456 abc = 123 4ï¼‰svnserve.confæ–‡ä»¶ [root@localhost conf]# vim svnserve.conf [root@localhost conf]# vim svnserve.conf 19 anon-access = none 20 auth-access = write 27 password-db = passwd 34 authz-db = authz 39 realm = cccc anon-access = noneï¼šè¡¨ç¤ºç¦æ­¢åŒ¿åç”¨æˆ·è®¿é—®ã€‚ auth-access = writeï¼šè¡¨ç¤ºæˆæƒç”¨æˆ·æ‹¥æœ‰è¯»å†™æƒé™ã€‚ password-db = passswdï¼šæŒ‡å®šç”¨æˆ·åå£ä»¤æ–‡ä»¶ï¼Œå³ passwd æ–‡ä»¶ã€‚ authz-db = authzï¼šæŒ‡å®šæƒé™é…ç½®æ–‡ä»¶ï¼Œå³ authz æ–‡ä»¶ã€‚ realm = ccccï¼šæŒ‡å®šè®¤è¯åŸŸï¼Œå³/svn/reposç›®å½•ã€‚ 4ã€å¯åŠ¨svn [root@localhost conf]# svnserve -d -r /svn [root@localhost conf]# ps -ef | grep svn root 10923 1 0 22:49 ? 00:00:00 svnserve -d -r /repo root 10925 1396 0 22:49 pts/0 00:00:00 grep --color=auto svn [root@localhost conf]# ss -anpl | grep svn tcp LISTEN 0 7 *:3690 *:* users:((\"svnserve\",pid=10923,fd=3)) [root@localhost conf]# 5ã€è¿æ¥ [root@localhost conf]# svn co svn://127.0.0.1/repos Authentication realm: \u003csvn://127.0.0.1:3690\u003e /repos Password for 'root': Authentication realm: \u003csvn://127.0.0.1:3690\u003e /repos Username: cccc Password for 'cccc': ----------------------------------------------------------------------- ATTENTION! Your password for authentication realm: \u003csvn://127.0.0.1:3690\u003e /repos can only be stored to disk unencrypted! You are advised to configure your system so that Subversion can store passwords encrypted, if possible. See the documentation for details. You can avoid future appearances of this warning by setting the value of the 'store-plaintext-passwords' option to either 'yes' or 'no' in '/root/.subversion/servers'. ----------------------------------------------------------------------- Store password unencrypted (yes/no)? yes Checked out revision 0. [root@localhost conf]# 6ã€ä½¿ç”¨sasldbåŠ å¯†å¯†ç æ–‡ä»¶ è¯´æ˜ï¼šLinuxä¸‹ä½¿ç”¨svnserveçš„SASLè®¤è¯èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œsubversion1.5ä»¥ä¸Šçš„ç‰ˆæœ¬é»˜è®¤è£…äº†saslè®¤è¯ï¼Œè§£å†³svnserveå¯†ç æ–‡ä»¶passwdæ˜¯æ˜æ–‡çš„é—®é¢˜ï¼Œç”Ÿæˆä¸€ä¸ªsaslè®¤è¯çš„å¯†ç æ–‡ä»¶sasldbã€‚ 1ï¼‰ä¿®æ”¹conf/svnserve.confæ–‡ä»¶ [sasl] use-sasl = true min-encryption = 128 max-encryption = 256 æ³¨é‡Šï¼š# password-db = passwdè¿™è¡Œä¿æŒæ³¨é‡Šæ‰çš„çŠ¶æ€ï¼Œä¸ä½¿ç”¨passwdæ–‡ä»¶ã€‚å˜é‡ min-encryption å’Œ max-encryption æ§åˆ¶æœåŠ¡å™¨æ‰€éœ€è¦çš„åŠ å¯†å¼ºåº¦ã€‚è¦å®Œå…¨ç¦ç”¨åŠ å¯†ï¼Œå°±å°†è¿™ 2 ä¸ªå˜é‡çš„å€¼éƒ½è®¾ä¸º 0ã€‚è¦å¯ç”¨ç®€å•çš„æ•°æ®æ ¡éªŒ(ä¾‹å¦‚ï¼Œä¸ºäº†é˜²æ­¢ç¯¡æ”¹å’Œä¿è¯æ•°æ®çš„å®Œæ•´ï¼Œä¸åŠ å¯†)ï¼Œå°±å°†è¿™ 2 ä¸ªå€¼éƒ½è®¾ä¸º 1ã€‚å¦‚æœä½ æƒ³å…è®¸(ä½†ä¸å¼ºåˆ¶)åŠ å¯†ï¼Œå°†æœ€å°å€¼è®¾ä¸º 0ï¼Œæœ€å¤§å€¼è®¾ä¸ºä»»æ„ä½æ•°ã€‚è¦å¼ºåˆ¶åŠ å¯†ï¼Œå°†è¿™ 2 ä¸ªå€¼è®¾ä¸ºå¤§äº 1 çš„æ•°å­—ã€‚åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¦æ±‚å®¢æˆ·ç«¯è‡³å°‘è¿›è¡Œ 128 ä½åŠ å¯†ï¼Œä½†æ˜¯ä¸å¤§äº 256 ä½åŠ å¯†ã€‚ 2ï¼‰æ–°å»ºsvn.confæ–‡ä»¶ ä¸€èˆ¬æ”¾åœ¨/usr/Lib/sasl2æˆ–è€…/etc/sasl2ï¼Œå†…å®¹å¦‚ä¸‹ pwcheck_method: auxprop auxprop_plugin: sasldb sasldb_path: /svn/repo/cccc/sasldb mech_list: DIGEST-MD5 æ³¨é‡Šï¼špwcheck_methodæŒ‡æ˜æ£€æŸ¥çš„æ–¹æ³•ï¼Œè¿™é‡Œæ˜¯â€œauxprop â€ï¼Œè¿™ä¸ªpwcheck_methodè¿˜å¯¹åº”äº†å¦‚å¯åŠ¨ä¸€ä¸ªä»£ç†ä½œä¸ºè®¤è¯æœåŠ¡ç­‰æ–¹å¼ï¼Œè€Œç°åœ¨çš„æ„æ€å°±æ˜¯ä½¿ç”¨æœ¬æ–‡ä»¶è¯´çš„æ–¹å¼å»æ£€æŸ¥ã€‚ç„¶åæˆ‘ä»¬æŒ‡æ˜auxprop_pluginä¸ºsasldbï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶å­˜æ”¾ç”¨æˆ·åå¯†ç ï¼Œä¹Ÿå°±æ˜¯/home/svn/svnjiami/sasldb,å…¶å®ƒçš„è®¤è¯ä¿¡æ¯å­˜æ”¾pluginè¿˜æœ‰sqlå’Œldapdbã€‚è€Œmech_listæŒ‡æ˜äº†è®¤è¯ä¿¡æ¯ä¼ é€’æœºåˆ¶ã€‚ 3ï¼‰é‡å¯svn å¦‚æœ svnserve å·²ç»åœ¨è¿è¡Œï¼Œä½ éœ€è¦é‡å¯æœåŠ¡ï¼Œå¹¶ç¡®ä¿å®ƒè¯»å–äº†æ›´æ–°åçš„é…ç½®å‚æ•° killall svnserve //åœæ­¢svnserveæœåŠ¡ svnserve â€“d â€“r /svn/repos //å¯åŠ¨svnserveæœåŠ¡ 4ï¼‰åˆ›å»ºåŠ å¯†åçš„ç”¨æˆ·å’Œå¯†ç  saslpasswd2 -c -f /svn/repo/cccc/sasldb -u cccc cccc # â€“u [svnserve.confé‡Œé¢é…ç½®çš„realmåå­—] [username] -p \u003cpw //æ–°å»ºç”¨æˆ·ï¼Œå¯ä¿®æ”¹ç”¨æˆ·ç”¨","date":"2023-11-18","objectID":"/posts/2023-11-18-svn/:1:2","tags":["svn","vcs","dev"],"title":"svn","uri":"/posts/2023-11-18-svn/"},{"categories":["DevOps"],"content":"Git ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:0:0","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"ä¸€ã€gitåŸºæœ¬ä½¿ç”¨ ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:1:0","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"1ã€commit [root@node01 project]# git add 1.txt [root@node01 project]# git commit -m \"create new 1.txt\" [master (root-commit) 3e8ce87] create new 1.txt 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 1.txt ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:1:1","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"2ã€diffæ–‡ä»¶ [root@node01 project]# git diff 1.txt diff --git a/1.txt b/1.txt index e69de29..21d56a0 100644 --- a/1.txt +++ b/1.txt @@ -0,0 +1 @@ +1111111111111111 ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:1:2","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"3ã€ç‰ˆæœ¬å›é€€ åœ¨è¿›è¡Œç‰ˆæœ¬å›é€€æ—¶ï¼Œä½¿ç”¨HEADä»£è¡¨å½“å‰ç‰ˆæœ¬ï¼ŒHEAD^ ä»£è¡¨ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼ŒHEAD^^ä»£è¡¨ä¸Šä¸Šä¸ªç‰ˆæœ¬ï¼Œè¿˜å¯ä»¥ä½¿ç”¨HEAD~10ä»£è¡¨å‰10ä¸ªç‰ˆæœ¬ [root@node01 project]# git reset --hard HEAD^ HEAD is now at fdf9d68 add new 1111 [root@node01 project]# [root@node01 project]# cat 1.txt 1111111111111111 [root@node01 project]# ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ ¼å¼: [root@node01 project] git reset --hard \u003ccommit_id\u003e [root@node01 project]# git reflog 1.txt fdf9d68 HEAD@{0}: reset: moving to HEAD^ 996cc77 HEAD@{1}: commit: add new 222 fdf9d68 HEAD@{2}: commit: add new 1111 3e8ce87 HEAD@{3}: commit (initial): create new 1.txt [root@node01 project]# [root@node01 project]# git reset --hard 996cc77 ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:1:3","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"4ã€æ’¤é”€æ›´æ”¹ 1ï¼‰å¯¹äºå°šæœªæ·»åŠ åˆ°æš‚å­˜åŒºçš„ä¿®æ”¹ï¼Œå¯ç›´æ¥é€šè¿‡ç¼–è¾‘åŸæ–‡ä»¶æˆ–è€…ä½¿ç”¨git checkout -- \u003cfile\u003eçš„æ–¹å¼è¿›è¡Œæ’¤é”€ [root@node01 project]# git checkout -- 1.txt [root@node01 project]# git status # On branch master nothing to commit, working directory clean 2ï¼‰å¯¹äºå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œä½†è¿˜æ²¡æœ‰git commitçš„ä¿®æ”¹ï¼Œå¯ä½¿ç”¨git reset HEAD \u003cfile\u003eçš„æ–¹å¼æ’¤é”€ [root@node01 project]# vim 1.txt [root@node01 project]# git add 1.txt [root@node01 project]# git status # On branch master # Changes to be committed: # (use \"git reset HEAD \u003cfile\u003e...\" to unstage) # # modified: 1.txt # [root@node01 project]# git reset HEAD 1.txt Unstaged changes after reset: M 1.txt [root@node01 project]# git status # On branch master # Changes not staged for commit: # (use \"git add \u003cfile\u003e...\" to update what will be committed) # (use \"git checkout -- \u003cfile\u003e...\" to discard changes in working directory) # # modified: 1.txt # no changes added to commit (use \"git add\" and/or \"git commit -a\") [root@node01 project]# git checkout -- 1.txt [root@node01 project]# git status # On branch master nothing to commit, working directory clean [root@node01 project]# cat 1.txt 1111111111111111 22222222222222222 3333333333333 3ï¼‰å¯¹äºå·²ç»æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œå¹¶å·²ç»æäº¤çš„ä¿®æ”¹å¯é€šè¿‡git reset â€“hard \u003ccommit_id\u003eçš„æ–¹å¼è¿›è¡Œæ’¤é”€ [root@node01 project]# vim 1.txt [root@node01 project]# git add 1.txt [root@node01 project]# git commit -m \"add new 44444444\" [master 240af53] add new 44444444 1 file changed, 1 insertion(+) [root@node01 project]# git reflog 1.txt 240af53 HEAD@{0}: commit: add new 44444444 5424335 HEAD@{1}: commit: add new 333333 996cc77 HEAD@{2}: reset: moving to 996cc77 3e8ce87 HEAD@{3}: reset: moving to 3e8ce87 996cc77 HEAD@{4}: reset: moving to 996cc77 fdf9d68 HEAD@{5}: reset: moving to HEAD^ 996cc77 HEAD@{6}: commit: add new 222 fdf9d68 HEAD@{7}: commit: add new 1111 3e8ce87 HEAD@{8}: commit (initial): create new 1.txt [root@node01 project]# [root@node01 project]# [root@node01 project]# git reset --hard 5424335 HEAD is now at 5424335 add new 333333 ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:1:4","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"äºŒã€gité…ç½® ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:2:0","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"1ã€é…ç½®åŸºæœ¬ä¿¡æ¯ [root@localhost srv]# git config --global user.name 'sugar' [root@localhost srv]# git config --global user.email 't@local.com' [root@localhost srv]# git config --global color.ui true #é…ç½®æ˜¾ç¤ºçš„é¢œè‰²ï¼Œæ–¹ä¾¿çœ‹åˆ°æ›´æ”¹çš„ä¿¡æ¯ [root@localhost srv]# git config --global core.ignorecase false # é…ç½®å¤§å°å†™æ•æ„Ÿï¼Œgité»˜è®¤å¤§å°å†™ä¸æ•æ„Ÿ ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:2:1","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"2ã€gitconfigé…ç½®æ–‡ä»¶ [user] name = sugar email = t@local.com # signingkey = DCE96Cxxxxxxxxxxxxxxxxxxxxxxxx #[commit] # gpgsign = true # ~/github/ ç›®å½•ä¸‹çš„é¡¹ç›®ä½¿ç”¨~/github/.gitconfigä¸‹çš„gitconfigé…ç½®æ–‡ä»¶ [includeIf \"gitdir:~/github/\"] path = ~/github/.gitconfig [includeIf \"gitdir:~/my-prod/\"] path = ~/my-prod/.gitconfig [init] defaultBranch = main [color] ui = true [alias] lg = log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)\u003c%an\u003e%Creset' --abbrev-commit [alias] # status st = status ss = status --short --branch # stash sh = stash shp = stash pop shl = stash list shs = stash save sha = stash apply std = stash drop # branch br = branch bra = branch -a brm = branch -m co = checkout cob = checkout -b sw = switch swc = switch -c # remote ra = remote add rao = remote add origin ru = remote set-url ruo = remote set-url origin rv = remote -v # fetch fe = fetch fep = fetch -p fo = fetch origin fop = fetch origin -p # merge mr = merge mnc = merge --no-commit # msq = merge --squash # commit cm = commit -m # config user and mail user = config user.name mail = config user.email [url \"git@github.com:username\"] insteadOf = https://github.com/username # å¼ºåˆ¶httpsè½¬sshåè®® [url \"ssh://git@local.com/\"] insteadOf = https://local.com/ [core] excludesfile = ~/.gitignore_global autocrlf = input quotepath = false ignorecase = false editor = vim # sshCommand = ssh -i ~/.ssh/id_rsa -o IdentitiesOnly=yes -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no [i18n \"commit\"] encoding = utf-8 [i18n] logoutputencoding = utf-8 [http \"https://github.com\"] proxy = socks5://127.0.0.1:8888 [http] proxy = http://127.0.0.1:8889 [https] proxy = http://127.0.0.1:8889 ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:2:2","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"3ã€windowsä¸Šç»ˆç«¯æ‰“å¼€å‡ºç°ä¹±ç  cmdé…ç½® git config --global core.quotepath false git config --global gui.encoding utf-8 git config --global i18n.commit.encoding utf-8 git config --global i18n.logoutputencoding utf-8 # bash ç¯å¢ƒä¸‹ export LESSCHARSET=utf-8 # cmdç¯å¢ƒä¸‹ï¼š set LESSCHARSET=utf-8 powershellé…ç½® git config --global core.quotepath false git config --global gui.encoding utf-8 git config --global i18n.commit.encoding utf-8 git config --global i18n.logoutputencoding utf-8 $env:LESSCHARSET='utf-8' git bash sugar@sugar MINGW64 /e/Desktop/company/github (master) $ cat /etc/bash.bashrc alias ls='ls -F --color --show-control-chars' NOW_DIR=\"E:\\Desktop\" cd ${NOW_DIR} export LESSCHARSET=utf-8 ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:2:3","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"ä¸‰ã€åˆ†æ”¯ç®¡ç† gitç‰ˆæœ¬åº“æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯è¿è¡Œåœ¨åˆ†æ”¯ä¸Šï¼Œgitä»“åº“åˆ›å»ºæ—¶ä¼šå»ºç«‹é»˜è®¤çš„åˆ†æ”¯ï¼Œåç§°ä¸ºmasterï¼›æ‰€æœ‰çš„æ“ä½œéƒ½åœ¨masteråˆ†æ”¯ä¸Šè¿›è¡Œ åœ¨å¯¹ç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶è¿›è¡Œæ“ä½œæ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸åŒçš„åˆ†æ”¯ï¼Œä¸åŒçš„æ“ä½œè¿è¡Œåœ¨ä¸åŒçš„åˆ†æ”¯ä¸Šï¼Œä¸åŒåˆ†æ”¯ä¸Šçš„æ“ä½œä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œæ“ä½œè¿›è¡Œå®Œæˆåï¼Œå¯ä»¥åˆå¹¶ä¸åŒåˆ†æ”¯ä¸Šçš„æ“ä½œ ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:3:0","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"1ã€åˆ›å»ºåˆ†æ”¯ [root@node01 project]# git checkout -b game Switched to a new branch 'game' [root@node01 project]# [root@node01 project]# git branch dev * game master 1ï¼‰è¿œç¨‹chekoutåˆ°æœ¬åœ° [root@node01 project]# git checkout origin/develop -b develop 2ï¼‰åˆ é™¤åˆ†æ”¯ # åˆ é™¤æœ¬åœ°åˆ†æ”¯ [root@node01 project]# git branch -d release-1.1.0 # å¼ºåˆ¶åˆ é™¤ [root@node01 project]# git branch -D release-1.1.0 # åˆ é™¤è¿œç¨‹åˆ†æ”¯ [root@node01 project]# git push origin --delete release-1.1.0 æˆ–è€… [root@node01 project]# git push origin :release-1.1.0 3ï¼‰æ ¹æ®hashå€¼è¿›è¡Œcheckout git checkout d21a8c517ca3xxxxxxxxxxxxxxxxxxxxxxxxxxx 4ï¼‰åˆ†æ”¯åˆå¹¶ åˆ‡æ¢åˆ°å‡†å¤‡åˆå¹¶åçš„åˆ†æ”¯ï¼Œåˆå¹¶å…¶ä»–åˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ [root@node01 project]# git merge dev Updating bb6fb7a..d83dae8 Fast-forward 1.txt | 2 ++ 1 file changed, 2 insertions(+) ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:3:1","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"å››ã€tagç®¡ç† æ‰“æ ‡ç­¾ï¼Œç”¨äºä»“åº“æŸä¸ªæäº¤æ‰“ä¸Šæ ‡ç­¾ï¼Œä»¥è¡¨ç¤ºå…¶ç‰¹æ®Šæ€§ã€‚æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„æ˜¯äººä»¬ä¼šä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æ¥æ ‡è®°å‘å¸ƒç»“ç‚¹ï¼ˆ v1.0 ã€ v2.0 ç­‰ç­‰ï¼‰ 1ã€æŸ¥çœ‹æœ¬åœ°å·²æœ‰æ ‡ç­¾ [root@localhost github_web]# git tag 4.101.0 4.103.0 4.103.1 åˆ—å‡ºæ‰€æœ‰æ ‡ç­¾ -læˆ–è€…--listï¼ŒæŒ‡å®šæŸäº›æäº¤ä¿¡æ¯-l \"v4.4*\" 2ã€åˆ›å»ºtag Git æ”¯æŒä¸¤ç§æ ‡ç­¾ï¼š è½»é‡æ ‡ç­¾ï¼ˆlightweightï¼‰ é™„æ³¨æ ‡ç­¾ï¼ˆannotatedï¼‰ã€‚ è½»é‡æ ‡ç­¾å¾ˆåƒä¸€ä¸ªä¸ä¼šæ”¹å˜çš„åˆ†æ”¯â€”â€”å®ƒåªæ˜¯æŸä¸ªç‰¹å®šæäº¤çš„å¼•ç”¨ã€‚ è€Œé™„æ³¨æ ‡ç­¾æ˜¯å­˜å‚¨åœ¨ Git æ•°æ®åº“ä¸­çš„ä¸€ä¸ªå®Œæ•´å¯¹è±¡ï¼Œ å®ƒä»¬æ˜¯å¯ä»¥è¢«æ ¡éªŒçš„ï¼Œå…¶ä¸­åŒ…å«æ‰“æ ‡ç­¾è€…çš„åå­—ã€ç”µå­é‚®ä»¶åœ°å€ã€æ—¥æœŸæ—¶é—´ï¼Œ æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªæ ‡ç­¾ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ GNU Privacy Guard ï¼ˆGPGï¼‰ç­¾åå¹¶éªŒè¯ã€‚ é€šå¸¸ä¼šå»ºè®®åˆ›å»ºé™„æ³¨æ ‡ç­¾ï¼Œè¿™æ ·ä½ å¯ä»¥æ‹¥æœ‰ä»¥ä¸Šæ‰€æœ‰ä¿¡æ¯ã€‚ä½†æ˜¯å¦‚æœä½ åªæ˜¯æƒ³ç”¨ä¸€ä¸ªä¸´æ—¶çš„æ ‡ç­¾ï¼Œ æˆ–è€…å› ä¸ºæŸäº›åŸå› ä¸æƒ³è¦ä¿å­˜è¿™äº›ä¿¡æ¯ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ç”¨è½»é‡æ ‡ç­¾ã€‚ é™„å±æ ‡ç­¾ï¼š git tag -a v1.4 -m \"my version 1.4\" æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ git show v1.4 è¾“å‡ºæ˜¾ç¤ºäº†æ‰“æ ‡ç­¾è€…çš„ä¿¡æ¯ã€æ‰“æ ‡ç­¾çš„æ—¥æœŸæ—¶é—´ã€é™„æ³¨ä¿¡æ¯ï¼Œç„¶åæ˜¾ç¤ºå…·ä½“çš„æäº¤ä¿¡æ¯ã€‚ è½»é‡æ ‡ç­¾: å¦ä¸€ç§ç»™æäº¤æ‰“æ ‡ç­¾çš„æ–¹å¼æ˜¯ä½¿ç”¨è½»é‡æ ‡ç­¾ã€‚ è½»é‡æ ‡ç­¾æœ¬è´¨ä¸Šæ˜¯å°†æäº¤æ ¡éªŒå’Œå­˜å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­â€”â€”æ²¡æœ‰ä¿å­˜ä»»ä½•å…¶ä»–ä¿¡æ¯ã€‚ åˆ›å»ºè½»é‡æ ‡ç­¾ï¼Œä¸éœ€è¦ä½¿ç”¨ -aã€-s æˆ– -m é€‰é¡¹ï¼Œåªéœ€è¦æä¾›æ ‡ç­¾åå­—ï¼š $ git tag v1.4-lw $ git tag v0.1 v1.3 v1.4 è¿™æ—¶ï¼Œå¦‚æœåœ¨æ ‡ç­¾ä¸Šè¿è¡Œ git showï¼Œä½ ä¸ä¼šçœ‹åˆ°é¢å¤–çš„æ ‡ç­¾ä¿¡æ¯ã€‚ å‘½ä»¤åªä¼šæ˜¾ç¤ºå‡ºæäº¤ä¿¡æ¯ï¼š $ git show v1.4-lw commit ca82a6dff817ec66f44342007202690a93763949 Author: Scott Chacon \u003ct@local.com\u003e Date: Mon Mar 17 21:52:11 2008 -0700 changed the version number åæœŸæ‰“æ ‡ç­¾ git tag -a v1.2 9fceb02 å…±äº«æ ‡ç­¾ é»˜è®¤æƒ…å†µä¸‹ï¼Œgit push å‘½ä»¤å¹¶ä¸ä¼šä¼ é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“æœåŠ¡å™¨ä¸Šã€‚ åœ¨åˆ›å»ºå®Œæ ‡ç­¾åä½ å¿…é¡»æ˜¾å¼åœ°æ¨é€æ ‡ç­¾åˆ°å…±äº«æœåŠ¡å™¨ä¸Šã€‚ è¿™ä¸ªè¿‡ç¨‹å°±åƒå…±äº«è¿œç¨‹åˆ†æ”¯ä¸€æ ·â€”â€”ä½ å¯ä»¥è¿è¡Œ git push origin \u003ctagname\u003eã€‚ $ git push origin v1.5 Counting objects: 14, done. Delta compression using up to 8 threads. Compressing objects: 100% (12/12), done. Writing objects: 100% (14/14), 2.05 KiB | 0 bytes/s, done. Total 14 (delta 3), reused 0 (delta 0) To git@github.com:schacon/simplegit.git * [new tag] v1.5 -\u003e v1.5 å¦‚æœæƒ³è¦ä¸€æ¬¡æ€§æ¨é€å¾ˆå¤šæ ‡ç­¾ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¸¦æœ‰ --tags é€‰é¡¹çš„ git push å‘½ä»¤ã€‚ è¿™å°†ä¼šæŠŠæ‰€æœ‰ä¸åœ¨è¿œç¨‹ä»“åº“æœåŠ¡å™¨ä¸Šçš„æ ‡ç­¾å…¨éƒ¨ä¼ é€åˆ°é‚£é‡Œã€‚ $ git push origin --tags Counting objects: 1, done. Writing objects: 100% (1/1), 160 bytes | 0 bytes/s, done. Total 1 (delta 0), reused 0 (delta 0) To git@github.com:schacon/simplegit.git * [new tag] v1.4 -\u003e v1.4 * [new tag] v1.4-lw -\u003e v1.4-lw 3ã€åˆ é™¤æ ‡ç­¾ è¦åˆ é™¤æ‰ä½ æœ¬åœ°ä»“åº“ä¸Šçš„æ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ git tag -d \u003ctagname\u003eã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ é™¤ä¸€ä¸ªè½»é‡æ ‡ç­¾ï¼š $ git tag -d v1.4-lw Deleted tag 'v1.4-lw' (was e7d5add) æ³¨æ„ä¸Šè¿°å‘½ä»¤å¹¶ä¸ä¼šä»ä»»ä½•è¿œç¨‹ä»“åº“ä¸­ç§»é™¤è¿™ä¸ªæ ‡ç­¾ï¼Œä½ å¿…é¡»ç”¨ git push \u003cremote\u003e :refs/tags/\u003ctagname\u003e æ¥æ›´æ–°ä½ çš„è¿œç¨‹ä»“åº“ï¼š æ–¹æ³•ä¸€ï¼šgit push \u003cremote\u003e :refs/tags/\u003ctagname\u003e $ git push origin :refs/tags/v1.4-lw To /git@github.com:username/project.git - [deleted] v1.4-lw ä¸Šé¢è¿™ç§æ“ä½œçš„å«ä¹‰æ˜¯ï¼Œå°†å†’å·å‰é¢çš„ç©ºå€¼æ¨é€åˆ°è¿œç¨‹æ ‡ç­¾åï¼Œä»è€Œé«˜æ•ˆåœ°åˆ é™¤å®ƒã€‚ æ–¹æ³•äºŒï¼šç›´æ¥åˆ é™¤è¿œç¨‹æ ‡ç­¾ $ git push origin --delete \u003ctagname\u003e 4ã€æ£€å‡ºæ ‡ç­¾ æ£€å‡ºæ ‡ç­¾ä¸ºä¸€ä¸ªåˆ†æ”¯ï¼Œæ ¼å¼ä¸ºgit checkout -b branch_name tag_name git checkout -b version2 v2.0.0 5ã€.git ç›®å½• â”œâ”€â”€ HEAD â”œâ”€â”€ branches â”œâ”€â”€ config â”œâ”€â”€ description â”œâ”€â”€ hooks â”‚ â”œâ”€â”€ pre-commit.sample â”‚ â”œâ”€â”€ pre-push.sample â”‚ â””â”€â”€ ... â”œâ”€â”€ info â”‚ â””â”€â”€ exclude â”œâ”€â”€ objects â”‚ â”œâ”€â”€ info â”‚ â””â”€â”€ pack â””â”€â”€ refs â”œâ”€â”€ heads â””â”€â”€ tags config ï¼ˆé…ç½®ï¼‰è¯¥æ–‡ä»¶åŒ…å«ä½ çš„ä»“åº“é…ç½®ï¼Œæ¯”å¦‚è¿œç¨‹çš„ url ï¼Œä½ çš„é‚®ç®±å’Œç”¨æˆ·åç­‰ã€‚æ¯æ¬¡ä½ åœ¨æ§åˆ¶å°ä½¿ç”¨ git configâ€¦ éƒ½ä¼šå¯¹è¿™é‡Œäº§ç”Ÿå½±å“ã€‚ descriptionï¼ˆæè¿°ï¼‰ä¾› gitweb ( github çš„ä¸€ç§å‰èº«) ä½¿ç”¨ï¼Œæ˜¾ç¤ºä»“åº“çš„æè¿°ã€‚ hooks (é’©å­)è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç‰¹æ€§ã€‚ Git æä¾›äº†ä¸€å¥—è„šæœ¬ï¼Œå¯ä»¥åœ¨æ¯ä¸ªæœ‰æ„ä¹‰çš„ Git é˜¶æ®µè‡ªåŠ¨è¿è¡Œã€‚è¿™äº›è¢«ç§°ä¸ºé’©å­çš„è„šæœ¬å¯ä»¥åœ¨æäº¤ (commit)ã€å˜åŸº (rebase)ã€æ‹‰å– ( pull ) æ“ä½œçš„å‰åè¿è¡Œã€‚è„šæœ¬å‘½é¢„ç¤ºç€å®ƒçš„æ‰§è¡Œæ—¶æœºã€‚å¦‚æˆ‘ä»¬å¯ä»¥ç¼–å†™ pre-push çš„ä½œä¸ºé’©å­ï¼Œè¿›è¡Œæ¨é€ä»£ç å‰çš„æ£€æŸ¥ã€‚ info (ä¿¡æ¯)ä½ å¯ä»¥å°†ä¸æƒ³è¢« git ç®¡ç†çš„æ–‡ä»¶è®°å½•åˆ° .gitignore æ–‡ä»¶ä¸­ã€‚æ’é™¤æ–‡ä»¶çš„æ„æ€æ˜¯ä¸æƒ³å…±äº«è¿™ä¸ªæ–‡ä»¶ã€‚ä¾‹å¦‚ä½ ä¸æƒ³å…±äº«ä½ çš„ IDE è‡ªå®šä¹‰é…ç½®ï¼Œå°†å…¶æ·»åŠ åˆ° .gitignore æ–‡ä»¶ä¸­å³å¯ã€‚ ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:4:0","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"äº”ã€cherry-pick å‚è€ƒï¼šhttps://www.ruanyifeng.com/blog/2020/04/git-cherry-pick.html å¯¹äºå¤šåˆ†æ”¯çš„ä»£ç åº“ï¼Œå°†ä»£ç ä»ä¸€ä¸ªåˆ†æ”¯è½¬ç§»åˆ°å¦ä¸€ä¸ªåˆ†æ”¯æ˜¯å¸¸è§éœ€æ±‚ã€‚ è¿™æ—¶åˆ†ä¸¤ç§æƒ…å†µã€‚ä¸€ç§æƒ…å†µæ˜¯ï¼Œä½ éœ€è¦å¦ä¸€ä¸ªåˆ†æ”¯çš„æ‰€æœ‰ä»£ç å˜åŠ¨ï¼Œé‚£ä¹ˆå°±é‡‡ç”¨åˆå¹¶ï¼ˆgit mergeï¼‰ã€‚å¦ä¸€ç§æƒ…å†µæ˜¯ï¼Œä½ åªéœ€è¦éƒ¨åˆ†ä»£ç å˜åŠ¨ï¼ˆæŸå‡ ä¸ªæäº¤ï¼‰ï¼Œè¿™æ—¶å¯ä»¥é‡‡ç”¨ Cherry pickã€‚ 1ã€åŸºæœ¬è¯­æ³• git cherry-pickå‘½ä»¤çš„ä½œç”¨ï¼Œå°±æ˜¯å°†æŒ‡å®šçš„æäº¤ï¼ˆcommitï¼‰åº”ç”¨äºå…¶ä»–åˆ†æ”¯ã€‚ $ git cherry-pick \u003ccommitHash\u003e ä¸Šé¢å‘½ä»¤å°±ä¼šå°†æŒ‡å®šçš„æäº¤commitHashï¼Œåº”ç”¨äºå½“å‰åˆ†æ”¯ã€‚è¿™ä¼šåœ¨å½“å‰åˆ†æ”¯äº§ç”Ÿä¸€ä¸ªæ–°çš„æäº¤ï¼Œå½“ç„¶å®ƒä»¬çš„å“ˆå¸Œå€¼ä¼šä¸ä¸€æ ·ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œä»£ç ä»“åº“æœ‰masterå’Œfeatureä¸¤ä¸ªåˆ†æ”¯ã€‚ a - b - c - d Master \\ e - f - g Feature ç°åœ¨å°†æäº¤fåº”ç”¨åˆ°masteråˆ†æ”¯ã€‚ # åˆ‡æ¢åˆ° master åˆ†æ”¯ $ git checkout master # Cherry pick æ“ä½œ $ git cherry-pick f ä¸Šé¢çš„æ“ä½œå®Œæˆä»¥åï¼Œä»£ç åº“å°±å˜æˆäº†ä¸‹é¢çš„æ ·å­ã€‚ a - b - c - d - f Master \\ e - f - g Feature ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œmasteråˆ†æ”¯çš„æœ«å°¾å¢åŠ äº†ä¸€ä¸ªæäº¤fã€‚ git cherry-pickå‘½ä»¤çš„å‚æ•°ï¼Œä¸ä¸€å®šæ˜¯æäº¤çš„å“ˆå¸Œå€¼ï¼Œåˆ†æ”¯åä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¡¨ç¤ºè½¬ç§»è¯¥åˆ†æ”¯çš„æœ€æ–°æäº¤ã€‚ $ git cherry-pick feature ä¸Šé¢ä»£ç è¡¨ç¤ºå°†featureåˆ†æ”¯çš„æœ€è¿‘ä¸€æ¬¡æäº¤ï¼Œè½¬ç§»åˆ°å½“å‰åˆ†æ”¯ã€‚ æ“ä½œç¤ºä¾‹ï¼š [sugar@centos-7 git-test]$ git log -1 commit dcf3a215fd6ba3288ad21584d2112bdab5a713b4 Author: sugar \u003ccccc@gmail.com\u003e Date: Sun Sep 12 14:29:26 2021 +0800 feat: v1 version 1s add [sugar@centos-7 git-test]$ git checkout master Switched to branch 'master' [sugar@centos-7 git-test]$ git log commit 31da420cc2d2ae6094f88e368a72f0353541d89f Author: sugar \u003ccccc@gmail.com\u003e Date: Sun Sep 12 14:25:43 2021 +0800 feat: ç¬¬ä¸€æ­¤å¢åŠ  [sugar@centos-7 git-test]$ git cherry-pick dcf3a215fd6ba3288ad21584d2112bdab5a713b4 [master fa78bb0] feat: v1 version 1s add 1 file changed, 2 insertions(+), 1 deletion(-) [sugar@centos-7 git-test]$ ls cccc.txt [sugar@centos-7 git-test]$ git log -1 commit fa78bb090d3221ba2ff9cae59efa1f8691677115 Author: sugar \u003ccccc@gmail.com\u003e Date: Sun Sep 12 14:29:26 2021 +0800 feat: v1 version 1s add 2ã€è½¬ç§»å¤šä¸ªcommit Cherry pick æ”¯æŒä¸€æ¬¡è½¬ç§»å¤šä¸ªæäº¤ [sugar@centos-7 git-test]$ git cherry-pick \u003cHashA\u003e \u003cHashB\u003e è¿ç»­æäº¤å¤šä¸ªcommit # æäº¤Aåˆ°Bçš„commitï¼Œä½†ä¸åŒ…å«Aï¼›æäº¤Aå¿…é¡»æ—©äºæäº¤Bï¼Œå¦åˆ™å‘½ä»¤å°†å¤±è´¥ï¼Œä½†ä¸ä¼šæŠ¥é”™ã€‚ [sugar@centos-7 git-test]$ git cherry-pick A..B # æäº¤Aåˆ°Bçš„commitï¼ŒåŒ…å«A [sugar@centos-7 git-test]$ git cherry-pick A^..B 3ã€å‚æ•° git cherry-pickå‘½ä»¤çš„å¸¸ç”¨é…ç½®é¡¹å¦‚ä¸‹ã€‚ ï¼ˆ1ï¼‰-eï¼Œ--edit æ‰“å¼€å¤–éƒ¨ç¼–è¾‘å™¨ï¼Œç¼–è¾‘æäº¤ä¿¡æ¯ã€‚ ï¼ˆ2ï¼‰-nï¼Œ--no-commit åªæ›´æ–°å·¥ä½œåŒºå’Œæš‚å­˜åŒºï¼Œä¸äº§ç”Ÿæ–°çš„æäº¤ã€‚ ï¼ˆ3ï¼‰-x åœ¨æäº¤ä¿¡æ¯çš„æœ«å°¾è¿½åŠ ä¸€è¡Œ(cherry picked from commit ...)ï¼Œæ–¹ä¾¿ä»¥åæŸ¥åˆ°è¿™ä¸ªæäº¤æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚ ï¼ˆ4ï¼‰-sï¼Œ--signoff åœ¨æäº¤ä¿¡æ¯çš„æœ«å°¾è¿½åŠ ä¸€è¡Œæ“ä½œè€…çš„ç­¾åï¼Œè¡¨ç¤ºæ˜¯è°è¿›è¡Œäº†è¿™ä¸ªæ“ä½œã€‚ ï¼ˆ5ï¼‰-m parent-numberï¼Œ--mainline parent-number å¦‚æœåŸå§‹æäº¤æ˜¯ä¸€ä¸ªåˆå¹¶èŠ‚ç‚¹ï¼Œæ¥è‡ªäºä¸¤ä¸ªåˆ†æ”¯çš„åˆå¹¶ï¼Œé‚£ä¹ˆ Cherry pick é»˜è®¤å°†å¤±è´¥ï¼Œå› ä¸ºå®ƒä¸çŸ¥é“åº”è¯¥é‡‡ç”¨å“ªä¸ªåˆ†æ”¯çš„ä»£ç å˜åŠ¨ã€‚ -mé…ç½®é¡¹å‘Šè¯‰ Gitï¼Œåº”è¯¥é‡‡ç”¨å“ªä¸ªåˆ†æ”¯çš„å˜åŠ¨ã€‚å®ƒçš„å‚æ•°parent-numberæ˜¯ä¸€ä¸ªä»1å¼€å§‹çš„æ•´æ•°ï¼Œä»£è¡¨åŸå§‹æäº¤çš„çˆ¶åˆ†æ”¯ç¼–å·ã€‚ $ git cherry-pick -m 1 \u003ccommitHash\u003e ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼ŒCherry pick é‡‡ç”¨æäº¤commitHashæ¥è‡ªç¼–å·1çš„çˆ¶åˆ†æ”¯çš„å˜åŠ¨ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œ1å·çˆ¶åˆ†æ”¯æ˜¯æ¥å—å˜åŠ¨çš„åˆ†æ”¯ï¼ˆthe branch being merged intoï¼‰ï¼Œ2å·çˆ¶åˆ†æ”¯æ˜¯ä½œä¸ºå˜åŠ¨æ¥æºçš„åˆ†æ”¯ï¼ˆthe branch being merged fromï¼‰ã€‚ 4ã€ä»£ç å†²çª å¦‚æœæ“ä½œè¿‡ç¨‹ä¸­å‘ç”Ÿä»£ç å†²çªï¼ŒCherry pick ä¼šåœä¸‹æ¥ï¼Œè®©ç”¨æˆ·å†³å®šå¦‚ä½•ç»§ç»­æ“ä½œã€‚ 1ï¼‰--contine ç”¨æˆ·è§£å†³ä»£ç å†²çªåï¼Œç¬¬ä¸€æ­¥å°†ä¿®æ”¹çš„æ–‡ä»¶é‡æ–°åŠ å…¥æš‚å­˜åŒºï¼ˆgit add .ï¼‰ï¼Œç¬¬äºŒæ­¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œè®© Cherry pick è¿‡ç¨‹ç»§ç»­æ‰§è¡Œã€‚ $ git cherry-pick --continue 2ï¼‰--abort å‘ç”Ÿä»£ç å†²çªåï¼Œæ”¾å¼ƒåˆå¹¶ï¼Œå›åˆ°æ“ä½œå‰çš„æ ·å­ã€‚ 3ï¼‰--quit å‘ç”Ÿä»£ç å†²çªåï¼Œé€€å‡º Cherry pickï¼Œä½†æ˜¯ä¸å›åˆ°æ“ä½œå‰çš„æ ·å­ã€‚ 5ã€è½¬ç§»åˆ°å¦å¤–ä¸€ä¸ªä»“åº“ Cherry pick ä¹Ÿæ”¯æŒè½¬ç§»å¦ä¸€ä¸ªä»£ç åº“çš„æäº¤ï¼Œæ–¹æ³•æ˜¯å…ˆå°†è¯¥åº“åŠ ä¸ºè¿œç¨‹ä»“åº“ã€‚ # æ·»åŠ ä¸€ä¸ªè¿œç¨‹ä»“åº“ $ git remote add target git://gitUrl # å°†è¿œç¨‹ä»“åº“çš„ä»£ç æŠ“å–åˆ°æœ¬åœ° $ git fetch target # æ£€æŸ¥ä¸€ä¸‹è¦ä»è¿œç¨‹ä»“åº“è½¬ç§»çš„æäº¤ï¼Œè·å–å®ƒçš„å“ˆå¸Œå€¼ $ git log target/master # ä½¿ç”¨git cherry-pickå‘½ä»¤è½¬ç§»æäº¤ $ git cherry-pick \u003ccommitHash\u003e ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:5:0","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"å…­ã€åˆå¹¶commit åœ¨ä½¿ç”¨ Git ä½œä¸ºç‰ˆæœ¬æ§åˆ¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”±äºå„ç§å„æ ·çš„åŸå› æäº¤äº†è®¸å¤šä¸´æ—¶çš„ commitï¼Œè€Œè¿™äº› commit æ‹¼æ¥èµ·æ¥æ‰æ˜¯å®Œæ•´çš„ä»»åŠ¡ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸ºäº†é¿å…å¤ªå¤šçš„ commit è€Œé€ æˆç‰ˆæœ¬æ§åˆ¶çš„æ··ä¹±ï¼Œé€šå¸¸æˆ‘ä»¬æ¨èå°†è¿™äº› commit åˆå¹¶æˆä¸€ä¸ªã€‚ ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:6:0","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"1ã€æŸ¥çœ‹æäº¤å†å² $ git log commit 3ca6ec340edc66df13423f36f52919dfa3...... commit 1b4056686d1b494a5c86757f9eaed844...... commit 53f244ac8730d33b353bee3b24210b07...... commit 3a4226b4a0b6fa68783b07f1cee7b688....... ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:6:1","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"2ã€git rebase æƒ³è¦åˆå¹¶1-3æ¡ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³• 1ï¼‰ä»HEADç‰ˆæœ¬å¼€å§‹å¾€è¿‡å»æ•°3ä¸ªç‰ˆæœ¬ $ git rebase -i HEAD~3 2ï¼‰æŒ‡åè¦åˆå¹¶çš„ç‰ˆæœ¬ä¹‹å‰çš„ç‰ˆæœ¬å· $ git rebase -i 3a4226b è¯·æ³¨æ„3a4226bè¿™ä¸ªç‰ˆæœ¬æ˜¯ä¸å‚ä¸åˆå¹¶çš„ï¼Œåªæ˜¯æŠŠå®ƒå½“åšä¸€ä¸ªåæ ‡ ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:6:2","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"3ã€é€‰æ‹©è¦åˆå¹¶çš„æäº¤ pæ˜¯ä¿ç•™ï¼Œsæ˜¯åˆå¹¶ 1ï¼‰æ‰§è¡Œäº†rebaseå‘½ä»¤ä¹‹åï¼Œä¼šå¼¹å‡ºä¸€ä¸ªçª—å£ï¼Œå¤´å‡ è¡Œå¦‚ä¸‹ï¼š pick 3ca6ec3 'æ³¨é‡Š**********' pick 1b40566 'æ³¨é‡Š*********' pick 53f244a 'æ³¨é‡Š**********' 2ï¼‰å°†pickæ”¹ä¸ºsquashæˆ–è€…s,ä¹‹åä¿å­˜å¹¶å…³é—­æ–‡æœ¬ç¼–è¾‘çª—å£å³å¯ã€‚æ”¹å®Œä¹‹åæ–‡æœ¬å†…å®¹å¦‚ä¸‹ï¼š pick 3ca6ec3 'æ³¨é‡Š**********' s 1b40566 'æ³¨é‡Š*********' s 53f244a 'æ³¨é‡Š**********' 3ï¼‰ç„¶åä¿å­˜é€€å‡ºï¼ŒGitä¼šå‹ç¼©æäº¤å†å²ï¼Œå¦‚æœæœ‰å†²çªï¼Œéœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹çš„æ—¶å€™è¦æ³¨æ„ï¼Œä¿ç•™æœ€æ–°çš„å†å²ï¼Œä¸ç„¶æˆ‘ä»¬çš„ä¿®æ”¹å°±ä¸¢å¼ƒäº†ã€‚ä¿®æ”¹ä»¥åè¦è®°å¾—æ•²ä¸‹é¢çš„å‘½ä»¤ï¼š pick 3ca6ec3 'æ³¨é‡Š**********' s 1b40566 'æ³¨é‡Š*********' s 53f244a 'æ³¨é‡Š**********' ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:6:3","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"4ï¼‰å†²çªè§£å†³ ç„¶åä¿å­˜é€€å‡ºï¼ŒGitä¼šå‹ç¼©æäº¤å†å²ï¼Œå¦‚æœæœ‰å†²çªï¼Œéœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹çš„æ—¶å€™è¦æ³¨æ„ï¼Œä¿ç•™æœ€æ–°çš„å†å² git add . # ç»§ç»­åˆå¹¶ git rebase --continue # æ”¾å¼ƒåˆå¹¶ git rebase --abort å¦‚æœæ²¡æœ‰å†²çªï¼Œæˆ–è€…å†²çªå·²ç»è§£å†³ï¼Œåˆ™ä¼šå‡ºç°å¦‚ä¸‹çš„ç¼–è¾‘çª—å£ï¼š # This is a combination of 4 commits. #The first commitâ€™s message is: æ³¨é‡Š...... # The 2nd commitâ€™s message is: æ³¨é‡Š...... # The 3rd commitâ€™s message is: æ³¨é‡Š...... # Please enter the commit message for your changes. Lines starting # with â€˜#â€™ will be ignored, and an empty message aborts the commit. ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:6:4","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"5ï¼‰æ£€æŸ¥ git logæŸ¥çœ‹ commit å†å²ä¿¡æ¯ï¼ŒæŸ¥è¯¢commitçš„ä¿¡æ¯ ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:6:5","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"ä¸ƒã€Git Hook Git Hook ä¹Ÿåˆ†ä¸ºä¸¤ä¸ªç«¯: å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚ å®¢æˆ·ç«¯çš„ Git Hook å°±æ˜¯å·¥ä½œåœ¨æˆ‘ä»¬æœ¬åœ°æœºå™¨çš„ï¼ŒæœåŠ¡ç«¯çš„ Git Hook åˆ™æ˜¯å·¥ä½œåœ¨æˆ‘ä»¬æäº¤åˆ°è¿œç¨‹çš„æœåŠ¡å™¨ä»“åº“ä¸­ã€‚ å®¢æˆ·ç«¯ Git Hook: pre-commit: æ‰§è¡Œgit commitå‘½ä»¤æ—¶è§¦å‘ï¼Œå¸¸ç”¨äºæ£€æŸ¥ä»£ç é£æ ¼ prepare-commit-msg: è§¦å‘äº commit message ç¼–è¾‘å™¨å‘¼èµ·å‰ ,default commit messageåˆ›å»ºå,å¸¸ç”¨äºç”Ÿæˆé»˜è®¤çš„æ ‡å‡†åŒ–çš„æäº¤è¯´æ˜ commit-msg: å¼€å‘è€…ç¼–å†™å®Œå¹¶ç¡®è®¤commit messageåè§¦å‘ï¼Œå¸¸ç”¨äºæ ¡éªŒæäº¤è¯´æ˜æ˜¯å¦æ ‡å‡† post-commit: æ•´ä¸ªgit commitå®Œæˆåè§¦å‘ï¼Œå¸¸ç”¨äºé‚®ä»¶é€šçŸ¥ã€æé†’ applypatch-msg: æ‰§è¡Œgit amå‘½ä»¤æ—¶è§¦å‘ï¼Œå¸¸ç”¨äºæ£€æŸ¥å‘½ä»¤æå–å‡ºæ¥çš„æäº¤ä¿¡æ¯æ˜¯å¦ç¬¦åˆç‰¹å®šæ ¼å¼ pre-applypatch: git amæå–å‡ºè¡¥ä¸å¹¶åº”ç”¨äºå½“å‰åˆ†æ”¯åï¼Œå‡†å¤‡æäº¤å‰è§¦å‘ï¼Œå¸¸ç”¨äºæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹æˆ–æ£€æŸ¥ç¼“å†²åŒºä»£ç  post-applypatch: git amæäº¤åè§¦å‘ï¼Œå¸¸ç”¨äºé€šçŸ¥ã€æˆ–è¡¥ä¸é‚®ä»¶å›å¤ï¼ˆæ­¤é’©å­ä¸èƒ½åœæ­¢git amè¿‡ç¨‹ï¼‰ pre-rebase: æ‰§è¡Œgit rebaseå‘½ä»¤æ—¶è§¦å‘ post-rewrite: æ‰§è¡Œä¼šæ›¿æ¢commitçš„å‘½ä»¤æ—¶è§¦å‘ï¼Œæ¯”å¦‚git rebaseæˆ–git commit â€“amend post-checkout: æ‰§è¡Œgit checkoutå‘½ä»¤æˆåŠŸåè§¦å‘ï¼Œå¯ç”¨äºç”Ÿæˆç‰¹å®šæ–‡æ¡£ï¼Œå¤„ç†å¤§äºŒè¿›åˆ¶æ–‡ä»¶ç­‰ post-merge: æˆåŠŸå®Œæˆä¸€æ¬¡ mergeè¡Œä¸ºåè§¦å‘ pre-push: æ‰§è¡Œgit pushå‘½ä»¤æ—¶è§¦å‘ï¼Œå¯ç”¨äºæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ pre-auto-gc: æ‰§è¡Œåƒåœ¾å›æ”¶å‰è§¦å‘ æœåŠ¡ç«¯ Git Hook: pre-receive: å½“æœåŠ¡ç«¯æ”¶åˆ°ä¸€ä¸ª push æ“ä½œè¯·æ±‚æ—¶è§¦å‘ï¼Œå¯ç”¨äºæ£€æµ‹ push çš„å†…å®¹ update: update è„šæœ¬å’Œ pre-receive è„šæœ¬ååˆ†ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä¼šä¸ºæ¯ä¸€ä¸ªå‡†å¤‡æ›´æ–°çš„åˆ†æ”¯å„è¿è¡Œä¸€æ¬¡ã€‚ å‡å¦‚æ¨é€è€…åŒæ—¶å‘å¤šä¸ªåˆ†æ”¯æ¨é€å†…å®¹ï¼Œpre-receive åªè¿è¡Œä¸€æ¬¡ï¼Œç›¸æ¯”ä¹‹ä¸‹ update åˆ™ä¼šä¸ºæ¯ä¸€ä¸ªè¢«æ¨é€çš„åˆ†æ”¯å„è¿è¡Œä¸€æ¬¡ã€‚ post-receive: post-receive æŒ‚é’©åœ¨æ•´ä¸ªè¿‡ç¨‹å®Œç»“ä»¥åè¿è¡Œï¼Œå¯ä»¥ç”¨æ¥æ›´æ–°å…¶ä»–ç³»ç»ŸæœåŠ¡æˆ–è€…é€šçŸ¥ç”¨æˆ·ã€‚å®ƒçš„ç”¨é€”åŒ…æ‹¬ç»™æŸä¸ªé‚®ä»¶åˆ—è¡¨å‘ä¿¡ï¼Œé€šçŸ¥æŒç»­é›†æˆï¼ˆcontinous integrationï¼‰çš„æœåŠ¡å™¨ï¼Œæˆ–è€…æ›´æ–°é—®é¢˜è¿½è¸ªç³»ç»Ÿï¼ˆticket-tracking systemï¼‰ â€”â€” ç”šè‡³å¯ä»¥é€šè¿‡åˆ†ææäº¤ä¿¡æ¯æ¥å†³å®šæŸä¸ªé—®é¢˜ï¼ˆticketï¼‰æ˜¯å¦åº”è¯¥è¢«å¼€å¯ï¼Œä¿®æ”¹æˆ–è€…å…³é—­ã€‚ ä½¿ç”¨git hook Git Hook æœ¬èº«è‡ªå¸¦æœ‰è„šæœ¬ï¼Œä¼šå­˜æ”¾åœ¨ä»“åº“ .git/hooks æ–‡ä»¶å¤¹ä¸­ï¼Œç›®å½•ä¸€èˆ¬æ˜¯è¿™æ ·çš„: - YourGitRepo |- .git |- hooks |- hooks--commit-msg.sample |- hooks--post-update.sample ... æ³¨æ„å¦‚æœæ˜¯ sample æ–‡ä»¶ï¼Œè¦å»æ‰ .sample åç¼€ï¼Œå˜æˆå‰é¢ Git Hook åˆ†ç±» ä¸­æåˆ°å¯¹åº”çš„æ“ä½œæ¥ä½œä¸ºæ–‡ä»¶åã€‚ æ¯”å¦‚æˆ‘è¦åšçš„æ ¡éªŒ commit çš„æäº¤ä¿¡æ¯ï¼Œé‚£ä¹ˆä½¿ç”¨çš„ Git Hook è„šæœ¬ååº”è¯¥ä¸º commit-msg. åœ¨ hooks--commit-msg.sample é‡Œçš„å†…å®¹ä¸º: #!/bin/sh # # An example hook script to check the commit log message. # Called by \"git commit\" with one argument, the name of the file # that has the commit message. The hook should exit with non-zero # status after issuing an appropriate message if it wants to stop the # commit. The hook is allowed to edit the commit message file. # # To enable this hook, rename this file to \"commit-msg\". # Uncomment the below to add a Signed-off-by line to the message. # Doing this in a hook is a bad idea in general, but the prepare-commit-msg # hook is more suited to it. # # SOB=$(git var GIT_AUTHOR_IDENT | sed -n 's/^\\(.*\u003e\\).*$/Signed-off-by: \\1/p') # grep -qs \"^$SOB\" \"$1\" || echo \"$SOB\" \u003e\u003e \"$1\" # This example catches duplicate Signed-off-by lines. test \"\" = \"$(grep '^Signed-off-by: ' \"$1\" | sort | uniq -c | sed -e '/^[ ]*1[ ]/d')\" || { echo \u003e\u00262 Duplicate Signed-off-by lines. exit 1 } ä¸Šé¢è¯´æ˜é‡Œæœ‰ä¸€äº›åŸºæœ¬è¯´æ˜, è¿™é‡Œè·å¾—çš„ $1 å‚æ•°ï¼Œå…¶å®æ˜¯å­˜æ”¾ commit msg å†…å®¹çš„æ–‡ä»¶è·¯å¾„ï¼Œä¸º .git/COMMIT_EDITMSG. åˆ©ç”¨å‘½ä»¤: msg=$(cat $1) å°±èƒ½å–åˆ° commit çš„ä¿¡æ¯ï¼Œç¨ä½œä¿®æ”¹ï¼Œå°±èƒ½è¾¾åˆ°æˆ‘è¯´çš„ï¼Œæ ¡éªŒå›¢é˜Ÿ commit ä¿¡æ¯çš„è§„èŒƒçš„ç›®çš„äº†ã€‚ Git Hook ä¸ç”Ÿæ•ˆ å¦‚æœé‡åˆ°ä¸èµ·ä½œç”¨çš„ï¼Œå¯èƒ½è„šæœ¬æ²¡æœ‰æ‰“å¼€æ‰§è¡Œæƒé™ï¼Œå¯¼è‡´æ²¡åŠæ³•æ‰§è¡Œã€‚æˆ‘å°±æ˜¯è¿™æ ·çš„æƒ…å†µã€‚ cd åˆ° .git/hooks ç›®å½•ä¸‹,æ‰§è¡Œ chmod 777 å‘½ä»¤å³å¯,å¦‚ï¼š chmod 777 commit-msg ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:7:0","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"å…«ã€Git GC æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶å¹¶ä¼˜åŒ–æœ¬åœ°å­˜å‚¨åº“ å‚è€ƒé“¾æ¥ï¼šGit - ç®¡ç† | Administration - git gc - å¼€å‘è€…æ‰‹å†Œ - äº‘+ç¤¾åŒº - è…¾è®¯äº‘ (tencent.com) Gitçš„åº•å±‚å¹¶æ²¡æœ‰é‡‡ç”¨ CVSã€SVN åº•å±‚æ‰€é‡‡ç”¨çš„é‚£å¥—å¢é‡å¼æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€å¥—è‡ªè¡Œç»´æŠ¤çš„å­˜å‚¨æ–‡ä»¶ç³»ç»Ÿã€‚å½“æ–‡ä»¶å˜åŠ¨å‘ç”Ÿæäº¤æ—¶ï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨çš„ä¸æ˜¯æ–‡ä»¶çš„å·®å¼‚ä¿¡æ¯ï¼Œè€Œæ˜¯æ–‡ä»¶å¿«ç…§ï¼Œå³æ•´ä¸ªæ–‡ä»¶å†…å®¹ï¼Œå¹¶ä¿å­˜æŒ‡å‘å¿«ç…§çš„ç´¢å¼•ã€‚è¿™ç§åšæ³•ï¼Œæé«˜ Git åˆ†æ”¯çš„ä½¿ç”¨æ•ˆç‡ï¼›ä½†ä¹Ÿå®¹æ˜“å¯¼è‡´ä»£ç ä»“åº“ä¸­å†…å®¹é‡å¤ç¨‹åº¦è¿‡é«˜ï¼Œä»è€Œä»“åº“ä½“ç§¯è¿‡å¤§ã€‚å½“é‡åˆ°è¿™ç§æƒ…å†µæ—¶ï¼Œæˆ–è€…éœ€è¦å°†ä»“åº“æ¨é€åˆ°è¿œç¨‹ä¸»æœºæ—¶ï¼Œå°±éœ€è¦Gitä¸­çš„gcï¼ˆgarbage collectï¼‰åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾å›æ”¶åŠŸèƒ½ã€‚ å¤§ä½“æ¥è¯´ï¼Œå½“è¿è¡Œ â€œgit gcâ€ å‘½ä»¤æ—¶ï¼ŒGitä¼šæ”¶é›†æ‰€æœ‰æ¾æ•£å¯¹è±¡å¹¶å°†å®ƒä»¬å­˜å…¥ packfileï¼Œåˆå¹¶è¿™äº› packfile è¿›ä¸€ä¸ªå¤§çš„ packfileï¼Œç„¶åå°†ä¸è¢«ä»»ä½• commit å¼•ç”¨å¹¶ä¸”å·²å­˜åœ¨ä¸€æ®µæ—¶é—´ (æ•°æœˆ) çš„å¯¹è±¡åˆ é™¤ã€‚ æ­¤å¤–ï¼ŒGitè¿˜ä¼šå°†æ‰€æœ‰å¼•ç”¨ (references) å¹¶å…¥ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ã€‚ å°±ç»†èŠ‚è€Œè¨€ï¼ŒGitåšäº†è¿™å‡ ä»¶äº‹ï¼š pack_refs è¿‡ç¨‹ reflog expire è¿‡ç¨‹ repack è¿‡ç¨‹ prune è¿‡ç¨‹ rerere è¿‡ç¨‹ æ¦‚è¦ï¼š git gc [--aggressive] [--auto] [--quiet] [--prune=\u003cdate\u003e | --no-prune] [--force] æè¿°ï¼š åœ¨å½“å‰å­˜å‚¨åº“ä¸­è¿è¡Œè®¸å¤šå†…åŠ¡å¤„ç†ä»»åŠ¡ï¼Œä¾‹å¦‚å‹ç¼©æ–‡ä»¶ä¿®è®¢ï¼ˆä»¥å‡å°‘ç£ç›˜ç©ºé—´å¹¶æé«˜æ€§èƒ½ï¼‰å¹¶ç§»é™¤å¯èƒ½ç”±ä¹‹å‰git addè°ƒç”¨åˆ›å»ºçš„ä¸å¯è¾¾å¯¹è±¡ã€‚ é¼“åŠ±ç”¨æˆ·åœ¨æ¯ä¸ªå­˜å‚¨åº“ä¸­å®šæœŸè¿è¡Œæ­¤ä»»åŠ¡ï¼Œä»¥ä¿æŒè‰¯å¥½çš„ç£ç›˜ç©ºé—´åˆ©ç”¨ç‡å’Œè‰¯å¥½çš„æ“ä½œæ€§èƒ½ã€‚ ä¸€äº›gitå‘½ä»¤å¯èƒ½ä¼šè‡ªåŠ¨è¿è¡Œgit gc; --autoè¯¦ç»†ä¿¡æ¯è¯·å‚é˜…ä¸‹é¢çš„æ ‡å¿—ã€‚å¦‚æœæ‚¨çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå¹¶ä¸”æ‰€æœ‰æ‚¨æƒ³è¦çš„éƒ½æ˜¯æ°¸ä¹…ç¦ç”¨æ­¤è¡Œä¸ºè€Œæ— éœ€è¿›ä¸€æ­¥è€ƒè™‘ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š $ git config --global gc.auto 0 é€‰é¡¹ï¼š â€“aggressive é€šå¸¸git gcè¿è¡Œé€Ÿåº¦å¾ˆå¿«ï¼ŒåŒæ—¶æä¾›è‰¯å¥½çš„ç£ç›˜ç©ºé—´åˆ©ç”¨ç‡å’Œæ€§èƒ½ æ­¤é€‰é¡¹å°†å¯¼è‡´git gcæ›´ç§¯æåœ°ä¼˜åŒ–å­˜å‚¨åº“ï¼Œä½†èŠ±è´¹æ›´å¤šæ—¶é—´ã€‚è¿™ç§ä¼˜åŒ–çš„æ•ˆæœæ˜¯æŒä¹…çš„ï¼Œæ‰€ä»¥è¿™ä¸ªé€‰é¡¹åªéœ€è¦å¶å°”ä½¿ç”¨; æ¯éš”å‡ ç™¾ä¸ªå˜æ›´é›†å·¦å³ã€‚ â€“auto ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œgit gcæ£€æŸ¥æ˜¯å¦éœ€è¦è¿›è¡Œä»»ä½•æ¸…æ´å·¥ä½œ; å¦‚æœæ²¡æœ‰ï¼Œå®ƒä¼šé€€å‡ºè€Œä¸æ‰§è¡Œä»»ä½•å·¥ä½œã€‚ä¸€äº›gitå‘½ä»¤git gc --autoåœ¨æ‰§è¡Œå¯èƒ½ä¼šäº§ç”Ÿè®¸å¤šæ¾æ•£å¯¹è±¡çš„æ“ä½œä¹‹åè¿è¡Œã€‚ å¦‚æœå­˜å‚¨åº“ä¸­çš„æ¾æ•£å¯¹è±¡å¤ªå¤šæˆ–åŒ…è£…å¤ªå¤šï¼Œåˆ™éœ€è¦è¿›è¡Œå†…åŠ¡å¤„ç†ã€‚å¦‚æœæ¾æ•£å¯¹è±¡çš„æ•°é‡è¶…è¿‡äº†gc.autoé…ç½®å˜é‡çš„å€¼ï¼Œåˆ™æ‰€æœ‰æ¾æ•£å¯¹è±¡éƒ½å°†ä½¿ç”¨ç»„åˆåˆ°ä¸€ä¸ªåŒ…ä¸­git repack -d -lã€‚å°†å€¼è®¾ç½®gc.autoä¸º0å°†ç¦ç”¨è‡ªåŠ¨å¡«å……æ¾æ•£ç‰©ä½“ã€‚ å¦‚æœåŒ…è£…æ•°é‡è¶…è¿‡äº†ä»·å€¼gc.autoPackLimitï¼Œé‚£ä¹ˆç°æœ‰åŒ…è£…ï¼ˆæ ‡æœ‰.keepæ–‡ä»¶çš„åŒ…è£…é™¤å¤–ï¼‰å°†é€šè¿‡ä½¿ç”¨-Aé€‰é¡¹åˆå¹¶åˆ°ä¸€ä¸ªåŒ…è£…ä¸­git repackã€‚è®¾ç½®gc.autoPackLimitä¸º0å°†ç¦ç”¨è‡ªåŠ¨åˆå¹¶åŒ…è£…ã€‚ â€“prune= ä¿®å‰ªæ¯”æ—¥æœŸæ›´æ—§çš„æ¾æ•£å¯¹è±¡ï¼ˆé»˜è®¤ä¸º2å‘¨å‰ï¼Œå¯ç”±é…ç½®å˜é‡è¦†ç›–gc.pruneExpireï¼‰ã€‚â€“prune =ä¸ç®¡å¹´é¾„å¤§å°ï¼Œéƒ½ä¿®å‰ªæ¾æ•£çš„ç‰©ä½“ï¼Œå¹¶ä¸”å¦‚æœå¦ä¸€ä¸ªè¿›ç¨‹åŒæ—¶å†™å…¥å­˜å‚¨åº“ï¼Œåˆ™ä¼šå¢åŠ è…è´¥é£é™©; è¯·å‚é˜…ä¸‹é¢çš„â€œæ³¨æ„äº‹é¡¹â€ã€‚â€“pruneé»˜è®¤æ‰“å¼€ã€‚ â€“no-prune ä¸è¦ä¿®å‰ªä»»ä½•æ¾åŠ¨çš„ç‰©ä½“ã€‚ â€“quiet å–æ¶ˆæ‰€æœ‰è¿›åº¦æŠ¥å‘Šã€‚ â€“force git gcå³ä½¿å¯èƒ½æœ‰å¦ä¸€ä¸ªgit gcå®ä¾‹åœ¨æ­¤å­˜å‚¨åº“ä¸Šè¿è¡Œï¼Œä¹Ÿå¼ºåˆ¶è¿è¡Œã€‚ æ³¨æ„ï¼š git gcå°½é‡ä¸è¦åˆ é™¤åœ¨å­˜å‚¨åº“ä¸­ä»»ä½•ä½ç½®å¼•ç”¨çš„å¯¹è±¡ã€‚ç‰¹åˆ«æ˜¯ï¼Œå®ƒä¸ä»…ä¼šä¿å­˜å½“å‰ä¸€ç»„åˆ†æ”¯å’Œæ ‡è®°æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿˜ä¼šä¿ç•™ç”±ç´¢å¼•å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿œç¨‹è·Ÿè¸ªåˆ†æ”¯ï¼Œgit filter-branchrefs / original /ä¸­ä¿å­˜çš„å¼•ç”¨æˆ–reflogsï¼ˆå¯å¼•ç”¨åˆ†æ”¯ä¸­çš„æäº¤åæ¥ä¿®æ”¹æˆ–å€’å¸¦ï¼‰ã€‚å¦‚æœæ‚¨å¸Œæœ›æŸäº›å¯¹è±¡è¢«åˆ é™¤è€Œä¸æ˜¯ï¼Œè¯·æ£€æŸ¥æ‰€æœ‰è¿™äº›ä½ç½®ï¼Œå¹¶å†³å®šåœ¨æ‚¨çš„æƒ…å†µä¸‹åˆ é™¤è¿™äº›å¼•ç”¨æ˜¯å¦æœ‰æ„ä¹‰ã€‚ å¦ä¸€æ–¹é¢ï¼Œå½“git gcä¸å¦ä¸€ä¸ªè¿›ç¨‹åŒæ—¶è¿è¡Œæ—¶ï¼Œå¯èƒ½ä¼šåˆ é™¤å¦ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨ä½†å°šæœªåˆ›å»ºå¼•ç”¨çš„å¯¹è±¡ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´å…¶ä»–è¿›ç¨‹å¤±è´¥æˆ–è€…å¯èƒ½ä¼šæŸåå­˜å‚¨åº“ï¼Œå¦‚æœå…¶ä»–è¿›ç¨‹ç¨åæ·»åŠ å¯¹å·²åˆ é™¤å¯¹è±¡çš„å¼•ç”¨ã€‚Gitæœ‰ä¸¤ä¸ªåŠŸèƒ½å¯ä»¥æ˜¾ç€ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼š --pruneä¿ç•™ä¿®æ”¹æ—¶é—´æ¯”æ—¥æœŸæ›´æ–°çš„ä»»ä½•å¯¹è±¡ä»¥åŠå¯ä»å…¶è®¿é—®çš„æ‰€æœ‰å¯¹è±¡ã€‚ å°†å¯¹è±¡æ·»åŠ åˆ°æ•°æ®åº“çš„å¤§å¤šæ•°æ“ä½œéƒ½ä¼šæ›´æ–°å¯¹è±¡çš„ä¿®æ”¹æ—¶é—´ï¼ˆå¦‚æœè¯¥å¯¹è±¡å·²å­˜åœ¨ï¼Œä»¥ä¾¿åº”ç”¨ï¼ƒ1ï¼‰ã€‚ ç„¶è€Œï¼Œè¿™äº›åŠŸèƒ½å¹¶ä¸èƒ½æä¾›å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œå› æ­¤ï¼ŒåŒæ—¶è¿è¡Œå‘½ä»¤çš„ç”¨æˆ·å¿…é¡»å¿å—ä¸€äº›è…è´¥é£é™©ï¼ˆå®è·µä¸­ä¼¼ä¹å¾ˆä½ï¼‰ï¼Œé™¤éä»–ä»¬å…³é—­è‡ªåŠ¨åƒåœ¾æ”¶é›†git config gc.auto 0 ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:8:0","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"ä¹ã€Git gpgç­¾å # æŸ¥çœ‹gpgå¯†é’¥ [root@local ~]# gpg --list-key /root/.gnupg/pubring.kbx ------------------------ pub rsa4096 2021-08-23 [SC] C40EA42A60xxxxxxxxxxxxxxxxxx uid [ ç»å¯¹ ] cccc (local) \u003ct@local.com\u003e sub rsa4096 2021-08-23 [E] pub rsa4096 2021-08-23 [SC] 3CB22116355xxxxxxxxxxxxxxxxxx uid [ ç»å¯¹ ] tom (github) \u003ct@local.cc\u003e sub rsa4096 2021-08-23 [E] é…ç½®ä½¿ç”¨gpgç­¾å # git é…ç½®ä½¿ç”¨gpgç­¾å git config --global user.signingkey \u003cgpg-key-id\u003e # æäº¤æ˜¯å¦å¼ºåˆ¶ GPGï¼Œå¸¦ä¸Š--global æ˜¯ä½œç”¨å…¨å±€ï¼Œå±€éƒ¨çš„å»é™¤--global [root@sugar2 ~]# git config --global commit.gpgsign true # commit æäº¤è®¾ç½®GPGç­¾åï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®å¼ºåˆ¶ï¼Œåˆ™éœ€è¦åŠ ä¸Š-S [root@sugar2 ~]# git commit -S -m â€œcommit message\" # åœ¨githubä¸Šç­¾åçš„æäº¤å°†æ˜¾ç¤ºåŒ…å«â€œ Verifiedâ€ é—®é¢˜ï¼š [root@sugar ssl]# git commit -m \"init repo\" error: gpg æ•°æ®ç­¾åå¤±è´¥ fatal: å†™æäº¤å¯¹è±¡å¤±è´¥ å‚è€ƒé“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/97984430 è§£å†³åŠæ³•ï¼šexport GPG_TTY=$(tty) åœ¨ç¯å¢ƒå˜é‡é‡Œå¢åŠ ä¸€é¡¹GPG_TTY ","date":"2023-11-18","objectID":"/posts/2023-11-18-git/:9:0","tags":["git","vcs","dev"],"title":"Git","uri":"/posts/2023-11-18-git/"},{"categories":["DevOps"],"content":"Nexus å‚è€ƒï¼š https://juejin.cn/post/6844904016762109959 https://cloud.tencent.com/developer/article/1764866 å®˜ç½‘ï¼šhttps://help.sonatype.com/repomanager3/ ","date":"2023-11-18","objectID":"/posts/2023-11-18-nexus/:0:0","tags":["nexus","repo"],"title":"Nexus","uri":"/posts/2023-11-18-nexus/"},{"categories":["DevOps"],"content":"ä»‹ç» ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€èˆ¬ä¸ä¼šå…è®¸æ‰€æœ‰æœåŠ¡å™¨éƒ½èƒ½è®¿é—®å…¬ç½‘ï¼Œç†æƒ³çš„æƒ…å†µæ˜¯æœ‰å‡ å°æœåŠ¡å™¨ä½œä¸ºè®¿é—®ä»£ç†ï¼ŒåŒæ—¶ä½œä¸ºç¼“å­˜æœåŠ¡å™¨ã€‚å½“æœåŠ¡å™¨ä¸­æœ‰æ‰€éœ€åŒ…æ—¶é€šè¿‡å†…ç½‘è·å–ï¼Œå¦‚æ— åˆ™é€šè¿‡å…¬ç½‘è·å–åŒæ—¶åœ¨æœ¬åœ°ä¿å­˜ã€‚å¸¸ç”¨æ­å»ºç§æœ‰yumæºçš„æ–¹æ³•æ˜¯createrepoç”Ÿæˆæœ¬åœ°ä»“åº“ï¼Œå…¶å®ƒæœåŠ¡å™¨é€šè¿‡httpè®¿é—®ä»“åº“ã€‚è¿™ç§æ–¹æ³•çš„å¼Šç«¯æ˜¯å¦‚æœå½“å‰ä»“åº“ä¸­æ²¡æœ‰æ‰€éœ€è½¯ä»¶åŒ…ä¼šå¯¼è‡´å®‰è£…å¤±è´¥ï¼Œä¸ä¼šå»å…¶å®ƒæºè·å–æ•°æ®ã€‚Nexusæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ä»“åº“ç®¡ç†å™¨ï¼Œå®ƒæå¤§åœ°ç®€åŒ–äº†è‡ªå·±å†…éƒ¨ä»“åº“çš„ç»´æŠ¤å’Œå¤–éƒ¨ä»“åº“çš„è®¿é—®ã€‚ Nexusæ˜¯ä¸€ä¸ªå¼ºå¤§çš„Mavenä»“åº“ç®¡ç†å™¨ï¼Œå®ƒæå¤§åœ°ç®€åŒ–äº†æœ¬åœ°å†…éƒ¨ä»“åº“çš„ç»´æŠ¤å’Œå¤–éƒ¨ä»“åº“çš„è®¿é—®ã€‚ å¦‚æœä½¿ç”¨äº†å…¬å…±çš„Mavenä»“åº“æœåŠ¡å™¨ï¼Œå¯ä»¥ä»Mavenä¸­å¤®ä»“åº“ä¸‹è½½æ‰€éœ€è¦çš„æ„ä»¶ï¼ˆArtifactï¼‰ï¼Œä½†è¿™é€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ã€‚ æ­£å¸¸åšæ³•æ˜¯åœ¨æœ¬åœ°æ¶è®¾ä¸€ä¸ªMavenä»“åº“æœåŠ¡å™¨ï¼Œå³åˆ©ç”¨Nexuså¯ä»¥åªåœ¨ä¸€ä¸ªåœ°æ–¹å°±èƒ½å¤Ÿå®Œå…¨æ§åˆ¶è®¿é—®å’Œéƒ¨ç½²åœ¨ä½ æ‰€ç»´æŠ¤ä»“åº“ä¸­çš„æ¯ä¸ªArtifactã€‚ Nexusåœ¨ä»£ç†è¿œç¨‹ä»“åº“çš„åŒæ—¶ç»´æŠ¤æœ¬åœ°ä»“åº“ï¼Œä»¥é™ä½ä¸­å¤®ä»“åº“çš„è´Ÿè·,èŠ‚çœå¤–ç½‘å¸¦å®½å’Œæ—¶é—´ï¼ŒNexuså°±å¯ä»¥æ»¡è¶³è¿™æ ·çš„éœ€è¦ã€‚ Nexusæ˜¯ä¸€å¥—â€œå¼€ç®±å³ç”¨â€çš„ç³»ç»Ÿä¸éœ€è¦æ•°æ®åº“ï¼Œå®ƒä½¿ç”¨æ–‡ä»¶ç³»ç»ŸåŠ Luceneæ¥ç»„ç»‡æ•°æ®ã€‚ Nexusä½¿ç”¨ExtJSæ¥å¼€å‘ç•Œé¢ï¼Œåˆ©ç”¨Restletæ¥æä¾›å®Œæ•´çš„REST APIsï¼Œé€šè¿‡m2eclipseä¸Eclipseé›†æˆä½¿ç”¨ã€‚ Nexusæ”¯æŒWebDAVä¸LDAPå®‰å…¨èº«ä»½è®¤è¯ã€‚ Nexusè¿˜æä¾›äº†å¼ºå¤§çš„ä»“åº“ç®¡ç†åŠŸèƒ½ï¼Œæ„ä»¶æœç´¢åŠŸèƒ½ï¼Œå®ƒåŸºäºRESTï¼Œå‹å¥½çš„UIæ˜¯ä¸€ä¸ªextjsçš„RESTå®¢æˆ·ç«¯ï¼Œå®ƒå ç”¨è¾ƒå°‘çš„å†…å­˜ï¼ŒåŸºäºç®€å•æ–‡ä»¶ç³»ç»Ÿè€Œéæ•°æ®åº“ã€‚ ä¸ºä»€ä¹ˆè¦æ„å»ºNexusç§æœï¼Ÿ å¦‚æœæ²¡æœ‰Nexusç§æœï¼Œæˆ‘ä»¬æ‰€éœ€çš„æ‰€æœ‰æ„ä»¶éƒ½éœ€è¦é€šè¿‡mavençš„ä¸­å¤®ä»“åº“å’Œç¬¬ä¸‰æ–¹çš„Mavenä»“åº“ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè€Œä¸€ä¸ªå›¢é˜Ÿä¸­çš„æ‰€æœ‰äººéƒ½é‡å¤çš„ä»mavenä»“åº“ä¸‹è½½æ„ä»¶æ— ç–‘åŠ å¤§äº†ä»“åº“çš„è´Ÿè½½å’Œæµªè´¹äº†å¤–ç½‘å¸¦å®½ï¼Œå¦‚æœç½‘é€Ÿæ…¢çš„è¯ï¼Œè¿˜ä¼šå½±å“é¡¹ç›®çš„è¿›ç¨‹ã€‚å¾ˆå¤šæƒ…å†µä¸‹é¡¹ç›®çš„å¼€å‘éƒ½æ˜¯åœ¨å†…ç½‘è¿›è¡Œçš„ï¼Œè¿æ¥ä¸åˆ°mavenä»“åº“æ€ä¹ˆåŠå‘¢ï¼Ÿå¼€å‘çš„å…¬å…±æ„ä»¶æ€ä¹ˆè®©å…¶å®ƒé¡¹ç›®ä½¿ç”¨ï¼Ÿè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¸å¾—ä¸ä¸ºè‡ªå·±çš„å›¢é˜Ÿæ­å»ºå±äºè‡ªå·±çš„mavenç§æœï¼Œè¿™æ ·æ—¢èŠ‚çœäº†ç½‘ç»œå¸¦å®½ä¹Ÿä¼šåŠ é€Ÿé¡¹ç›®æ­å»ºçš„è¿›ç¨‹ï¼Œå½“ç„¶å‰ææ¡ä»¶å°±æ˜¯ä½ çš„ç§æœä¸­æ‹¥æœ‰é¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰æ„ä»¶ã€‚ åŒæ—¶Nexusæ”¯æŒä»“åº“æœ‰ï¼šAptã€Bowerã€CocoaPodsã€Condaã€Dockerã€Git LFSã€Goã€Mavenã€Npmã€NuGetã€PyPiã€Rawã€RubyGemsã€Yum ","date":"2023-11-18","objectID":"/posts/2023-11-18-nexus/:1:0","tags":["nexus","repo"],"title":"Nexus","uri":"/posts/2023-11-18-nexus/"},{"categories":["DevOps"],"content":"äºŒã€å®‰è£… äºŒè¿›åˆ¶å®‰è£… # ä¸‹è½½åœ°å€ https://help.sonatype.com/repomanager3/download # è§£å‹ tar zxf nexus-3.23.0-03-unix.tar.gz mv nexus-3.23.0-03 sonatype-work /data echo 'NEXUS_HOME=\"/data/nexus-3.23.0-03\"' \u003e\u003e ~/.bashrc echo 'run_as_user=\"root\"' \u003e\u003e /data/nexus-3.23.0-03/bin/nexus.rc # é…ç½®systemdæœåŠ¡ $ vim /etc/systemd/system/nexus.service [Unit] Description=nexus service After=network.target [Service] Type=forking LimitNOFILE=65536 ExecStart=/data/nexus-3.23.0-03/bin/nexus start ExecStop=/data/nexus-3.23.0-03/bin/nexus stop User=root Restart=on-abort [Install] WantedBy=multi-user.target # å¯åŠ¨æœåŠ¡ systemctl start nexus # æ­¤å¤„å¯åŠ¨åï¼Œè¯·è€å¿ƒç­‰å¾…ï¼Œnetstat -tunlp æŸ¥çœ‹ç«¯å£8081ç›‘å¬åç»§ç»­ # æŸ¥çœ‹adminç”¨æˆ·çš„å¯†ç  cat /data/sonatype-work/nexus3/admin.password åŸºäºdockerå®‰è£…nexus mkdir -p /data/nexus/data \u0026\u0026 chown -R 200 /data/nexus/data docker run -d -p 8081:8081 --name nexus -v /data/nexus/data:/nexus-data sonatype/nexus3 docker-composeå®‰è£… mkdir -p /data/nexus/data \u0026\u0026 chown -R 200 /data/nexus/data # docker-compose cat \u003edocker-compose.yaml \u003c\u003cEOF version: \"3\" services: nexus3: image: sonatype/nexus3 container_name: nexus3 restart: always privileged: true environment: - TZ=Asia/Shanghai ports: - '8081:8081' volumes: - /data/nexus/data:/nexus-data EOF æŸ¥çœ‹å¯†ç  ç®¡ç†å‘˜ï¼šadmin å¯†ç ï¼šcat /data/nexus/data/admin.passwor nginxä»£ç†è®¾ç½® upstream nexus-server{ server 127.0.0.1:8081; } #server { # listen 80; # server_name mirrors.cccc.io; # location / { # return 301 https://xx.xx; # } # location ~ /.well-known { # root /tmp; # } #} server { listen 80; server_name mirrors.local.com; location / { proxy_set_header Host $host; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Real-IP $remote_addr; #proxy_set_header X-Forwarded-Proto \"https\"; proxy_max_temp_file_size 0; proxy_pass http://nexus-server; # This is the maximum upload size client_max_body_size 1024m; client_body_buffer_size 128k; proxy_connect_timeout 90; proxy_send_timeout 90; proxy_read_timeout 90; proxy_temp_file_write_size 64k; # Required for new HTTP-based CLI #proxy_http_version 1.1; #proxy_request_buffering off; #proxy_buffering off; # Required for HTTP-based CLI to work over SSL } #ssl_certificate cert/xx.pem; #ssl_certificate_key cert/xx.key; } ","date":"2023-11-18","objectID":"/posts/2023-11-18-nexus/:2:0","tags":["nexus","repo"],"title":"Nexus","uri":"/posts/2023-11-18-nexus/"},{"categories":["DevOps"],"content":"äºŒã€nexusä»“åº“ Nexus ä»“åº“æŒ‰ç…§ç±»å‹ï¼ˆTypeï¼‰åŒºåˆ†ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹ 3 ä¸ªç±»å‹ï¼š ä»£ç†ä»“åº“ï¼ˆproxyï¼‰ï¼šä¸»è¦ç”¨äºä»£ç†ç¼“å­˜è®¿é—®å¤–ç½‘ä¸Šå…¶ä»–å…¬å¼€çš„ä»“åº“ï¼Œå°†æ¯æ¬¡ä»ä»£ç†ä»“åº“æ‹‰å–çš„åˆ¶å“ç¼“å­˜åˆ°nexusæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¸‹æ¬¡å†æ‹‰å–ç›¸åŒç‰ˆæœ¬åˆ¶å“æ—¶å°±ä¸éœ€å†æ¬¡ä»å¤–ç½‘æ‹‰å–ï¼Œèµ·åˆ°ä»£ç†è®¿é—®ç¼“å­˜çš„åŠŸèƒ½ã€‚ å®¿ä¸»ä»“åº“ï¼ˆhostedï¼‰ï¼šç±»å‹çš„ä»“åº“ä¸»è¦ç”¨äºå­˜æ”¾å„ä¸ªé¡¹ç›®ç»„äº§å‡ºçš„ã€ç”¨äºå…±äº«ã€ä¸èƒ½æ”¾åˆ°å…¬ç½‘ä¸Šã€ç§æœ‰çš„åˆ¶å“ã€‚æœ‰ä¸¤ç§ç‰ˆæœ¬ç­–ç•¥ï¼Œä¸€ç§æ˜¯Snapshotsç‰ˆæœ¬ç­–ç•¥ç±»å‹çš„ï¼Œå¯¹äºç›¸åŒç‰ˆæœ¬åˆ¶å“çš„ä¸Šä¼ ï¼Œnexusä¼šè‡ªåŠ¨è¿½åŠ æ—¶é—´æˆ³åŠ ä»¥åŒºåˆ†ï¼›ä¸€ç§æ˜¯Releaseç‰ˆæœ¬ç­–ç•¥ç±»å‹çš„ï¼Œå¯¹äºç›¸åŒçš„åˆ¶å“ï¼Œè¦æ˜ç¡®ç‰ˆæœ¬ï¼Œä¸èƒ½å­˜æ”¾ç›¸åŒç‰ˆæœ¬ã€‚å¯ä»¥ç†è§£ä¸ºsnapshotsä»“åº“å­˜æ”¾ä¸€äº›å†…å®¹å˜æ›´é¢‘ç¹çš„åˆ¶å“ï¼Œè¿™æ ·ä¸ç®¡ä¸Šä¼ è¿˜æ˜¯ä½¿ç”¨æ—¶ä¸ç”¨é¢‘ç¹å˜æ›´ç‰ˆæœ¬å·å°±èƒ½æ‹‰å–åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚è€Œreleaseä»“åº“å­˜æ”¾ä¸€äº›å†…å®¹ç¨³å®šå˜æ›´å°‘çš„åˆ¶å“ï¼Œä½¿ç”¨æ—¶æŒ‡å®šå¥½ç‰ˆæœ¬å°±è¡Œï¼Œæ— éœ€ç»å¸¸å˜åŠ¨ã€‚ ä»“åº“ç»„ï¼ˆgroupï¼‰ï¼šä¸»è¦ç”¨äºç»„åˆå…¶ä»–ä»“åº“ï¼Œç»Ÿä¸€å¯¹å¤–ä½¿ç”¨æ–¹å¼ã€‚å¯è®¾ç½®ç»„ä»“åº“ç»„åˆå…¶ä»–ä»“åº“çš„é¡ºåºã€‚ä¾‹å¦‚ç»„åˆé¡ºåºä¸ºå…ˆæ‹‰å–mavenæ ¼å¼aliyunä»£ç†ä»“åº“ä¸­çš„åˆ¶å“ï¼Œå¦‚æœå…¶ä¸­æ²¡æœ‰æƒ³è¦çš„åˆ¶å“ï¼Œå†å»æ‹‰å–mavenæ ¼å¼Centralä»£ç†ä»“åº“ä¸­çš„åˆ¶å“ã€‚å¦‚æœè¿˜æ²¡æœ‰ï¼Œå°±å»mavenæ ¼å¼hostedç±»å‹ä»“åº“ä¸­æ‹‰å–ï¼Œç›´åˆ°éå†å®Œæ‰€æœ‰çš„ç»„åˆä»“åº“ã€‚åŒæ—¶ï¼Œæ‹‰å–ä½¿ç”¨æ—¶ä¸éœ€è¦é…ç½®é‚£ä¹ˆå¤šçš„ä»“åº“åœ°å€ï¼Œåªéœ€è¦é…ç½®groupä»“åº“åœ°å€å°±è¡Œã€‚ groupä»“åº“å¯ä»¥åŒ…å«proxyå’Œhostedç±»å‹çš„ä»“åº“ï¼Œå¹¶å¯¹å¤–æä¾›ç»Ÿä¸€çš„æœåŠ¡ ","date":"2023-11-18","objectID":"/posts/2023-11-18-nexus/:3:0","tags":["nexus","repo"],"title":"Nexus","uri":"/posts/2023-11-18-nexus/"},{"categories":["DevOps"],"content":"äºŒã€æ•°æ®æ¥å…¥prometheus grafanaæ¨¡æ¿ï¼š 155563 https://grafana.com/grafana/dashboards/16459 neuxs å®˜æ–¹å‚è€ƒåœ°å€ï¼š https://help.sonatype.com/repomanager3/nexus-repository-administration/support-features#SupportFeatures-Prometheus é…ç½®æ–‡ä»¶æ¨¡æ¿ global: scrape_interval: 15s scrape_timeout: 10s evaluation_interval: 15s alerting: alertmanagers: - static_configs: - targets: [] scheme: http timeout: 10s scrape_configs: - job_name: nxrm scrape_interval: 15s scrape_timeout: 10s metrics_path: /service/metrics/prometheus scheme: http basic_auth: username: admin password: admin123 static_configs: - targets: - localhost:8081 ","date":"2023-11-18","objectID":"/posts/2023-11-18-nexus/:4:0","tags":["nexus","repo"],"title":"Nexus","uri":"/posts/2023-11-18-nexus/"},{"categories":["Database"],"content":"PostgreSQL ","date":"2023-11-12","objectID":"/posts/2023-11-12-postgresql/:0:0","tags":["pg","postgresql","db"],"title":"postgresql","uri":"/posts/2023-11-12-postgresql/"},{"categories":["Database"],"content":"ä¸€ã€å®‰è£… docker å®‰è£… # docker-compose.yaml version: \"3\" services: postgres10-5432: image: \"postgres:10-bullseye\" container_name: postgres10-5432 shm_size: \"1gb\" restart: always ports: - \"5432:5432\" volumes: - /data/postgresql:/var/lib/postgresql/data - $PWD/init.sql:/docker-entrypoint-initdb.d/init.sql environment: - POSTGRES_PASSWORD=xxxxxxxxxxx # init.sql CREATE USER db_user WITH CREATEDB ENCRYPTED PASSWORD 'xxxxxxxxxx'; alter user db_user superuser; ","date":"2023-11-12","objectID":"/posts/2023-11-12-postgresql/:1:0","tags":["pg","postgresql","db"],"title":"postgresql","uri":"/posts/2023-11-12-postgresql/"},{"categories":["Database"],"content":"äºŒã€é…ç½® ","date":"2023-11-12","objectID":"/posts/2023-11-12-postgresql/:2:0","tags":["pg","postgresql","db"],"title":"postgresql","uri":"/posts/2023-11-12-postgresql/"},{"categories":["Database"],"content":"1ã€ä¿®æ”¹æ•°æ®åº“æ—¶åŒº postgres=# show timezone; TimeZone ---------- Etc/UTC (1 row) sed -i \"s+timezone = 'Etc/UTC'+timezone = 'Asia/Shanghai\" postgresql.conf sed -i \"s+log_timezone = 'Etc/UTC'+log_timezone = 'Asia/Shanghai'\" postgresql.conf postgres=# select pg_reload_conf(); pg_reload_conf ---------------- t (1 row) postgres=# show timezone; TimeZone --------------- Asia/Shanghai (1 row) ","date":"2023-11-12","objectID":"/posts/2023-11-12-postgresql/:2:1","tags":["pg","postgresql","db"],"title":"postgresql","uri":"/posts/2023-11-12-postgresql/"},{"categories":["Database"],"content":"2ã€sqlä½¿ç”¨ æŸ¥è¯¢æ•°æ®åº“å¤§å°ï¼š select datname, pg_size_pretty (pg_database_size(datname)) AS size from pg_database order by size; æŸ¥çœ‹è¡¨å¤§å° --æ•°æ®åº“ä¸­å•ä¸ªè¡¨çš„å¤§å°ï¼ˆä¸åŒ…å«ç´¢å¼•ï¼‰ select pg_size_pretty(pg_relation_size('è¡¨å')); --æŸ¥å‡ºæ‰€æœ‰è¡¨ï¼ˆåŒ…å«ç´¢å¼•ï¼‰å¹¶æ’åº SELECT table_schema || '.' || table_name AS table_full_name, pg_size_pretty(pg_total_relation_size('\"' || table_schema || '\".\"' || table_name || '\"')) AS size FROM information_schema.tables ORDER BY pg_total_relation_size('\"' || table_schema || '\".\"' || table_name || '\"') DESC limit 20; --æŸ¥å‡ºè¡¨å¤§å°æŒ‰å¤§å°æ’åºå¹¶åˆ†ç¦»dataä¸index SELECT table_name, pg_size_pretty(table_size) AS table_size, pg_size_pretty(indexes_size) AS indexes_size, pg_size_pretty(total_size) AS total_size FROM ( SELECT table_name, pg_table_size(table_name) AS table_size, pg_indexes_size(table_name) AS indexes_size, pg_total_relation_size(table_name) AS total_size FROM ( SELECT ('\"' || table_schema || '\".\"' || table_name || '\"') AS table_name FROM information_schema.tables ) AS all_tables ORDER BY total_size DESC ) AS pretty_sizes -- ä¿®æ”¹ç”¨æˆ·å¯†ç  ALTER USER postgres with password 'hello_world'; schema ç®¡ç† -- åˆ›å»ºschema create schema test; -- æŸ¥çœ‹schema \\dn -- ä¿®æ”¹schema å±ä¸» alter schema test owner to highgo; -- ä¿®æ”¹schemaåç§° alter schema test rename to testa; create schema test authorization highgo;; -- åˆ‡æ¢schema set search_path to test_schema ä¿®æ”¹æ•°æ®åº“å -- ä¿®æ”¹æ•°æ®åº“å alter database src_dbname rename to dst_dbname; -- å°†æ•°æ®åº“çš„åç§°ç”±database2æ”¹æˆdatabase1 UPDATE pg_database SET datname = 'database1' WHERE datname = 'database2'; æ…¢æŸ¥è¯¢é…ç½® # postgresql.conf # 10s log_min_duration_statement=10000 # çƒ­åŠ è½½é…ç½® postgres=# select pg_reload_conf(); 1 # æŸ¥çœ‹é…ç½®ï¼š postgres=# show log_min_duration_statement; log_min_duration_statement ---------------------------- 10s (1 row) # ä¹Ÿå¯ä»¥é’ˆå¯¹æŸä¸ªç”¨æˆ·æˆ–è€…æŸæ•°æ®åº“è¿›è¡Œè®¾ç½®ï¼š postgres=# alter database test set log_min_duration_statement=5000; # sql æŸ¥è¯¢æ…¢è¯­å¥ï¼Œè¶…è¿‡1s postgres=# select * from pg_stat_activity where state\u003c\u003e'idle' and now()-query_start \u003e interval '1 s' order by query_start; select * from pg_stat_activity where state\u003c\u003e'idle' and now()-query_start \u003e interval '5 s' order by query_start; # æ–­å¼€æ•°æ®åº“è¿æ¥ select pg_terminate_backend(pid) from (select pid from pg_stat_activity where datname = 'db_name' ) as a; # åˆ›å»ºä¸€ä¸ªæ•°æ®åº“å½’å±å…¶ä»–ç”¨æˆ· create database 'db_name' OWNER db_user; # æŸ¥çœ‹æ•°æ®åº“è¿æ¥æ•° select count(*) from pg_stat_activity; select * from pg_stat_activity; # æŸ¥è¯¢æ•°æ®åº“æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯100 postgres=\u003e show max_connections; # docker éƒ¨ç½²åˆ°æ•°æ®åº“ä¿®æ”¹æœ€å¤§è¿æ¥æ•° # è¿›å…¥å®¹å™¨ï¼Œä¿®æ”¹æœ€å¤§è¿æ¥æ•° root@ip142:~# docker exec -ti postgres10-5433 bash root@568a83e098a5:/# sed -ri '/max_connections/c max_connections = 2000' /var/lib/postgresql/data/postgresql.conf ç”¨æˆ·åªè¯»æƒé™è®¾ç½®ï¼šhttps://blog.csdn.net/qq_41018743/article/details/105492884 -- ä»¥super useråˆ›å»ºåªè¯»ç”¨æˆ· CREATE USER readonly WITH PASSWORD '*****'; -- ä»¥super userè®¾ç½®ç”¨æˆ·é»˜è®¤äº‹åŠ¡åªè¯» alter user readonly set default_transaction_read_only=on; -- ä½¿ç”¨æ•°æ®åº“çš„åˆ›å»ºæ‰€æœ‰è€…å»æ‰§è¡Œä»¥ä¸‹æ“ä½œ -- å¢åŠ è¿æ¥æ•°æ®åº“æƒé™ GRANT CONNECT ON DATABASE testDB to readonly; -- åˆ‡æ¢åˆ° testDB \\c testDB; -- èµ‹äºˆç”¨æˆ·æƒé™è®¿é—®publicæ¨¡å¼ GRANT USAGE ON SCHEMA public to readonly; -- èµ‹äºˆè¡¨åºåˆ—æŸ¥çœ‹æƒé™ GRANT SELECT ON ALL SEQUENCES IN SCHEMA public TO readonly; GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly; -- æ–°å¢åŠ çš„è¡¨éƒ½é»˜è®¤å¢åŠ æƒé™ alter default privileges in schema public grant select on tables to readonly; -- æ–°å¢åŠ çš„åºåˆ—éƒ½é»˜è®¤å¢åŠ æƒé™ alter default privileges in schema public grant select on SEQUENCES to readonly; ","date":"2023-11-12","objectID":"/posts/2023-11-12-postgresql/:2:2","tags":["pg","postgresql","db"],"title":"postgresql","uri":"/posts/2023-11-12-postgresql/"},{"categories":["Database"],"content":"ä¸‰ã€ä»åº“é…ç½® å‚è€ƒé“¾æ¥ï¼šhttps://help.aliyun.com/document_detail/53096.html ","date":"2023-11-12","objectID":"/posts/2023-11-12-postgresql/:3:0","tags":["pg","postgresql","db"],"title":"postgresql","uri":"/posts/2023-11-12-postgresql/"},{"categories":["Database"],"content":"1ã€é…ç½®PostgreSQLä¸»èŠ‚ç‚¹ 1ï¼‰è¾“å…¥ä»¥ä¸‹SQLè¯­å¥åˆ›å»ºæ•°æ®åº“è´¦å·replicaï¼Œå¹¶è®¾ç½®å¯†ç åŠç™»å½•æƒé™å’Œå¤‡ä»½æƒé™ã€‚ æœ¬ç¤ºä¾‹ä¸­å°†å¯†ç è®¾ç½®ä¸ºreplicaã€‚ CREATE ROLE replica login replication encrypted password 'replica'; CREATE ROLE replica login replication encrypted password 'rRweb9iojLxhVeWNddddddddddd'; 2ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶ data/pg_hba.conf åœ¨IPv4 local connectionsæ®µæ·»åŠ ä¸‹é¢ä¸¤è¡Œå†…å®¹ã€‚ host all all \u003cä»èŠ‚ç‚¹çš„VPC IPv4ç½‘æ®µ\u003e md5 #å…è®¸VPCç½‘æ®µä¸­md5å¯†ç è®¤è¯è¿æ¥ host replication replica \u003cä»èŠ‚ç‚¹çš„VPC IPv4ç½‘æ®µ\u003e md5 #å…è®¸ç”¨æˆ·ä»replicationæ•°æ®åº“è¿›è¡Œæ•°æ®åŒæ­¥ postgresql.conf listen_addresses = '*' #ç›‘å¬çš„IPåœ°å€ wal_level = hot_standby #å¯ç”¨çƒ­å¤‡æ¨¡å¼ synchronous_commit = on #å¼€å¯åŒæ­¥å¤åˆ¶ max_wal_senders = 32 #åŒæ­¥æœ€å¤§çš„è¿›ç¨‹æ•°é‡ wal_sender_timeout = 60s #æµå¤åˆ¶ä¸»æœºå‘é€æ•°æ®çš„è¶…æ—¶æ—¶é—´ max_connections = 100 #æœ€å¤§è¿æ¥æ•°ï¼Œä»åº“çš„max_connectionså¿…é¡»è¦å¤§äºä¸»åº“çš„ ä¿®æ”¹å®Œåé‡å¯æœåŠ¡ ","date":"2023-11-12","objectID":"/posts/2023-11-12-postgresql/:3:1","tags":["pg","postgresql","db"],"title":"postgresql","uri":"/posts/2023-11-12-postgresql/"},{"categories":["Database"],"content":"2ã€ä»èŠ‚ç‚¹ä¸Šæ“ä½œ å‚è€ƒé“¾æ¥ï¼šhttps://blog.51cto.com/u_13482808/6875114 pg_basebackup --help ç”¨æ³•ï¼š pg_basebackup [é€‰é¡¹] ... æ§åˆ¶è¾“å‡ºçš„é€‰é¡¹ï¼š -D, --pgdata=DIRECTORY æ¥æ”¶åŸºæœ¬å¤‡ä»½åˆ°ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º -F, --format=p|t è¾“å‡ºæ ¼å¼ï¼ˆplain,ç›´æ¥æ‹·è´æ•°æ®æ–‡ä»¶ï¼Œtar é…åˆ -z -Z è¿›è¡Œæ‰“åŒ…å‹ç¼©ï¼‰ -r, --max-rate=RATE ä¼ è¾“æ•°æ®ç›®å½•çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ï¼ˆä»¥ kB/s ä¸ºå•ä½ï¼Œæˆ–ä½¿ç”¨åç¼€â€œkâ€æˆ–â€œMâ€ï¼‰ -R,--write-recovery-conf æ˜¯å¦è¾“å‡ºrecovery-confæ–‡ä»¶ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨å¤‡ä»½å¿«é€Ÿæ­å»ºå‡ºä»èŠ‚ç‚¹ -T, --tablespace-mapping=OLDDIR=NEWDIR å°† OLDDIR ä¸­çš„è¡¨ç©ºé—´é‡å®šä½åˆ° NEWDIR --waldir=WALDIR é¢„å†™æ—¥å¿—ç›®å½•çš„ä½ç½® -X, --wal-method=none|fetch|stream åŒ…å«æŒ‡å®šæ–¹æ³•æ‰€éœ€çš„ WAL æ–‡ä»¶ -z, --gzip å‹ç¼© tar è¾“å‡º -Z, --compress=0-9 ä½¿ç”¨ç»™å®šçš„å‹ç¼©çº§åˆ«å‹ç¼© tar è¾“å‡º å¸¸è§„é€‰é¡¹ï¼š -c, --checkpoint=fast|spread è®¾ç½®å¿«é€Ÿæˆ–æ‰©å±•æ£€æŸ¥ç‚¹ -C, --create-slot åˆ›å»ºå¤åˆ¶æ§½ -l, --label=LABEL è®¾ç½®å¤‡ä»½æ ‡ç­¾ -n, --no-clean å‡ºé”™åä¸æ¸…ç† -N, --no-sync ä¸ç­‰å¾…æ›´æ”¹å®‰å…¨å†™å…¥ç£ç›˜ -P, --progress æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯ -S, --slot=SLOTNAME è¦ä½¿ç”¨çš„å¤åˆ¶æ§½ -v, --verbose è¾“å‡ºè¯¦ç»†ä¿¡æ¯ -V, --version è¾“å‡ºç‰ˆæœ¬ä¿¡æ¯ï¼Œç„¶åé€€å‡º --no-slot é˜²æ­¢åˆ›å»ºä¸´æ—¶å¤åˆ¶æ§½ --no-verify-checksums ä¸éªŒè¯æ ¡éªŒå’Œ -?, --help æ˜¾ç¤ºæ­¤å¸®åŠ©ï¼Œç„¶åé€€å‡º è¿æ¥é€‰é¡¹ï¼š -d, --dbname æ•°æ®åº“åç§° -h, --host æ•°æ®åº“æœåŠ¡å™¨ä¸»æœºipæˆ–å¥—æ¥å­—ç›®å½• -p, --port æ•°æ®åº“å£å· -s, --status-interval=çŠ¶æ€åŒ…å‘é€åˆ°æœåŠ¡å™¨çš„é—´éš”æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ -U, --username è¿æ¥ç”¨æˆ·ï¼Œè¦æœ‰superæƒé™ -w, --no-password ä»ä¸æç¤ºè¾“å…¥å¯†ç  1ï¼‰å¤‡ä»½æ•°æ® ä½¿ç”¨pg_basebackupåŸºç¡€å¤‡ä»½å·¥å…·æŒ‡å®šå¤‡ä»½ç›®å½•ã€‚ #ä¿æŒpg dataç›®å½•æ ¼å¼ pg_basebackup -h 192.168.1.1 -p 5432 -U replica -D /data/test -cfast -Xs -Pv # è‡ªåŠ¨åˆ›å»ºrecovery.conf pg_basebackup -h 192.168.1.1 -p 5432 -U replica -D /data/test -cfast -Xs -Pv -R # æ‰“åŒ…æˆtaræ–‡ä»¶ pg_basebackup -h 192.168.1.1 -p 5432 -U replica -D /data/test -cfast -Xs -Pv -Ft # æ‰“åŒ…æˆtar.gzæ–‡ä»¶ pg_basebackup -h 192.168.1.1 -p 5432 -U replica -D /data/test -cfast -Xs -Pv -Ft -z æ–°å»ºå¹¶ä¿®æ”¹recovery.confé…ç½®æ–‡ä»¶ã€‚ vim /var/lib/pgsql/11/data/recovery.conf ####åˆ†åˆ«æ‰¾åˆ°ä»¥ä¸‹å‚æ•°ï¼Œå¹¶å°†å‚æ•°ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼š standby_mode = on #å£°æ˜æ­¤èŠ‚ç‚¹ä¸ºä»åº“ primary_conninfo = 'host=\u003cä¸»èŠ‚ç‚¹IP\u003e port=5432 user=replica password=replica' #å¯¹åº”ä¸»åº“çš„è¿æ¥ä¿¡æ¯ recovery_target_timeline = 'latest' #æµå¤åˆ¶åŒæ­¥åˆ°æœ€æ–°çš„æ•°æ® ä¿®æ”¹postgresql.confæ–‡ä»¶ max_connections = 1000 # æœ€å¤§è¿æ¥æ•°ï¼Œä»èŠ‚ç‚¹éœ€è®¾ç½®æ¯”ä¸»èŠ‚ç‚¹å¤§ hot_standby = on # å¼€å¯çƒ­å¤‡ max_standby_streaming_delay = 30s # æ•°æ®æµå¤‡ä»½çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ wal_receiver_status_interval = 5s # ä»èŠ‚ç‚¹å‘ä¸»èŠ‚ç‚¹æŠ¥å‘Šè‡ªèº«çŠ¶æ€çš„æœ€é•¿é—´éš”æ—¶é—´ hot_standby_feedback = on # å¦‚æœæœ‰é”™è¯¯çš„æ•°æ®å¤åˆ¶å‘ä¸»è¿›è¡Œåé¦ˆ ä¿®æ”¹æ•°æ®ç›®å½•çš„æƒé™ chown -R postgres.postgres /var/lib/pgsql/11/data å¯åŠ¨æœåŠ¡ ","date":"2023-11-12","objectID":"/posts/2023-11-12-postgresql/:3:2","tags":["pg","postgresql","db"],"title":"postgresql","uri":"/posts/2023-11-12-postgresql/"},{"categories":["Database"],"content":"3ã€éªŒè¯ 1ï¼‰åœ¨ä¸»èŠ‚ç‚¹ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹senderè¿›ç¨‹ã€‚ ps aux |grep sender è¿”å›ç»“æœå¦‚ä¸‹ï¼Œè¡¨ç¤ºå¯æˆåŠŸæŸ¥çœ‹åˆ°senderè¿›ç¨‹ã€‚ postgres 2916 0.0 0.3 340388 3220 ? Ss 15:38 0:00 postgres: wal sender process replica 192.168.**.**(49640) streaming 0/F01C1A8 2ï¼‰åœ¨ä»èŠ‚ç‚¹ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹receiverè¿›ç¨‹ã€‚ ps aux |grep receiver è¿”å›ç»“æœå¦‚ä¸‹ï¼Œè¡¨ç¤ºå¯æˆåŠŸæŸ¥çœ‹åˆ°receiverè¿›ç¨‹ã€‚ postgres 23284 0.0 0.3 387100 3444 ? Ss 16:04 0:00 postgres: wal receiver process streaming 0/F01C1A8 3ï¼‰åœ¨ä¸»èŠ‚ç‚¹ä¸­è¿›å…¥PostgreSQLäº¤äº’ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹SQLè¯­å¥ï¼Œåœ¨ä¸»åº“ä¸­æŸ¥çœ‹ä»åº“çŠ¶æ€ã€‚ select * from pg_stat_replication; è¿”å›ç»“æœå¦‚ä¸‹ï¼Œè¡¨ç¤ºå¯æˆåŠŸæŸ¥çœ‹åˆ°ä»åº“çŠ¶æ€ã€‚ pid | usesysid | usename | application_name | client_addr | client_hostname | client_port | backend_start | backend_xmin | state | sent_location | write_locati on | flush_location | replay_location | sync_priority | sync_state ------+----------+---------+------------------+---------------+-----------------+------------- +-------------------------------+--------------+-----------+---------------+------------- ---+----------------+-----------------+---------------+------------ 2916 | 16393 | replica | walreceiver | 192.168.**.** | | 49640 | 2017-05-02 15:38:06.188988+08 | 1836 | streaming | 0/F01C0C8 | 0/F01C0C8 | 0/F01C0C8 | 0/F01C0C8 | 0 | async (1 rows) ","date":"2023-11-12","objectID":"/posts/2023-11-12-postgresql/:3:3","tags":["pg","postgresql","db"],"title":"postgresql","uri":"/posts/2023-11-12-postgresql/"},{"categories":["Database"],"content":"4ã€æŸ¥çœ‹ä¸»ä»å»¶è¿Ÿ å¦‚æœä¸»åº“æ²¡æœ‰æ’å…¥æˆ–è€…ä¿®æ”¹çš„æ•°æ®çš„sqlæ‰§è¡Œï¼Œä¸»ä»åŒæ­¥çš„å»¶æ—¶ä¼šé€æ¸å¢åŠ  select now() - pg_last_xact_replay_timestamp() AS replication_delay; ","date":"2023-11-12","objectID":"/posts/2023-11-12-postgresql/:3:4","tags":["pg","postgresql","db"],"title":"postgresql","uri":"/posts/2023-11-12-postgresql/"},{"categories":["å®‰å…¨ä¿¡æ¯"],"content":"æ¼æ´ä¿¡æ¯ äº‘æœåŠ¡å•†å®‰å…¨æœåŠ¡å…¬å‘Š äº‘æœåŠ¡å•† é“¾æ¥ cveå®˜ç½‘ https://cve.mitre.org/ é˜¿é‡Œäº‘ https://help.aliyun.com/noticelist/9213612.html?spm=a2c4g.789004748.n2.3.cddb4c07NBt9Rl åä¸ºäº‘ https://www.huaweicloud.com/notice.securecenter.html è…¾è®¯äº‘ https://cloud.tencent.com/announce?categorys=21\u0026page=1 é˜¿é‡Œäº‘æ¼æ´æ•°æ®åº“ https://avd.aliyun.com/ å›½å®¶ä¿¡æ¯æ¼æ´åº“ http://www.cnnvd.org.cn/ å¸¸ç”¨è½¯ä»¶å®˜æ–¹å®‰å…¨å…¬å‘Šé“¾æ¥ åç§° é“¾æ¥ redis https://github.com/redis/redis/security nginx http://nginx.org/en/security_advisories.html httpd https://httpd.apache.org/security ","date":"2023-11-12","objectID":"/posts/2023-11-12-security-info/:1:0","tags":["security","cve"],"title":"security-info","uri":"/posts/2023-11-12-security-info/"},{"categories":["å®‰å…¨ä¿¡æ¯"],"content":"å®‰å…¨æœåŠ¡æ¨é€ github: https://github.com/zema1/watchvuln version: \"3\" services: watchvuln: image: zemal/watchvuln container_name: watchvuln hostname: watchvuln restart: always environment: DINGDING_ACCESS_TOKEN: cd316d9dxxxxxxxxxxxxxxxxxxxxxxx DINGDING_SECRET: SECa87a39xxxxxxxxxxxxxxxxxxxxxxxxxxxx LARK_ACCESS_TOKEN: 1ddfb805-xxxxxxxxxxxxxxxxxxxxxxxxxxxx LARK_SECRET: GUUKIrxxxxxxxxxxxxxxxxxxxxxxxxxxxx INTERVAL: 30m volumes: - \"/etc/localtime:/etc/localtime:ro\" ","date":"2023-11-12","objectID":"/posts/2023-11-12-security-info/:2:0","tags":["security","cve"],"title":"security-info","uri":"/posts/2023-11-12-security-info/"},{"categories":["Database"],"content":"SQLite SQLiteæ˜¯ä¸€ç§å¼€æºï¼Œé›¶é…ç½®ï¼Œç‹¬ç«‹çš„ï¼Œç‹¬ç«‹çš„ï¼Œäº‹åŠ¡å…³ç³»æ•°æ®åº“å¼•æ“ï¼Œæ—¨åœ¨åµŒå…¥åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚ ","date":"2023-11-12","objectID":"/posts/2023-11-12-sqlite3/:0:0","tags":["sqlite","sqlite3","db"],"title":"sqlite3","uri":"/posts/2023-11-12-sqlite3/"},{"categories":["Database"],"content":"ä¸€ã€å®‰è£…sqlite SQLiteä»¥å…¶é›¶é…ç½®è€Œé—»åï¼Œæ‰€ä»¥ä¸éœ€è¦å¤æ‚çš„è®¾ç½®æˆ–ç®¡ç†ã€‚ # rpm yum -y install sqlite3 # apt apt install sqlite3 ","date":"2023-11-12","objectID":"/posts/2023-11-12-sqlite3/:1:0","tags":["sqlite","sqlite3","db"],"title":"sqlite3","uri":"/posts/2023-11-12-sqlite3/"},{"categories":["Database"],"content":"äºŒã€sqliteå‘½ä»¤ ","date":"2023-11-12","objectID":"/posts/2023-11-12-sqlite3/:2:0","tags":["sqlite","sqlite3","db"],"title":"sqlite3","uri":"/posts/2023-11-12-sqlite3/"},{"categories":["Database"],"content":"è¿›å…¥sqlite [sugar@MacBook-Pro ~]$ sqlite3 SQLite version 3.32.3 2020-06-18 14:16:19 Enter \".help\" for usage hints. Connected to a transient in-memory database. Use \".open FILENAME\" to reopen on a persistent database. sqlite\u003e .exit å¦‚éœ€è·å–å¯ç”¨çš„ç‚¹å‘½ä»¤çš„æ¸…å•ï¼Œå¯ä»¥åœ¨ä»»ä½•æ—¶å€™è¾“å…¥ â€œ.helpâ€ sqlite\u003e .help .auth ON|OFF Show authorizer callbacks .backup ?DB? FILE Backup DB (default \"main\") to FILE .bail on|off Stop after hitting an error. Default OFF .binary on|off Turn binary output on or off. Default OFF .cd DIRECTORY Change the working directory to DIRECTORY .changes on|off Show number of rows changed by SQL .check GLOB Fail if output since .testcase does not match .clone NEWDB Clone data into NEWDB from the existing database .databases List names and files of attached databases .dbconfig ?op? ?val? List or change sqlite3_db_config() options .dbinfo ?DB? Show status information about the database .dump ?TABLE? Render database content as SQL .echo on|off Turn command echo on or off ä¸Šé¢çš„å‘½ä»¤ä¼šæ˜¾ç¤ºå„ç§é‡è¦çš„ SQLite ç‚¹å‘½ä»¤çš„åˆ—è¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å‘½ä»¤ æè¿° .backup ? DB? FILE å¤‡ä»½ DB æ•°æ®åº“ï¼ˆé»˜è®¤æ˜¯ â€œmainâ€ï¼‰åˆ° FILE æ–‡ä»¶ã€‚ .bail ON|OFF å‘ç”Ÿé”™è¯¯ååœæ­¢ã€‚é»˜è®¤ä¸º OFFã€‚ .databases åˆ—å‡ºæ•°æ®åº“çš„åç§°åŠå…¶æ‰€ä¾é™„çš„æ–‡ä»¶ã€‚ .dump ?TABLE? ä»¥ SQL æ–‡æœ¬æ ¼å¼è½¬å‚¨æ•°æ®åº“ã€‚å¦‚æœæŒ‡å®šäº† TABLE è¡¨ï¼Œåˆ™åªè½¬å‚¨åŒ¹é… LIKE æ¨¡å¼çš„ TABLE è¡¨ã€‚ .echo ON|OFF å¼€å¯æˆ–å…³é—­ echo å‘½ä»¤ã€‚ .exit é€€å‡º SQLite æç¤ºç¬¦ã€‚ .explain ON|OFF å¼€å¯æˆ–å…³é—­é€‚åˆäº EXPLAIN çš„è¾“å‡ºæ¨¡å¼ã€‚å¦‚æœæ²¡æœ‰å¸¦å‚æ•°ï¼Œåˆ™ä¸º EXPLAIN onï¼Œå³å¼€å¯ EXPLAINã€‚ .header(s) ON|OFF å¼€å¯æˆ–å…³é—­å¤´éƒ¨æ˜¾ç¤ºã€‚ .help æ˜¾ç¤ºæ¶ˆæ¯ã€‚ .import FILE TABLE å¯¼å…¥æ¥è‡ª FILE æ–‡ä»¶çš„æ•°æ®åˆ° TABLE è¡¨ä¸­ã€‚ .indices ?TABLE? æ˜¾ç¤ºæ‰€æœ‰ç´¢å¼•çš„åç§°ã€‚å¦‚æœæŒ‡å®šäº† TABLE è¡¨ï¼Œåˆ™åªæ˜¾ç¤ºåŒ¹é… LIKE æ¨¡å¼çš„ TABLE è¡¨çš„ç´¢å¼•ã€‚ .load FILE ?ENTRY? åŠ è½½ä¸€ä¸ªæ‰©å±•åº“ã€‚ .log FILE|off å¼€å¯æˆ–å…³é—­æ—¥å¿—ã€‚FILE æ–‡ä»¶å¯ä»¥æ˜¯ stderrï¼ˆæ ‡å‡†é”™è¯¯ï¼‰/stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ã€‚ .mode MODE è®¾ç½®è¾“å‡ºæ¨¡å¼ï¼ŒMODE å¯ä»¥æ˜¯ä¸‹åˆ—ä¹‹ä¸€ï¼šcsv é€—å·åˆ†éš”çš„å€¼column å·¦å¯¹é½çš„åˆ—html HTML çš„ ä»£ç insert TABLE è¡¨çš„ SQL æ’å…¥ï¼ˆinsertï¼‰è¯­å¥line æ¯è¡Œä¸€ä¸ªå€¼list ç”± .separator å­—ç¬¦ä¸²åˆ†éš”çš„å€¼tabs ç”± Tab åˆ†éš”çš„å€¼tcl TCL åˆ—è¡¨å…ƒç´  .nullvalue STRING åœ¨ NULL å€¼çš„åœ°æ–¹è¾“å‡º STRING å­—ç¬¦ä¸²ã€‚ .output FILENAME å‘é€è¾“å‡ºåˆ° FILENAME æ–‡ä»¶ã€‚ .output stdout å‘é€è¾“å‡ºåˆ°å±å¹•ã€‚ .print STRINGâ€¦ é€å­—åœ°è¾“å‡º STRING å­—ç¬¦ä¸²ã€‚ .prompt MAIN CONTINUE æ›¿æ¢æ ‡å‡†æç¤ºç¬¦ã€‚ .quit é€€å‡º SQLite æç¤ºç¬¦ã€‚ .read FILENAME æ‰§è¡Œ FILENAME æ–‡ä»¶ä¸­çš„ SQLã€‚ .schema ?TABLE? æ˜¾ç¤º CREATE è¯­å¥ã€‚å¦‚æœæŒ‡å®šäº† TABLE è¡¨ï¼Œåˆ™åªæ˜¾ç¤ºåŒ¹é… LIKE æ¨¡å¼çš„ TABLE è¡¨ã€‚ .separator STRING æ”¹å˜è¾“å‡ºæ¨¡å¼å’Œ .import æ‰€ä½¿ç”¨çš„åˆ†éš”ç¬¦ã€‚ .show æ˜¾ç¤ºå„ç§è®¾ç½®çš„å½“å‰å€¼ã€‚ .stats ON|OFF å¼€å¯æˆ–å…³é—­ç»Ÿè®¡ã€‚ .tables ?PATTERN? åˆ—å‡ºåŒ¹é… LIKE æ¨¡å¼çš„è¡¨çš„åç§°ã€‚ .timeout MS å°è¯•æ‰“å¼€é”å®šçš„è¡¨ MS æ¯«ç§’ã€‚ .width NUM NUM ä¸º â€œcolumnâ€ æ¨¡å¼è®¾ç½®åˆ—å®½åº¦ã€‚ .timer ON|OFF å¼€å¯æˆ–å…³é—­ CPU å®šæ—¶å™¨ã€‚ ç”¨.showå‘½ä»¤æ¥æŸ¥çœ‹ SQLite å‘½ä»¤æç¤ºç¬¦çš„é»˜è®¤è®¾ç½® sqlite\u003e .show echo: off eqp: off explain: auto headers: off mode: list nullvalue: \"\" output: stdout colseparator: \"|\" rowseparator: \"\\n\" stats: off width: filename: :memory: sqlite\u003e ","date":"2023-11-12","objectID":"/posts/2023-11-12-sqlite3/:2:1","tags":["sqlite","sqlite3","db"],"title":"sqlite3","uri":"/posts/2023-11-12-sqlite3/"},{"categories":["Database"],"content":"æ ¼å¼åŒ–è¾“å‡º .header on .mode column .timer on .changes on è¿™æ ·è®¾ç½®åªæ˜¯åœ¨å½“å‰ç»ˆç«¯ä¸­è®¾ç½®äº†æ ¼å¼åŒ–è¾“å‡ºï¼Œå½“å†æ¬¡æ‰“å¼€æ—¶åˆ™éœ€è¦å†æ¬¡è®¾ç½®ï¼Œå¯ä»¥æŠŠsqliteçš„é…ç½®å†™å…¥åˆ°~/.sqliter [sugar@localhost domain]$ cat ~/.sqliterc .header on .mode column .timer on [sugar@localhost domain]$ sqlite3 domain.db -- Loading resources from /Users/sugar/.sqliterc SQLite version 3.37.0 2021-12-09 01:34:53 Enter \".help\" for usage hints. sqlite\u003e .tables ssls sqlite\u003e select * from ssls; id created_at updated_at deleted_at status web -- -------------------------------- -------------------------------- ---------- ------ ----------------- 1 2022-10-14 23:31:24.473488+08:00 2022-10-14 23:31:24.473488+08:00 1 https://gitea.com Run Time: real 0.001 user 0.000178 sys 0.000250 ","date":"2023-11-12","objectID":"/posts/2023-11-12-sqlite3/:2:2","tags":["sqlite","sqlite3","db"],"title":"sqlite3","uri":"/posts/2023-11-12-sqlite3/"},{"categories":["Database"],"content":"ä¸‰ã€sqlæ“ä½œ åˆ›å»ºæ•°æ®åº“ $ sqlite3 cccc.db SQLite version 3.32.3 2020-06-18 14:16:19 Enter \".help\" for usage hints. sqlite\u003e ä¸Šé¢çš„å‘½ä»¤å°†åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ cccc.dbã€‚è¯¥æ–‡ä»¶å°†è¢« SQLite å¼•æ“ç”¨ä½œæ•°æ®åº“ã€‚å¦‚æœæ‚¨å·²ç»æ³¨æ„åˆ° sqlite3 å‘½ä»¤åœ¨æˆåŠŸåˆ›å»ºæ•°æ®åº“æ–‡ä»¶ä¹‹åï¼Œå°†æä¾›ä¸€ä¸ª sqlite\u003e æç¤ºç¬¦ã€‚ ä¸€æ—¦æ•°æ®åº“è¢«åˆ›å»ºï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨ SQLite çš„ .databases å‘½ä»¤æ¥æ£€æŸ¥å®ƒæ˜¯å¦åœ¨æ•°æ®åº“åˆ—è¡¨ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š sqlite\u003e .database main: /Users/sugar/Desktop/workspace/cccc.db sqlite\u003e æ•°æ®åº“å¤‡ä»½ sqlite3 cccc.db .dump \u003e cccc.sql æ¢å¤æ•°æ®åº“ sqlite3 cccc.db \u003c cccc.sql æŸ¥çœ‹è¡¨è¯¦ç»†ä¿¡æ¯ .schema éäº¤äº’å¼æ‰§è¡Œsql [sugar@Sugar sqlite]$ sqlite3 cccc.db \"select * from msg;\" -- Loading resources from /Users/sugar/.sqliterc age id --- ---- 19 1001 ","date":"2023-11-12","objectID":"/posts/2023-11-12-sqlite3/:3:0","tags":["sqlite","sqlite3","db"],"title":"sqlite3","uri":"/posts/2023-11-12-sqlite3/"},{"categories":["Database"],"content":"å››ã€sqlè¯­æ³• å¤§å°å†™ SQLiteä¸åŒºåˆ†å¤§å°å†™ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€äº›åŒºåˆ†å¤§å°å†™çš„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼šGLOBå’Œglobåœ¨SQLiteè¯­å¥ä¸­æœ‰ä¸åŒçš„å«ä¹‰ã€‚ æ³¨é‡Šï¼š æ³¨é‡Šç”¨äºåœ¨SQLiteä»£ç ä¸­å¢åŠ ä»£ç çš„å¯è¯»æ€§ã€‚ æ³¨é‡Šä¸èƒ½åµŒå¥—ã€‚ æ³¨é‡Šä»¥ä¸¤ä¸ªè¿ç»­çš„â€œ - â€å­—ç¬¦ã€‚ ä¹Ÿå¯ä½¿ç”¨â€œ/*â€å­—ç¬¦å¼€å§‹ï¼Œå¹¶å»¶ä¼¸è‡³ä¸‹ä¸€ä¸ªâ€œ*/â€å­—ç¬¦å¯¹æ‰€åŒ…æ‹¬çš„å†…å®¹è§†ä¸ºæ³¨é‡Šã€‚ 1ã€è¡¨æ“ä½œ åˆ—çš„æ•°æ®ç±»å‹ NULL â€”è¯¥å€¼ä¸º NULL å€¼ INTEGER â€”æœ‰ç¬¦å·æ•´æ•° REAL â€”æµ®ç‚¹å€¼ TEXT-æ–‡æœ¬å­—ç¬¦ä¸² BLOB â€”æ•°æ®å— -- åˆ›å»ºè¡¨ sqlite\u003e CREATE TABLE Testing(Id INTEGER); Run Time: real 0.002 user 0.000269 sys 0.001006 changes: 0 total_changes: 0 sqlite\u003e -- æŸ¥çœ‹è¡¨ç»“æ„ sqlite\u003e .schema CREATE TABLE Testing(Id INTEGER); sqlite\u003e .schema Testing CREATE TABLE Testing(Id INTEGER); sqlite\u003e -- å¦‚æœå­˜åœ¨åˆ™ä¸åˆ›å»º CREATE TABLE IF NOT EXISTS Testing(Id INTEGER); -- å¤åˆ¶è¡¨ CREATE TABLE Cars2 AS SELECT * FROM Cars; -- æŸ¥çœ‹æ‰€æœ‰è¡¨ sqlite\u003e .tables Testing -- é€šç”¨è¯­æ³• sqlite\u003e select * from sqlite_master; type name tbl_name rootpage sql ----- ------- -------- -------- -------------------------------- table Testing Testing 2 CREATE TABLE Testing(Id INTEGER) Run Time: real 0.001 user 0.000111 sys 0.000102 changes: 0 total_changes: 0 sqlite\u003e -- åˆ é™¤è¡¨ sqlite\u003e DROP TABLE Testing; sqlite\u003e DROP TABLE IF EXISTS Testing; -- é‡å‘½åæ•°è¡¨ sqlite\u003e CREATE TABLE Names(Id INTEGER, Name TEXT); sqlite\u003e ALTER TABLE Names RENAME TO NamesOfFriends; sqlite\u003e .schema NamesOfFriends 2ã€æ•°æ®æ“ä½œ sqlite\u003e CREATE TABLE Cars(Id INTEGER PRIMARY KEY, Name TEXT,Price INTEGER DEFAULT 'Not available'); -- æ’å…¥æ•°æ® sqlite\u003e INSERT INTO Cars(Id, Name, Price) VALUES(1, 'Audi', 52642); -- åˆ é™¤æ•°æ® sqlite\u003e DELETE FROM Cars2 WHERE Id=1; -- åˆ é™¤è¡¨æ‰€æœ‰æ•°æ® sqlite\u003e DELETE FROM Cars2; -- æ›´æ–°æ•°æ® sqlite\u003e UPDATE Cars SET Name='Skoda Octavia' WHERE Id=3; 3ã€çº¦æŸ # éç©º NOT NULL # å”¯ä¸€ UNIQUE # ä¸»é”® PRIMARY KEY # å¤–é”® FOREIGN KEY # é»˜è®¤å€¼ sqlite\u003e CREATE TABLE Hotels(Id INTEGER PRIMARY KEY, Name TEXT,City TEXT DEFAULT 'not available'); æ‰€æœ‰çš„SQLiteè¯­å¥éƒ½æ˜¯ä»¥å…³é”®å­—(å¦‚ï¼šSELECTï¼ŒINSERTï¼ŒUPDATEï¼ŒDELETEï¼ŒALTERï¼ŒDROPç­‰)å¼€å§‹çš„ã€‚æ‰€æœ‰è¯­å¥éƒ½ä»¥åˆ†å·(;)ç»“å°¾ã€‚ ANALYZEè¯­å¥çš„è¯­æ³•ï¼š ANALYZE; -- or ANALYZE database_name; -- or ANALYZE database_name.table_name; AND/ORå­å¥çš„è¯­æ³•ï¼š SELECT column1, column2....columnN FROM table_name WHERE CONDITION-1 {AND|OR} CONDITION-2; ALTER TABLEè¯­å¥çš„è¯­æ³• ALTER TABLE table_name ADD COLUMN column_def...; ALTER TABLEè¯­å¥(Rename)è¯­å¥çš„è¯­æ³• ALTER TABLE table_name RENAME TO new_table_name; ATTACH DATABASEè¯­å¥çš„è¯­æ³•ï¼š ATTACH DATABASE 'DatabaseName' As 'Alias-Name'; BEGIN TRANSACTIONè¯­å¥çš„è¯­æ³•ï¼š BEGIN; -- or BEGIN EXCLUSIVE TRANSACTION; BETWEENè¯­å¥çš„è¯­æ³•ï¼š SELECT column1, column2....columnN FROM table_name WHERE column_name BETWEEN val-1 AND val-2; SQLite COMMIT Statement: COMMIT; CREATE INDEXè¯­å¥çš„è¯­æ³•ï¼š CREATE INDEX index_name ON table_name ( column_name COLLATE NOCASE ); CREATE UNIQUE INDEXè¯­å¥çš„è¯­æ³•ï¼š CREATE UNIQUE INDEX index_name ON table_name ( column1, column2,...columnN); CREATE TABLEè¯­å¥çš„è¯­æ³•ï¼š CREATE TABLE table_name( column1 datatype, column2 datatype, column3 datatype, ..... columnN datatype, PRIMARY KEY( one or more columns )); CREATE TRIGGERè¯­å¥çš„è¯­æ³•ï¼š CREATE TRIGGER database_name.trigger_name BEFORE INSERT ON table_name FOR EACH ROW BEGIN stmt1; stmt2; .... END; CREATE VIEWè¯­å¥çš„è¯­æ³•ï¼š CREATE VIEW database_name.view_name AS SELECT statement....; CREATE VIRTUAL TABLEè¯­å¥çš„è¯­æ³•ï¼š CREATE VIRTUAL TABLE database_name.table_name USING weblog( access.log ); -- or CREATE VIRTUAL TABLE database_name.table_name USING fts3( ); COMMIT TRANSACTIONè¯­å¥çš„è¯­æ³•ï¼š COMMIT; COUNTè¯­å¥çš„è¯­æ³•ï¼š SELECT COUNT(column_name) FROM table_name WHERE CONDITION; DELETEè¯­å¥çš„è¯­æ³•ï¼š DELETE FROM table_name WHERE {CONDITION}; DETACH DATABASEè¯­å¥çš„è¯­æ³•ï¼š DETACH DATABASE 'Alias-Name'; DISTINCTè¯­å¥çš„è¯­æ³•ï¼š SELECT DISTINCT column1, column2....columnN FROM table_name; DROP INDEXè¯­å¥çš„è¯­æ³•ï¼š DROP INDEX database_name.index_name; DROP TABLEè¯­å¥çš„è¯­æ³•ï¼š DROP TABLE database_name.table_name; DROP VIEWè¯­å¥çš„è¯­æ³•ï¼š DROP INDEX database_name.view_name; SQLite DROP TRIGGER è¯­å¥çš„è¯­æ³•ï¼š DROP INDEX database_name.trigger_name; SQLite EXISTSè¯­å¥çš„è¯­æ³•ï¼š SELECT column1, column2....columnN FROM table_name WHERE column_name EXISTS (SELECT * FROM table_name ); EXPLAINè¯­å¥çš„è¯­æ³•ï¼š EXPLAIN INSERT statement...; -- or EXPLAIN QUERY PLAN SELECT statement...; GLOBè¯­å¥çš„è¯­æ³•ï¼š SELECT column1, column2....columnN FROM table_name WHERE column_name GLOB { PATTERN }; GROUP BYè¯­å¥çš„è¯­æ³•ï¼š SELECT SUM(column_name) FROM table_name WHERE CONDITION GROUP BY column_name; HAVINGè¯­å¥çš„è¯­æ³•ï¼š SELEC","date":"2023-11-12","objectID":"/posts/2023-11-12-sqlite3/:4:0","tags":["sqlite","sqlite3","db"],"title":"sqlite3","uri":"/posts/2023-11-12-sqlite3/"},{"categories":["æœºå™¨äººé€šçŸ¥"],"content":"é’‰é’‰æœºå™¨äºº ","date":"2023-11-11","objectID":"/posts/2023-11-11-dingbot/:0:0","tags":["dingbot"],"title":"dingbot","uri":"/posts/2023-11-11-dingbot/"},{"categories":["æœºå™¨äººé€šçŸ¥"],"content":"ä¸€ã€shellè„šæœ¬ ","date":"2023-11-11","objectID":"/posts/2023-11-11-dingbot/:1:0","tags":["dingbot"],"title":"dingbot","uri":"/posts/2023-11-11-dingbot/"},{"categories":["æœºå™¨äººé€šçŸ¥"],"content":"1ã€åŸºäºå…³é”®å­—æˆ–è€… ip ç‰ˆ å‘é€txtæ ¼å¼æ¶ˆæ¯ info='hello' logFile='/var/log/dingbot.log' #å‘é€æ¶ˆæ¯ sendMsg() { token='1e18ffe069052b56f5a0f8fe9b6c058373e7df7ef4xxxxxxxxxxxxxxx' result=$(curl -s \"https://oapi.dingtalk.com/robot/send?access_token=$token\" \\ -H 'Content-Type: application/json' \\ -d \"{'msgtype': 'text','text': {'content': 'msg:\\n$*'}}\") [ $(echo $result | grep \"errmsg.*ok\") ] \u0026\u0026 echo 'send succees!' echo \"$(date +'%Y-%m-%d %H:%M.%S') state: $result msg: $*\" \u003e\u003e$logFile } sendMsg $info å‘é€ markdown æ ¼å¼æ¶ˆæ¯ logFile='/var/log/DingBot.log' token='1e18ffe069052b56f5a0f8fe9b6c058373xxxxxxxxxxxxxx' #å‘é€æ¶ˆæ¯ sendMsg() { local info=$* result=$(curl -s \"https://oapi.dingtalk.com/robot/send?access_token=$token\" \\ -H 'Content-Type: application/json' \\ -d \"{'msgtype': 'text', 'text': { 'content': '$info' } }\") [ $(echo $result | grep \"errmsg.*ok\") ] \u0026\u0026 echo 'send succees!' echo \"$(date +'%Y-%m-%d %H:%M.%S') state: $result MessagesType: text [ text: $* ]\" \u003e\u003e$logFile } SendMsgByMD() { local info=$1 # $info markdownçš„æ ‡é¢˜ local infoMsg=$2 # $infoMsg å†…å®¹ # token='1e18ffe069052b56f5a0f8fe9b6c058373e7df7xxxxxxxxxxxxxx' result=$(curl -s \"https://oapi.dingtalk.com/robot/send?access_token=$token\" \\ -H 'Content-Type: application/json' \\ -d \"{ 'msgtype': 'markdown', 'markdown': { 'title':'$info', 'text': '$infoMsg' }, 'at': { 'atMobiles': [ '156xxxx8827', '189xxxx8325' ], 'isAtAll': true } }\") [ $(echo $result | grep \"errmsg.*ok\") ] \u0026\u0026 echo 'send succees!' echo \"$(date +'%Y-%m-%d %H:%M.%S') state: $result MessagesType: markdown [ title: $info text: $infoMsg ]\" \u003e\u003e$logFile } #main() (sendMsg 'zabbix') \u0026 (SendMsgByMD 'zabbix' '# send msg') \u0026 ","date":"2023-11-11","objectID":"/posts/2023-11-11-dingbot/:1:1","tags":["dingbot"],"title":"dingbot","uri":"/posts/2023-11-11-dingbot/"},{"categories":["æœºå™¨äººé€šçŸ¥"],"content":"2ã€ç­¾åè®¡ç®—ç‰ˆ è®¡ç®—ç­¾åæ˜¯ä½¿ç”¨çš„dateæ˜¯linuxç‰ˆçš„ï¼Œè€Œmacä¸Šçš„dateæ˜¯unixç‰ˆçš„ï¼Œåœ¨macä¸Šéœ€è¦æ›¿æ¢ä¸ºlinuxç‰ˆçš„dateæ‰èƒ½æ­£å¸¸è®¡ç®—ç­¾åã€‚ ## é’‰é’‰æœºå™¨äººé…ç½® dingbot_secret='SECa87axxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' dingbot_url='https://oapi.dingtalk.com/robot/send?access_token=cd3xxxxxxxxxxxxx' ## secret_type keywords || sign ding_secret_type='sign' ## éœ€è¦è‰¾ç‰¹çš„äººçš„æ‰‹æœºå·ç ï¼Œä»¥ç©ºæ ¼éš”å¼€ atMobiles=(13346123456 13346123457) ## encode url function url_encode() { t=\"${1}\" if [[ -n \"${1}\" \u0026\u0026 -n \"${2}\" ]];then if ! echo 'xX' | grep -q \"${t}\";then t='x' fi echo -n \"${2}\" | od -t d1 | awk -v a=\"${t}\" '{for (i = 2; i \u003c= NF; i++) {printf(($i\u003e=48 \u0026\u0026 $i\u003c=57) || ($i\u003e=65 \u0026\u0026$i\u003c=90) || ($i\u003e=97 \u0026\u0026 $i\u003c=122) ||$i==45 || $i==46 || $i==95 || $i==126 ?\"%c\" : \"%%%02\"a, $i)}}' else echo -e '$1 and $2 can not empty\\n$1 ==\u003e 'x' or 'X', x ==\u003e lower, X ==\u003e toupper.\\n$2 ==\u003e Strings need to url encode' fi } ## Dingbot function dingbot(){ send_strs=\"${1}\" new_url=\"${dingbot_url}\" at_who='' for i in ${atMobiles[*]} do if [ -n \"${at_who}\" ];then at_who=\"${at_who},\\\"${i}\\\"\" else at_who=\"\\\"${i}\\\"\" fi done if [ \"${ding_secret_type}\" == 'keywords' ];then curl -s -X POST -H 'Content-Type: application/json' \"${new_url}\" \\ -d \"{\\\"at\\\":{\\\"atMobiles\\\":[${at_who}]},\\\"msgtype\\\":\\\"text\\\",\\\"text\\\":{\\\"content\\\":\\\"${send_strs}\\\"}}\" elif [ \"${ding_secret_type}\" == 'sign' ];then timestamp=$(date \"+%s%3N\") dingbot_sign=$(echo -ne \"${timestamp}\\n${dingbot_secret}\" | openssl dgst -sha256 -hmac \"${dingbot_secret}\" -binary | base64) dingbot_sign=$(url_encode 'X' \"${dingbot_sign}\") post_url=\"${dingbot_url}\u0026timestamp=${timestamp}\u0026sign=${dingbot_sign}\" curl -s -X POST -H 'Content-Type: application/json' \"${post_url}\" \\ -d \"{\\\"at\\\":{\\\"atMobiles\\\":[${at_who}]},\\\"msgtype\\\":\\\"text\\\",\\\"text\\\":{\\\"content\\\":\\\"${send_strs}\\\"}}\" else echo \"secret_type æœªçŸ¥ï¼Œè¯·æ£€æŸ¥é…ç½®\" fi } dingbot \"hello\" ","date":"2023-11-11","objectID":"/posts/2023-11-11-dingbot/:1:2","tags":["dingbot"],"title":"dingbot","uri":"/posts/2023-11-11-dingbot/"},{"categories":["æœºå™¨äººé€šçŸ¥"],"content":"äºŒã€pythonç‰ˆ ","date":"2023-11-11","objectID":"/posts/2023-11-11-dingbot/:2:0","tags":["dingbot"],"title":"dingbot","uri":"/posts/2023-11-11-dingbot/"},{"categories":["æœºå™¨äººé€šçŸ¥"],"content":"1ã€åŸºäºå…³é”®å­—æˆ–è€… ip #!/usr/bin/python3 # encoding: utf-8 import requests import json def dingmsg(): #é’‰é’‰æœºå™¨äººçš„url ding_url = 'https://oapi.dingtalk.com/robot/send?access_token=' #é’‰é’‰æœºå™¨äººçš„token token = 'ba9b7c169caebb1048a66845fa8344348b3e8fdaefxxxxxxxxxxx' #è¯·æ±‚çš„urlï¼Œwebhookçš„åœ°å€ webhook = ding_url+token #æ„å»ºè¯·æ±‚çš„å¤´éƒ¨ header = { \"Content-Type\": \"application/json\", \"Charset\": \"UTF-8\" } #æ„å»ºè¯·æ±‚æ•°æ® text = \"this is first python to test dingding\" msg = { \"msgtype\": \"text\", \"text\": { \"content\": text, } } #å¯¹è¯·æ±‚çš„æ•°æ®è¿›è¡Œå°è£… msg_json = json.dumps(msg) #å‘èµ·è¯·æ±‚ info = requests.post(url=webhook,data=msg_json,headers=header) #æ‰“å°è¿”å›çš„ç»“æœ print(info.text) if __name__ == \"__main__\": dingmsg() ","date":"2023-11-11","objectID":"/posts/2023-11-11-dingbot/:2:1","tags":["dingbot"],"title":"dingbot","uri":"/posts/2023-11-11-dingbot/"},{"categories":["æœºå™¨äººé€šçŸ¥"],"content":"2ã€åŸºäºåŠ ç­¾è®¡ç®— #!/usr/bin/python3 # encoding: utf-8 import requests import json import time import hmac import hashlib import base64 import urllib.parse class dingRobot: def __init__(self): self.dingUrl = 'https://oapi.dingtalk.com/robot/send?access_token=' self.__secret = 'SECc95942d1139feaefcdef6abf33e6497eb3d0120b4ca3dxxxxxxxxxx' self.__token = 'ba9b7c169caebb1048a66845fa8344348b3e8fdaef264e6exxxxxxxxxxxdc' self.__sign = '' self.__timestamp = '' def createTimestampSign(self): self.__timestamp = str(round(time.time() * 1000)) secret_enc = self.__secret.encode('utf-8') string_to_sign = '{}\\n{}'.format(self.__timestamp, self.__secret) string_to_sign_enc = string_to_sign.encode('utf-8') hmac_code = hmac.new(secret_enc, string_to_sign_enc, digestmod=hashlib.sha256).digest() self.__sign = urllib.parse.quote_plus(base64.b64encode(hmac_code)) def sendMsg(self,text): self.createTimestampSign() # è¯·æ±‚çš„urlï¼Œwebhookçš„åœ°å€ webhook = self.dingUrl + self.__token + '\u0026timestamp=' + self.__timestamp + '\u0026sign=' + self.__sign # æ„å»ºè¯·æ±‚çš„å¤´éƒ¨ header = { \"Content-Type\": \"application/json\", \"Charset\": \"UTF-8\" } # æ„å»ºè¯·æ±‚æ•°æ® # text = \"this is first python to test dingding\" msg = { \"msgtype\": \"text\", \"text\": { \"content\": text, } } # å¯¹è¯·æ±‚çš„æ•°æ®è¿›è¡Œå°è£… msg_json = json.dumps(msg) # å‘èµ·è¯·æ±‚ info = requests.post(url=webhook, data=msg_json, headers=header) return info if __name__ == \"__main__\": robot = dingRobot() result = robot.sendMsg('åªæ˜¯ç”¨äºæµ‹è¯•') if json.loads(result.text)['errcode'] == 0: print(\"å‘é€æ¶ˆæ¯æˆåŠŸ\") else: print(\"å‘é€æ¶ˆæ¯å¤±è´¥\") ","date":"2023-11-11","objectID":"/posts/2023-11-11-dingbot/:2:2","tags":["dingbot"],"title":"dingbot","uri":"/posts/2023-11-11-dingbot/"},{"categories":["linux åŸºç¡€"],"content":"æœåŠ¡å™¨ä¸­æœ‰å…³å¸¸ç”¨ç«¯å£çš„ä¿¡æ¯åœ¨/etc/servicesæ–‡ä»¶ä¸­è®°å½• [root@localhost ~]# vim /etc/services åè®® ç«¯å£ è¯´æ˜ FTP 21 FTPæœåŠ¡ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ã€‚ SSH 22 è¿œç¨‹è¿æ¥Linuxå¼¹æ€§äº‘æœåŠ¡å™¨æˆ–è€…SFTPã€‚ Telnet 23 ä½¿ç”¨Telnetåè®®è®¿é—®ç½‘ç«™ã€‚ HTTP 80 ä½¿ç”¨HTTPåè®®è®¿é—®ç½‘ç«™ã€‚ POP3 110 ä½¿ç”¨POP3åè®®æ¥å—é‚®ä»¶ã€‚ IMAP 143 ä½¿ç”¨IMAPåè®®æ¥å—é‚®ä»¶ã€‚ LDAP 389 LDAPç«¯å£ HTTPS 443 ä½¿ç”¨HTTPSåè®®è®¿é—®ç½‘ç«™ã€‚ LDAPS 636 LDAP over SSL SQL Server 1433 SQL Serverçš„TCPç«¯å£ï¼Œç”¨äºä¾›SQL Serverå¯¹å¤–æä¾›æœåŠ¡ã€‚ SQL Server 1434 SQL Serverçš„TCPç«¯å£ï¼Œç”¨äºè¿”å›SQLServerä½¿ç”¨äº†å“ªä¸ªTCP/IPç«¯å£ã€‚ Oracle 1521 Oracleé€šä¿¡ç«¯å£ï¼Œå¼¹æ€§äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†Oracle SQLéœ€è¦æ”¾è¡Œçš„ç«¯å£ã€‚ MySQL 3306 MySQLæ•°æ®åº“å¯¹å¤–æä¾›æœåŠ¡çš„ç«¯å£ã€‚ Windows Server Remote Desktop Services 3389 Windowsè¿œç¨‹æ¡Œé¢æœåŠ¡ç«¯å£ï¼Œé€šè¿‡è¿™ä¸ªç«¯å£å¯ä»¥è¿æ¥Windowså¼¹æ€§äº‘æœåŠ¡å™¨ã€‚ Postgresql 5432 Postgresqlæ•°æ®åº“å¯¹å¤–æä¾›æœåŠ¡ç«¯å£ Redis 6379 Rediså¯¹å¤–æä¾›æœåŠ¡ç«¯å£ RabbitMQ 5672/15672 5672æ˜¯rabbitmqå¯¹å¤–æä¾›æœåŠ¡ç«¯å£ï¼Œ15672æ˜¯rabbitmq managementå¯¹å¤–æä¾›æœåŠ¡ç«¯å£ ä»£ç† 8080 8080ç«¯å£å¸¸ç”¨äºWWWä»£ç†æœåŠ¡ï¼Œå®ç°ç½‘é¡µæµè§ˆï¼Œå®ç°ç½‘é¡µæµè§ˆã€‚å¦‚æœæ‚¨ä½¿ç”¨8080ç«¯å£ï¼Œè®¿é—®ç½‘ç«™æˆ–ä½¿ç”¨ä»£ç†æœåŠ¡å™¨æ—¶ï¼Œéœ€è¦åœ¨IPåœ°å€åé¢åŠ ä¸Šï¼š8080ã€‚å®‰è£…Apache TomcatæœåŠ¡åï¼Œé»˜è®¤æœåŠ¡ç«¯å£ä¸º8080ã€‚ NetBIOS 137ã€138ã€139 NetBIOSåè®®å¸¸è¢«ç”¨äºWindowsæ–‡ä»¶ã€æ‰“å°æœºå…±äº«å’ŒSambaã€‚Â·137ã€138:UDPç«¯å£ï¼Œé€šè¿‡ç½‘ä¸Šé‚»å±…ä¼ è¾“æ–‡ä»¶æ—¶ä½¿ç”¨çš„ç«¯å£ã€‚Â·139:é€šè¿‡è¿™ä¸ªç«¯å£è¿›å…¥çš„è¿æ¥è¯•å›¾è·å¾—NetBIOS/SMBæœåŠ¡ã€‚ æ— æ³•è®¿é—®å…¬æœ‰äº‘æŸäº›ç«¯å£ 1ï¼‰é—®é¢˜ç°è±¡ï¼š è®¿é—®å…¬æœ‰äº‘ç‰¹å®šç«¯å£ï¼Œåœ¨éƒ¨åˆ†åœ°åŒºéƒ¨åˆ†è¿è¥å•†æ— æ³•è®¿é—®ï¼Œè€Œå…¶å®ƒç«¯å£è®¿é—®æ­£å¸¸ã€‚ 2ï¼‰é—®é¢˜åˆ†æï¼š éƒ¨åˆ†è¿è¥å•†åˆ¤æ–­å¦‚ä¸‹è¡¨çš„ç«¯å£ä¸ºé«˜å±ç«¯å£ï¼Œé»˜è®¤è¢«å±è”½ã€‚ é«˜å±ç«¯å£ åè®® ç«¯å£ TCP 42 135 138 139 444 445 593 1025 1068 1434 3127 3128 3129 3130 UDP 135ï½139 1026 1027 1028 è§£å†³æ–¹æ¡ˆï¼š å»ºè®®æ‚¨ä¿®æ”¹æ•æ„Ÿç«¯å£ä¸ºå…¶å®ƒéé«˜å±ç«¯å£æ¥æ‰¿è½½ä¸šåŠ¡ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-port/:0:0","tags":["port"],"title":"port","uri":"/posts/2023-11-11-port/"},{"categories":["web server"],"content":"Caddy Caddy æ˜¯ä¸€ä¸ª Go ç¼–å†™çš„ Web æœåŠ¡å™¨ï¼Œç±»ä¼¼äº Nginxï¼ŒCaddy æä¾›äº†æ›´åŠ å¼ºå¤§çš„åŠŸèƒ½ï¼Œéšç€ v2 ç‰ˆæœ¬å‘å¸ƒ Caddy å·²ç»å¯ä»¥ä½œä¸ºä¸­å°å‹ç«™ç‚¹ Web æœåŠ¡å™¨çš„å¦ä¸€ä¸ªé€‰æ‹©ï¼›ç›¸è¾ƒäº Nginx æ¥è¯´ä½¿ç”¨ Caddy çš„ä¼˜åŠ¿å¦‚ä¸‹: è‡ªåŠ¨çš„ HTTPS è¯ä¹¦ç”³è¯·(ACME HTTP/DNS æŒ‘æˆ˜) è‡ªåŠ¨è¯ä¹¦ç»­æœŸä»¥åŠ OCSP stapling ç­‰ æ›´é«˜çš„å®‰å…¨æ€§åŒ…æ‹¬ä½†ä¸é™äº TLS é…ç½®ä»¥åŠå†…å­˜å®‰å…¨ç­‰ å‹å¥½ä¸”å¼ºå¤§çš„é…ç½®æ–‡ä»¶æ”¯æŒ æ”¯æŒ API åŠ¨æ€è°ƒæ•´é…ç½®(æœ‰æœ¨æœ‰äººå¯ä»¥æä¸ª Dashboardï¼Ÿ) æ”¯æŒ HTTP3(QUIC) æ”¯æŒåŠ¨æ€åç«¯ï¼Œä¾‹å¦‚è¿æ¥ Consulã€ä½œä¸º k8s ingress ç­‰ åç«¯å¤šç§è´Ÿè½½ç­–ç•¥ä»¥åŠå¥åº·æ£€æµ‹ç­‰ æœ¬èº« Go ç¼–å†™ï¼Œé«˜åº¦æ¨¡å—åŒ–çš„ç³»ç»Ÿæ–¹ä¾¿æ‰©å±•(CoreDNS åŸºäº Caddy1 å¼€å‘) ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:0:0","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"ä¸€ã€Caddyfile ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:1:0","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"1ã€ç®€å•ä½¿ç”¨ åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºCaddyfileæ–‡ä»¶ localhost { respond \"Hello, world!\" } localhost:2016 { respond \"Goodbye, world!\" } æœåŠ¡ç®¡ç† # å¯åŠ¨æœåŠ¡ caddy start # é‡å¯æœåŠ¡ï¼Œé‡å¯æœåŠ¡æœ‰ä¸¤ç§æ–¹å¼ caddy reload curl localhost:2019/load \\ -X POST \\ -H \"Content-Type: text/caddyfile\" \\ --data-binary @Caddyfile # åœæ­¢æœåŠ¡ caddy stop ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:1:1","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"2ã€é™æ€æ–‡ä»¶ç®¡ç† æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨ localhost file_server browse æ–‡ä»¶å¤¹ä½œä¸ºç«™ç‚¹æ ¹ç›®å½•ï¼š localhost root * /home/me/mysite file_server ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:1:2","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"3ã€åå‘ä»£ç† localhost reverse_proxy 127.0.0.1:9000 ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:1:3","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"4ã€å¯ç”¨å‹ç¼©ç®—æ³• localhost encode zstd gzip file_server browse ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:1:4","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"5ã€å¤šä¸ªç«™ç‚¹ :8080 { respond \"I am 8080\" } :8081 { respond \"I am 8081\" } å¤šç«¯å£ :8080, :8081 { ... } ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:1:5","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"6ã€åŒ¹é…å™¨ å¯¹æŸä¸€ä¸ªapiä½¿ç”¨åå‘ä»£ç† localhost file_server reverse_proxy /api/* 127.0.0.1:9005 # ç°åœ¨åå‘ä»£ç†åªä¼šå¤„ç†æ‰€æœ‰ä»¥/api/å¼€å§‹çš„è¯·æ±‚ã€‚ ä½¿ç”¨ç¯å¢ƒå˜é‡ export SITE_ADDRESS=localhost:9055 {$SITE_ADDRESS} file_server root * /var/www # matcher token: * root /index.html /var/www # matcher token: /index.html root @post /var/www # matcher token: @post å ä½ç¬¦ ç®€å†™ æ›¿æ¢ {dir} {http.request.uri.path.dir} {file} {http.request.uri.path.file} {header.*} {http.request.header.*} {host} {http.request.host} {labels.*} {http.request.host.labels.*} {hostport} {http.request.hostport} {port} {http.request.port} {method} {http.request.method} {path} {http.request.uri.path} {path.*} {http.request.uri.path.*} {query} {http.request.uri.query} {query.*} {http.request.uri.query.*} {re.*.*} {http.regexp.*.*} {remote} {http.request.remote} {remote_host} {http.request.remote.host} {remote_port} {http.request.remote.port} {scheme} {http.request.scheme} {uri} {http.request.uri} {tls_cipher} {http.request.tls.cipher_suite} {tls_version} {http.request.tls.version} {tls_client_fingerprint} {http.request.tls.client.fingerprint} {tls_client_issuer} {http.request.tls.client.issuer} {tls_client_serial} {http.request.tls.client.serial} {tls_client_subject} {http.request.tls.client.subject} {tls_client_certificate_pem} {http.request.tls.client.certificate_pem} {tls_client_certificate_der_base64} {http.request.tls.client.certificate_der_base64} {upstream_hostport} {http.reverse_proxy.upstream.hostport} åœ¨Caddyfileä¸­ï¼Œç´§è·Ÿåœ¨æŒ‡ä»¤åé¢çš„åŒ¹é…å™¨æ ‡è®°å¯ä»¥é™åˆ¶è¯¥æŒ‡ä»¤çš„èŒƒå›´ã€‚åŒ¹é…å™¨æ ‡è®°å¯ä»¥æ˜¯ä»¥ä¸‹å½¢å¼ä¹‹ä¸€ï¼š \\* åŒ¹é…æ‰€æœ‰è¯·æ±‚ï¼ˆé€šé…ç¬¦ï¼›é»˜è®¤ï¼‰ã€‚ /path ä»¥æ­£æ–œæ å¼€å¤´ä»¥åŒ¹é…è¯·æ±‚è·¯å¾„ã€‚ @name æŒ‡å®šä¸€ä¸ªå‘½ååŒ¹é…å™¨ã€‚ åŒ¹é…å™¨æ ‡è®°é€šå¸¸æ˜¯å¯é€‰çš„ã€‚å¦‚æœçœç•¥åŒ¹é…å™¨æ ‡è®°ï¼Œåˆ™å®ƒä¸é€šé…ç¬¦åŒ¹é…å™¨ï¼ˆ*ï¼‰ç›¸åŒã€‚ å‘½ååŒ¹é…å™¨ è¦åŒ¹é…è·¯å¾„ä»¥å¤–çš„ä»»ä½•å†…å®¹ï¼Œè¯·å®šä¹‰ä¸€ä¸ªå‘½ååŒ¹é…å™¨å¹¶ä½¿ç”¨@nameå¼•ç”¨å®ƒï¼š @postfoo { method POST path /foo/* } reverse_proxy @postfoo localhost:9000 @websockets { header Connection *Upgrade* header Upgrade websocket } reverse_proxy @websockets localhost:6001 file file { root \u003cpaths\u003e try_files \u003cfiles...\u003e try_policy first_exist|smallest_size|largest_size|most_recent_modified split_path \u003cdelims...\u003e } é€šè¿‡æ–‡ä»¶è¿›è¡ŒåŒ¹é…ã€‚ rootå®šä¹‰åœ¨å…¶ä¸­æŸ¥æ‰¾æ–‡ä»¶çš„ç›®å½•ã€‚é»˜è®¤æ˜¯å½“å‰å·¥ä½œç›®å½•ï¼Œæˆ–è€…rootå˜é‡ ({http.vars.root})å¯¹åº”çš„ä½ç½® (å¯ä»¥é€šè¿‡rootæŒ‡ä»¤è®¾ç½®)ã€‚ try_filesæ£€æŸ¥å…¶åˆ—è¡¨ä¸­ä¸é‡è¯•ç­–ç•¥(try_policy)åŒ¹é…çš„æ–‡ä»¶ã€‚å¦‚æœtry_policyæ˜¯first_existï¼Œé‚£ä¹ˆåˆ—è¡¨ä¸­çš„æœ€åä¸€é¡¹å¯èƒ½æ˜¯ä¸€ä¸ªä»¥=(æ¯”å¦‚=404)å¼€å¤´çš„æ•°å­—ï¼Œä½œä¸ºåå¤‡ï¼Œå°†è§¦å‘ä»¥è¿™ä¸ªæ•°å­—ä½œä¸ºé”™è¯¯ç çš„å›è°ƒ; è¯¥é”™è¯¯ä¹Ÿå¯ä»¥ä½¿ç”¨handle_errorsæ•è·å’Œå¤„ç†é”™è¯¯ã€‚ try_policy æŒ‡å®šå¦‚ä½•é€‰æ‹©æ–‡ä»¶ã€‚é»˜è®¤ä¸º first_exist . first_existæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚é€‰æ‹©å­˜åœ¨çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚ smallest_sizeé€‰æ‹©å¤§å°æœ€å°çš„æ–‡ä»¶ã€‚ largest_sizeé€‰æ‹©æœ€å¤§çš„æ–‡ä»¶ã€‚ most_recent_modifiedé€‰æ‹©æœ€è¿‘ä¿®æ”¹çš„æ–‡ä»¶ã€‚ split_pathå°†å¯¼è‡´è·¯å¾„åœ¨æ¯ä¸ªè¦å°è¯•çš„æ–‡ä»¶è·¯å¾„ä¸­æ‰¾åˆ°çš„åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªåˆ†éš”ç¬¦å¤„æ‹†åˆ†ã€‚å¯¹äºæ¯ä¸ªæ‹†åˆ†å€¼ï¼Œæ‹†åˆ†çš„å·¦ä¾§ï¼ˆåŒ…æ‹¬åˆ†éš”ç¬¦æœ¬èº«ï¼‰å°†æ˜¯å°è¯•çš„æ–‡ä»¶è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œ/remote.php/dav/ä½¿ç”¨.phpä½œä¸ºåˆ†éš”ç¬¦ï¼Œå°†å°è¯•æ–‡ä»¶/remote.phpã€‚æ¯ä¸ªåˆ†éš”ç¬¦å¿…é¡»å‡ºç°åœ¨ URI è·¯å¾„ç»„ä»¶çš„æœ«å°¾ï¼Œæ‰èƒ½ç”¨ä½œæ‹†åˆ†åˆ†éš”ç¬¦ã€‚è¿™æ˜¯ä¸€ä¸ªå°ä¼—è®¾ç½®ï¼Œä¸»è¦ç”¨äºä¸º PHP ç«™ç‚¹æä¾›æœåŠ¡ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:1:6","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"7ã€åœ°å€ æœ‰æ•ˆåœ°å€ï¼š localhost example.com :443 http://example.com localhost:8080 127.0.0.1 [::1]:2015 example.com/foo/* *.example.com http:// æ³¨æ„ï¼šå¦‚æœä½ çš„ç«™ç‚¹åœ°å€åŒ…å«ä¸»æœºåæˆ– IP åœ°å€ï¼Œåˆ™ä¼šå¯ç”¨è‡ªåŠ¨HTTPSã€‚ç„¶è€Œï¼Œè¿™ç§è¡Œä¸ºçº¯ç²¹æ˜¯éšå«çš„ï¼Œå› æ­¤å®ƒæ°¸è¿œä¸ä¼šè¦†ç›–ä»»ä½•æ˜¾å¼é…ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç«™ç‚¹çš„åœ°å€æ˜¯http://example.comï¼Œåˆ™ä¸ä¼šæ¿€æ´»è‡ªåŠ¨HTTPSï¼Œå› ä¸ºè¯¥æ–¹æ¡ˆæ˜¯æ˜ç¡®çš„http://ã€‚ å¦‚æœæ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œåˆ™å›é€€åˆ°å‘å‡º404é”™è¯¯ã€‚ file {path}.html {path} =404 header header \u003cfield\u003e [\u003cvalue\u003e] é€šè¿‡è¯·æ±‚å¤´å­—æ®µè¿›è¡ŒåŒ¹é…ã€‚ \u003cfield\u003e æ˜¯è¦æ£€æŸ¥çš„ HTTP æ ‡å¤´å­—æ®µçš„åç§°ã€‚ å¦‚æœä»¥!ä¸ºå‰ç¼€ï¼Œåˆ™è¯¥å­—æ®µå¿…é¡»ä¸å­˜åœ¨æ‰èƒ½åŒ¹é… (çœç•¥valueå‚æ•°). \u003cvalue\u003e æ˜¯å­—æ®µå¿…é¡»åŒ¹é…çš„å€¼ã€‚ å¦‚æœå‰ç¼€æ˜¯*ï¼Œåˆ™æ‰§è¡Œå¿«é€Ÿåç¼€åŒ¹é…ã€‚ å¦‚æœåç¼€ä¸º*ï¼Œåˆ™æ‰§è¡Œå¿«é€Ÿå‰ç¼€åŒ¹é…ã€‚ å¦‚æœç”¨*æ‹¬èµ·æ¥ï¼Œå®ƒå°†æ‰§è¡Œå¿«é€Ÿå­å­—ç¬¦ä¸²åŒ¹é…ã€‚ å¦åˆ™ï¼Œå®ƒæ˜¯å¿«é€Ÿç²¾ç¡®åŒ¹é…ã€‚ ç»Ÿä¸€é›†åˆçš„ä¸åŒheaderå­—æ®µæ˜¯â€œå’Œâ€çš„å…³ç³»ã€‚æ¯ä¸ªå­—æ®µçš„å¤šä¸ªå€¼ä¹‹é—´æ˜¯â€œæˆ–â€çš„å…³ç³»ã€‚ ç¤ºä¾‹ï¼š åŒ¹é…è¯·æ±‚Connectionæ ‡å¤´å­—æ®µåŒ…å«Upgradeçš„è¯·æ±‚ï¼š header Connection *Upgrade* åŒ¹é…Fooæ ‡å¤´å­—æ®µåŒ…å«baræˆ–è€…bazçš„è¯·æ±‚ï¼š @foo { header Foo bar header Foo baz } åŒ¹é…æ ¹æœ¬æ²¡æœ‰Fooæ ‡å¤´å­—æ®µçš„è¯·æ±‚ï¼š @not_foo { header !Foo } ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:1:7","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"8ã€ç‰‡æ®µ å¯ä»¥å®šä¹‰ç§°ä¸ºç‰‡æ®µçš„ç‰¹æ®Šå—ï¼Œæ–¹æ³•æ˜¯ç»™å®ƒä»¬ä¸€ä¸ªç”¨æ‹¬å·æ‹¬èµ·æ¥çš„åç§°ï¼š (redirect) { @http { protocol http } redir @http https://{host}{uri} } ç„¶åä½ å¯ä»¥åœ¨ä»»ä½•ä½ éœ€è¦çš„åœ°æ–¹é‡å¤ä½¿ç”¨å®ƒï¼š import redirect ä¾‹å¦‚ï¼š (snippet) { respond \"Yahaha! You found {args.0}!\" } a.example.com { import snippet \"Example A\" } b.example.com { import snippet \"Example B\" } ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:1:8","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"9ã€å…¨å±€å‚æ•° { # General Options debug http_port \u003cport\u003e https_port \u003cport\u003e order \u003cdir1\u003e first|last|[before|after \u003cdir2\u003e] storage \u003cmodule_name\u003e { \u003coptions...\u003e } storage_clean_interval \u003cduration\u003e admin off|\u003caddr\u003e { origins \u003corigins...\u003e enforce_origin } log [name] { output \u003cwriter_module\u003e ... format \u003cencoder_module\u003e ... level \u003clevel\u003e include \u003cnamespaces...\u003e exclude \u003cnamespaces...\u003e } grace_period \u003cduration\u003e # TLS Options auto_https off|disable_redirects|ignore_loaded_certs email \u003cyours\u003e default_sni \u003cname\u003e local_certs skip_install_trust acme_ca \u003cdirectory_url\u003e acme_ca_root \u003cpem_file\u003e acme_eab \u003ckey_id\u003e \u003cmac_key\u003e acme_dns \u003cprovider\u003e ... on_demand_tls { ask \u003cendpoint\u003e interval \u003cduration\u003e burst \u003cn\u003e } key_type ed25519|p256|p384|rsa2048|rsa4096 cert_issuer \u003cname\u003e ... ocsp_stapling off preferred_chains [smallest] { root_common_name \u003ccommon_names...\u003e any_common_name \u003ccommon_names...\u003e } # Server Options servers [\u003clistener_address\u003e] { listener_wrappers { \u003clistener_wrappers...\u003e } timeouts { read_body \u003cduration\u003e read_header \u003cduration\u003e write \u003cduration\u003e idle \u003cduration\u003e } max_header_size \u003csize\u003e protocol { allow_h2c experimental_http3 strict_sni_host } } } ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:1:9","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"äºŒã€ä½¿ç”¨ç¤ºä¾‹ 1ã€é™æ€æ–‡ä»¶æœåŠ¡å™¨ example.com { root * /var/www file_server } åƒå¾€å¸¸ä¸€æ ·ï¼Œç¬¬ä¸€è¡Œæ˜¯ç«™ç‚¹åœ°å€ã€‚è¯¥rootæŒ‡ä»¤æŒ‡å®šç«™ç‚¹æ ¹ç›®å½•çš„è·¯å¾„ï¼ˆ*åŒ¹é…æ‰€æœ‰è¯·æ±‚çš„æ–¹æ³•ï¼Œä»¥ä¾¿ä¸è·¯å¾„åŒ¹é…å™¨æ¶ˆé™¤æ­§ä¹‰ï¼‰ï¼›å¦‚æœç«™ç‚¹ä¸æ˜¯å½“å‰å·¥ä½œç›®å½•ï¼Œåˆ™æ›´æ”¹ç«™ç‚¹çš„è·¯å¾„ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ç”¨é™æ€æ–‡ä»¶æœåŠ¡å™¨ã€‚ 2ã€åå‘ä»£ç†æœåŠ¡å™¨ ä»£ç†æ‰€æœ‰è¯·æ±‚ example.com { reverse_proxy localhost:5000 } åªä»£ç†ä»¥/api/å¼€å¤´çš„è¯·æ±‚ï¼Œå¹¶ä¸ºå…¶ä»–æ‰€æœ‰å†…å®¹æä¾›é™æ€æ–‡ä»¶ï¼š example.com {} root * /var/www reverse_proxy /api/* localhost:5000 file_server } 3ã€php åœ¨è¿è¡ŒPHP FastCGIæœåŠ¡çš„æƒ…å†µä¸‹ï¼Œç±»ä¼¼è¿™æ ·çš„å†…å®¹é€‚ç”¨äºå¤§å¤šæ•°ç°ä»£PHPåº”ç”¨ç¨‹åº example.com root * /var/www php_fastcgi /blog/* localhost:9000 file_server è¯·å¯¹åº”åœ°è°ƒæ•´ç«™ç‚¹æ ¹ç›®å½•å’Œè·¯å¾„åŒ¹é…å™¨ï¼›æ­¤ç¤ºä¾‹å‡å®šPHPä»…ä½äº/blog/å­ç›®å½•ä¸­â€”â€”æ‰€æœ‰å…¶ä»–è¯·æ±‚å°†ä½œä¸ºé™æ€æ–‡ä»¶æä¾›ã€‚ è¯¥php_fastcgiæŒ‡ä»¤å®é™…ä¸Šåªæ˜¯å‡ ä¸ªé…ç½®çš„å¿«æ·æ–¹å¼ã€‚ 4ã€é‡å®šå‘åˆ°www.å­åŸŸå example.com { redir https://www.example.com{uri} } www.example.com { } www.example.com { redir https://example.com{uri} } example.com { } 5ã€é€šé…ç¬¦è¯ä¹¦ *.example.com { tls { dns \u003cprovider_name\u003e [\u003cparams...\u003e] } @foo host foo.example.com handle @foo { respond \"Foo!\" } @bar host bar.example.com handle @bar { respond \"Bar!\" } # Fallback for otherwise unhandled domains handle { abort } } 6ã€web example.com { # ç½‘ç«™çš„åŸŸåä¿¡æ¯ tls example.com.pem example.com.key # è¯ä¹¦å’Œå¯†é’¥çš„ PEM æ ¼å¼çš„æ–‡ä»¶è·¯å¾„ encode zstd gzip # å¯ç”¨å‹ç¼© root * ./ # åŸŸåæ˜ å°„æ ¹è·¯å¾„ file_server # å¯åŠ¨æ–‡ä»¶æœåŠ¡ } example2.com { # ç½‘ç«™çš„åŸŸåä¿¡æ¯ tls example2.com.pem example2.com.key # è¯ä¹¦å’Œå¯†é’¥çš„ PEM æ ¼å¼çš„æ–‡ä»¶è·¯å¾„ reverse_proxy localhost:9000 # åå‘ä»£ç† } ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:2:0","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["web server"],"content":"ä¸‰ã€éƒ¨ç½² docker-compose.yaml version: \"3.7\" services: caddy: image: caddy:\u003cversion\u003e restart: unless-stopped ports: - \"80:80\" - \"443:443\" volumes: - $PWD/Caddyfile:/etc/caddy/Caddyfile - $PWD/site:/srv - caddy_data:/data - caddy_config:/config volumes: caddy_data: caddy_config: ","date":"2023-11-11","objectID":"/posts/2023-11-11-caddy/:2:1","tags":["caddy","go-web","web-server"],"title":"caddy","uri":"/posts/2023-11-11-caddy/"},{"categories":["flatpak"],"content":"flatpak ","date":"2023-11-11","objectID":"/posts/2023-11-11-flatpak/:0:0","tags":["flatpak"],"title":"flatpak","uri":"/posts/2023-11-11-flatpak/"},{"categories":["flatpak"],"content":"ç®€ä»‹ Flatpak æ˜¯ä¸€ç§æ–°çš„é€šç”¨åŒ…è£…æ ¼å¼ã€‚å¯ç”¨ Flatpak å°†ä½¿æ‚¨èƒ½å¤Ÿè½»æ¾å®‰è£…è®¸å¤š Linux åº”ç”¨ç¨‹åºã€‚è¿™æ˜¯åœ¨ Ubuntu å’Œå…¶ä»– Linux å‘è¡Œç‰ˆä¸­ä½¿ç”¨ Flatpak çš„æ–¹æ³•ã€‚ åœ¨ Linux ä¸­å®‰è£…åº”ç”¨ç¨‹åºå°±åƒæ‰“å¼€è½¯ä»¶ä¸­å¿ƒã€æœç´¢å’Œå®‰è£…ä¸€æ ·ç®€å•ã€‚App Store ä¸­æ²¡æœ‰çš„åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ DEB æˆ– RPM åŒ…å®‰è£…ã€‚å…¶ä¸­ä¸€äº›å¯é€šè¿‡ PPAï¼ˆç”¨äºåŸºäº Debian çš„å‘è¡Œç‰ˆï¼‰è·å¾—ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥ä»æºä»£ç æ„å»ºã€‚ è™½ç„¶æœ‰ä¸€äº›é™åˆ¶ã€‚App Store é€šå¸¸æ²¡æœ‰æœ€æ–°ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼Œå¤„ç†ä¾èµ–é¡¹å¯èƒ½å¾ˆçƒ¦äººï¼Œè€Œä¸” PPA å¯èƒ½å¹¶ä¸æ€»æ˜¯å®‰å…¨çš„ï¼è€Œä¸”ï¼Œä»æºå¤´æ„å»ºéœ€è¦ä¸€äº›ç»ˆç«¯åŠ¨æ‰‹æ“ä½œã€‚ å¯¹äºå¤šä¸ª Linux å‘è¡Œç‰ˆå’ŒåŒ…ç®¡ç†ç³»ç»Ÿï¼Œéœ€è¦ä¸€ä¸ªé€šç”¨æ‰“åŒ…ç³»ç»Ÿï¼Œå®ƒå¯ä»¥è¿è¡Œåº”ç”¨ç¨‹åºï¼Œè€Œä¸ç®¡æ‚¨ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆ Linux å‘è¡Œç‰ˆã€‚Canonical æƒ³åˆ°äº†å®ƒå¹¶åˆ›å»ºäº†Snapsã€‚è¿˜æœ‰ä¸€ä¸ªåä¸ºAppImageçš„ç‹¬ç«‹é€šç”¨è½¯ä»¶åŒ… ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­ä¸‹è½½åº”ç”¨ç¨‹åºå¹¶è¿è¡Œå®ƒï¼Œè€Œæ— éœ€å®é™…å®‰è£…åº”ç”¨ç¨‹åºã€‚ é™¤äº† Snaps å’ŒAppImageä¹‹å¤–ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªåä¸ºFlatpakçš„é€šç”¨åŒ…ç³»ç»Ÿã€‚æˆ‘ä»¬å°†äº†è§£å¦‚ä½•åœ¨å¤§å¤šæ•° Linux å‘è¡Œç‰ˆä¸Šå®‰è£…å’Œä½¿ç”¨ Flatpak åŠå…¶ä¼˜åŠ¿ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-flatpak/:0:1","tags":["flatpak"],"title":"flatpak","uri":"/posts/2023-11-11-flatpak/"},{"categories":["flatpak"],"content":"ä»€ä¹ˆæ˜¯ Flatpakï¼Ÿ FlatpakåŸºæœ¬ä¸Šæ˜¯ Linux ä¸Šçš„åº”ç”¨ç¨‹åºæ¡†æ¶ã€‚ç”±äºä¸åŒçš„å‘è¡Œç‰ˆæ›´å–œæ¬¢è‡ªå·±çš„åŒ…ç®¡ç†ï¼ŒFlatpak æ—¨åœ¨æä¾›å…·æœ‰å…¶ä»–ä¼˜åŠ¿çš„è·¨å¹³å°è§£å†³æ–¹æ¡ˆã€‚å®ƒä½¿å¼€å‘äººå‘˜çš„å·¥ä½œæ›´åŠ è½»æ¾ã€‚å‡ ä¹æ‰€æœ‰ Linux å‘è¡Œç‰ˆï¼ˆæ”¯æŒ Flatpakï¼‰éƒ½å¯ä»¥ä½¿ç”¨å•ä¸ªåº”ç”¨ç¨‹åºæ„å»ºï¼Œè€Œæ— éœ€å¯¹æ†ç»‘åŒ…è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-flatpak/:1:0","tags":["flatpak"],"title":"flatpak","uri":"/posts/2023-11-11-flatpak/"},{"categories":["flatpak"],"content":"Flatpak çš„ä¸»è¦ä¼˜åŠ¿ é™¤äº†ä¸ºä¸åŒçš„ Linux å‘è¡Œç‰ˆæä¾›å•ä¸ªæ†ç»‘åŒ…ä¹‹å¤–ï¼ŒFlatpak è¿˜æä¾›ä¸ Linux æ¡Œé¢çš„é›†æˆï¼Œä»è€Œæ›´å®¹æ˜“æµè§ˆã€å®‰è£…å’Œä½¿ç”¨ Flatpak åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ Gnome è½¯ä»¶ä¸­å¿ƒå¯ç”¨äºå®‰è£… Flatpakã€‚ Flatpak æ˜¯å‘å‰å…¼å®¹çš„ï¼Œå³ç›¸åŒçš„ Flatpak åº”ç”¨ç¨‹åºå¯ä»¥åœ¨å‘è¡Œç‰ˆçš„ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸Šè¿è¡Œè€Œæ— éœ€æ›´æ”¹ã€‚ ç»´æŠ¤å¯ä»¥ç”±åº”ç”¨ç¨‹åºä½¿ç”¨çš„è¿è¡Œæ—¶ä¾èµ–é¡¹ã€‚ç¼ºå°‘çš„å¯ä»¥ä½œä¸ºåº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†æ·»åŠ ã€‚ è™½ç„¶ Flatpak æä¾›äº†åº”ç”¨åˆ†å‘çš„ä¸­å¿ƒåŒ–æœåŠ¡ï¼Œä½†å®ƒå®Œå…¨æ”¯æŒåº”ç”¨çš„å»ä¸­å¿ƒåŒ–åˆ†å‘ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-flatpak/:1:1","tags":["flatpak"],"title":"flatpak","uri":"/posts/2023-11-11-flatpak/"},{"categories":["flatpak"],"content":"ä½¿ç”¨ # æŸ¥çœ‹å½“å‰çš„remote [root@sugar ~]# flatpak remotes # æœ€æ–¹ä¾¿çš„æ–¹å¼æ·»åŠ è¿œç¨‹ä»“åº“æ˜¯ä½¿ç”¨ .flatpakrepo æ–‡ä»¶ï¼Œå®ƒåŒ…å«è¿œç¨‹ä»“åº“çš„ä¿¡æ¯å’ŒGPGç§˜é’¥ï¼š [root@sugar ~]# flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo # ç§»é™¤è¿œç¨‹ä»“åº“ [root@sugar ~]# flatpak remote-delete flathub # æŸ¥è¯¢è½¯ä»¶ flatpak search gimp # å®‰è£…è½¯ä»¶ flatpak install flathub org.gimp.GIMP ä½¿ç”¨å›½å†…é•œåƒ $ flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo $ flatpak remote-modify flathub --url=https://mirror.sjtu.edu.cn/flathub # æˆ–è€… $ flatpak remote-add --if-not-exists sjtu https://mirror.sjtu.edu.cn/flathub/flathub.flatpakrepo # å¦‚æœæ‚¨ä¸­æ–­äº†æŸæ¬¡å®‰è£…ï¼Œé‡æ–°ä¸‹è½½å¯èƒ½ä¼šå‡ºç°æ‰¾ä¸åˆ°æ–‡ä»¶çš„é—®é¢˜ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ flatpak repair è§£å†³ç›¸å…³çš„é—®é¢˜ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-flatpak/:1:2","tags":["flatpak"],"title":"flatpak","uri":"/posts/2023-11-11-flatpak/"},{"categories":["æœåŠ¡ç®¡ç†"],"content":"Daemon å®ˆæŠ¤è¿›ç¨‹æœåŠ¡ systemd supervisor launchd ","date":"2023-11-11","objectID":"/posts/2023-11-11-daemon/:0:0","tags":["daemon","systemd","supervisor","launchd"],"title":"daemon","uri":"/posts/2023-11-11-daemon/"},{"categories":["æœåŠ¡ç®¡ç†"],"content":"ä¸€ã€supervisor â€‹ æ˜¯ç”¨Pythonå¼€å‘çš„ä¸€å¥—é€šç”¨çš„è¿›ç¨‹ç®¡ç†ç¨‹åºï¼Œèƒ½å°†ä¸€ä¸ªæ™®é€šçš„å‘½ä»¤è¡Œè¿›ç¨‹å˜ä¸ºåå°daemonï¼Œå¹¶ç›‘æ§è¿›ç¨‹çŠ¶æ€ï¼Œå¼‚å¸¸é€€å‡ºæ—¶èƒ½è‡ªåŠ¨é‡å¯ã€‚å®ƒæ˜¯é€šè¿‡fork/execçš„æ–¹å¼æŠŠè¿™äº›è¢«ç®¡ç†çš„è¿›ç¨‹å½“ä½œsupervisorçš„å­è¿›ç¨‹æ¥å¯åŠ¨ï¼Œè¿™æ ·åªè¦åœ¨supervisorçš„é…ç½®æ–‡ä»¶ä¸­ï¼ŒæŠŠè¦ç®¡ç†çš„è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„å†™è¿›å»å³å¯ã€‚ä¹Ÿå®ç°å½“å­è¿›ç¨‹æŒ‚æ‰çš„æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥å‡†ç¡®è·å–å­è¿›ç¨‹æŒ‚æ‰çš„ä¿¡æ¯çš„ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦è‡ªå·±å¯åŠ¨å’ŒæŠ¥è­¦ã€‚supervisorè¿˜æä¾›äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥ä¸ºsupervisordæˆ–è€…æ¯ä¸ªå­è¿›ç¨‹ï¼Œè®¾ç½®ä¸€ä¸ªérootçš„userï¼Œè¿™ä¸ªuserå°±å¯ä»¥ç®¡ç†å®ƒå¯¹åº”çš„è¿›ç¨‹ supervisorå®˜ç½‘ï¼šsupervisord.org ","date":"2023-11-11","objectID":"/posts/2023-11-11-daemon/:1:0","tags":["daemon","systemd","supervisor","launchd"],"title":"daemon","uri":"/posts/2023-11-11-daemon/"},{"categories":["æœåŠ¡ç®¡ç†"],"content":"å®‰è£…supervisor supervisoræ˜¯ç”¨pythonå¼€å‘çš„ï¼Œæ”¯æŒyumå’Œpipå®‰è£… [root@localhost ~]# yum install supervisor [root@localhost ~]# pip3 install supervisor ","date":"2023-11-11","objectID":"/posts/2023-11-11-daemon/:1:1","tags":["daemon","systemd","supervisor","launchd"],"title":"daemon","uri":"/posts/2023-11-11-daemon/"},{"categories":["æœåŠ¡ç®¡ç†"],"content":"é…ç½®æ–‡ä»¶ è‹¥æ²¡æœ‰é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç”Ÿæˆä¸»é…ç½®æ–‡ä»¶æ¨¡æ¿ [root@localhost ~]# echo_supervisord_conf \u003e /etc/supervisord.conf # å‚è€ƒé“¾æ¥ http://supervisord.org/configuration.html é…ç½®æ¨¡æ¿ # å‚æ•°å¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œè°ƒæ•´ [program:pock] directory=/home/sugars/pock/backend command=/home/sugars/pock/pock_venv/bin/python3 /home/sugars/pock/backend/sugars.py autostart=true autorestart=true startsecs=7 user = sugars stderr_logfile=/var/log/supervisor/pock-err.log stdout_logfile=/var/log/supervisor/pock.log redirect_stderr = true stdout_logfile_maxbytes = 50MB stdout_logfile_backups = 3 stopasgroup=true killasgroup=true é…ç½®æ–‡ä»¶è¯»å–ç›®å½•äºé¡ºåº # é…ç½®æ–‡ä»¶æ˜åä¸ºsupervisor.comf,å¦‚æœä¸ä½¿ç”¨`-c` æŒ‡å®šæ–‡ä»¶åï¼Œåˆ™è‡ªåŠ¨åŒ¹é…çš„æ–‡ä»¶è·¯å¾„ä¸º 1) ../etc/supervisord.conf 2) ../supervisord.conf 3) $CWD/supervisord.conf 4) $CWD/etc/supervisord.conf 5) /etc/supervisord.conf 6) /etc/supervisor/supervisord.conf systemctl start supervisord ","date":"2023-11-11","objectID":"/posts/2023-11-11-daemon/:1:2","tags":["daemon","systemd","supervisor","launchd"],"title":"daemon","uri":"/posts/2023-11-11-daemon/"},{"categories":["æœåŠ¡ç®¡ç†"],"content":"supervisorå‘½ä»¤è¯´æ˜ supervisorctl status æŸ¥çœ‹è¿›ç¨‹è¿è¡ŒçŠ¶æ€ supervisorctl start g_name å¯åŠ¨è¿›ç¨‹ supervisorctl stop g_name å…³é—­è¿›ç¨‹ supervisorctl restart g_name é‡å¯è¿›ç¨‹ supervisorctl update é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶(é…ç½®æ–‡ä»¶ä¿®æ”¹åä½¿ç”¨è¯¥å‘½ä»¤åŠ è½½æ–°çš„é…ç½®) supervisorctl shutdown å…³é—­ supervisord supervisorctl clear g_name æ¸…ç©ºè¿›ç¨‹æ—¥å¿— supervisorctl è¿›å…¥åˆ°äº¤äº’æ¨¡å¼ä¸‹ã€‚ä½¿ç”¨helpæŸ¥çœ‹æ‰€æœ‰å‘½ä»¤ã€‚ supervisorctl start/stop/restart + all è¡¨ç¤ºå¯åŠ¨ï¼Œå…³é—­ï¼Œé‡å¯æ‰€æœ‰è¿›ç¨‹ supervisorctl reload //é‡æ–°å¯åŠ¨é…ç½®ä¸­çš„æ‰€æœ‰ç¨‹åº æ–°æ·»åŠ ä¸€ä¸ªprogramåçš„æ“ä½œ root@serialt:~# supervisorctl update sugar åœæ­¢sugaræœåŠ¡ root@serialt:~# supervisorctl stop sugar å¯åŠ¨sugaræœåŠ¡ root@serialt:~# supervisorctl start sugar é‡å¯sugaræœåŠ¡ root@serialt:~# supervisorctl restart sugar ","date":"2023-11-11","objectID":"/posts/2023-11-11-daemon/:1:3","tags":["daemon","systemd","supervisor","launchd"],"title":"daemon","uri":"/posts/2023-11-11-daemon/"},{"categories":["æœåŠ¡ç®¡ç†"],"content":"æ—¥å¿—ç®¡ç† åœ¨rhelä¸­ï¼Œsupervisordçš„æ—¥å¿—è½®è½¬ç®¡ç†æ˜¯é€šè¿‡è°ƒç”¨logrotateæ¥å®ç°çš„ï¼Œå…¶é…ç½®æ–‡ä»¶å†…å®¹æ˜¯ [root@serialt ~]# cat /etc/logrotate.d/supervisor /var/log/supervisor/*.log { missingok weekly notifempty nocompress } ä¼šè‡ªåŠ¨è½®è½¬/var/log/supervisor/*.logçš„æ–‡ä»¶ï¼Œè‹¥æŠŠç”¨supervisorç®¡ç†çš„æ—¥å¿—ä¹Ÿè¾“å…¥åˆ°/var/log/supervisor/é‡Œä¼šå¯¼è‡´æ—¥å¿—æ–‡ä»¶è¢«è½®è½¬æˆå¸¦æ—¶é—´æˆ³çš„æ ¼å¼ sugar.log sugar.log-20211019 sugar.log-20211026 sugar.log.1 sugar.log.2 sugar.log.3 ä¸¤ç§è§£å†³åŠæ³•ï¼š 1ï¼‰ä¿®æ”¹supervisordçš„æ—¥å¿—è®°å½•æ–‡ä»¶ï¼ŒåŒæ—¶ä¿®æ”¹supervisordçš„logrotateé…ç½®æ–‡ä»¶ 2ï¼‰supervisordç®¡ç†çš„è¿›ç¨‹çš„æ—¥å¿—ä¸è¾“å‡ºåˆ°/var/log/supervisoré‡Œ æ—¥å¿—å‹ç¼© supervisordæœ¬èº«æ—¥å¿—åªèƒ½è½®è½¬ï¼Œä¸èƒ½ç”¨äºå‹ç¼©ï¼Œè¦å®ç°æ—¥å¿—å‹ç¼©è®ºè¯ï¼Œéœ€è¦å€Ÿç”¨logrotate [root@tc ~]# cat /etc/logrotate.d/sugar /var/log/sugar/*.log { missingok daily notifempty create 0664 nobody root #dateext #dateformat .%Y%m%d rotate 20 compress delaycompress copytruncate size 10K } ","date":"2023-11-11","objectID":"/posts/2023-11-11-daemon/:1:4","tags":["daemon","systemd","supervisor","launchd"],"title":"daemon","uri":"/posts/2023-11-11-daemon/"},{"categories":["æœåŠ¡ç®¡ç†"],"content":"äºŒã€systemd å¸¸ç”¨å‘½ä»¤ systemctl restart foo systemctl stop foo systemctl start foo systemctl status foo systemctl cat foo systemctl daemon-reload é…ç½®æ¨¡æ¿ [Unit] Description=Gins After=network-online.target Documentation=https://serialt.github.io/ Documentation=https://serialt.github.io on-failure always [Service] Type=simple WorkingDirectory=/usr/local/gin KillSignal=SIGTERM ExecStart=/usr/local/gins/bin/gins start ExecStop=/bin/kill -SIGTERM $MAINPID Restart=on-failure RestartSec=3 TimeoutSec=50 User=gins Group=gins [Install] WantedBy=multi-user.target systemd 236ä¹‹åçš„ç‰ˆæœ¬å¯ä»¥ç›´æ¥åœ¨systemdçš„unitæ–‡ä»¶é‡Œé¢é…ç½®StandardOutputå’ŒStandardErrorä¸¤ä¸ªå‚æ•°æ¥å°†ç›¸å…³è¿è¡Œæ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚ [Unit] Description=Gins After=network.target Documentation=https://serialt.github.io/ Documentation=https://serialt.github.io on-failure always [Service] Type=simple WorkingDirectory=/usr/local/gin KillSignal=SIGTERM ExecStart=/usr/local/gins/bin/gins start ExecStop=/bin/kill -SIGTERM $MAINPID # appendç±»å‹å¯ä»¥åœ¨åŸæœ‰æ–‡ä»¶æœ«å°¾ç»§ç»­è¿½åŠ å†…å®¹ï¼Œè€Œfileç±»å‹åˆ™æ˜¯é‡æ–°æ‰“å¼€ä¸€ä¸ªæ–°æ–‡ä»¶ # ä¸¤è€…çš„åŒºåˆ«ç±»ä¼¼äº echo \u003e\u003e å’Œ echo \u003e StandardOutput=append:/home/coredns/logs/coredns.log StandardError=append:/home/coredns/logs/coredns_error.log Restart=on-failure RestartSec=3 TimeoutSec=50 User=gins Group=gins [Install] WantedBy=multi-user.target ","date":"2023-11-11","objectID":"/posts/2023-11-11-daemon/:2:0","tags":["daemon","systemd","supervisor","launchd"],"title":"daemon","uri":"/posts/2023-11-11-daemon/"},{"categories":["æœåŠ¡ç®¡ç†"],"content":"ä¸‰ã€launchdæœåŠ¡ https://www.fythonfang.com/blog/2021/4/19/mac-launchd-daemons-and-agents-tutorial ","date":"2023-11-11","objectID":"/posts/2023-11-11-daemon/:3:0","tags":["daemon","systemd","supervisor","launchd"],"title":"daemon","uri":"/posts/2023-11-11-daemon/"},{"categories":["æœåŠ¡ç®¡ç†"],"content":"åŸºæœ¬æ¦‚å¿µ launchd æ˜¯ MacOS ä¸Šç”¨äºç®¡ç†ç³»ç»Ÿçº§æˆ–è€…ç”¨æˆ·çº§åå°æœåŠ¡è¿›ç¨‹çš„ç®¡ç†å·¥å…·ã€‚ä¹Ÿæ˜¯å®˜æ–¹æ¨èçš„ç³»ç»Ÿåå°è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå°±å¥½åƒåœ¨ Linux ç³»ç»Ÿé‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ systemd å»ç®¡ç†åå°æœåŠ¡è¿›ç¨‹ä¸€æ ·ã€‚ launchd æ˜¯ä¸€ä¸ªç¨‹åºï¼Œä»¥ç³»ç»Ÿå¸¸é©»è¿›ç¨‹çš„å½¢æ€è¿è½¬ï¼Œæ˜¯ MacOS ç³»ç»Ÿå¯åŠ¨åçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œåœ¨ Terminal ç»ˆç«¯ï¼Œé”®å…¥å‘½ä»¤ ps aux å¯ä»¥çœ‹åˆ°ï¼Œlaunchd çš„è¿›ç¨‹IDï¼ˆPIDï¼‰æ˜¯ 1ã€‚ä¹Ÿå³è¿™æ˜¯ç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ã€‚ ä¸ launchd äº¤äº’çš„å·¥å…·ï¼Œå« launchctlã€‚å¯ä»¥è®¤ä¸ºæ˜¯å®ƒçš„ç®¡ç†å®¢æˆ·ç«¯ç¨‹åºã€‚é€šè¿‡è¯¥å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€æŒ‡ä»¤ç»™ launchd å®Œæˆå¯¹ç³»ç»ŸæœåŠ¡æˆ–åå°è¿›ç¨‹çš„ç®¡ç†ã€‚ launchd çš„ç®¡ç†å¯¹è±¡éƒ½æ˜¯åå°è¿›ç¨‹ï¼Œè¿™äº›åå°è¿›ç¨‹ä½¿ç”¨ä¸€ç§ç‰¹å®šæ ¼å¼çš„é…ç½®æ–‡ä»¶å« launchd.plist æ¥æè¿°è¢«ç®¡ç†çš„å¯¹è±¡ã€‚è¿™ç§æ–‡ä»¶æ˜¯ XML æ ¼å¼çš„ï¼Œæ ¹æ®ä¸åŒçš„è¿è¡Œæƒé™ï¼Œæ”¾åœ¨ä¸åŒçš„ç›®å½•é‡Œé¢ï¼Œè¯·çœ‹ä¸‹é¢çš„è¡¨æ ¼ã€‚ ç›®å½• è¯´æ˜ ~/Library/LaunchAgents ç”¨æˆ·è‡ªå·±æä¾›çš„ç”¨æˆ·çº§ Agentã€‚ /Library/LaunchAgents ç®¡ç†å‘˜æä¾›çš„ç”¨æˆ·çº§ Agentã€‚ /Library/LaunchDaemons ç®¡ç†å‘˜æä¾›çš„ç³»ç»Ÿçº§ Daemonã€‚ /System/Library/LaunchAgents è‹¹æœå®˜æ–¹æä¾›çš„ç”¨æˆ·çº§ Agentã€‚ /System/Library/LaunchDaemons è‹¹æœå®˜æ–¹æä¾›çš„ç³»ç»Ÿçº§ Daemonã€‚ å­˜æ”¾ launchd é…ç½®æ–‡ä»¶çš„å¸¸ç”¨ç›®å½• é€šè¿‡ launchd ç®¡ç†çš„è¿›ç¨‹ï¼Œäººä¸ºè¢«åˆ†ä¸ºäº†å‡ ä¸ªç§ç±»ï¼š æœåŠ¡ï¼ˆServicesï¼‰â€”â€” åœ¨åå°è¿è¡Œï¼Œç”¨ä»¥æ”¯æŒå›¾å½¢ç•Œé¢åº”ç”¨ï¼ˆGUI Appï¼‰è¿è¡Œçš„æœåŠ¡è¿›ç¨‹ï¼Œæ¯”å¦‚å“åº”ç³»ç»Ÿå…¨å±€å¿«æ·é”®ï¼Œæˆ–è€…è¿›è¡Œç½‘ç»œé€šä¿¡ç­‰ï¼› å®ˆæŠ¤è¿›ç¨‹ï¼ˆDaemonsï¼‰â€”â€” ç†è®ºä¸Šï¼Œä¸å±äºæœåŠ¡çš„åå°è¿›ç¨‹ï¼Œéƒ½å½’ä¸ºå®ˆæŠ¤è¿›ç¨‹ä¸€ç±»ï¼Œä¸è¿‡è¿™é‡Œç‰¹æŒ‡è¿è¡Œåœ¨åå°ï¼Œä¸”ä¸èƒ½ä¸ç”¨æˆ·äº¤äº’å›¾å½¢ç•Œé¢äº§ç”Ÿè”ç³»çš„è¿›ç¨‹ï¼› ä»£ç†ï¼ˆAgentsï¼‰â€”â€” ä»¥ç”¨æˆ·çš„åä¹‰ï¼Œåœ¨åå°è¿è¡Œçš„è¿›ç¨‹ï¼Œå¯ä»¥å’Œç”¨æˆ·å›¾å½¢ç•Œé¢äº§ç”Ÿè”ç³»ï¼Œæ¯”å¦‚å‘¼èµ·ä¸€ä¸ªè½¯ä»¶çš„ç•Œé¢ï¼Œä¸è¿‡å®˜æ–¹ä¸æ¨èè¿™ä¹ˆç”¨ã€‚ ä¸€èˆ¬æ–‡ä»¶åéƒ½ä»¥com.domain.programName.plistæ ¼å¼å‘½åï¼Œä¸ç®¡æ˜¯ Daemons è¿˜æ˜¯ Agents æ ¼å¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å­˜æ”¾ä½ç½®ä¸åŒã€‚çœ‹ä¸‹é¢ä¸€ä¸ª hello world çš„ä¾‹å­ ~/Library/LaunchAgents/com.example.hello.plist \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003c!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"\u003e \u003cplist version=\"1.0\"\u003e \u003cdict\u003e \u003ckey\u003eLabel\u003c/key\u003e \u003cstring\u003ecom.example.hello\u003c/string\u003e \u003ckey\u003eProgramArguments\u003c/key\u003e \u003carray\u003e \u003cstring\u003e/bin/echo\u003c/string\u003e \u003cstring\u003ehello world\u003c/string\u003e \u003c/array\u003e \u003c/dict\u003e \u003c/plist\u003e ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªæœ€ç®€å•çš„ä»»åŠ¡åªä½¿ç”¨äº†Labelå’ŒProgramAgrumentsä¸¤ä¸ªé”® Labelè¿™æ˜¯ä¸ªå¿…é¡»çš„é”®ï¼ŒæŒ‡å®šè¿™ä¸ªä»»åŠ¡å ProgramArgumentsæ˜¯å¸¦å‚æ•°çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸Šé¢ç­‰åŒäºè¿è¡Œ/bin/echo hello worldå‘½ä»¤ï¼Œå¦‚æœæ‰§è¡Œçš„ç¨‹åºä¸å¸¦å‚æ•°å¯ä»¥ä½¿ç”¨Programé”®ï¼Œä½†ä¸€ä¸ªä»»åŠ¡ä¸­å¿…é¡»åŒ…å«è¿™ä¸¤ä¸ªä¸­çš„å…¶ä¸­ä¸€ä¸ªé”® è¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„é”®åï¼Œæ‰€æœ‰çš„é”®å¯å‚è€ƒman 5 launchd.plistæˆ–è€…è¿™é‡Œ Keys Description EnvironmentVariables è®¾ç½®è¿è¡Œç¯å¢ƒå˜é‡ StandardOutPath æ ‡å‡†è¾“å‡ºåˆ°æ–‡ä»¶ StandardErrorPath æ ‡å‡†é”™è¯¯åˆ°æ–‡ä»¶ RunAtLoad æ˜¯å¦å†åŠ è½½çš„æ—¶å€™å°±è¿è¡Œ StartInterval è®¾ç½®ç¨‹åºæ¯éš”å¤šå°‘ç§’è¿è¡Œä¸€æ¬¡ KeepAlive æ˜¯å¦è®¾ç½®ç¨‹åºæ˜¯ä¸€ç›´å­˜æ´»ç€ å¦‚æœé€€å‡ºå°±é‡å¯ UserName è®¾ç½®ç”¨æˆ·ååªåœ¨ Daemons å¯ç”¨ WorkingDirectory è®¾ç½®å·¥ä½œç›®å½• # æ£€æŸ¥é…ç½® $ plutil ~/Library/LaunchAgents/com.example.hello.plist /Users/fython/Library/LaunchAgents/com.example.hello.plist: OK # åŠ è½½é…ç½®æ–‡ä»¶ $ launchctl load ~/Library/LaunchAgents/com.example.hello.plist # å¯åŠ¨æœåŠ¡ $ launchctl start com.example.hello $ cat /tmp/hello.log hello world $ launchctl list | grep hello - 0 com.example.hello $ launchctl remove com.example.hello # remove jobs ä¸€ä¸ªä»»åŠ¡é¦–å…ˆéœ€è¦è¢«åŠ è½½(load)ï¼Œç„¶åå¯åŠ¨(start)æ­£å¸¸è¿è¡Œå®Œé€€å‡ºï¼Œæ‰€ä»¥æˆ‘ä»¬æŸ¥çœ‹/tmpç›®å½•ä¸‹ä¼šæœ‰æ—¥å¿—è¾“å‡º â€‹ 1ï¼‰ä»»åŠ¡ä¸€èˆ¬éƒ½è¦æ‰‹åŠ¨å¯åŠ¨(start)ï¼Œå¦‚æœè®¾ç½®äº†RunAtLoadæˆ–è€…KeepAliveåˆ™åœ¨launchctl loadæ—¶å°±å¯åŠ¨ â€‹ 2ï¼‰ä½¿ç”¨launchctl liståˆ—å‡ºå½“å‰åŠ è½½çš„ä»»åŠ¡ï¼Œç¬¬ä¸€åˆ—ä»£è¡¨è¿›ç¨‹idï¼Œå› ä¸ºä¸Šé¢çš„ç¨‹åºè¿è¡Œä¸€æ¬¡å°±é€€å‡ºäº†æ‰€ä»¥æ˜¾ç¤º-ï¼Œç¬¬äºŒåˆ—æ˜¯ç¨‹åºä¸Šæ¬¡è¿è¡Œé€€å‡ºçš„codeï¼Œ0ä»£è¡¨æ­£å¸¸é€€å‡ºï¼Œå¦‚æœæ˜¯æ­£æ•°ä»£è¡¨é€€å‡ºçš„æ—¶å€™æ˜¯æœ‰é”™è¯¯çš„ï¼Œè´Ÿæ•°ä»£è¡¨æ˜¯æ¥æ”¶åˆ°ä¿¡å·è¢«ç»ˆæ­¢çš„ â€‹ 3ï¼‰launchctl stop \u003cservice_name\u003eå¯ä»¥ç»ˆæ­¢ä¸€ä¸ªåœ¨è¿è¡Œä¸­çš„ä»»åŠ¡ï¼Œlaunchctl unload \u003cpath\u003eæŒ‡å®šè·¯å¾„å¸è½½ä¸€ä¸ªä»»åŠ¡ï¼Œlaunchctl remove \u003cservice_name\u003eé€šè¿‡æœåŠ¡åå¸è½½ä»»åŠ¡ â€‹ 4ï¼‰launchctl load \u003cpath\u003eåªä¼šåŠ è½½æ²¡æœ‰è¢«disableçš„ä»»åŠ¡ï¼Œå¯ä»¥åŠ -wå‚æ•° launchctl load -w \u003cpath\u003eè¦†ç›–å¦‚æœè®¾ç½®äº†disableçš„ï¼Œä¸‹æ¬¡å¼€æœºå¯åŠ¨ä¸€å®šä¼šèµ·æ¥ã€‚launchctl unload \u003cpath\u003eåªä¼šåœæ­¢å’Œå¸è½½è¿™ä¸ªä»»åŠ¡ï¼Œä½†ä¸‹æ¬¡å¯åŠ¨è¿˜ä¼šåŠ è½½ï¼Œå¯ä»¥ä½¿ç”¨-wå‚æ•°launchctl unload -w \u003cpath\u003eåœæ­¢ä»»åŠ¡ï¼Œä¸‹æ¬¡å¯åŠ¨ä¹Ÿä¸ä¼šèµ·æ¥ï¼Œä¹Ÿå°±æ˜¯æ ‡è®°äº†disable â€‹ 5ï¼‰è°ƒè¯•ä¸€ä¸ªä»»åŠ¡å¯ä»¥é…åˆä½¿ç”¨plutilå‘½ä»¤æ£€æŸ¥è¯­æ³•ï¼Œè®¾ç½®StandardOutPathã€StandardErrorPathã€Debugé”®ï¼Œä¹Ÿå¯ä»¥çœ‹çœ‹è‹¹æœè‡ªå¸¦çš„Console.appåº”ç”¨ä¸­çš„system.log ","date":"2023-11-11","objectID":"/posts/2023-11-11-daemon/:3:1","tags":["daemon","systemd","supervisor","launchd"],"title":"daemon","uri":"/posts/2023-11-11-daemon/"},{"categories":["æœåŠ¡ç®¡ç†"],"content":"åŸºæœ¬æ“ä½œ # ç½—åˆ—ç³»ç»Ÿå½“å‰è¿è¡Œçš„è¿›ç¨‹æ¸…å• launchctl list # æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„é…ç½®ä¿¡æ¯ launchctl list com.adobe.AdobeCreativeCloud # åŠ è½½ç‰¹å®šçš„æœåŠ¡é…ç½® launchctl load \u003cfile_path\u003e # å¸è½½ç‰¹å®šçš„æœåŠ¡é…ç½® launchctl unload -w /Library/LaunchAgents/com.adobe.AdobeCreativeCloud.plist # ç‰¹æ­¤è¯´æ˜ï¼Œ-w å‚æ•°çš„ä½œç”¨æ˜¯ï¼Œå¦‚æœè‡ªåŠ¨æ‰§è¡Œäº† load å‘½ä»¤å°è¯•å»æ¢å¤æœåŠ¡æ³¨å†Œï¼Œåˆ™è®©å…¶æ— æ•ˆ plist æ–‡ä»¶é…ç½® www.launchd.info ","date":"2023-11-11","objectID":"/posts/2023-11-11-daemon/:3:2","tags":["daemon","systemd","supervisor","launchd"],"title":"daemon","uri":"/posts/2023-11-11-daemon/"},{"categories":["æœåŠ¡ç®¡ç†"],"content":"é…ç½®å‚æ•° 1ï¼‰é…ç½®jobå \u003ckey\u003eLabel\u003c/key\u003e \u003cstring\u003ecom.local.cmd\u003c/string\u003e 2ï¼‰cmdå¯åŠ¨é…ç½® \u003ckey\u003eProgramArguments\u003c/key\u003e \u003carray\u003e \u003cstring\u003e/usr/bin/rsync\u003c/string\u003e \u003cstring\u003e--archive\u003c/string\u003e \u003cstring\u003e--compress-level=9\u003c/string\u003e \u003cstring\u003e/Volumes/Macintosh HD\u003c/string\u003e \u003cstring\u003e/Volumes/Backup\u003c/string\u003e \u003c/array\u003e æ‰§è¡Œåå‘½ä»¤ /usr/bin/rsync --archive --compress-level=9 \"/Volumes/Macintosh HD\" \"/Volumes/Backup\" 3ï¼‰ç¯å¢ƒå˜é‡è®¾ç½® \u003ckey\u003eEnvironmentVariables\u003c/key\u003e \u003cdict\u003e \u003ckey\u003ePATH\u003c/key\u003e \u003cstring\u003e/bin:/usr/bin:/usr/local/bin\u003c/string\u003e \u003c/dict\u003e 3ï¼‰è®¾ç½®å·¥ä½œç›®å½• \u003ckey\u003eWorkingDirectory\u003c/key\u003e \u003cstring\u003e/tmp\u003c/string\u003e 4ï¼‰èµ„æºé™åˆ¶ \u003ckey\u003eHardResourceLimits\u003c/key\u003e \u003cdict\u003e \u003ckey\u003eFileSize\u003c/key\u003e \u003cinteger\u003e1048576\u003c/integer\u003e \u003c/dict\u003e \u003ckey\u003eSoftResourceLimits\u003c/key\u003e \u003cdict\u003e \u003ckey\u003eFileSize\u003c/key\u003e \u003cinteger\u003e524288\u003c/integer\u003e \u003c/dict\u003e 5ï¼‰å…¶ä»– RunAtLoad \u003ckey\u003eRunAtLoad\u003c/key\u003e \u003ctrue/\u003e æ¯éš”å¤šå°‘ç§’æ‰§è¡Œ å•ä½ ç§’ \u003ckey\u003eStartInterval\u003c/key\u003e \u003cinteger\u003e3600\u003c/integer\u003e å®šæ—¶æ‰§è¡Œ \u003ckey\u003eStartCalendarInterval\u003c/key\u003e \u003cdict\u003e \u003ckey\u003eHour\u003c/key\u003e \u003cinteger\u003e3\u003c/integer\u003e \u003ckey\u003eMinute\u003c/key\u003e \u003cinteger\u003e0\u003c/integer\u003e \u003c/dict\u003e å¯ç”¨å‚æ•° Month Integer Month of year (1..12, 1 being January) Day Integer Day of month (1..31) Weekday Integer Day of week (0..7, 0 and 7 being Sunday) Hour Integer Hour of day (0..23) Minute Integer Minute of hour (0..59) ç¤ºä¾‹1ï¼š /Library/LaunchDaemons/com.fython.clash.plist \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003c!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"\u003e \u003cplist version=\"1.0\"\u003e \u003cdict\u003e \u003ckey\u003eLabel\u003c/key\u003e \u003cstring\u003ecom.fython.clash\u003c/string\u003e \u003ckey\u003eRunAtLoad\u003c/key\u003e \u003ctrue/\u003e \u003ckey\u003eUserName\u003c/key\u003e \u003cstring\u003eroot\u003c/string\u003e \u003ckey\u003eStandardErrorPath\u003c/key\u003e \u003cstring\u003e/Users/fython/bin/clash/stderr.log\u003c/string\u003e \u003ckey\u003eStandardOutPath\u003c/key\u003e \u003cstring\u003e/Users/fython/bin/clash/stdout.log\u003c/string\u003e \u003ckey\u003eWorkingDirectory\u003c/key\u003e \u003cstring\u003e/Users/fython/bin/clash\u003c/string\u003e \u003ckey\u003eProgramArguments\u003c/key\u003e \u003carray\u003e \u003cstring\u003e/Users/fython/bin/clash/clash\u003c/string\u003e \u003cstring\u003e-f\u003c/string\u003e \u003cstring\u003econfig.yaml\u003c/string\u003e \u003cstring\u003e-d\u003c/string\u003e \u003cstring\u003e/Users/fython/bin/clash\u003c/string\u003e \u003c/array\u003e \u003ckey\u003eKeepAlive\u003c/key\u003e \u003ctrue/\u003e \u003c/dict\u003e \u003c/plist\u003e ","date":"2023-11-11","objectID":"/posts/2023-11-11-daemon/:3:3","tags":["daemon","systemd","supervisor","launchd"],"title":"daemon","uri":"/posts/2023-11-11-daemon/"},{"categories":["DNS"],"content":"CoreDNS åœ¨å†…ç½‘æœåŠ¡ä¸­ï¼Œéœ€è¦éƒ¨ç½²å†…éƒ¨çš„ dnsï¼Œç”¨äºå„ç§æœåŠ¡çš„ dns è§£æã€‚å¸¸è§çš„ dns server æœ‰ bindï¼Œdnsmasqï¼Œcoredns ç­‰ã€‚coredns å‡ºåäºç”¨äº kubernetes ä¸­ service åˆ° ip çš„è§£æï¼Œç”±äºæ˜¯ä½¿ç”¨ go å¼€å‘çš„ï¼Œæ„å»ºçš„äºŒè¿›åˆ¶å¾ˆå‘å¸ƒéƒ¨ç½²ä½¿ç”¨ï¼ŒåŒæ—¶ coredns ä¹Ÿå…¼å®¹ bind çš„åŸŸåè§£æé…ç½®æ–‡ä»¶ã€‚ å®˜ç½‘ï¼šhttps://coredns.io/ å‚è€ƒé“¾æ¥ï¼šhttps://blog.gmem.cc/coredns-study-note ","date":"2023-11-11","objectID":"/posts/2023-11-11-coredns/:0:0","tags":["dns","coredns"],"title":"coredns","uri":"/posts/2023-11-11-coredns/"},{"categories":["DNS"],"content":"ä¸€ã€åŸºæœ¬ä½¿ç”¨ å¸¸ç”¨æ’ä»¶ bind æŒ‡å®šæœåŠ¡å™¨ç›‘å¬çš„ç½‘ç»œæ¥å£ï¼ˆIPåœ°å€ï¼‰ï¼š bind ADDRESS â€¦ . { bind 127.0.0.1 ::1 } . { bind 127.0.0.1 bind ::1 } autopath å…è®¸æœåŠ¡å™¨ç«¯è¿›è¡Œçš„æœç´¢åç¼€ï¼ˆsearch domainï¼‰è¡¥å…¨ã€‚å¦‚æœæ’ä»¶å‘ç°å®¢æˆ·ç«¯æŸ¥è¯¢çš„åç§°ï¼ŒåŒ¹é…search pathçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™è‡ªåŠ¨éå†search pathä¸­çš„domainé“¾ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªéNXDOMAINç»“æœã€‚å¦‚æœå‡ºç°å¤±è´¥ï¼Œåˆ™è¿”å›åŸå§‹æŸ¥è¯¢çš„åº”ç­”ã€‚ ç”±äºautopathçš„åº”ç­”ä¸­çš„åç§°ï¼Œå’ŒåŸå§‹é—®é¢˜ä¸åŒ¹é…ï¼Œå› æ­¤ä»–ä¼šåœ¨CoreDNSä¸­æ·»åŠ ä¸€ä¸ªCNAMEï¼Œä»åŸå§‹åç§°æŒ‡å‘åº”ç­”ä¸­çš„åç§°ã€‚ # ZONE autopathæƒå¨è´Ÿè´£çš„Zone # RESOLV-CONF åŒ…å«search domainçš„é…ç½®æ–‡ä»¶ã€‚æˆ–è€…æŒ‡å‘å…¶å®ƒæ’ä»¶ï¼Œä¾‹å¦‚@kubernetesï¼Œè¿™æ—¶ä»å…¶å®ƒæ’ä»¶è¯»å–search domain # é…ç½®æ–‡ä»¶ä¸­å¿…é¡»æœ‰ search domain1 domain2 ... è¿™æ ·çš„è¡Œ autopath [ZONE...] RESOLV-CONF cache å®ç°å‰ç«¯ç¼“å­˜ï¼Œç”¨äºæŸ¥è¯¢åç«¯ï¼ˆUpstreamã€Databaseâ€¦ï¼‰æˆæœ¬è¾ƒé«˜çš„åœºæ™¯ã€‚å¯ç”¨æ­¤æ’ä»¶åï¼Œé™¤äº†Zone transfers / Metadataä»¥å¤–çš„è®°å½•ä¼šè¢«ç¼“å­˜é»˜è®¤3600sã€‚ # TTL ç¼“å­˜æœ‰æ•ˆæœŸï¼Œå•ä½ç§’ï¼Œé»˜è®¤3600 # ZONES å“ªäº›Zoneæ”¯æŒç¼“å­˜ cache [TTL] [ZONES...] { # æˆåŠŸçš„DNSåº”ç­”çš„ç¼“å­˜é…ç½® success CAPACITY [TTL] [MINTTL] # Denial of existenceåº”ç­”çš„ç¼“å­˜é…ç½® denial CAPACITY [TTL] [MINTTL] prefetch AMOUNT [[DURATION] [PERCENTAGE%]] } loop èƒ½å¤Ÿæ£€æµ‹ç®€å•çš„forwardingå¾ªç¯å¹¶ç»ˆæ­¢æœåŠ¡å™¨ã€‚ debug èƒ½å¤Ÿä»Panicä¸­æ¢å¤ï¼Œç”¨äºè°ƒè¯•ç”¨é€” errors å¯ç”¨é”™è¯¯æ—¥å¿—è®°å½•ï¼Œæ ¼å¼ï¼š errors { # åœ¨DURATIONæœŸé—´æŠ“å–åŒ¹é…REGEXPçš„é”™è¯¯æ—¥å¿—ï¼Œèšåˆä¸ºå•æ¡æ—¥å¿— consolidate DURATION REGEXP } . { errors { consolidate 5m \".* i/o timeout$\" consolidate 30s \"^Failed to .+\" } } forward å°†DNSè¯·æ±‚è½¬å‘ç»™ä¸Šæ¸¸DNSæœåŠ¡å™¨ï¼Œæ”¯æŒDNS / TCP / DNS over TLSã€‚è¯¥æ’ä»¶ä»£æ›¿åŸå…ˆçš„proxyæ’ä»¶ã€‚ # FROM åŒ¹é…æ­¤åç¼€çš„DNSæŸ¥è¯¢ä¼šè¢«è½¬å‘ # TO ä¸Šæ¸¸æœåŠ¡å™¨çš„ç«¯ç‚¹ï¼Œæ”¯æŒæŒ‡å®šåè®®ï¼Œä¾‹å¦‚tls://9.9.9.9 forward FROM TO... { # ç©ºæ ¼åˆ†éš”çš„ï¼Œä¸è¿›è¡Œè½¬å‘çš„åŸŸååˆ—è¡¨ except IGNORED_NAMES... # å¼ºåˆ¶åŸºäºTCPåè®® force_tcp # ä¼˜å…ˆä½¿ç”¨UDP prefer_udp # å¤šä¹…åä¸¢å¼ƒè¿æ¥ï¼Œ expire DURATION # åˆ¤å®šä¸ºä¸å¥åº·éœ€è¦çš„è¿ç»­å¤±è´¥è¾ä¹¦ max_fails INTEGER # DNS over TLSé…ç½® tls CERT KEY CA tls_servername NAME # é€‰å–ä¸Šæ¸¸æœåŠ¡å™¨çš„ç®—æ³•ï¼Œé»˜è®¤random policy random|round_robin|sequential # å¥åº·æ£€æŸ¥å‘¨æœŸ health_check DURATION } ç›´æ¥è½¬å‘ï¼Œç”¨äºå…œåº•çš„ç¤ºä¾‹ï¼š forward . 223.5.5.5 1.1.1.1 ä½¿ç”¨TLSçš„ç¤ºä¾‹ï¼š forward . tls://9.9.9.9 { tls_servername dns.quad9.net health_check 5s } å¼ºåˆ¶TCPè½¬å‘ï¼š svc.k8s.gmem.cc { forward . 127.0.0.1:5353 { force_tcp } } ä»æ–‡ä»¶ä¸­è¯»å–ä¸Šæ¸¸DNSï¼š forward . /etc/resolv.conf å¦‚æœCoreDNSè¿è¡Œåœ¨K8Sä¸­ï¼Œåˆ™CoreDNSçš„Podçš„/etc/resolv.confå†…å®¹çš„åŸºç¡€ï¼Œå–å†³äºkubeletçš„â€“resolv-confé…ç½®ï¼Œé»˜è®¤å€¼æŒ‡å‘å®¿ä¸»æœºçš„/etc/resolv.confæ–‡ä»¶ã€‚ ä¸Šæ¸¸å¥åº·æ£€æŸ¥ é¦–æ¬¡è½¬å‘ï¼Œéšæœºé€‰å–ä¸€ä¸ªä¸Šæ¸¸æœåŠ¡å™¨ï¼Œåç»­ä¸€ç›´ä½¿ç”¨ï¼Œç›´åˆ°å®ƒä¸å¥åº·äº†ã€‚ å½“å‡ºç°ä¸€ä¸ªé”™è¯¯ â€”â€” ä»»ä½•DNSå“åº”éƒ½ä¸çœ‹ä½œé”™è¯¯ï¼ˆREFUSED, NOTIMPL, SERVFAIL â€¦ ï¼‰â€”â€” åˆ™CoreDNSå¯åŠ¨å¥åº·æ£€æŸ¥å¾ªç¯ï¼ˆé»˜è®¤0.5sä¸€æ¬¡ï¼‰ï¼Œç›´åˆ°ä¸Šæ¸¸æœåŠ¡å™¨æ¢å¤å¥åº·ã€‚ å¦‚æœmax_failsè®¾ç½®ä¸º0åˆ™ä¸è¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œæ€»æ˜¯è®¤ä¸ºä¸Šæ¸¸æœåŠ¡å™¨æ˜¯å¥åº·çš„ã€‚ CoreDNSä¸å‘ä¸å¥åº·çš„ä¸Šæ¸¸æœåŠ¡å™¨è½¬å‘è¯·æ±‚ï¼Œå¦‚æœæ‰€æœ‰ä¸Šæ¸¸æœåŠ¡å™¨éƒ½ä¸å¥åº·ï¼Œåˆ™éšæœºé€‰å–ä¸€ä¸ªè½¬å‘ã€‚ health å¯ç”¨è¿›ç¨‹çº§åˆ«çš„ç›‘æ§æ£€æŸ¥ã€‚ç¤ºä¾‹ï¼š health :8080ï¼Œä½ å¯ä»¥è®¿é—®:8080/healthè·å–å¥åº·çŠ¶æ€ã€‚ ready æä¾›readinessæ¢é’ˆã€‚ç¤ºä¾‹ï¼š ready localhost:8091 hosts ä»¥/etc/hostsé£æ ¼æä¾›Zoneæ•°æ®ï¼Œæ ¼å¼ï¼š # FILE ä»æ–‡ä»¶ä¸­è¯»å–Zoneæ•°æ®ï¼Œé»˜è®¤ä»/etc/hostsè¯»å– # ZONES æ­¤æ’ä»¶çš„æƒå¨Zone hosts [FILE [ZONES...]] { # å†…è”çš„HOSTSæ¡ç›® [INLINE] # ä¿®æ”¹ç”Ÿæˆçš„DNSè®°å½•çš„DNS TTL ttl SECONDS # ç¦æ­¢è‡ªåŠ¨ç”Ÿæˆin-addr.arpaæˆ–ip6.arpaæ¡ç›® no_reverse # é‡æ–°è½½å…¥æ–‡ä»¶çš„é—´éš”ï¼Œä¾‹å¦‚ 300ms 1.5h 2h45m reload DURATION # å¯¹äºåŒ¹é…çš„ZONESï¼Œå¦‚æœæ­¤æ’ä»¶æ²¡æœ‰è®°å½•ï¼Œåˆ™ç”±ä¸‹ä¸€ä¸ªæ’ä»¶å¤„ç† fallthrough [ZONES...] } hosts { 172.21.0.1 kdc-1 fallthrough } import è¯¥æ’ä»¶æœ‰ä¸¤ä¸ªç”¨é€”ï¼š å¯¼å…¥å…¶å®ƒé…ç½®æ–‡ä»¶åˆ°ä¸»é…ç½®æ–‡ä»¶ å¯¼å…¥é…ç½®ç‰‡æ®µ æ ¼å¼ï¼š import PATTERN log è®°å½•æŸ¥è¯¢æ—¥å¿—ï¼Œæ ¼å¼ï¼š # NAMES åŒ¹é…çš„DNSæŸ¥è¯¢è¢«è®°å½• # FORMAT æ—¥å¿—æ ¼å¼ï¼Œ log [NAMES...] [FORMAT] log [NAMES...] [FORMAT] { class CLASSES... } CLASSES æŒ‡å®šå“ªäº›RCodeä¼šè¢«è®°å½• å–å€¼ è¯´æ˜ success è®°å½•æˆåŠŸçš„è¯·æ±‚ denial è®°å½•NXDOMAINçš„è¯·æ±‚ã€NOERRORä½†æ˜¯æ²¡æœ‰æ•°æ®çš„ï¼ˆnodataï¼ŒåŸŸåå­˜åœ¨ï¼Œä½†æ˜¯è¯·æ±‚çš„è®°å½•ç±»å‹æ²¡æœ‰ï¼‰ error è®°å½•SERVFAILã€NOTIMPã€REFUSEDç­‰ç­‰ï¼Œä»»ä½•æç¤ºè¿œç¨‹æœåŠ¡å™¨ä¸æ„¿æ„è§£æè¯·æ±‚çš„åº”ç­”éƒ½åŒ…å«åœ¨å†… all é»˜è®¤ï¼Œè®°å½•æ‰€æœ‰è¯·æ±‚ rewrite æ‰§è¡Œå†…éƒ¨çš„æ¶ˆæ¯é‡å†™ã€‚æ ¼å¼ # FIELD è¯·æ±‚/åº”ç­”çš„ä»€ä¹ˆå­—æ®µéœ€è¦è¢«é‡å†™ # type è¯·æ±‚çš„TYPEå­—æ®µ # class æ¶ˆæ¯çš„ç±»å‹ # name è¯·æ±‚ä¸­çš„DNSåç§° # answer name åº”ç­”ä¸­çš„DNSåç§° # ttl TTLå€¼ rewrite [continue|stop] FIELD [FROM TO|FROM TTL] è¦é‡å†™DNSè¯·æ±‚ä¸­çš„åç§°ï¼Œä½¿ç”¨æ ¼å¼ï¼š rewrite [continue|stop] name [exact|prefix|suffix|substring|regex] STRING STRING ç¤ºä¾‹ï¼š rewrite name substring k8s.gmem.cc k8s.gmem.site rewrite name regex (.*)\\.gmem\\.cc {1}.gmem.site rewrite name suffix .gmem.cc. .gmem.site. è¦é‡å†™DNSå“åº”ä¸­çš„åç§°ï¼Œå‚è€ƒï¼š rewrite stop { name regex (.*)\\.gmem\\.site {1}.gmem.site answer name (.*)\\.gmem\\.site {1}.gmem.site } template æä¾›ä¸€ä¸ªæ¨¡æ¿ï¼ŒåŸºäºè¯·æ±‚æ¥åŠ¨æ€çš„ç”Ÿæˆå“åº”ã€‚æ ¼å¼ # CLASS æŸ¥è¯¢åˆ†ç±»ï¼ŒINæˆ–ANY # TYPE æŸ¥è¯¢ç±»å‹ï¼ŒAã€PTR... ANYåŒ¹é…æ‰€æœ‰ç±»å‹ # ZONE æ­¤æ¨¡æ¿çš„Zone template CLASS TYPE [ZONE...] { # åŒ¹é…è¯·æ±‚DNSåç§°çš„æ­£åˆ™å¼ match REGEX... # DNSåº”ç­” answer RR additional RR authority RR rcode CODE # ç”¨äºè§£æCNAMEsçš„ä¸Šæœ‰é›†ç¾¤ upstream fallthrough [ZONE...] } æ³›åŸŸå ä½¿ç”¨templateæ’ä»¶å¯ä»¥å®ç°æ³›åŸŸåè§£æï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š template IN A mesh.gmem.cc { match .*\\.mesh\\.gmem\\.cc answer \"{{ .Name }} 60 IN A 10.0.11.11\" fallthrough } å½“å‰ç‰ˆæœ¬æœ‰ä¸€ä¸ªå¥‡æ€ªçš„è¡Œä¸ºï¼š ä¸Šè¿°é…ç½®å¯¼è‡´hostsæ’ä»¶æŒ‡å®šçš„10.0.11.1 mesh.gmem.ccæ¡ç›®å¤±æ•ˆï¼Œå¿…é¡»æŒ‡å®šfallthroughæ‰èƒ½é¿å…æ­¤é—®é¢˜ã€‚ å¯åŠ¨æœåŠ¡ docker run -d --restart=always --name coredns-srv -p 53:53/udp -v `pwd`/conf:/Conf coredns/c","date":"2023-11-11","objectID":"/posts/2023-11-11-coredns/:1:0","tags":["dns","coredns"],"title":"coredns","uri":"/posts/2023-11-11-coredns/"},{"categories":["DNS"],"content":"å¯è¡Œçš„é…ç½® å‚è€ƒé“¾æ¥ï¼šhttps://segmentfault.com/a/1190000022179401 Corefile .:53 { health { lameduck 5s } auto { directory ./zones reload 1m } hosts { 127.0.0.1 local.io ttl 120 reload 1m fallthrough } #chaos CoreDNS-001 info@coredns.io # prometheus 0.0.0.0:0153 log #cache 120 loop errors forward . 114.114.114.114:53 8.8.8.8:53 [2400:3200::1]:53 loadbalance } db.local.com $TTL 3600 ; è®°å½•è¶…æ—¶æ—¶é—´ $ORIGIN local.com. ; æŒ‡å®š originï¼Œä¸‹é¢çš„@ç¬¦å·å¯ä»¥ä½œä¸ºä»–çš„åˆ«åï¼Œæ³¨æ„åé¢çš„. ; SOA æ ¼å¼ [domain_name] IN SOA [åŸŸä¸»æœåŠ¡å™¨æˆ–ä¸»DNSæœåŠ¡å™¨å] [ç®¡ç†å‘˜email] (æ—¶é—´ä¿¡æ¯) @ IN SOA ns1.local.com. admin.local.com. ( 2019071601 ; Serial 4H ; Refresh 1H ; Retry 7D ; Expire 4H ) ; Negative Cache TTL ; é…ç½® DNS è®°å½•ï¼ŒæŒ‡å‘ ns1.local.com @ IN NS ns1 ; é…ç½® ns1.local.com çš„ A è®°å½•, æŒ‡å‘corednsæ‰€åœ¨çš„æœºå™¨ ns1 IN A 192.168.78.51 ; é…ç½® local.com çš„ A è®°å½•ï¼ŒæŒ‡å‘ç½‘ç«™æˆ–å…¶ä»–ç”¨é€”çš„æœºå™¨ @ IN A 192.168.78.51 git IN A 192.168.78.51 drone IN A 192.168.78.51 drone-runner IN A 192.168.78.51 www IN A 192.168.78.51 ccc IN A 192.168.78.51 ; é…ç½®æ³›åŸŸåï¼Œæ²¡æœ‰å‡†ç¡®çš„ä¸‰çº§å­åŸŸåçš„åŸŸåå…¨éƒ¨æŒ‡å‘æ­¤IPV4åœ°å€ * IN A 192.168.78.50 å¯åŠ¨æœåŠ¡ docker run -tid -p 53:53/udp -v /yaml/coredns/Corefile:/Corefile -v /yaml/coredns/zones:/zones --name=coredns coredns/coredns ","date":"2023-11-11","objectID":"/posts/2023-11-11-coredns/:1:1","tags":["dns","coredns"],"title":"coredns","uri":"/posts/2023-11-11-coredns/"},{"categories":["DNS"],"content":"äºŒã€å¢åŠ å’Œç¼–è¯‘æ’ä»¶ ç¼–è¯‘å®‰è£…corednsï¼š corednså®˜æ–¹å¯¹äºæ’ä»¶çš„åˆ†ç±»åŸºæœ¬å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼šPluginsã€External Pluginså’Œå…¶ä»–ã€‚å…¶ä¸­Pluginsä¸€èˆ¬éƒ½ä¼šè¢«é»˜è®¤ç¼–è¯‘åˆ°corednsçš„é¢„ç¼–è¯‘ç‰ˆæœ¬ä¸­ï¼Œè€ŒExternal Pluginsåˆ™ä¸ä¼šã€‚å®˜æ–¹çš„æ–‡æ¡£å¯¹å¤–éƒ¨æ’ä»¶çš„å®šä¹‰æœ‰ç€æ˜ç¡®çš„è§£é‡Šï¼Œä¸»è¦è¦æ±‚å¤§æ¦‚æ˜¯æœ‰ç”¨ã€é«˜æ•ˆã€ç¬¦åˆæ ‡å‡†ã€æ–‡æ¡£é½å…¨ã€é€šè¿‡æµ‹è¯•ç­‰ã€‚ å®˜æ–¹ç»™å‡ºäº†ä¸€ä¸ªè¯¦ç»†çš„æ–‡æ¡£è¯´æ˜ï¼Œç¼–è¯‘æ’ä»¶åŸºæœ¬å¯ä»¥åˆ†ä¸ºä¿®æ”¹æºç å’Œä¿®æ”¹ç¼–è¯‘çš„é…ç½®æ–‡ä»¶è¿™ä¸¤ç§æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç®€å•é«˜æ•ˆçš„ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œæµ‹è¯•ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-coredns/:2:0","tags":["dns","coredns"],"title":"coredns","uri":"/posts/2023-11-11-coredns/"},{"categories":["DNS"],"content":"1ã€ç¼–è¯‘ ä¸‹è½½æºç ï¼šhttps://github.com/coredns/coredns.git åœ¨æˆ‘ä»¬å‰é¢ä¸‹è½½çš„å®˜æ–¹æºç ä¸­ï¼Œæœ‰ä¸€ä¸ªpluginçš„ç›®å½•ï¼Œé‡Œé¢æ˜¯å„ç§æ’ä»¶çš„å®‰è£…åŒ…ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªplugin.cfgçš„æ–‡ä»¶ï¼Œé‡Œé¢åˆ—å‡ºäº†ä¼šç¼–è¯‘åˆ°corednsä¸­çš„æ’ä»¶ï¼Œ [root@sugar2 coredns]# tail plugin.cfg secondary:secondary etcd:etcd loop:loop forward:forward grpc:grpc erratic:erratic whoami:whoami on:github.com/coredns/caddy/onevent sign:sign git:github.com/miekg/coredns-git æ·»åŠ ä¸€ä¸ªgitæ’ä»¶ git:github.com/miekg/coredns-git å¯¹äºåœ¨pluginç›®å½•ä¸‹å·²ç»å­˜åœ¨çš„æ’ä»¶ï¼Œåˆ™å¯ä»¥ç›´æ¥å†™æˆpluginä¸­çš„ç›®å½•åï¼Œä¸åœ¨çš„åˆ™å†™æ’ä»¶çš„ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨go getä¸‹è½½ï¼š sign:sign ä¸‹è½½æ’ä»¶ï¼š go get github.com/miekg/coredns-git ç„¶åæˆ‘ä»¬å¼€å§‹ç¼–è¯‘ [root@sugar2 coredns]# make ","date":"2023-11-11","objectID":"/posts/2023-11-11-coredns/:2:1","tags":["dns","coredns"],"title":"coredns","uri":"/posts/2023-11-11-coredns/"},{"categories":["DNS"],"content":"2ã€éªŒè¯æ’ä»¶ å¯ä»¥ä½¿ç”¨-pluginsè¾“å‡ºåŒ…å«çš„æ’ä»¶ [root@sugar2 coredns]# ./coredns -plugins Server types: dns Caddyfile loaders: flag default Other plugins: dns.acl dns.any dns.auto dns.autopath dns.azure dns.bind dns.bufsize dns.cache dns.cancel dns.chaos dns.clouddns dns.debug dns.dns64 dns.dnssec dns.dnstap dns.erratic dns.errors dns.etcd dns.file dns.forward dns.geoip dns.git dns.grpc dns.header dns.health dns.hosts dns.k8s_external dns.kubernetes dns.loadbalance dns.local dns.log dns.loop dns.metadata dns.minimal dns.nsid dns.pprof dns.prometheus dns.ready dns.reload dns.rewrite dns.root dns.route53 dns.secondary dns.sign dns.template dns.tls dns.trace dns.transfer dns.whoami on 1ï¼‰ä½¿ç”¨gitæ’ä»¶ å»ºç«‹å­˜å‚¨zonesæ–‡ä»¶çš„çš„gitä»“åº“ï¼šgit@local.io:sugar/coredns_zone.git é…ç½®æ–‡ä»¶æ¨¡æ¿ .:53 { health { lameduck 5s } auto { directory /usr/local/coredns/zones reload 1m } hosts { ttl 120 reload 1m fallthrough } #chaos CoreDNS-001 info@coredns.io prometheus 0.0.0.0:9153 log cache 300 loop errors forward . 114.114.114.114:53 8.8.8.8:53 [2400:3200::1]:53 loadbalance git git@local.io:sugar/coredns_zone.git /usr/local/coredns/zones { branch master interval 3000 # pullçš„æ—¶é—´é—´éš” args --depth=1 pull_args --force } } supervisord [root@ftp coredns]# cat /etc/supervisord.d/coredns.ini [program:coredns] directory=/usr/local/coredns command=/usr/local/coredns/coredns -conf /usr/local/coredns/Corefile autostart=true autorestart=true startsecs=7 user = root stderr_logfile=/var/log/coredns/coredns-err.log stdout_logfile=/var/log/coredns/coredns.log redirect_stderr = true stdout_logfile_maxbytes = 100MB stdout_logfile_backups = 4 stopasgroup=true killasgroup=true ","date":"2023-11-11","objectID":"/posts/2023-11-11-coredns/:2:2","tags":["dns","coredns"],"title":"coredns","uri":"/posts/2023-11-11-coredns/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"â€‹ Multipass æ˜¯ä¸€ä¸ªè½»é‡è™šæ‹Ÿæœºç®¡ç†å™¨ï¼Œæ˜¯ç”± Ubuntu è¿è¥å…¬å¸ Canonical æ‰€æ¨å‡ºçš„å¼€æºé¡¹ç›®ã€‚è¿è¡Œç¯å¢ƒæ”¯æŒ Linuxã€Windowsã€macOSã€‚åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šï¼Œä½¿ç”¨çš„æ˜¯ä¸åŒçš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚åœ¨ Linux ä¸Šä½¿ç”¨çš„æ˜¯ KVMã€Window ä¸Šä½¿ç”¨ Hyper-Vã€macOS ä¸­ä½¿ç”¨ HyperKit ä»¥æœ€å°å¼€é”€è¿è¡ŒVMï¼Œæ”¯æŒåœ¨ç¬”è®°æœ¬æ¨¡æ‹Ÿå°å‹äº‘ã€‚Multipasså”¯ä¸€çš„é—æ†¾æ˜¯æ”¯æŒLinuxç‰ˆæœ¬åªæœ‰Ubuntuã€‚ åŒæ—¶ï¼ŒMultipass æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢æ¥å¯åŠ¨å’Œç®¡ç† Linux å®ä¾‹ã€‚ä¸‹è½½ä¸€ä¸ªå…¨æ–°çš„é•œåƒéœ€è¦å‡ ç§’é’Ÿçš„æ—¶é—´ï¼Œå¹¶ä¸”åœ¨å‡ åˆ†é’Ÿå†…å°±å¯ä»¥å¯åŠ¨å¹¶è¿è¡Œ VMã€‚ githubåœ°å€ï¼šhttps://github.com/canonical/multipass å®˜ç½‘ï¼šhttps://multipass.run/ ","date":"2023-11-11","objectID":"/posts/2023-11-11-multipass/:0:0","tags":["multipass","vm"],"title":"multipass","uri":"/posts/2023-11-11-multipass/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"å®‰è£… Macï¼š # 1ï¼‰brew å®‰è£… brew install --cask multipass # 2)githubæˆ–è€…å®˜ç½‘ä¸‹äºŒè¿›åˆ¶å®‰è£… Linuxï¼š ubuntuå®˜æ–¹åªreleaseäº†snapå®‰è£…ç‰ˆæœ¬ sudo snap install multipass Windowsï¼š githubä¸‹è½½å®‰è£…åŒ… ","date":"2023-11-11","objectID":"/posts/2023-11-11-multipass/:0:1","tags":["multipass","vm"],"title":"multipass","uri":"/posts/2023-11-11-multipass/"},{"categories":["è™šæ‹ŸåŒ–"],"content":"ä½¿ç”¨ 1ï¼‰æŸ¥æ‰¾å¯ä»¥ä¸‹è½½çš„ubuntué•œåƒï¼ˆmultipasså®˜æ–¹é•œåƒåªæœ‰ubuntuï¼‰ [root@sugar ~]$ multipass find Image Aliases Version Description 18.04 bionic 20221014 Ubuntu 18.04 LTS 20.04 focal 20221018 Ubuntu 20.04 LTS 22.04 jammy,lts 20221101.1 Ubuntu 22.04 LTS anbox-cloud-appliance latest Anbox Cloud Appliance charm-dev latest A development and testing environment for charmers docker latest A Docker environment with Portainer and related tools jellyfin latest Jellyfin is a Free Software Media System that puts you in control of managing and streaming your media. minikube latest minikube is local Kubernetes 2ï¼‰åˆ›å»ºè™šæ‹Ÿæœº å‚æ•°ï¼š -n, --name: åç§° -c, --cpus: cpuæ ¸å¿ƒæ•°, é»˜è®¤: 1 -m, --mem: å†…å­˜å¤§å°, é»˜è®¤: 1G -d, --disk: ç¡¬ç›˜å¤§å°, é»˜è®¤: 5G åˆ›å»ºè™šæ‹Ÿæœºæ—¶éœ€è¦è”ç½‘ä¸‹è½½é•œåƒ # ä½¿ç”¨æœ€æ–°ç‰ˆLTSé•œåƒ [root@sugar ~]$ multipass launch -n vm01 -c 1 -m 1G -d 10G # è®¾ç½®ä½¿ç”¨çš„é•œåƒ [root@sugar ~]$ multipass launch focal -n vm01 -c 1 -m 1G -d 10G # è®¾ç½®ç½‘ç»œ # name ç½‘å¡å # mode dhcpæ–¹å¼ï¼Œautoæˆ–è€…manualï¼Œé»˜è®¤auto # mac è®¾ç½®macåœ°å€ [root@sugar ~]$ multipass launch --network en0 --network name=bridge0,mode=manual ä¿®æ”¹é…ç½® [root@sugar ~]$ multipass set local.\u003cinstance-name\u003e.(cpus|disk|memory) xxx 3ï¼‰ä¸è™šæ‹Ÿæœºäº¤äº’ # é»˜è®¤æ˜¯ä»¥ubuntuç”¨æˆ·è¿›å…¥ [root@sugar ~]$ multipass shell vm01 # åœ¨è™šæ‹Ÿæœºå¤–æ‰§è¡Œå‘½ä»¤ [root@sugar ~]$ multipass exec vm01 -- pwd 4ï¼‰å¯åŠ¨ä¸å…³é—­ [root@sugar ~]$ multipass start vm01 [root@sugar ~]$ multipass start vm01 vm02 [root@sugar ~]$ multipass start --all [root@sugar ~]$ multipass suspend vm01 [root@sugar ~]$ multipass suspend --all [root@sugar ~]$ multipass stop vm01 [root@sugar ~]$ multipass stop --all [root@sugar ~]$ multipass delete vm01 [root@sugar ~]$ multipass delete --all # ä»ä¸€ä¸ªåˆ é™¤çš„å®ä¾‹ä¸­æ¢å¤ [root@sugar ~]$ multipass recover keen-yak # ç§»é™¤ä¸€ä¸ªå®ä¾‹ [root@sugar ~]$ multipass delete keen-yak [root@sugar ~]$ multipass purge [root@sugar ~]$ multipass list No instances found. # æˆ–è€… [root@sugar ~]$$ multipass delete --purge keen-yak 5ï¼‰æ•°æ®å…±äº« mount $ multipass mount $HOME keen-yak $ multipass info keen-yak â€¦ Mounts: /home/michal =\u003e /home/michal # æŒ‚è½½æŒ‡å®šè·¯å¾„ $ multipass mount $HOME keen-yak:/some/path # æŸ¥çœ‹ä¿¡æ¯ $ multipass info keen-yak # å¸è½½ $ multipass umount keen-yak ä¼ è¾“æ–‡ä»¶ $ multipass transfer keen-yak:/etc/crontab keen-yak:/etc/fstab /home/michal $ ls -l /home/michal/crontab /home/michal/fstab -rw-r--r-- 1 michal michal 722 Oct 18 12:13 /home/michal/crontab -rw-r--r-- 1 michal michal 82 Oct 18 12:13 /home/michal/fstab $ multipass transfer /home/michal/crontab /home/michal/fstab keen-yak: $ multipass exec keen-yak -- ls -l crontab fstab -rw-rw-r-- 1 ubuntu ubuntu 722 Oct 18 12:14 crontab -rw-rw-r-- 1 ubuntu ubuntu 82 Oct 18 12:14 fstab 6ï¼‰å®¹å™¨è‡ªåŠ¨åŒ– ä¸ºäº†ä¿æŒå¼€å‘ç¯å¢ƒå’Œçº¿ä¸Šç¯å¢ƒä¸€è‡´æ€§ åŒæ—¶èŠ‚çœéƒ¨ç½²æ—¶é—´ multipass ç»™æˆ‘ä»¬æä¾›äº† â€“cloud-init é€‰é¡¹è¿›è¡Œå®¹å™¨å¯åŠ¨åˆå§‹åŒ–é…ç½®: multipass launch --name ubuntu --cloud-init config.yaml ä¸Šé¢ config.yaml åˆ™æ˜¯å®¹å™¨çš„åˆå§‹åŒ–é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³åœ¨åˆå§‹åŒ–å®¹å™¨çš„æ—¶å€™ï¼Œè‡ªåŠ¨ä¸‹è½½å®‰è£… Node.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š #cloud-config runcmd: - curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash - - sudo apt-get install -y nodejs runcmd å¯ä»¥æŒ‡å®šå®¹å™¨ é¦–æ¬¡å¯åŠ¨ æ—¶è¿è¡Œçš„å‘½ä»¤ å‡¡æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„cloud-initçš„é…ç½®æ–‡ä»¶,å¿…é¡»ä»¥#cloud-configå¼€å¤´ï¼Œè¿™æ˜¯cloud-initè¯†åˆ«å®ƒçš„æ–¹å¼ã€‚ yaml é…ç½®æ–‡ä»¶å‚è€ƒé“¾æ¥ï¼šhttps://cloudinit.readthedocs.io/en/latest/topics/examples.html?highlight=lock-passwd#including-users-and-groups ","date":"2023-11-11","objectID":"/posts/2023-11-11-multipass/:0:2","tags":["multipass","vm"],"title":"multipass","uri":"/posts/2023-11-11-multipass/"},{"categories":["Go åŸºç¡€"],"content":"1ã€å˜é‡å®šä¹‰ var name string var isOk bool // éšå¼ç”³æ˜ a := 100 str := \"serialt\" // æ‰¹é‡å£°æ˜ var ( a string b int c bool d float32 ) // å˜é‡çš„åˆå§‹åŒ– var name string = \"github\" var age int = 10 var name, age = \"github\", 11 // ç±»å‹æ¨å¯¼ var name = \"github\" var age = 11 // å¸¸é‡å£°æ˜ const pi = 3.1415 const e = 2.7182 const ( pi = 3.1415 e = 2.7182 ) // conståŒæ—¶å£°æ˜å¤šä¸ªå¸¸é‡æ—¶ï¼Œå¦‚æœçœç•¥äº†å€¼åˆ™è¡¨ç¤ºå’Œä¸Šé¢ä¸€è¡Œçš„å€¼ç›¸åŒã€‚ const ( n1 = 100 n2 n3 ) // æšä¸¾ const ( n1 = iota //0 n2 //1 n3 //2 n4 //3 ) // ä½¿ç”¨_è·³è¿‡æŸäº›å€¼ const ( n1 = iota //0 n2 //1 _ n4 //3 ) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:1:0","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"2ã€æµç¨‹æ§åˆ¶ func ifDemo1() { score := 65 if score \u003e= 90 { fmt.Println(\"A\") } else if score \u003e 75 { fmt.Println(\"B\") } else { fmt.Println(\"C\") } } func forDemo() { for i := 0; i \u003c 10; i++ { fmt.Println(i) } } func forDemo3() { i := 0 for i \u003c 10 { fmt.Println(i) i++ } } // æ— é™å¾ªç¯ for { å¾ªç¯ä½“è¯­å¥ } // switch è¯­æ³• func testSwitch3() { n := 7 switch n { case 1, 3, 5, 7, 9: fmt.Println(\"å¥‡æ•°\") case 2, 4, 6, 8: fmt.Println(\"å¶æ•°\") default: fmt.Println(n) } } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:2:0","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"3ã€slice a := []int{1, 2, 3, 4, 5} // ä»åˆ‡ç‰‡ä¸­åˆ é™¤å…ƒç´  func main() { // ä»åˆ‡ç‰‡ä¸­åˆ é™¤å…ƒç´  a := []int{30, 31, 32, 33, 34, 35, 36, 37} // è¦åˆ é™¤ç´¢å¼•ä¸º2çš„å…ƒç´  a = append(a[:2], a[3:]...) fmt.Println(a) //[30 31 33 34 35 36 37] } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:3:0","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"4ã€å‡½æ•° // åŒ¿åå‡½æ•° func(x, y int) { fmt.Println(x + y) }(10, 20) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:4:0","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"ç»“æ„ä½“ // åµŒå¥—åŒ¿åå­—æ®µ type Address struct { Province string City string } //User ç”¨æˆ·ç»“æ„ä½“ type User struct { Name string Gender string Address //åŒ¿åå­—æ®µ } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:4:1","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"5ã€ç¼–è¯‘ Mac ä¸‹ç¼–è¯‘ Linux å’Œ Windowså¹³å° 64ä½ å¯æ‰§è¡Œç¨‹åºï¼š CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build # go 1.16+ç‰ˆæœ¬ CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build CGO_ENABLED=0 GOOS=windows GOARCH=arm64 go build Linux ä¸‹ç¼–è¯‘ Mac å’Œ Windows å¹³å°64ä½å¯æ‰§è¡Œç¨‹åºï¼š CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build Windowsä¸‹ç¼–è¯‘Macå¹³å°64ä½å¯æ‰§è¡Œç¨‹åºï¼š SET CGO_ENABLED=0 SET GOOS=darwin SET GOARCH=amd64 go build å›½å†…é•œåƒè®¾ç½® export GOPROXY=https://goproxy.cn,direct export GOPATH=/root/go export GO111MODULE=\"on\" export GOBIN=$GOPATH/bin export PATH=$PATH:$GOROOT/bin:$GOBIN ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:5:0","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"6ã€ç§æœ‰ä»“åº“è®¾ç½® go env -w GOPRIVATE=\"github.com/private_org/private_repo\" go env -w GOPRIVATE=\"github.com/private_org\" å¼ºåˆ¶èµ°sshåè®®getç§æœ‰åŒ…ä»£ç  [url \"ssh://git@github.com/\"] insteadOf = https://github.com/ # æˆ–è€… git config --global url.\"ssh://git@github.com/\".insteadOf https://github.com/ # go get/install é»˜è®¤æ˜¯èµ°httpsçš„ï¼Œé»˜è®¤go getå‘èµ·è¯·æ±‚ä½¿ç”¨çš„æ˜¯HTTPSï¼Œå¦‚æœè‡ªå·±çš„ç§æœ‰æœåŠ¡æ˜¯HTTPçš„ï¼Œåˆ™éœ€è¦é…ç½®ä¸‹ã€‚ go env -w GOINSECURE=git.local.com ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:6:0","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"7ã€makefile PROJECT_NAME= cli GOBASE=$(shell pwd) GOFILES=$(wildcard *.go) BRANCH := $(shell git symbolic-ref HEAD 2\u003e/dev/null | cut -d\"/\" -f 3) # BRANCH := `git fetch --tags \u0026\u0026 git tag | sort -V | tail -1` # BUILD := $(shell git rev-parse --short HEAD) BUILD_DIR := $(GOBASE)/dist VERSION = $(BRANCH) BuildTime := $(shell date -u '+%Y-%m-%d %H:%M:%S %Z') GitHash := $(shell git rev-parse HEAD) GoVersion = $(shell go version | cut -d \" \" -f 3 ) Maintainer := cccc@gmail.com KEY := wzFdVccccccccccccccc PKGFLAGS := \" -s -w -X 'main.APPVersion=$(VERSION)' -X 'main.GoVersion=$(GoVersion)' -X 'main.BuildTime=$(BuildTime)' -X 'main.GitCommit=$(GitHash)' -X 'main.AesKey=$(KEY)' \" APP_NAME = $(PROJECT_NAME) # go-pkg.v0.1.1-linux-amd64 .PHONY: clean clean: @-rm -rf dist/$(PROJECT_NAME)* .PHONY: serve serve: go run . .PHONY: build build: clean @go build -trimpath -ldflags $(PKGFLAGS) -o \"dist/$(APP_NAME)\" @echo \"\\n******************************\" @echo \" build succeed \" @echo \"******************************\\n\" @ls -la dist/$(PROJECT_NAME)* @echo .PHONY: build-linux build-linux: clean @go mod tidy @GOOS=\"linux\" GOARCH=\"amd64\" go build -trimpath -ldflags $(PKGFLAGS) -v -o \"dist/$(APP_NAME)-linux-amd64\" @GOOS=\"linux\" GOARCH=\"arm64\" go build -trimpath -ldflags $(PKGFLAGS) -v -o \"dist/$(APP_NAME)-linux-arm64\" @echo \"\\n******************************\" @echo \" build linux succeed \" @echo \"******************************\\n\" @ls -la dist/$(PROJECT_NAME)* @echo .PHONY: release release: clean @go mod tidy @GOOS=\"windows\" GOARCH=\"amd64\" go build -trimpath -ldflags $(PKGFLAGS) -v -o \"dist/$(APP_NAME)-windows-amd64.exe\" @GOOS=\"linux\" GOARCH=\"amd64\" go build -trimpath -ldflags $(PKGFLAGS) -v -o \"dist/$(APP_NAME)-linux-amd64\" @GOOS=\"linux\" GOARCH=\"arm64\" go build -trimpath -ldflags $(PKGFLAGS) -v -o \"dist/$(APP_NAME)-linux-arm64\" @GOOS=\"darwin\" GOARCH=\"amd64\" go build -trimpath -ldflags $(PKGFLAGS) -v -o \"dist/$(APP_NAME)-darwin-amd64\" @GOOS=\"darwin\" GOARCH=\"arm64\" go build -trimpath -ldflags $(PKGFLAGS) -v -o \"dist/$(APP_NAME)-darwin-arm64\" @echo \"\\n******************************\" @echo \" release succeed \" @echo \"******************************\\n\" @ls -la dist/$(PROJECT_NAME)* @echo ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:7:0","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"8ã€go work å‚è€ƒé“¾æ¥ï¼šhttps://cloud.tencent.com/developer/article/1970405 go 1.18 æ–°å¢åŠ  workspaceçš„å¼€å‘æ¨¡å¼ï¼Œ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:8:0","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"Go work ä½¿ç”¨ä»‹ç» 1ï¼‰åˆ›å»ºä¸€ä¸ªworkspace [root@tc ~]$ mkdir github [root@tc ~]$ cd github 2ï¼‰åˆ›å»ºåŒ… p1 [root@tc p1]$ tree . . â”œâ”€â”€ go.mod â””â”€â”€ p1.go 0 directories, 2 files [root@tc p1]$ cat p1.go package p1 import \"fmt\" func Hello(obj string) { fmt.Printf(\"Hello %s\\n\", obj) } 3ï¼‰å›åˆ°githubç›®å½•ï¼Œç”Ÿæˆgo.work [root@tc github]$ go work init ./p1 [root@tc github]$ cat go.work go 1.18 use ( ./p1 ) 4ã€åˆ›å»ºp2ï¼Œgo [root@tc p2]$ tree . . â”œâ”€â”€ go.mod â””â”€â”€ main.go 0 directories, 2 files [root@tc p2]$ cat main.go package main import ( \"github.com/serialt/p1\" ) func main() { p1.Hello(\"world\") } [root@tc p2]$ go run main.go Hello world æ³¨æ„ï¼šä»¥ä¸Šæ“ä½œä¸èƒ½buildæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› ä¸ºp2 æ²¡æœ‰è¢«æ·»åŠ go worké‡Œï¼Œéœ€è¦æŠŠp2 æ·»åŠ è¿›go workæ‰èƒ½ä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘githubç›®å½•ä¸‹çš„go.workï¼Œä¹Ÿå¯ä½¿ç”¨go work use p2 æŠŠp2æ·»åŠ åˆ°go worké‡Œï¼Œç„¶åå†æ‰§è¡Œgo build [root@tc p2]$ go build [root@tc p2]$ ls go.mod main.go p2 [root@tc p2]$ ./p2 Hello world æ³¨æ„ï¼šå› ä¸ºæ­¤æ—¶p1 æ²¡æœ‰æäº¤åˆ°è¿œç¨‹gitä»“åº“ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œgo mod tidy çš„æ—¶å€™æ˜¯ä¼šå»è¿œç¨‹ä»“åº“ä¸‹è½½è§£å†³ä¾èµ–ï¼Œå¯ä»¥ç­‰p1 å¼€å‘å®Œå æŠŠp1 æäº¤åˆ°è¿œç¨‹ä»“åº“åå†å¯¹p2 è¿›è¡Œgo mod tidyã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:8:1","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"9ã€ä¾èµ–ç‰ˆæœ¬æ§åˆ¶ go ç‰ˆæœ¬ä¾èµ–åº“ç®¡ç†æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:9:0","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"æ–¹å¼1ï¼š v1ç‰ˆæœ¬go.mod module github.com/serialt/sugar v2ç‰ˆæœ¬go.md module github.com/serialt/sugar/v2 ä½¿ç”¨åº“æ—¶åº“åä»ç„¶æ˜¯sugar.xxxx å‚è€ƒåœ°å€ https://github.com/serialt/sugar ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:9:1","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"æ–¹å¼2: github.com/go-git/go-git/v5 ä½¿ç”¨åº“æ—¶å€™åº“åæ˜¯gitï¼Œä½¿ç”¨åº“åæ—¶å€™ä¼šè‡ªåŠ¨å»æ‰go-ï¼Œç›´æ¥ä½¿ç”¨gitã€‚ å‚è€ƒåœ°å€ï¼š https://github.com/serialt/git-mirror/blob/master/service/github.go ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:9:2","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"æ–¹å¼3ï¼š gopkg.in/yaml.v3 å‚è€ƒåœ°å€ï¼š https://github.com/go-yaml/yaml ä½¿ç”¨åº“æ˜¯æ—¶å€™æ˜¯yaml.xxxxxï¼Œä¼šè‡ªåŠ¨å»æ‰.v3 æ³¨æ„ï¼Œä»¥ä¸Šæ–¹å¼ä¸€ä¸ªrepoå¤šä¸ªç‰ˆæœ¬å…±å­˜çš„åŸºç¡€æ˜¯éœ€è¦ä¸go.mdå¯¹åº”ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:9:3","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"10ã€å¯é€‰å‚æ•° type Option func(*OptionSet) func New(opts ...Option){ //ä¸‹é¢è®¾ç½®é»˜è®¤å€¼ options:=OptionSet{ A:\"default-a\", B:\"default-b\", C:\"default-c\", } for _,fun:=range opts{ fun(\u0026options) } } //å¦‚æœæˆ‘ä»¬éœ€è¦æä¾›optioné€‰é¡¹,æ¯”æ–¹è¯´è®¾ç½®A func WithA(a string) Option{ return func(opt *OptionSet){ opt.A=a } } // ä½¿ç”¨çš„æ—¶å€™ a=New(WithA(\"abc\")) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:10:0","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["Go åŸºç¡€"],"content":"11ã€è¿›ç¨‹é€€å‡º // è¿›ç¨‹æŒç»­è¿è¡Œ c := make(chan os.Signal, 1) signal.Notify(c, syscall.SIGTERM, syscall.SIGINT) s := \u003c-c slog.Info(\"Aborting...\", \"signal\", s) os.Exit(2) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-basic/:11:0","tags":["Go","basic"],"title":"Go basic","uri":"/posts/2023-11-11-go-basic/"},{"categories":["mac"],"content":"Mac ä¼˜åŒ– ","date":"2023-11-11","objectID":"/posts/2023-11-11-mac/:0:0","tags":["mac"],"title":"mac","uri":"/posts/2023-11-11-mac/"},{"categories":["mac"],"content":"1ã€macç»ˆç«¯å¢åŠ é¢œè‰²ï¼Œå‚è€ƒcentos7 eval \"$(/opt/homebrew/bin/brew shellenv)\" # Setting PATH for Python 3.9 # The original version is saved in .bash_profile.pysave PATH=\"/Library/Frameworks/Python.framework/Versions/3.9/bin:${PATH}\" export PG_HOME=/opt/homebrew/Cellar/postgresql@10/10.17 export PATH export GOPROXY=https://goproxy.cn,direct export GOPATH=/Users/sugar/go export GO111MODULE=\"on\" export GOBIN=$GOPATH/bin export PATH=$PATH:$GOROOT/bin:$GOBIN:$PG_HOME/bin # å‚è€ƒRHEL console export PS1=\"[\\u@\\h \\W]\\\\$ \" export CLICOLOR=1 export LSCOLORS=ExGxFxdaCxDaDahbadeche export LC_ALL=en_US.UTF-8 export LANG=en_US.UTF-8 ","date":"2023-11-11","objectID":"/posts/2023-11-11-mac/:1:0","tags":["mac"],"title":"mac","uri":"/posts/2023-11-11-mac/"},{"categories":["mac"],"content":"2ã€å®‰è£…homebrew å‚è€ƒï¼šhttp://mirrors.ustc.edu.cn/help/brew.git.html é…ç½®ç¯å¢ƒå˜é‡ [sugar@localhost ~]$ cat ~/.bash_profile # brew å®‰è£…å…¶ä»–ç›®å½•ä¸‹æ‰éœ€è¦è®¾ç½® #eval \"$(/opt/homebrew/bin/brew shellenv)\" export HOMEBREW_BREW_GIT_REMOTE=\"https://mirrors.ustc.edu.cn/brew.git\" export HOMEBREW_CORE_GIT_REMOTE=\"https://mirrors.ustc.edu.cn/homebrew-core.git\" export HOMEBREW_BOTTLE_DOMAIN=\"https://mirrors.ustc.edu.cn/homebrew-bottles\" å®‰è£… /bin/bash -c \"$(curl -fsSL https://cdn.jsdelivr.net/gh/Homebrew/install@HEAD/install.sh)\" 3ã€å»é™¤è‡ªåŠ¨ç”Ÿæˆ.DS_Storeæ–‡ä»¶ .DS_Storeæ˜¯Mac OSä¿å­˜æ–‡ä»¶å¤¹çš„è‡ªå®šä¹‰å±æ€§çš„éšè—æ–‡ä»¶ï¼Œå¦‚æ–‡ä»¶çš„å›¾æ ‡ä½ç½®æˆ–èƒŒæ™¯è‰²ï¼Œç›¸å½“äºWindowsçš„desktop.ini 1ï¼‰ç¦æ­¢.DS_Storeæ–‡ä»¶çš„ç”Ÿæˆï¼š defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool TRUE 2ï¼‰æ¢å¤.DS_Storeæ–‡ä»¶çš„ç”Ÿæˆ defaults delete com.apple.desktopservices DSDontWriteNetworkStores 3ï¼‰åˆ é™¤ç£ç›˜ä¸Šçš„ .DS_Store,åˆ é™¤å½“å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸‹çš„æ‰€æœ‰.DS_Store æ–‡ä»¶: sudo find . -name '*.DS_Store' -type f -delete æœ€åé‡å¯ç”µè„‘å³å¯ç”Ÿæ•ˆï¼ ","date":"2023-11-11","objectID":"/posts/2023-11-11-mac/:2:0","tags":["mac"],"title":"mac","uri":"/posts/2023-11-11-mac/"},{"categories":["mac"],"content":"4ã€ç¯å¢ƒå˜é‡ eval \"$(/opt/homebrew/bin/brew shellenv)\" export HOMEBREW_BREW_GIT_REMOTE=\"https://mirrors.ustc.edu.cn/brew.git\" export HOMEBREW_BOTTLE_DOMAIN=\"https://mirrors.ustc.edu.cn/homebrew-bottles\" export HOMEBREW_CORE_GIT_REMOTE=\"https://mirrors.ustc.edu.cn/homebrew-core.git\" export PG_HOME=/opt/homebrew/Cellar/postgresql@10/10.17 export GOPROXY=https://goproxy.cn,direct export GOPATH=/Users/sugar/go export GO111MODULE=\"on\" export GOBIN=$GOPATH/bin export PATH=$PATH:$GOROOT/bin:$GOBIN:$PG_HOME/bin export GOPRIVATE=\"local.com,gitee.com/cccccc\" export GOINSECURE=\"local.com\" #export CGO_ENABLED=\"0\" #export PS1='[\\u@\\h \\W]\\$ ' export PS1=\"[\\u@\\h \\W]\\\\$ \" export CLICOLOR=1 export LSCOLORS=ExGxFxdaCxDaDahbadeche export LC_ALL=en_US.UTF-8 export LANG=en_US.UTF-8 function k8s-local(){ unset KUBECONFIG export KUBECONFIG=~/.kube/kubeconfig-local.json kubectl cluster-info kubectl get namespace } function k8s-1(){ unset KUBECONFIG export KUBECONFIG=~/.kube/kubeconfig-1.json kubectl cluster-info kubectl get namespace } alias ll='ls -l' alias lh='ls -lh' #UserIP=$(who -u am i | cut -d\"(\" -f 2 | sed -e \"s/[()]//g\") export HISTTIMEFORMAT=\"[%F %T] [`whoami`] \" export HISTSIZE=99999 export HISTFILESIZE=550 # socket5 proxy(){ export http_proxy=\"http://127.0.0.1:5559\" export https_proxy=\"http://127.0.0.1:5559\" # è®¾ç½®ä»£ç† networksetup -setwebproxy Wi-Fi 127.0.0.1 5559 networksetup -setsecurewebproxy Wi-Fi 127.0.0.1 5559 networksetup -setsocksfirewallproxy Wi-Fi 127.0.0.1 5558 # æ‰“å¼€ç³»ç»Ÿä»£ç† networksetup -setwebproxystate Wi-Fi on networksetup -setsecurewebproxystate Wi-Fi on networksetup -setsocksfirewallproxystate Wi-Fi on ~/Desktop/v2cc/proxy } # å–æ¶ˆè®¾ç½®çš„ä»£ç† noproxy(){ unset http_proxy unset https_proxy networksetup -setwebproxystate Wi-Fi off networksetup -setsecurewebproxystate Wi-Fi off networksetup -setsocksfirewallproxystate Wi-Fi off } export PATH=\"/opt/homebrew/opt/icu4c/bin:$PATH\" export PATH=\"/opt/homebrew/opt/icu4c/sbin:$PATH\" #For compilers to find icu4c you may need to set: export LDFLAGS=\"-L/opt/homebrew/opt/icu4c/lib\" export CPPFLAGS=\"-I/opt/homebrew/opt/icu4c/include\" #For pkg-config to find icu4c you may need to set: export PKG_CONFIG_PATH=\"/opt/homebrew/opt/icu4c/lib/pkgconfig\" export PATH=\"/opt/homebrew/opt/node@14/bin:$PATH\" export LDFLAGS=\"-L/opt/homebrew/opt/node@14/lib\" export CPPFLAGS=\"-I/opt/homebrew/opt/node@14/include\" 5ã€ä½¿ç”¨bash-completionè¡¥å…¨ bash-completionéƒ¨åˆ†å·²ç»ä¸å…¼å®¹ï¼Œéœ€è¦ä½¿ç”¨v2ç‰ˆ brew install bash-completion@2 vim ~/.bash_profile # use bash-completion export BASH_COMPLETION_COMPAT_DIR=\"/opt/homebrew/etc/bash_completion.d\" [[ -r \"/opt/homebrew/etc/profile.d/bash_completion.sh\" ]] \u0026\u0026 . \"/opt/homebrew/etc/profile.d/bash_completion.sh\" 6ã€kubectlå‘½ä»¤è¡¥é½ vim ~/.bash_profile kubectl completion bash \u003e /opt/homebrew/etc/bash_completion.d/kubectl # è®¾ç½®åˆ«å echo 'alias k=kubectl' \u003e\u003e~/.bash_profile echo 'complete -o default -F __start_kubectl k' \u003e\u003e~/.bash_profile 7ã€åº”ç”¨ä¸‹è½½ç½‘ç«™ http://mac-torrent-download.net/ https://www.torrentmac.net/ https://mac-torrents.io/ 8 ã€è½¯ä»¶å‡ºç° ã€xxxxxå°†å¯¹æ‚¨çš„ç”µè„‘é€ æˆä¼¤å®³ï¼Œæ‚¨åº”è¯¥å°†å®ƒç§»åŠ¨åˆ°åºŸçº¸ç¯“ã€‘ # åˆ‡æ¢åˆ°è½¯ä»¶æˆ–è€…cmdæ‰€åœ¨çš„ç›®å½• codesign -f -s - --deep xxxx_app_name # ä¾‹å¦‚ codesign -f -s - --deep terraform 9ã€å®‰è£…â€œChromiumâ€å·²æŸåï¼Œæ— æ³•æ‰“å¼€ã€‚ æ‚¨åº”è¯¥å°†å®ƒç§»åˆ°åºŸçº¸ç¯“ã€‚ # å› ä¸ºç­¾åä¸é€ æˆçš„ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ sudo xattr -cr /Applications/Chromium.app 10ã€é…ç½®githubä»£ç† # http || https # Host github.com # User git # ProxyCommand nc -v -x 127.0.0.1:5559 %h %p Host github.com User git ProxyCommand nc -v -x 127.0.0.1:5558 %h %p ","date":"2023-11-11","objectID":"/posts/2023-11-11-mac/:3:0","tags":["mac"],"title":"mac","uri":"/posts/2023-11-11-mac/"},{"categories":["linux åŸºç¡€"],"content":"ubuntu åŸºç¡€ ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:0:0","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["linux åŸºç¡€"],"content":"ä¸€ã€aptæº ä¿®æ”¹aptæºä¸ºå›½å†…æºï¼Œä¸»é…ç½®æ–‡ä»¶ï¼š/etc/apt/sources.listï¼Œé…ç½®æ–‡ä»¶ç›®å½•ï¼š/etc/apt/sources.dï¼Œä»¥1804ä¸ºä¾‹ã€‚ # ä¿®æ”¹ /etc/apt/sources.list deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse ä¿®æ”¹å‘½ä»¤ sudo sed -i \"s@http://.*archive.ubuntu.com@http://repo.huaweicloud.com@g\" /etc/apt/sources.list sudo sed -i \"s@http://.*security.ubuntu.com@http://repo.huaweicloud.com@g\" /etc/apt/sources.list ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:1:0","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["linux åŸºç¡€"],"content":"apt ä½¿ç”¨é—®é¢˜ 1ï¼‰apt-getå®‰è£…ä¸­çš„E: Sub-process /usr/bin/dpkg returned an error code (1)é—®é¢˜ å‚è€ƒç½‘å€ï¼šhttps://www.cnblogs.com/orzs/p/10844869.html cd /var/lib/dpkg/ sudo mv info/ info_bak # ç°å°†infoæ–‡ä»¶å¤¹æ›´å sudo mkdir info # å†æ–°å»ºä¸€ä¸ªæ–°çš„infoæ–‡ä»¶å¤¹ sudo apt-get update # æ›´æ–° sudo apt-get -f install # ä¿®å¤ sudo mv info/* info_bak/ # æ‰§è¡Œå®Œä¸Šä¸€æ­¥æ“ä½œåä¼šåœ¨æ–°çš„infoæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€äº›æ–‡ä»¶ï¼Œç°å°†è¿™äº›æ–‡ä»¶å…¨éƒ¨ç§»åˆ°info_bakæ–‡ä»¶å¤¹ä¸‹ sudo rm -rf info # æŠŠè‡ªå·±æ–°å»ºçš„infoæ–‡ä»¶å¤¹åˆ æ‰ sudo mv info_bak info # æŠŠä»¥å‰çš„infoæ–‡ä»¶å¤¹é‡æ–°æ”¹å›å 2ï¼‰Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend) è§£å†³åŠæ³•ï¼š ç¬¬ä¸€ç§æƒ…å†µï¼š è¿›ç¨‹ä¸­å­˜åœ¨ä¸aptç›¸å…³çš„æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼š é¦–å…ˆæ£€æŸ¥æ˜¯å¦åœ¨è¿è¡Œapt,apt-getç›¸å…³çš„è¿›ç¨‹ ps aux | grep -i apt å¦‚æœå­˜åœ¨ä¸aptç›¸å…³çš„æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œkillæ‰è¿›ç¨‹ï¼› sudo kill -9 \u003cprocess id\u003e æˆ–è€…ç›´æ¥ç®€å•ç²—æš´çš„ï¼š sudo killall apt apt-get å¦‚æœè¿›è¡Œå®Œä¸Šé¢çš„æ­¥éª¤è¿˜æ˜¯æ— æ³•é¡ºåˆ©æ‰§è¡Œapt-get æ“ä½œï¼Œåˆ™å±äºç¬¬äºŒç§æƒ…å†µï¼š ç¬¬äºŒç§æƒ…å†µï¼š è¿›ç¨‹åˆ—è¡¨ä¸­å·²ç»æ²¡æœ‰ä¸apt,apt-getç›¸å…³çš„è¿›ç¨‹åœ¨è¿è¡Œï¼Œä½†ä¾ç„¶æŠ¥é”™ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäº§ç”Ÿé”™è¯¯çš„æ ¹æœ¬åŸå› æ˜¯lock fileã€‚ loack fileç”¨äºé˜²æ­¢ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ä½¿ç”¨ç›¸åŒçš„æ•°æ®ã€‚ å½“è¿è¡Œaptæˆ–apt-commandsæ—¶ï¼Œå®ƒä¼šåœ¨å‡ ä¸ªåœ°æ–¹åˆ›å»ºlock filesã€‚ å½“å‰ä¸€ä¸ªaptå‘½ä»¤æœªæ­£ç¡®ç»ˆæ­¢æ—¶ï¼Œlock fileæœªè¢«åˆ é™¤ï¼Œå› æ­¤å®ƒä»¬ä¼šé˜»æ­¢ä»»ä½•æ–°çš„apt / apt-getå‘½ä»¤å®ä¾‹ï¼Œæ¯”å¦‚æ­£åœ¨æ‰§è¡Œapt-get upgradeï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ç›´æ¥ctrl+cå–æ¶ˆäº†è¯¥æ“ä½œï¼Œå¾ˆæœ‰å¯èƒ½å°±ä¼šé€ æˆè¿™ç§æƒ…å†µã€‚ è¦è§£å†³æ­¤é—®é¢˜ï¼Œé¦–å…ˆè¦åˆ é™¤lock fileã€‚ ä½¿ç”¨lsofå‘½ä»¤è·å–æŒæœ‰lock fileçš„è¿›ç¨‹çš„è¿›ç¨‹ID,ä¾æ¬¡è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š lsof /var/lib/dpkg/lock lsof /var/lib/apt/lists/lock lsof /var/cache/apt/archives/lock éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥ä¸Šå‘½ä»¤æ‰§è¡Œç»“æœå¦‚æœæ— è¿”å›ï¼Œè¯´æ˜æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼›å¦‚æœè¿”å›äº†ç›¸åº”çš„è¿›ç¨‹ï¼Œéœ€è¦killæ‰ã€‚ åˆ é™¤æ‰€æœ‰çš„lock file sudo rm /var/lib/apt/lists/lock sudo rm /var/cache/apt/archives/lock sudo rm /var/lib/dpkg/lock æœ€åé‡æ–°é…ç½®ä¸€ä¸‹dpkgï¼š sudo dpkg --configure -a å¦‚æœä¸Šè¿°å‘½ä»¤ä¸å‡ºä»»ä½•é”™è¯¯ï¼Œå°±ä¸‡äº‹å¤§å‰äº†ã€‚ï¼ˆæˆ‘æ˜¯åˆ°è¿™é‡Œé—®é¢˜å°±è§£å†³äº†ï¼‰ ä½†æ˜¯æœ‰æ—¶å€™ï¼Œç”Ÿæ´»æ€»æ˜¯å«Œä½ ä¸å¤Ÿæƒ¨ï¼Œæ‰§è¡Œé…ç½®å‘½ä»¤æ—¶å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š dpkg: error: dpkg frontend is locked by another process è¿™éœ€è¦æˆ‘ä»¬é¢å¤–è¿›è¡Œä¸€äº›æ“ä½œï¼š æ‰¾å‡ºæ­£åœ¨é”å®šlock fileçš„è¿›ç¨‹ï¼š lsof /var/lib/dpkg/lock-frontend killæ‰è¾“å‡ºçš„è¿›ç¨‹ï¼ˆå¦‚æœè¾“å‡ºä¸ºç©ºåˆ™å¿½ç•¥ï¼‰ sudo kill -9 PID åˆ é™¤lock fileå¹¶é‡æ–°é…ç½®dpkg: sudo rm /var/lib/dpkg/lock-frontend sudo dpkg --configure -a ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:1:1","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["linux åŸºç¡€"],"content":"å‡çº§ç³»ç»Ÿ ubuntu 1804 å‡çº§åˆ°2004 1ï¼‰åˆ‡æ¢aptæº deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse 2ï¼‰æ›´æ–°å’Œé‡å¯ç³»ç»Ÿ apt update apt upgrade reboot 3ï¼‰æ›´æ–°ç³»ç»Ÿ do-release-upgrade Reading cache Checking package manager Continue running under SSH? This session appears to be running under ssh. It is not recommended to perform a upgrade over ssh currently because in case of failure it is harder to recover. If you continue, an additional ssh daemon will be started at port '1022'. Do you want to continue? Continue [yN] y Starting additional sshd To make recovery in case of failure easier, an additional sshd will be started on port '1022'. If anything goes wrong with the running ssh you can still connect to the additional one. If you run a firewall, you may need to temporarily open this port. As this is potentially dangerous it's not done automatically. You can open the port with e.g.: 'iptables -I INPUT -p tcp --dport 1022 -j ACCEPT' ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:1:2","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["linux åŸºç¡€"],"content":"äºŒã€å®‰è£… docker ubuntuä¸çº¢å¸½ç³»åˆ—ç³»ç»Ÿä¸åŒï¼Œåœ¨é…ç½®aptæºæ—¶éœ€è¦å…ˆé…ç½®è¦æ·»åŠ çš„å¯†é’¥çš„è¯ä¹¦ root@harbor:~# curl -fsSL https://mirrors.huaweicloud.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - root@harbor:~# sudo apt-get install software-properties-common root@harbor:~# add-apt-repository \"deb [arch=amd64] https://mirrors.huaweicloud.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\" root@harbor:~# apt-get update root@harbor:~# apt-get install docker-ce ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:2:0","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["linux åŸºç¡€"],"content":"ä¸‰ã€vim è®¾ç½® ubuntuä¸Šé»˜è®¤çš„è®¸å¤šæ–‡ä»¶çš„ç¼–è¾‘å™¨æ˜¯nanoï¼Œå…¶ä½¿ç”¨éå¸¸ä¸å‹å¥½ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºvim root@ubuntu:~# sudo select-editor Select an editor. To change later, run 'select-editor'. 1. /bin/nano \u003c---- easiest 2. /usr/bin/vim.basic 3. /usr/bin/vim.tiny 4. /bin/ed Choose 1-4 [1]: 2 # å…ˆæ‹©vim.basicï¼Œè®¾ç½®å¥½åå°±å¯ä»¥åœ¨ç¼–è¾‘ä¸€äº›æ–‡ä»¶æˆ–æœåŠ¡æ—¶ä½¿ç”¨vim ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:3:0","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["linux åŸºç¡€"],"content":"å››ã€exsi é…ç½® exsi å®‰è£…ubuntu2004 æŠ¥é”™ multipathd[651]: sda: add missing path multipathd[651]: sda: failed to get udev uid: Invalid argument multipathd[651]: sda: failed to get sysfs uid: Invalid argument multipathd[651]: sda: failed to get sgio uid: No such file or directory multipathd[651]: sda: add missing path multipathd[651]: sda: failed to get udev uid: Invalid argument multipathd[651]: sda: failed to get sysfs uid: Invalid argument multipathd[651]: sda: failed to get sgio uid: No such file or directory è§£å†³åŠæ³•ï¼š https://askubuntu.com/questions/1242731/ubuntu-20-04-multipath-configuration æ–¹æ³•ä¸€ï¼š exsiè™šæ‹Ÿæœºé…ç½®æ–‡ä»¶ä¸­å¢åŠ  disk.EnableUUID = \"TRUE\" æ–¹æ³•äºŒï¼š # vim defaults { user_friendly_names yes } blacklist { device { vendor \"VMware\" product \"Virtual disk\" } } # é‡å¯ /etc/init.d/multipath-tools restart # æˆ–è€… systemctl restart multipathd defaults { user_friendly_names yes } blacklist { devnode \"^(ram|raw|loop|fd|md|dm-|sr|scd|st|sda)[0-9]*\" } ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:4:0","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["linux åŸºç¡€"],"content":"äº”ã€networké…ç½® é™æ€IP 1ã€é…ç½®é™æ€ip root@ubuntu:/etc/netplan# pwd /etc/netplan root@ubuntu:/etc/netplan# vim 50-cloud-init.yaml network: version: 2 renderer: networkd ethernets: ens160: dpch4: no addresses: - 192.168.100.17/24 gateway4: 192.168.100.1 nameservers: addresses: - 223.5.5.5 æˆ–è€… network: ethernets: ens3: dhcp4: no addresses: [192.168.100.141/24] gateway4: 192.168.100.1 nameservers: addresses: [114.114.114.114,8.8.8.8] version: 2 2204å¼€å§‹ network: version: 2 ethernets: ens3: dhcp4: false addresses: [192.168.100.141/24] routes: - to: default via: 192.168.100.1 nameservers: addresses: [114.114.114.114,8.8.8.8] 2ã€åŠ è½½é…ç½® root@ubuntu:~# netplan apply #æµ‹è¯•ç½‘ç»œ root@ubuntu:~# ping baidu.com 3ã€è¿æ¥wifi network: version: 2 wifis: wlan0: dhcp4: true access-points: \"sugar\": # ssid name password: \"password\" ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:5:0","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["linux åŸºç¡€"],"content":"å…­ã€rc.local è®¾ç½® [root@tc ~]# cat /etc/systemd/system/rc-local.service [Unit] Description=/etc/rc.local Compatibility Documentation=man:systemd-rc-local-generator(8) ConditionFileIsExecutable=/etc/rc.local After=network.target [Service] Type=forking ExecStart=/etc/rc.local TimeoutStartSec=0 TimeoutStopSec=30 RemainAfterExit=yes GuessMainPID=no [Install] WantedBy=multi-user.target [root@tc rc.d]# cat rc.local #!/bin/bash date \u003e\u003e /tmp/data.txt exit 0 ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:6:0","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["linux åŸºç¡€"],"content":"ä¸ƒã€ssh æœåŠ¡é…ç½® ubuntué»˜è®¤ä¸å®‰è£…openssh-server 1ã€å®‰è£…openssl-server root@ubuntu:~# apt-get install openssh-sevrer root@ubuntu:~# systemctl start ssh root@ubuntu:~# systemctl enable ssh 2ã€å…è®¸rootç”¨æˆ·è¿œç¨‹ç™»é™† ubuntué»˜è®¤ä¸å…è®¸rootç”¨æˆ·è¿œç¨‹ç™»é™† root@ubuntu:~# vim /etc/ssh/sshd_config 32 #PermitRootLogin prohibit-password ä¿®æ”¹ä¸º 33 PermitRootLogin yes æ‰“å¼€å¯†é’¥è®¤è¯ 56 #PasswordAuthentication yes ä¿®æ”¹ä¸º 57 PasswordAuthentication yes ä¸ºrootç”¨æˆ·è®¾ç½®å¯†ç  root@ubuntu:~# passwd root é‡å¯sshæœåŠ¡ root@ubuntu:~# systemctl restart ssh ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:7:0","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["linux åŸºç¡€"],"content":"å…«ã€unsnapd ubuntu ç³»ç»Ÿå¸è½½snap åœæ­¢å¼€æœºè‡ªå¯ sudo systemctl disable snapd.service sudo systemctl disable snapd.socket sudo systemctl disable snapd.seeded.service å¸è½½snapå®‰è£…çš„è½¯ä»¶ # æŸ¥è¯¢å½“å‰ç³»ç»Ÿä¸Šsnapå®‰è£…äº†å“ªäº›app snap list # å¸è½½ sudo snap remove xxxxx_app ç¦æ­¢é‡æ–°å®‰è£…snap sudo vim /etc/apt/preferences.d/nosnap.pref Package: snapd Pin: release a=* Pin-Priority: -10 ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:8:0","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["linux åŸºç¡€"],"content":"ä¹ã€ç”¨æˆ·ç®¡ç† 1ã€ç”¨æˆ· Ubuntuç³»ç»Ÿä¸­å­˜åœ¨çš„æ˜¯nobodyå’Œnogroup åœ¨ä½¿ç”¨useraddå‘½ä»¤åˆ›å»ºç”¨æˆ·çš„æ—¶å€™ï¼Œubuntuä¸ä¼šä¸ºä¸»åŠ¨ä¸ºç”¨æˆ·åˆ›å»ºå®¶ç›®å½•ï¼Œå…¶é»˜è®¤çš„shellä¹Ÿä¸æ˜¯bash åˆ›å»ºä¸€ä¸ªå…·æœ‰å®¶ç›®å½•çš„ç”¨æˆ·ï¼Œå…¶shellä¸ºbash root@ubuntu:~# useradd -m test3 -s /bin/bash # è‹¥æ²¡æœ‰æŒ‡å®šshellï¼Œå¯ä»¥è¿›è¡Œä¿®æ”¹ root@ubuntu:~# chsh -s /bin/bash test1 2ã€åˆ›å»ºç”¨æˆ·ï¼Œéäº¤äº’å¼æ›´æ”¹å¯†ç  root@ubuntu:~# useradd tom root@ubuntu:~# echo tom:jerry | chpasswd æ ¼å¼ï¼šecho username:password | chpasswd 3ã€sudoæƒé™å…å¯† root@ubuntu:~# vim /etc/sudoers ops_serialt ALL=(ALL) NOPASSWD: ALL 4ã€ubuntu 2004é‡ç½®å¯†ç  å‚è€ƒé“¾æ¥ï¼šhttps://blog.51cto.com/u_15169172/2793265 1ï¼‰é‡å¯æœåŠ¡å™¨åæŒ‰eè¿›å…¥grubèœå• 2ï¼‰åœ¨linuxçš„ä¸€è¡Œçš„æœ€åä¿®æ”¹ä¸ºrw init=/bin/bash 3ï¼‰æŒ‰ctrl + xå¯åŠ¨ç³»ç»Ÿ æŒ‰ä¸‹Ctrl+cå¯ä»¥æ’¤é”€ç™»å½• 4ï¼‰æŸ¥çœ‹æ ¹ç›®å½•æ˜¯å¦æœ‰å†™çš„æƒé™ï¼šmount | grep -w / 5ï¼‰é‡ç½®å¯†ç  ç¡®è®¤æ ¹ç›®å½•æ­£å¤„äºrwçŠ¶æ€åï¼Œé‚£å°±å¯ä»¥ç›´æ¥é‡ç½®æˆ–ç ´è§£Ubuntu 20.04ä»»ä½•ç”¨æˆ·çš„å¯†ç äº†ã€‚ é‡ç½®rootå¯†ç ï¼š passwd root 6ï¼‰é‡å¯ å®Œæˆé‡ç½®å¯†ç æˆ–è€…ç ´è§£å¯†ç çš„å·¥ä½œåï¼Œé‡å¯Ubuntu 20.04ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡å¯æœåŠ¡å™¨ï¼š exec /sbin/init ","date":"2023-11-11","objectID":"/posts/2023-11-11-ubuntu/:9:0","tags":["ubuntu","linux"],"title":"ubuntu basic","uri":"/posts/2023-11-11-ubuntu/"},{"categories":["windows"],"content":"WSL2 windowsä¸Šåˆ°linux(windows sub system for linux ) ","date":"2023-11-11","objectID":"/posts/2023-11-11-wsl/:1:0","tags":["wsl","wsl-2","wsl-windows"],"title":"wsl","uri":"/posts/2023-11-11-wsl/"},{"categories":["windows"],"content":"ä¸€ã€å®‰è£… wsl 2 å¦‚æœç³»ç»Ÿä¸­å¸¦æœ‰ wslï¼Œåˆ™éœ€è¦å‡çº§åˆ° wsl 2ã€‚ ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShellï¼ˆâ€œå¼€å§‹â€èœå• \u003eâ€œPowerShellâ€\u003e å•å‡»å³é”® \u003eâ€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€ï¼‰ï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart å¯åŠ¨è™šæ‹ŸåŒ–åŠŸèƒ½ï¼Œç„¶åé‡å¯windows dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart ä¸‹è½½ linux å†…æ ¸æ›´æ–°åŒ… https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi ä¿®æ”¹ wsl 2 ä¸ºé»˜è®¤çš„ç‰ˆæœ¬ wsl --set-default-version 2 ä¸‹è½½ linux å‘è¡Œç‰ˆ Ubuntu 20.04 Ubuntu 20.04 ARM Ubuntu 18.04 Ubuntu 18.04 ARM Ubuntu 16.04 Debian GNU/Linux Kali Linux SUSE Linux Enterprise Server 12 SUSE Linux Enterprise Server 15 SP2 openSUSE Leap 15.2 Fedora Remix for WSL å°†è·å¾— \u003cdistro\u003e.appx åŒ… å¯¼å…¥ç³»ç»Ÿ app-name æ˜¯ Linux å‘è¡Œç‰ˆ .appx æ–‡ä»¶çš„åç§°ã€‚ Add-AppxPackage .\\app_name.appx ","date":"2023-11-11","objectID":"/posts/2023-11-11-wsl/:1:1","tags":["wsl","wsl-2","wsl-windows"],"title":"wsl","uri":"/posts/2023-11-11-wsl/"},{"categories":["windows"],"content":"äºŒã€wsl åŸºæœ¬å‘½ä»¤ wsl å¸¸ç”¨å‘½ä»¤ # å®‰è£…ç‰¹å®šçš„linuxå‘è¡Œç‰ˆ wsl -d \u003cDistribution Name\u003e # åˆ—å‡ºå¯ç”¨çš„ Linux å‘è¡Œç‰ˆ wsl -l -o # åˆ—å‡ºå·²å®‰è£…çš„ Linux å‘è¡Œç‰ˆ wsl --list --verbose # å°† WSL ç‰ˆæœ¬è®¾ç½®ä¸º 1 æˆ– 2 wsl --set-version 2 # è®¾ç½®é»˜è®¤ WSL ç‰ˆæœ¬ wsl --set-default-version \u003cVersion\u003e wsl --set-default-version 2 # è®¾ç½®é»˜è®¤ Linux å‘è¡Œç‰ˆ wsl --set-default \u003cDistribution Name\u003e # å°†ç›®å½•æ›´æ”¹ä¸ºä¸»é¡µ wsl ~ # é€šè¿‡ PowerShell æˆ– CMD è¿è¡Œç‰¹å®šçš„ Linux å‘è¡Œç‰ˆ wsl --distribution \u003cDistribution Name\u003e --user \u003cUser Name\u003e # å¯åŠ¨ä¸€ä¸ªå‘è¡Œç‰ˆ wsl -d Ubuntu-20.04 -u root æ›´æ–° WSL wsl --update å›æ»šwslç‰ˆæœ¬ wsl --update rollback æ£€æŸ¥ WSL çŠ¶æ€ wsl --status ä»¥ç‰¹å®šç”¨æˆ·çš„èº«ä»½è¿è¡Œ wsl -u \u003cUsername\u003e æ›´æ”¹å‘è¡Œç‰ˆçš„é»˜è®¤ç”¨æˆ· \u003cDistributionName\u003e config --default-user \u003cUsername\u003e # ubuntu config --default-user johndoe ä¼šå°† Ubuntu å‘è¡Œç‰ˆçš„é»˜è®¤ç”¨æˆ·æ›´æ”¹ä¸ºâ€œjohndoeâ€ç”¨æˆ·ã€‚ å…³é—­ wsl --shutdown å†…å­˜é™åˆ¶ .wslconfig æ–‡ä»¶ å…³é—­ä¸€ä¸ªå‘è¡Œç‰ˆ wsl --terminate \u003cDistribution Name\u003e å°†å‘è¡Œç‰ˆå¯¼å‡ºåˆ° TAR æ–‡ä»¶ wsl --export \u003cDistribution Name\u003e \u003cFileName\u003e å¯¼å…¥æ–°å‘è¡Œç‰ˆ wsl --import \u003cDistribution Name\u003e \u003cInstallLocation\u003e \u003cFileName\u003e æ³¨é”€æˆ–å¸è½½ Linux å‘è¡Œç‰ˆï¼Œæ³¨é”€åå°±è¢«åˆ é™¤ï¼Œæ³¨æ„ï¼ï¼ï¼ wsl --unregister \u003cDistributionName\u003e è£…è½½ç£ç›˜æˆ–è®¾å¤‡ wsl --mount \u003cDiskPath\u003e å®‰è£…ç‰¹å®šçš„linuxå‘è¡Œç‰ˆ wsl -d \u003cDistribution Name\u003e wsl é…ç½®æ–‡ä»¶ https://docs.microsoft.com/zh-cn/windows/wsl/wsl-config ","date":"2023-11-11","objectID":"/posts/2023-11-11-wsl/:1:2","tags":["wsl","wsl-2","wsl-windows"],"title":"wsl","uri":"/posts/2023-11-11-wsl/"},{"categories":["windows"],"content":"ä¸‰ã€å‘è¡Œç‰ˆç»´æŠ¤ 1ã€è¿ç§»å·¥ä½œç›®å½• wsl é»˜è®¤å®‰è£…cç›˜é‡Œï¼Œcç›˜å› ä¸ºç¡¬ç›˜åˆ†åŒºçš„é—®é¢˜ï¼Œå¯èƒ½åˆ†é…ç©ºé—´æ¯”è¾ƒå°ï¼Œå› æ­¤å¯èƒ½å­˜åœ¨éœ€è¦è¿ç§»çš„æ“ä½œã€‚ 1ï¼‰å…³é—­è¿è¡Œçš„ç³»ç»Ÿ PS C:\\Users\\serialt\u003e PS C:\\Users\\serialt\u003e wsl -l -v NAME STATE VERSION * Ubuntu-20.04 Running 2 docker-desktop Stopped 2 docker-desktop-data Stopped 2 PS C:\\Users\\serialt\u003e wsl --shutdown PS C:\\Users\\serialt\u003e wsl -l -v NAME STATE VERSION * Ubuntu-20.04 Stopped 2 docker-desktop Stopped 2 docker-desktop-data Stopped 2 PS C:\\Users\\serialt\u003e 2ï¼‰å¯¼å‡ºä¸å¯¼å…¥å‘è¡Œç‰ˆ wsl --export docker-desktop-data \"E:\\wsl\\docker-data\\docker-desktop-data.tar\" wsl --unregister docker-desktop-data wsl --import docker-desktop-data D:\\docker\\desktop \"E:\\wsl\\docker-data\\docker-desktop-data.tar\" --version 2 wsl --export docker-desktop \"E:\\wsl\\docker-data\\docker-desktop.tar\" wsl --unregister docker-desktop wsl --import docker-desktop D:\\docker\\desktop \"E:\\wsl\\docker-data\\docker-desktop.tar\" --version 2 ","date":"2023-11-11","objectID":"/posts/2023-11-11-wsl/:1:3","tags":["wsl","wsl-2","wsl-windows"],"title":"wsl","uri":"/posts/2023-11-11-wsl/"},{"categories":["windows"],"content":"å››ã€è‡ªå®šä¹‰å‘è¡Œç‰ˆ å‚è€ƒé“¾æ¥ï¼šhttps://docs.microsoft.com/zh-cn/windows/wsl/use-custom-distro é€šè¿‡ä½¿ç”¨ tar æ–‡ä»¶å¯¼å…¥ä»»ä½• Linux å‘è¡Œç‰ˆï¼Œå¯åœ¨é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ (WSL) ä¸­ä½¿ç”¨è¯¥å‘è¡Œç‰ˆï¼ˆå³ä½¿å®ƒä¸åœ¨ Microsoft Store ä¸­æä¾›ï¼‰ã€‚ æœ¬æ–‡æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡ä½¿ç”¨ Docker å®¹å™¨è·å– Linux å‘è¡Œç‰ˆ CentOS çš„ tar æ–‡ä»¶æ¥å°†å®ƒå¯¼å…¥ï¼Œä»¥ä¾¿ä¸ WSL ä¸€èµ·ä½¿ç”¨ã€‚ æ­¤è¿‡ç¨‹å¯åº”ç”¨äºå¯¼å…¥ä»»ä½• Linux å‘è¡Œç‰ˆã€‚ 1ã€è·å–å‘è¡Œç‰ˆçš„taræ–‡ä»¶ é¦–å…ˆï¼Œéœ€è¦è·å–ä¸€ä¸ª tar æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«å‘è¡Œç‰ˆçš„æ‰€æœ‰ Linux äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å¯é€šè¿‡å¤šç§æ–¹å¼è·å– tar æ–‡ä»¶ï¼Œå…¶ä¸­ä¸¤ç§æ–¹å¼åŒ…æ‹¬ï¼š ä¸‹è½½æä¾›çš„ tar æ–‡ä»¶ã€‚ å¯åœ¨ Alpine Linux ä¸‹è½½ç«™ç‚¹çš„â€œå¾®å‹æ ¹æ–‡ä»¶ç³»ç»Ÿâ€éƒ¨åˆ†æ‰¾åˆ° Alpine çš„ç¤ºä¾‹ã€‚ æŸ¥æ‰¾ Linux å‘è¡Œç‰ˆå®¹å™¨ï¼Œå°†å®ä¾‹å¯¼å‡ºä¸º tar æ–‡ä»¶ã€‚ ä»¥ä¸‹ç¤ºä¾‹å°†ä½¿ç”¨ CentOS å®¹å™¨æ¼”ç¤ºæ­¤è¿‡ç¨‹ã€‚ è·å–CentOSçš„taræ–‡ä»¶ ä»å®¹å™¨ä¸­å¯¼å‡ºtaræ–‡ä»¶ [root@tc tabby]# docker pull rockylinux Using default tag: latest latest: Pulling from library/rockylinux 72a2451028f1: Pull complete Digest: sha256:5fed5497b568bcf7a90a00965987fc099edbcf44b1179a5ef6d4b47758281ca5 Status: Downloaded newer image for rockylinux:latest docker.io/library/rockylinux:latest [root@tc tabby]# docker run -tid --name=rocky rockylinux 38b201fca776cc1aadf029cbf5a1d6a1fb57ff62f5d71d4ed0416d870b407550 [root@tc tabby]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 38b201fca776 rockylinux \"/bin/bash\" 4 seconds ago Up 2 seconds rocky [root@tc tabby]# [root@tc tabby]# dockerContainerID=$(docker container ls -a | grep -i rocky | awk '{print $1}') [root@tc tabby]# docker export $dockerContainerID \u003e /mnt/e/rocky.tar [root@tc tabby]# du -sh /mnt/e/rocky.tar 202M /mnt/e/rocky.tar 2ã€å¯¼å…¥åˆ°wslä¸­ å‡†å¤‡å¥½ tar æ–‡ä»¶åï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯¼å…¥å®ƒï¼šwsl --import \u003cDistro\u003e \u003cInstallLocation\u003e \u003cFileName\u003eã€‚ # åˆ›å»ºå¥½å­˜å‚¨å‘è¡Œç‰ˆçš„ç›®å½• cd E:\\wsl2 mkdir E:\\wsl2\\Rocky # å¯¼å…¥taræ–‡ä»¶ PS E:\\wsl2\u003e wsl --import Rocky E:\\wsl2\\Rocky ..\\rocky.tar PS E:\\wsl2\u003e wsl -l -v NAME STATE VERSION * docker-desktop-data Stopped 2 Rocky Stopped 2 docker-desktop Stopped 2 Ubuntu-20.04 Running 2 PS E:\\wsl2\u003e 3ã€å¯åŠ¨ wsl -d Rocky -u root è‡ªå®šä¹‰çš„å‘è¡Œç‰ˆå¯èƒ½å­˜åœ¨å› ä½¿ç”¨systemç®¡ç†æœåŠ¡è€Œæ— æ³•ä½¿ç”¨serviceå»ç®¡ç†æœåŠ¡ ","date":"2023-11-11","objectID":"/posts/2023-11-11-wsl/:1:4","tags":["wsl","wsl-2","wsl-windows"],"title":"wsl","uri":"/posts/2023-11-11-wsl/"},{"categories":["windows"],"content":"äº”ã€wsl é…ç½®æ–‡ä»¶ 1ã€wsl.conf â€‹```toml [root@tc tcs]# cat /etc/wsl.conf # Automatically mount Windows drive when the distribution is launched [automount] # Set to true will automount fixed drives (C:/ or D:/) with DrvFs under the root directory set above. Set to false means drives won't be mounted automatically, but need to be mounted manually or with fstab. enabled = true # Sets the directory where fixed drives will be automatically mounted. This example changes the mount location, so your C-drive would be /c, rather than the default /mnt/c. #root = /mnt/d/serialt/ # DrvFs-specific options can be specified. options = \"metadata,uid=1003,gid=1003,umask=077,fmask=11,case=off\" # Sets the `/etc/fstab` file to be processed when a WSL distribution is launched. mountFsTab = true # Network host settings that enable the DNS server used by WSL 2. This example changes the hostname, sets generateHosts to false, preventing WSL from the default behavior of auto-generating /etc/hosts, and sets generateResolvConf to false, preventing WSL from auto-generating /etc/resolv.conf, so that you can create your own (ie. nameserver 1.1.1.1). [network] hostname = tc generateHosts = true generateResolvConf = true # Set whether WSL supports interop process like launching Windows apps and adding path variables. Setting these to false will block the launch of Windows processes and block adding $PATH environment variables. [interop] enabled = false appendWindowsPath = true # Set the user when launching a distribution with WSL. [user] default = root # Set a command to run when a new WSL instance launches. This example starts the Docker container service. [boot] command = service docker start [root@tc tcs]# â€‹``` ","date":"2023-11-11","objectID":"/posts/2023-11-11-wsl/:1:5","tags":["wsl","wsl-2","wsl-windows"],"title":"wsl","uri":"/posts/2023-11-11-wsl/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"gopsutil åº“ å‚è€ƒé“¾æ¥ï¼šhttps://segmentfault.com/a/1190000022281174 ","date":"2023-11-11","objectID":"/posts/2023-11-11-gopsutil/:1:0","tags":["Go","gopsutil"],"title":"Go gopsutil","uri":"/posts/2023-11-11-gopsutil/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç®€ä»‹ gopsutilæ˜¯ Python å·¥å…·åº“psutil çš„ Golang ç§»æ¤ç‰ˆï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ–¹ä¾¿åœ°è·å–å„ç§ç³»ç»Ÿå’Œç¡¬ä»¶ä¿¡æ¯ã€‚gopsutilä¸ºæˆ‘ä»¬å±è”½äº†å„ä¸ªç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ï¼Œå…·æœ‰éå¸¸å¼ºæ‚çš„å¯ç§»æ¤æ€§ã€‚æœ‰äº†gopsutilï¼Œæˆ‘ä»¬ä¸å†éœ€è¦é’ˆå¯¹ä¸åŒçš„ç³»ç»Ÿä½¿ç”¨syscallè°ƒç”¨å¯¹åº”çš„ç³»ç»Ÿæ–¹æ³•ã€‚æ›´æ£’çš„æ˜¯gopsutilçš„å®ç°ä¸­æ²¡æœ‰ä»»ä½•cgoçš„ä»£ç ï¼Œä½¿å¾—äº¤å‰ç¼–è¯‘æˆä¸ºå¯èƒ½ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-gopsutil/:1:1","tags":["Go","gopsutil"],"title":"Go gopsutil","uri":"/posts/2023-11-11-gopsutil/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å¿«é€Ÿä½¿ç”¨ å®‰è£… go get github.com/shirou/gopsutil ä½¿ç”¨ package main import ( \"fmt\" \"github.com/shirou/gopsutil/mem\" ) func main() { v, _ := mem.VirtualMemory() fmt.Printf(\"Total: %v, Available: %v, UsedPercent:%f%%\\n\", v.Total, v.Available, v.UsedPercent) fmt.Println(v) } gopsutilå°†ä¸åŒçš„åŠŸèƒ½åˆ’åˆ†åˆ°ä¸åŒçš„å­åŒ…ä¸­ï¼š cpuï¼šCPU ç›¸å…³ï¼› diskï¼šç£ç›˜ç›¸å…³ï¼› dockerï¼šdocker ç›¸å…³ï¼› hostï¼šä¸»æœºç›¸å…³ï¼› memï¼šå†…å­˜ç›¸å…³ï¼› netï¼šç½‘ç»œç›¸å…³ï¼› processï¼šè¿›ç¨‹ç›¸å…³ï¼› winservicesï¼šWindows æœåŠ¡ç›¸å…³ã€‚ æƒ³è¦ä½¿ç”¨å¯¹åº”çš„åŠŸèƒ½ï¼Œè¦å¯¼å…¥å¯¹åº”çš„å­åŒ…ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¦è·å–å†…å­˜ä¿¡æ¯ï¼Œå¯¼å…¥çš„æ˜¯memå­åŒ…ã€‚mem.VirtualMemory()æ–¹æ³•è¿”å›å†…å­˜ä¿¡æ¯ç»“æ„mem.VirtualMemoryStatï¼Œè¯¥ç»“æ„æœ‰ä¸°å¯Œçš„å­—æ®µï¼Œæˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„æ— å¤–ä¹Totalï¼ˆæ€»å†…å­˜ï¼‰ã€Availableï¼ˆå¯ç”¨å†…å­˜ï¼‰ã€Usedï¼ˆå·²ä½¿ç”¨å†…å­˜ï¼‰å’ŒUsedPercentï¼ˆå†…å­˜ä½¿ç”¨ç™¾åˆ†æ¯”ï¼‰ã€‚mem.VirtualMemoryStatè¿˜å®ç°äº†fmt.Stringeræ¥å£ï¼Œä»¥ JSON æ ¼å¼è¿”å›å†…å­˜ä¿¡æ¯ã€‚è¯­å¥fmt.Println(v)ä¼šè‡ªåŠ¨è°ƒç”¨v.String()ï¼Œå°†è¿”å›ä¿¡æ¯è¾“å‡ºã€‚ç¨‹åºè¾“å‡ºï¼š Total: 8526921728, Available: 3768975360, UsedPercent:55.000000% {\"total\":8526921728,\"available\":3768975360,\"used\":4757946368,\"usedPercent\":55,\"free\":0,\"active\":0,\"inactive\":0,\"wired\":0,\"laundry\":0,\"buffers\":0,\"cached\":0,\"writeback\":0,\"dirty\":0,\"writebacktmp\":0,\"shared\":0,\"slab\":0,\"sreclaimable\":0,\"sunreclaim\":0,\"pagetables\":0,\"swapcached\":0,\"commitlimit\":0,\"committedas\":0,\"hightotal\":0,\"highfree\":0,\"lowtotal\":0,\"lowfree\":0,\"swaptotal\":0,\"swapfree\":0,\"mapped\":0,\"vmalloctotal\":0,\"vmallocused\":0,\"vmallocchunk\":0,\"hugepagestotal\":0,\"hugepagesfree\":0,\"hugepagesize\":0} å•ä½ä¸ºå­—èŠ‚ï¼Œæˆ‘çš„ç”µè„‘å†…å­˜ 8GBï¼Œå½“å‰ä½¿ç”¨ç™¾åˆ†æ¯”ä¸º 55%ï¼Œå¯ç”¨å†…å­˜ 3768975360Bï¼ˆå³ 3.51GBï¼‰ã€‚ CPU æˆ‘ä»¬çŸ¥é“ CPU çš„æ ¸æ•°æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç‰©ç†æ ¸æ•°ï¼Œä¸€ç§æ˜¯é€»è¾‘æ ¸æ•°ã€‚ç‰©ç†æ ¸æ•°å°±æ˜¯ä¸»æ¿ä¸Šå®é™…æœ‰å¤šå°‘ä¸ª CPUï¼Œä¸€ä¸ªç‰©ç† CPU ä¸Šå¯ä»¥æœ‰å¤šä¸ªæ ¸å¿ƒï¼Œè¿™äº›æ ¸å¿ƒè¢«ç§°ä¸ºé€»è¾‘æ ¸ã€‚gopsutilä¸­ CPU ç›¸å…³åŠŸèƒ½åœ¨cpuå­åŒ…ä¸­ï¼Œcpuå­åŒ…æä¾›äº†è·å–ç‰©ç†å’Œé€»è¾‘æ ¸æ•°ã€CPU ä½¿ç”¨ç‡çš„æ¥å£ï¼š Counts(logical bool)ï¼šä¼ å…¥falseï¼Œè¿”å›ç‰©ç†æ ¸æ•°ï¼Œä¼ å…¥trueï¼Œè¿”å›é€»è¾‘æ ¸æ•°ï¼› Percent(interval time.Duration, percpu bool)ï¼šè¡¨ç¤ºè·å–intervalæ—¶é—´é—´éš”å†…çš„ CPU ä½¿ç”¨ç‡ï¼Œpercpuä¸ºfalseæ—¶ï¼Œè·å–æ€»çš„ CPU ä½¿ç”¨ç‡ï¼Œpercpuä¸ºtrueæ—¶ï¼Œåˆ†åˆ«è·å–æ¯ä¸ª CPU çš„ä½¿ç”¨ç‡ï¼Œè¿”å›ä¸€ä¸ª[]float64ç±»å‹çš„å€¼ã€‚ ä¾‹å¦‚ï¼š func main() { physicalCnt, _ := cpu.Counts(false) logicalCnt, _ := cpu.Counts(true) fmt.Printf(\"physical count:%d logical count:%d\\n\", physicalCnt, logicalCnt) totalPercent, _ := cpu.Percent(3*time.Second, false) perPercents, _ := cpu.Percent(3*time.Second, true) fmt.Printf(\"total percent:%v per percents:%v\", totalPercent, perPercents) } ä¸Šé¢ä»£ç è·å–ç‰©ç†æ ¸æ•°å’Œé€»è¾‘æ ¸æ•°ï¼Œå¹¶è·å– 3s å†…çš„æ€» CPU ä½¿ç”¨ç‡å’Œæ¯ä¸ª CPU å„è‡ªçš„ä½¿ç”¨ç‡ï¼Œç¨‹åºè¾“å‡ºï¼ˆæ³¨æ„æ¯æ¬¡è¿è¡Œè¾“å‡ºå¯èƒ½éƒ½ä¸ç›¸åŒï¼‰ï¼š physical count:4 logical count:8 total percent:[30.729166666666668] per percents:[32.64248704663213 26.94300518134715 44.559585492227974 23.958333333333336 36.787564766839374 20.3125 38.54166666666667 28.125] è¯¦ç»†ä¿¡æ¯è°ƒç”¨cpu.Info()å¯è·å– CPU çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿”å›[]cpu.InfoStatï¼š func main() { infos, _ := cpu.Info() for _, info := range infos { data, _ := json.MarshalIndent(info, \"\", \" \") fmt.Print(string(data)) } } ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ‘ä½¿ç”¨ JSON è¾“å‡ºç»“æœï¼š { \"cpu\": 0, \"vendorId\": \"GenuineIntel\", \"family\": \"198\", \"model\": \"\", \"stepping\": 0, \"physicalId\": \"BFEBFBFF000906E9\", \"coreId\": \"\", \"cores\": 8, \"modelName\": \"Intel(R) Core(TM) i7-7700 CPU @ 3.60GHz\", \"mhz\": 3601, \"cacheSize\": 0, \"flags\": [], \"microcode\": \"\" } ç”±ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒCPU æ˜¯ Intel çš„ i7-7700 ç³»åˆ—ï¼Œé¢‘ç‡ 3.60GHzã€‚ä¸Šé¢æ˜¯æˆ‘åœ¨ Windows ä¸Šè¿è¡Œçš„è¿”å›ç»“æœï¼Œå†…éƒ¨ä½¿ç”¨äº†github.com/StackExchange/wmiåº“ã€‚åœ¨ Linux ä¸‹æ¯ä¸ªé€»è¾‘ CPU éƒ½ä¼šè¿”å›ä¸€ä¸ªInfoStatç»“æ„ã€‚ æ—¶é—´å ç”¨ è°ƒç”¨cpu.Times(percpu bool)å¯ä»¥è·å–ä»å¼€æœºç®—èµ·ï¼Œæ€» CPU å’Œ æ¯ä¸ªå•ç‹¬çš„ CPU æ—¶é—´å ç”¨æƒ…å†µã€‚ä¼ å…¥percpu=falseè¿”å›æ€»çš„ï¼Œä¼ å…¥percpu=trueè¿”å›å•ä¸ªçš„ã€‚æ¯ä¸ª CPU æ—¶é—´å ç”¨æƒ…å†µæ˜¯ä¸€ä¸ªTimeStatç»“æ„ï¼š // src/github.com/shirou/gopsutil/cpu/cpu.go type TimesStat struct { CPU string `json:\"cpu\"` User float64 `json:\"user\"` System float64 `json:\"system\"` Idle float64 `json:\"idle\"` Nice float64 `json:\"nice\"` Iowait float64 `json:\"iowait\"` Irq float64 `json:\"irq\"` Softirq float64 `json:\"softirq\"` Steal float64 `json:\"steal\"` Guest float64 `json:\"guest\"` GuestNice float64 `json:\"guestNice\"` } CPUï¼šCPU æ ‡è¯†ï¼Œå¦‚æœæ˜¯æ€»çš„ï¼Œè¯¥å­—æ®µä¸ºcpu-totalï¼Œå¦åˆ™ä¸ºcpu0ã€cpu1â€¦ï¼› Userï¼šç”¨æˆ·æ—¶é—´å ç”¨ï¼ˆç”¨æˆ·æ€ï¼‰ï¼› Systemï¼šç³»ç»Ÿæ—¶é—´å ç”¨ï¼ˆå†…æ ¸æ€ï¼‰ï¼› Idleï¼šç©ºé—²æ—¶é—´ï¼› â€¦ ä¾‹å¦‚ï¼š func main() { infos, _ := cpu.Times(true) for _, info := range infos { data, _ := json.MarshalIndent(info, \"\", \" \") fmt.Print(string(data)) } } ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ‘ç”¨ JSON è¾“å‡ºç»“æœï¼Œä¸‹é¢æ˜¯å…¶ä¸­ä¸€ä¸ªè¾“å‡ºï¼š { \"cpu\": \"cpu0\", \"user\": 674.46875, \"system\": 1184.984375, \"idle\": 7497.1875, \"nice\": 0, \"iowait\": 0, \"irq\": 75.578125, \"softirq\": 0, \"steal\": 0, \"guest\": 0, \"guestNice\": 0 } ç£ç›˜ å­åŒ…diskç”¨äºè·å–ç£ç›˜ä¿¡æ¯ã€‚diskå¯è·å– IO ç»Ÿè®¡ã€åˆ†åŒºå’Œä½¿ç”¨ç‡ä¿¡æ¯ã€‚ä¸‹é¢ä¾æ¬¡ä»‹ç»ã€‚ IO ç»Ÿè®¡ è°ƒç”¨disk.IOCounters()å‡½æ•°ï¼Œè¿”å›çš„ IO ç»Ÿè®¡ä¿¡æ¯ç”¨map[string]IOCountersStatç±»å‹è¡¨ç¤ºã€‚æ¯ä¸ªåˆ†åŒºä¸€ä¸ªç»“æ„ï¼Œé”®ä¸ºåˆ†åŒºåï¼Œå€¼ä¸ºç»Ÿè®¡ä¿¡æ¯ã€‚è¿™é‡Œæ‘˜å–ç»Ÿè®¡","date":"2023-11-11","objectID":"/posts/2023-11-11-gopsutil/:1:2","tags":["Go","gopsutil"],"title":"Go gopsutil","uri":"/posts/2023-11-11-gopsutil/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go è¯»å–yamlæ ¼å¼é…ç½®æ–‡ä»¶ package config import ( \"fmt\" \"io/ioutil\" \"gopkg.in/yaml.v3\" ) type Service struct { Host string `json:\"host\" yaml:\"host\"` Port string `json:\"port\" yaml:\"port\"` } type MyConfig struct { Service Service `json:\"service\" yaml:\"service\"` } var Config *MyConfig func LoadConfig(filepath string) { if filepath == \"\" { return } // è¯»yamlæ–‡ä»¶ config, err := ioutil.ReadFile(filepath) if err != nil { fmt.Printf(\"read config failed, please check the path: %v , err: %v\", filepath, err) } err = yaml.Unmarshal(config, \u0026Config) if err != nil { fmt.Printf(\"Unmarshal to struct, err: %v\", err) } fmt.Printf(\"LoadConfig: %v\", Config) } // å†™yamlæ–‡ä»¶ data, err := yaml.Marshal(SkopeoData) if err != nil { slog.Error(\"yaml marshal failed\", \"err\", err) return } err = os.WriteFile(config.AutoSyncfile, data, 0644) if err != nil { slog.Error(\"Write auto sync data to file failed\", \"err\", err) } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-yaml/:1:0","tags":["Go","yaml"],"title":"Go yaml","uri":"/posts/2023-11-11-go-yaml/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Goè¯­è¨€å†…ç½®åŒ…ä¹‹strconv Goè¯­è¨€ä¸­strconvåŒ…å®ç°äº†åŸºæœ¬æ•°æ®ç±»å‹å’Œå…¶å­—ç¬¦ä¸²è¡¨ç¤ºçš„ç›¸äº’è½¬æ¢ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-strconv/:0:0","tags":["Go","strconv"],"title":"Go strconv","uri":"/posts/2023-11-11-go-strconv/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"strconvåŒ… strconvåŒ…å®ç°äº†åŸºæœ¬æ•°æ®ç±»å‹ä¸å…¶å­—ç¬¦ä¸²è¡¨ç¤ºçš„è½¬æ¢ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å¸¸ç”¨å‡½æ•°ï¼š Atoi()ã€Itia()ã€parseç³»åˆ—ã€formatç³»åˆ—ã€appendç³»åˆ—ã€‚ æ›´å¤šå‡½æ•°è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-strconv/:0:1","tags":["Go","strconv"],"title":"Go strconv","uri":"/posts/2023-11-11-go-strconv/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"stringä¸intç±»å‹è½¬æ¢ è¿™ä¸€ç»„å‡½æ•°æ˜¯æˆ‘ä»¬å¹³æ—¶ç¼–ç¨‹ä¸­ç”¨çš„æœ€å¤šçš„ã€‚ Atoi() Atoi()å‡½æ•°ç”¨äºå°†å­—ç¬¦ä¸²ç±»å‹çš„æ•´æ•°è½¬æ¢ä¸ºintç±»å‹ï¼Œå‡½æ•°ç­¾åå¦‚ä¸‹ã€‚ func Atoi(s string) (i int, err error) å¦‚æœä¼ å…¥çš„å­—ç¬¦ä¸²å‚æ•°æ— æ³•è½¬æ¢ä¸ºintç±»å‹ï¼Œå°±ä¼šè¿”å›é”™è¯¯ã€‚ s1 := \"100\" i1, err := strconv.Atoi(s1) if err != nil { fmt.Println(\"can't convert to int\") } else { fmt.Printf(\"type:%T value:%#v\\n\", i1, i1) //type:int value:100 } Itoa() Itoa()å‡½æ•°ç”¨äºå°†intç±»å‹æ•°æ®è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå…·ä½“çš„å‡½æ•°ç­¾åå¦‚ä¸‹ã€‚ func Itoa(i int) string ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š i2 := 200 s2 := strconv.Itoa(i2) fmt.Printf(\"type:%T value:%#v\\n\", s2, s2) //type:string value:\"200\" açš„å…¸æ•… ã€æ‰©å±•é˜…è¯»ã€‘è¿™æ˜¯Cè¯­è¨€é—ç•™ä¸‹çš„å…¸æ•…ã€‚Cè¯­è¨€ä¸­æ²¡æœ‰stringç±»å‹è€Œæ˜¯ç”¨å­—ç¬¦æ•°ç»„(array)è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥Itoaå¯¹å¾ˆå¤šCç³»çš„ç¨‹åºå‘˜å¾ˆå¥½ç†è§£ã€‚ Parseç³»åˆ—å‡½æ•° Parseç±»å‡½æ•°ç”¨äºè½¬æ¢å­—ç¬¦ä¸²ä¸ºç»™å®šç±»å‹çš„å€¼ï¼šParseBool()ã€ParseFloat()ã€ParseInt()ã€ParseUint()ã€‚ ParseBool() func ParseBool(str string) (value bool, err error) è¿”å›å­—ç¬¦ä¸²è¡¨ç¤ºçš„boolå€¼ã€‚å®ƒæ¥å—1ã€0ã€tã€fã€Tã€Fã€trueã€falseã€Trueã€Falseã€TRUEã€FALSEï¼›å¦åˆ™è¿”å›é”™è¯¯ã€‚ ParseInt() func ParseInt(s string, base int, bitSize int) (i int64, err error) è¿”å›å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ•´æ•°å€¼ï¼Œæ¥å—æ­£è´Ÿå·ã€‚ baseæŒ‡å®šè¿›åˆ¶ï¼ˆ2åˆ°36ï¼‰ï¼Œå¦‚æœbaseä¸º0ï¼Œåˆ™ä¼šä»å­—ç¬¦ä¸²å‰ç½®åˆ¤æ–­ï¼Œâ€0xâ€æ˜¯16è¿›åˆ¶ï¼Œâ€0â€æ˜¯8è¿›åˆ¶ï¼Œå¦åˆ™æ˜¯10è¿›åˆ¶ï¼› bitSizeæŒ‡å®šç»“æœå¿…é¡»èƒ½æ— æº¢å‡ºèµ‹å€¼çš„æ•´æ•°ç±»å‹ï¼Œ0ã€8ã€16ã€32ã€64 åˆ†åˆ«ä»£è¡¨ intã€int8ã€int16ã€int32ã€int64ï¼› è¿”å›çš„erræ˜¯*NumErrç±»å‹çš„ï¼Œå¦‚æœè¯­æ³•æœ‰è¯¯ï¼Œerr.Error = ErrSyntaxï¼›å¦‚æœç»“æœè¶…å‡ºç±»å‹èŒƒå›´err.Error = ErrRangeã€‚ ParseUnit() func ParseUint(s string, base int, bitSize int) (n uint64, err error) ParseUintç±»ä¼¼ParseIntä½†ä¸æ¥å—æ­£è´Ÿå·ï¼Œç”¨äºæ— ç¬¦å·æ•´å‹ã€‚ ParseFloat() func ParseFloat(s string, bitSize int) (f float64, err error) è§£æä¸€ä¸ªè¡¨ç¤ºæµ®ç‚¹æ•°çš„å­—ç¬¦ä¸²å¹¶è¿”å›å…¶å€¼ã€‚ å¦‚æœsåˆä¹è¯­æ³•è§„åˆ™ï¼Œå‡½æ•°ä¼šè¿”å›æœ€ä¸ºæ¥è¿‘sè¡¨ç¤ºå€¼çš„ä¸€ä¸ªæµ®ç‚¹æ•°ï¼ˆä½¿ç”¨IEEE754è§„èŒƒèˆå…¥ï¼‰ã€‚ bitSizeæŒ‡å®šäº†æœŸæœ›çš„æ¥æ”¶ç±»å‹ï¼Œ32æ˜¯float32ï¼ˆè¿”å›å€¼å¯ä»¥ä¸æ”¹å˜ç²¾ç¡®å€¼çš„èµ‹å€¼ç»™float32ï¼‰ï¼Œ64æ˜¯float64ï¼› è¿”å›å€¼erræ˜¯*NumErrç±»å‹çš„ï¼Œè¯­æ³•æœ‰è¯¯çš„ï¼Œerr.Error=ErrSyntaxï¼›ç»“æœè¶…å‡ºè¡¨ç¤ºèŒƒå›´çš„ï¼Œè¿”å›å€¼fä¸ºÂ±Infï¼Œerr.Error= ErrRangeã€‚ ä»£ç ç¤ºä¾‹ b, err := strconv.ParseBool(\"true\") f, err := strconv.ParseFloat(\"3.1415\", 64) i, err := strconv.ParseInt(\"-2\", 10, 64) u, err := strconv.ParseUint(\"2\", 10, 64) è¿™äº›å‡½æ•°éƒ½æœ‰ä¸¤ä¸ªè¿”å›å€¼ï¼Œç¬¬ä¸€ä¸ªè¿”å›å€¼æ˜¯è½¬æ¢åçš„å€¼ï¼Œç¬¬äºŒä¸ªè¿”å›å€¼ä¸ºè½¬åŒ–å¤±è´¥çš„é”™è¯¯ä¿¡æ¯ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-strconv/:0:2","tags":["Go","strconv"],"title":"Go strconv","uri":"/posts/2023-11-11-go-strconv/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Formatç³»åˆ—å‡½æ•° Formatç³»åˆ—å‡½æ•°å®ç°äº†å°†ç»™å®šç±»å‹æ•°æ®æ ¼å¼åŒ–ä¸ºstringç±»å‹æ•°æ®çš„åŠŸèƒ½ã€‚ FormatBool() func FormatBool(b bool) string æ ¹æ®bçš„å€¼è¿”å›â€trueâ€æˆ–â€falseâ€ã€‚ FormatInt() func FormatInt(i int64, base int) string è¿”å›içš„baseè¿›åˆ¶çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚base å¿…é¡»åœ¨2åˆ°36ä¹‹é—´ï¼Œç»“æœä¸­ä¼šä½¿ç”¨å°å†™å­—æ¯â€™aâ€™åˆ°â€™zâ€™è¡¨ç¤ºå¤§äº10çš„æ•°å­—ã€‚ FormatUint() func FormatUint(i uint64, base int) string æ˜¯FormatIntçš„æ— ç¬¦å·æ•´æ•°ç‰ˆæœ¬ã€‚ FormatFloat() func FormatFloat(f float64, fmt byte, prec, bitSize int) string å‡½æ•°å°†æµ®ç‚¹æ•°è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²å¹¶è¿”å›ã€‚ bitSizeè¡¨ç¤ºfçš„æ¥æºç±»å‹ï¼ˆ32ï¼šfloat32ã€64ï¼šfloat64ï¼‰ï¼Œä¼šæ®æ­¤è¿›è¡Œèˆå…¥ã€‚ fmtè¡¨ç¤ºæ ¼å¼ï¼šâ€™fâ€™ï¼ˆ-ddd.ddddï¼‰ã€â€™bâ€™ï¼ˆ-ddddpÂ±dddï¼ŒæŒ‡æ•°ä¸ºäºŒè¿›åˆ¶ï¼‰ã€â€™eâ€™ï¼ˆ-d.ddddeÂ±ddï¼Œåè¿›åˆ¶æŒ‡æ•°ï¼‰ã€â€™Eâ€™ï¼ˆ-d.ddddEÂ±ddï¼Œåè¿›åˆ¶æŒ‡æ•°ï¼‰ã€â€™gâ€™ï¼ˆæŒ‡æ•°å¾ˆå¤§æ—¶ç”¨â€™eâ€™æ ¼å¼ï¼Œå¦åˆ™â€™fâ€™æ ¼å¼ï¼‰ã€â€™Gâ€™ï¼ˆæŒ‡æ•°å¾ˆå¤§æ—¶ç”¨â€™Eâ€™æ ¼å¼ï¼Œå¦åˆ™â€™fâ€™æ ¼å¼ï¼‰ã€‚ precæ§åˆ¶ç²¾åº¦ï¼ˆæ’é™¤æŒ‡æ•°éƒ¨åˆ†ï¼‰ï¼šå¯¹â€™fâ€™ã€â€™eâ€™ã€â€™Eâ€™ï¼Œå®ƒè¡¨ç¤ºå°æ•°ç‚¹åçš„æ•°å­—ä¸ªæ•°ï¼›å¯¹â€™gâ€™ã€â€™Gâ€™ï¼Œå®ƒæ§åˆ¶æ€»çš„æ•°å­—ä¸ªæ•°ã€‚å¦‚æœprec ä¸º-1ï¼Œåˆ™ä»£è¡¨ä½¿ç”¨æœ€å°‘æ•°é‡çš„ã€ä½†åˆå¿…éœ€çš„æ•°å­—æ¥è¡¨ç¤ºfã€‚ ä»£ç ç¤ºä¾‹ s1 := strconv.FormatBool(true) s2 := strconv.FormatFloat(3.1415, 'E', -1, 64) s3 := strconv.FormatInt(-2, 16) s4 := strconv.FormatUint(2, 16) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-strconv/:0:3","tags":["Go","strconv"],"title":"Go strconv","uri":"/posts/2023-11-11-go-strconv/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å…¶ä»– isPrint() func IsPrint(r rune) bool è¿”å›ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯å¯æ‰“å°çš„ï¼Œå’Œunicode.IsPrintä¸€æ ·ï¼Œrå¿…é¡»æ˜¯ï¼šå­—æ¯ï¼ˆå¹¿ä¹‰ï¼‰ã€æ•°å­—ã€æ ‡ç‚¹ã€ç¬¦å·ã€ASCIIç©ºæ ¼ã€‚ CanBackquote() func CanBackquote(s string) bool è¿”å›å­—ç¬¦ä¸²sæ˜¯å¦å¯ä»¥ä¸è¢«ä¿®æ”¹çš„è¡¨ç¤ºä¸ºä¸€ä¸ªå•è¡Œçš„ã€æ²¡æœ‰ç©ºæ ¼å’Œtabä¹‹å¤–æ§åˆ¶å­—ç¬¦çš„åå¼•å·å­—ç¬¦ä¸²ã€‚ å…¶ä»– é™¤ä¸Šæ–‡åˆ—å‡ºçš„å‡½æ•°å¤–ï¼ŒstrconvåŒ…ä¸­è¿˜æœ‰Appendç³»åˆ—ã€Quoteç³»åˆ—ç­‰å‡½æ•°ã€‚å…·ä½“ç”¨æ³•å¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-strconv/:0:4","tags":["Go","strconv"],"title":"Go strconv","uri":"/posts/2023-11-11-go-strconv/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go tailåº“ å®æ—¶è¯»å–æ–‡ä»¶å†…å®¹ go get github.com/hpcloud/tail ç¤ºä¾‹ï¼š package main import ( \"fmt\" \"time\" \"github.com/hpcloud/tail\" ) func main() { fileName := \"./my.log\" config := tail.Config{ ReOpen: true, // é‡æ–°æ‰“å¼€ Follow: true, // æ˜¯å¦è·Ÿéš Location: \u0026tail.SeekInfo{Offset: 0, Whence: 2}, // ä»æ–‡ä»¶çš„å“ªä¸ªåœ°æ–¹å¼€å§‹è¯» MustExist: false, // æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™ Poll: true, } tails, err := tail.TailFile(fileName, config) if err != nil { fmt.Println(\"tail file failed, err:\", err) return } var ( line *tail.Line ok bool ) for { line, ok = \u003c-tails.Lines if !ok { fmt.Printf(\"tail file close reopen, filename:%s\\n\", tails.Filename) time.Sleep(time.Second) continue } fmt.Println(\"line:\", line.Text) } } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-tail/:1:0","tags":["Go","tail"],"title":"Go tail","uri":"/posts/2023-11-11-go-tail/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Goè¯­è¨€æ ‡å‡†åº“netåŒ…ä»‹ç» ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-net/:1:0","tags":["Go","net"],"title":"Go net","uri":"/posts/2023-11-11-go-net/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ä¸€ã€åŸŸåè§£æ DNS è®°å½•æ˜¯ä¸ DNS æœåŠ¡å™¨å…³è”çš„æ˜ å°„æ–‡ä»¶ï¼Œæ— è®ºæ¯ä¸ªåŸŸåä¸å“ªä¸ª IP åœ°å€å…³è”ï¼Œå®ƒä»¬éƒ½èƒ½å¤„ç†å‘é€åˆ°æ¯ä¸ªåŸŸåçš„è¯·æ±‚ã€‚net åŒ…åŒ…å«å„ç§æ–¹æ³•æ¥æŸ¥æ‰¾ DNS è®°å½•çš„ç»†èŠ‚ã€‚è®©æˆ‘ä»¬è¿è¡Œä¸€äº›ç¤ºä¾‹ï¼Œæ”¶é›†æœ‰å…³ DNS æœåŠ¡å™¨çš„ä¿¡æ¯ä»¥åŠç›®æ ‡åŸŸåçš„ç›¸åº”è®°å½•ï¼š æœ¬æ–‡æ˜¯ Goè¯­è¨€ä¸­æ–‡ç½‘ç»„ç»‡çš„ GCTT ç¿»è¯‘ï¼Œå‘å¸ƒåœ¨ Goè¯­è¨€ä¸­æ–‡ç½‘å…¬ä¼—å·ï¼Œè½¬è½½è¯·è”ç³»æˆ‘ä»¬æˆæƒã€‚ 1ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„ A è®°å½• net.LookupIP() å‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆdomain-nameï¼‰å¹¶è¿”å›ä¸€ä¸ªåŒ…å«ä¸»æœºçš„ IPv4 å’Œ IPv6 åœ°å€çš„ net.IP å¯¹è±¡åˆ‡ç‰‡ã€‚ package main import ( \"fmt\" \"net\" ) func main() { iprecords, _ := net.LookupIP(\"facebook.com\") for _, ip := range iprecords { fmt.Println(ip) } } ä¸Šè¿°ç¨‹åºçš„è¾“å‡ºåˆ—å‡ºäº†ä»¥ IPv4 å’Œ IPv6 æ ¼å¼è¿”å›çš„ facebook.com çš„ A è®°å½•ã€‚ C:\\golang\\dns\u003e Go run example1.go 2a03:2880:f12f:83:face:b00c:0:25de 31.13.79.35 2ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„ CNAME è®°å½• CNAME æ˜¯è§„èŒƒåç§°çš„ç¼©å†™ã€‚CNAME æœ¬è´¨ä¸Šæ˜¯ç»‘å®šè·¯å¾„çš„åŸŸåå’Œå­åŸŸåçš„æ–‡æœ¬åˆ«åã€‚net.LookupCNAME() å‡½æ•°æ¥å—ä¸»æœºåŸŸåï¼ˆm.facebook.comï¼‰ä½œä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ç»™å®šä¸»æœºçš„å•ä¸ªè§„èŒƒåŸŸå package main import ( \"fmt\" \"net\" ) func main() { cname, _ := net.LookupCNAME(\"m.facebook.com\") fmt.Println(cname) } m.facebook.com åŸŸåè¿”å›çš„ CNAME è®°å½•å¦‚ä¸‹æ‰€ç¤ºï¼š C:\\golang\\dns\u003e Go run example2.go star-mini.c10r.facebook.comã€‚ 3ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„ PTR æŒ‡é’ˆè®°å½• è¿™äº›è®°å½•æä¾›ä»åœ°å€åˆ°åç§°çš„åå‘ç»‘å®šã€‚PTR è®°å½•åº”ä¸æ­£å‘è®°å½•å®Œå…¨åŒ¹é…ã€‚net.LookupAddr() å‡½æ•°å¯¹åœ°å€æ‰§è¡Œåå‘æŸ¥æ‰¾ï¼Œå¹¶è¿”å›æ˜ å°„åˆ°ç»™å®šåœ°å€çš„åç§°åˆ—è¡¨ã€‚ package main import ( \"fmt\" \"net\" ) func main() { ptr, _ := net.LookupAddr(\"6.8.8.8\") for _, ptrvalue := range ptr { fmt.Println(ptrvalue) } } å¯¹äºç»™å®šçš„åœ°å€ï¼Œä¸Šè¿°ç¨‹åºè¿”å›å•ä¸ªåå‘è®°å½•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š C:\\golang\\dns\u003ego run example3.go tms_server.yuma.army.mil. 4ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„åç§°æœåŠ¡å™¨ï¼ˆNSï¼‰è®°å½• NS è®°å½•æè¿°äº†åŒºåŸŸçš„æˆæƒåç§°æœåŠ¡å™¨ã€‚NS è¿˜å°†å­åŸŸåå§”æ‰˜ç»™åŒºåŸŸæ–‡ä»¶ä¸Šçš„å…¶ä»–ç»„ç»‡ã€‚net.LookupNS() å‡½æ•°å°†åŸŸåï¼ˆfacebook.comï¼‰ä½œä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å› DNS-NS è®°å½•ä½œä¸º NS ç»“æ„çš„åˆ‡ç‰‡ã€‚ package main import ( \"fmt\" \"net\" ) func main() { nameserver, _ := net.LookupNS(\"facebook.com\") for _, ns := range nameserver { fmt.Println(ns) } } æ”¯æŒè¯¥åŸŸåçš„ NS è®°å½•å¦‚ä¸‹æ‰€ç¤ºï¼š C:\\golang\\dns\u003ego run example4.go \u0026{a.ns.facebook.com.} \u0026{b.ns.facebook.com.} 5ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸçš„ MX è®°å½• è¿™äº›è®°å½•ç”¨æ¥è®°å½•å¯ä»¥äº¤æ¢ç”µå­é‚®ä»¶çš„æœåŠ¡å™¨ã€‚net.LookupMX() å‡½æ•°å°†åŸŸåä½œä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›æŒ‰é¦–é€‰é¡¹æ’åºçš„ MX ç»“æ„åˆ‡ç‰‡ã€‚MX ç»“æ„ç”±ç±»å‹ä¸ºå­—ç¬¦ä¸²çš„ HOST å’Œ ç±»å‹ä¸º uint16 çš„ Pref ç»„æˆã€‚ package main import ( \"fmt\" \"net\" ) func main() { mxrecords, _ := net.LookupMX(\"facebook.com\") for _, mx := range mxrecords { fmt.Println(mx.Host, mx.Pref) } } åŸŸåï¼ˆfacebook.comï¼‰çš„è¾“å‡ºåˆ—è¡¨ MX è®°å½•ã€‚ C:\\golang\\dns\u003ego run example5.go msgin.vvv.facebook.com. 10 6ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„ SRV æœåŠ¡è®°å½• LookupSRV å‡½æ•°å°è¯•è§£æç»™å®šæœåŠ¡ï¼Œåè®®å’ŒåŸŸåçš„ SRV æŸ¥è¯¢ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ â€œtcpâ€ æˆ– â€œudpâ€ã€‚è¿”å›çš„è®°å½•æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œå¹¶æŒ‰ç…§æƒé‡éšæœºåŒ–ã€‚ package main import ( \"fmt\" \"net\" ) func main() { cname, srvs, err := net.LookupSRV(\"xmpp-server\", \"tcp\", \"golang.org\") if err != nil { panic(err) } fmt.Printf(\"\\ncname: %s \\n\\n\", cname) for _, srv := range srvs { fmt.Printf(\"%v:%v:%d:%d\\n\", srv.Target, srv.Port, srv.Priority, srv.Weight) } } ä¸‹é¢çš„è¾“å‡ºæ¼”ç¤ºäº† CNAME è¿”å›ï¼Œåè·Ÿç”±å†’å·åˆ†éš”çš„ SRV è®°å½•çš„ç›®æ ‡ï¼Œç«¯å£ï¼Œä¼˜å…ˆçº§å’Œæƒé‡ã€‚ C:\\golang\\dns\u003ego run example6.go cname: _xmpp-server._tcp.golang.org. 7ã€Go ç¨‹åºæŸ¥æ‰¾åŸŸåçš„ TXT è®°å½• TXT è®°å½•å­˜å‚¨æœ‰å…³ SPF çš„ä¿¡æ¯ï¼Œè¯¥ä¿¡æ¯å¯ä»¥è¯†åˆ«æˆæƒæœåŠ¡å™¨ä»¥ä»£è¡¨æ‚¨çš„ç»„ç»‡å‘é€ç”µå­é‚®ä»¶ã€‚net.LookupTXT() å‡½æ•°å°†åŸŸåï¼ˆfacebook.comï¼‰ä½œä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å› DNS TXT è®°å½•çš„å­—ç¬¦ä¸²åˆ‡ç‰‡ã€‚ package main import ( \"fmt\" \"net\" ) func main() { txtrecords, _ := net.LookupTXT(\"facebook.com\") for _, txt := range txtrecords { fmt.Println(txt) } } gmail.com çš„å•ä¸ª TXT è®°å½•å¦‚ä¸‹æ‰€ç¤ºã€‚ C:\\golang\\dns\u003ego run example7.go v=spf1 redirect=_spf.facebook.com via: http://www.golangprograms.com/find-dns-records-programmatically.html ä½œè€…ï¼šgolangprograms[1]è¯‘è€…ï¼šlovechuck[2]æ ¡å¯¹ï¼špolaris1119[3] ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-net/:1:1","tags":["Go","net"],"title":"Go net","uri":"/posts/2023-11-11-go-net/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å‚è€ƒèµ„æ–™ [1]golangprograms: http://www.golangprograms.com [2]lovechuck: https://github.com/lovechuck [3]polaris1119: https://github.com/polaris1119 [4]GCTT: https://github.com/studygolang/GCTT [5]Go ä¸­æ–‡ç½‘: https://studygolang.com/ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-net/:1:2","tags":["Go","net"],"title":"Go net","uri":"/posts/2023-11-11-go-net/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"mapstructure è½¬æ¢åº“ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:0","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç®€ä»‹ mapstructureç”¨äºå°†é€šç”¨çš„map[string]interface{}è§£ç åˆ°å¯¹åº”çš„ Go ç»“æ„ä½“ä¸­ï¼Œæˆ–è€…æ‰§è¡Œç›¸åçš„æ“ä½œã€‚å¾ˆå¤šæ—¶å€™ï¼Œè§£ææ¥è‡ªå¤šç§æºå¤´çš„æ•°æ®æµæ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬äº‹å…ˆå¹¶ä¸çŸ¥é“ä»–ä»¬å¯¹åº”çš„å…·ä½“ç±»å‹ã€‚åªæœ‰è¯»å–åˆ°ä¸€äº›å­—æ®µä¹‹åæ‰èƒ½åšå‡ºåˆ¤æ–­ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨æ ‡å‡†çš„encoding/jsonåº“å°†æ•°æ®è§£ç ä¸ºmap[string]interface{}ç±»å‹ï¼Œç„¶åæ ¹æ®æ ‡è¯†å­—æ®µåˆ©ç”¨mapstructureåº“è½¬ä¸ºç›¸åº”çš„ Go ç»“æ„ä½“ä»¥ä¾¿ä½¿ç”¨ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:1","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å¿«é€Ÿä½¿ç”¨ æœ¬æ–‡ä»£ç é‡‡ç”¨ Go Modulesã€‚ é¦–å…ˆåˆ›å»ºç›®å½•å¹¶åˆå§‹åŒ–ï¼š $ mkdir mapstructure \u0026\u0026 cd mapstructure $ go mod init github.com/darjun/go-daily-lib/mapstructure ä¸‹è½½mapstructureåº“ï¼š $ go get github.com/mitchellh/mapstructure ä½¿ç”¨ï¼š package main import ( \"encoding/json\" \"fmt\" \"log\" \"github.com/mitchellh/mapstructure\" ) type Person struct { Name string Age int Job string } type Cat struct { Name string Age int Breed string } func main() { datas := []string{` { \"type\": \"person\", \"name\":\"dj\", \"age\":18, \"job\": \"programmer\" } `, ` { \"type\": \"cat\", \"name\": \"kitty\", \"age\": 1, \"breed\": \"Ragdoll\" } `, } for _, data := range datas { var m map[string]interface{} err := json.Unmarshal([]byte(data), \u0026m) if err != nil { log.Fatal(err) } switch m[\"type\"].(string) { case \"person\": var p Person mapstructure.Decode(m, \u0026p) fmt.Println(\"person\", p) case \"cat\": var cat Cat mapstructure.Decode(m, \u0026cat) fmt.Println(\"cat\", cat) } } } è¿è¡Œç»“æœï¼š $ go run main.go person {dj 18 programmer} cat {kitty 1 Ragdoll} æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªç»“æ„ä½“Personå’ŒCatï¼Œä»–ä»¬çš„å­—æ®µæœ‰äº›è®¸ä¸åŒã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çº¦å®šé€šä¿¡çš„ JSON ä¸²ä¸­æœ‰ä¸€ä¸ªtypeå­—æ®µã€‚å½“typeçš„å€¼ä¸ºpersonæ—¶ï¼Œè¯¥ JSON ä¸²è¡¨ç¤ºçš„æ˜¯Personç±»å‹çš„æ•°æ®ã€‚å½“typeçš„å€¼ä¸ºcatæ—¶ï¼Œè¯¥ JSON ä¸²è¡¨ç¤ºçš„æ˜¯Catç±»å‹çš„æ•°æ®ã€‚ ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬å…ˆç”¨json.Unmarshalå°†å­—èŠ‚æµè§£ç ä¸ºmap[string]interface{}ç±»å‹ã€‚ç„¶åè¯»å–é‡Œé¢çš„typeå­—æ®µã€‚æ ¹æ®typeå­—æ®µçš„å€¼ï¼Œå†ä½¿ç”¨mapstructure.Decodeå°†è¯¥ JSON ä¸²åˆ†åˆ«è§£ç ä¸ºPersonå’ŒCatç±»å‹çš„å€¼ï¼Œå¹¶è¾“å‡ºã€‚ å®é™…ä¸Šï¼ŒGoogle Protobuf é€šå¸¸ä¹Ÿä½¿ç”¨è¿™ç§æ–¹å¼ã€‚åœ¨åè®®ä¸­æ·»åŠ æ¶ˆæ¯ ID æˆ–å…¨é™å®šæ¶ˆæ¯åã€‚æ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åï¼Œå…ˆè¯»å–åè®® ID æˆ–å…¨é™å®šæ¶ˆæ¯åã€‚ç„¶åè°ƒç”¨ Protobuf çš„è§£ç æ–¹æ³•å°†å…¶è§£ç ä¸ºå¯¹åº”çš„Messageç»“æ„ã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œmapstructureä¹Ÿå¯ä»¥ç”¨äºç½‘ç»œæ¶ˆæ¯è§£ç ï¼Œå¦‚æœä½ ä¸è€ƒè™‘æ€§èƒ½çš„è¯ğŸ˜„ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:2","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å­—æ®µæ ‡ç­¾ é»˜è®¤æƒ…å†µä¸‹ï¼Œmapstructureä½¿ç”¨ç»“æ„ä½“ä¸­å­—æ®µçš„åç§°åšè¿™ä¸ªæ˜ å°„ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„ç»“æ„ä½“æœ‰ä¸€ä¸ªNameå­—æ®µï¼Œmapstructureè§£ç æ—¶ä¼šåœ¨map[string]interface{}ä¸­æŸ¥æ‰¾é”®ånameã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„nameæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼ type Person struct { Name string } å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šæ˜ å°„çš„å­—æ®µåã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå­—æ®µè®¾ç½®mapstructureæ ‡ç­¾ã€‚ä¾‹å¦‚ä¸‹é¢ä½¿ç”¨usernameä»£æ›¿ä¸Šä¾‹ä¸­çš„nameï¼š type Person struct { Name string `mapstructure:\"username\"` } çœ‹ç¤ºä¾‹ï¼š type Person struct { Name string `mapstructure:\"username\"` Age int Job string } type Cat struct { Name string Age int Breed string } func main() { datas := []string{` { \"type\": \"person\", \"username\":\"dj\", \"age\":18, \"job\": \"programmer\" } `, ` { \"type\": \"cat\", \"name\": \"kitty\", \"Age\": 1, \"breed\": \"Ragdoll\" } `, ` { \"type\": \"cat\", \"Name\": \"rooooose\", \"age\": 2, \"breed\": \"shorthair\" } `, } for _, data := range datas { var m map[string]interface{} err := json.Unmarshal([]byte(data), \u0026m) if err != nil { log.Fatal(err) } switch m[\"type\"].(string) { case \"person\": var p Person mapstructure.Decode(m, \u0026p) fmt.Println(\"person\", p) case \"cat\": var cat Cat mapstructure.Decode(m, \u0026cat) fmt.Println(\"cat\", cat) } } } ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ ‡ç­¾mapstructure:\"username\"å°†Personçš„Nameå­—æ®µæ˜ å°„ä¸ºusernameï¼Œåœ¨ JSON ä¸²ä¸­æˆ‘ä»¬éœ€è¦è®¾ç½®usernameæ‰èƒ½æ­£ç¡®è§£æã€‚å¦å¤–ï¼Œæ³¨æ„åˆ°ï¼Œæˆ‘ä»¬å°†ç¬¬äºŒä¸ª JSON ä¸²ä¸­çš„Ageå’Œç¬¬ä¸‰ä¸ª JSON ä¸²ä¸­çš„Nameé¦–å­—æ¯å¤§å†™äº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å½±å“è§£ç ç»“æœã€‚mapstructureå¤„ç†å­—æ®µæ˜ å°„æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:3","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å†…åµŒç»“æ„ ç»“æ„ä½“å¯ä»¥ä»»æ„åµŒå¥—ï¼ŒåµŒå¥—çš„ç»“æ„è¢«è®¤ä¸ºæ˜¯æ‹¥æœ‰è¯¥ç»“æ„ä½“åå­—çš„å¦ä¸€ä¸ªå­—æ®µã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ä¸¤ç§Friendçš„å®šä¹‰æ–¹å¼å¯¹äºmapstructureæ˜¯ä¸€æ ·çš„ï¼š type Person struct { Name string } // æ–¹å¼ä¸€ type Friend struct { Person } // æ–¹å¼äºŒ type Friend struct { Person Person } ä¸ºäº†æ­£ç¡®è§£ç ï¼ŒPersonç»“æ„çš„æ•°æ®è¦åœ¨personé”®ä¸‹ï¼š map[string]interface{} { \"person\": map[string]interface{}{\"name\": \"dj\"}, } æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®mapstructure:\",squash\"å°†è¯¥ç»“æ„ä½“çš„å­—æ®µæåˆ°çˆ¶ç»“æ„ä¸­ï¼š type Friend struct { Person `mapstructure:\",squash\"` } è¿™æ ·åªéœ€è¦è¿™æ ·çš„ JSON ä¸²ï¼Œæ— æ•ˆåµŒå¥—personé”®ï¼š map[string]interface{}{ \"name\": \"dj\", } çœ‹ç¤ºä¾‹ï¼š type Person struct { Name string } type Friend1 struct { Person } type Friend2 struct { Person `mapstructure:\",squash\"` } func main() { datas := []string{` { \"type\": \"friend1\", \"person\": { \"name\":\"dj\" } } `, ` { \"type\": \"friend2\", \"name\": \"dj2\" } `, } for _, data := range datas { var m map[string]interface{} err := json.Unmarshal([]byte(data), \u0026m) if err != nil { log.Fatal(err) } switch m[\"type\"].(string) { case \"friend1\": var f1 Friend1 mapstructure.Decode(m, \u0026f1) fmt.Println(\"friend1\", f1) case \"friend2\": var f2 Friend2 mapstructure.Decode(m, \u0026f2) fmt.Println(\"friend2\", f2) } } } æ³¨æ„å¯¹æ¯”Friend1å’ŒFriend2ä½¿ç”¨çš„ JSON ä¸²çš„ä¸åŒã€‚ å¦å¤–éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœçˆ¶ç»“æ„ä½“ä¸­æœ‰åŒåçš„å­—æ®µï¼Œé‚£ä¹ˆmapstructureä¼šå°†JSON ä¸­å¯¹åº”çš„å€¼åŒæ—¶è®¾ç½®åˆ°è¿™ä¸¤ä¸ªå­—æ®µä¸­ï¼Œå³è¿™ä¸¤ä¸ªå­—æ®µæœ‰ç›¸åŒçš„å€¼ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:4","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æœªæ˜ å°„çš„å€¼ å¦‚æœæºæ•°æ®ä¸­æœ‰æœªæ˜ å°„çš„å€¼ï¼ˆå³ç»“æ„ä½“ä¸­æ— å¯¹åº”çš„å­—æ®µï¼‰ï¼Œmapstructureé»˜è®¤ä¼šå¿½ç•¥å®ƒã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ç»“æ„ä½“ä¸­å®šä¹‰ä¸€ä¸ªå­—æ®µï¼Œä¸ºå…¶è®¾ç½®mapstructure:\",remain\"æ ‡ç­¾ã€‚è¿™æ ·æœªæ˜ å°„çš„å€¼å°±ä¼šæ·»åŠ åˆ°è¿™ä¸ªå­—æ®µä¸­ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå­—æ®µçš„ç±»å‹åªèƒ½ä¸ºmap[string]interface{}æˆ–map[interface{}]interface{}ã€‚ çœ‹ç¤ºä¾‹ï¼š type Person struct { Name string Age int Job string Other map[string]interface{} `mapstructure:\",remain\"` } func main() { data := ` { \"name\": \"dj\", \"age\":18, \"job\":\"programmer\", \"height\":\"1.8m\", \"handsome\": true } ` var m map[string]interface{} err := json.Unmarshal([]byte(data), \u0026m) if err != nil { log.Fatal(err) } var p Person mapstructure.Decode(m, \u0026p) fmt.Println(\"other\", p.Other) } ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸ºç»“æ„ä½“å®šä¹‰äº†ä¸€ä¸ªOtherå­—æ®µï¼Œç”¨äºä¿å­˜æœªæ˜ å°„çš„é”®å€¼ã€‚è¾“å‡ºç»“æœï¼š other map[handsome:true height:1.8m] ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:5","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"é€†å‘è½¬æ¢ å‰é¢æˆ‘ä»¬éƒ½æ˜¯å°†map[string]interface{}è§£ç åˆ° Go ç»“æ„ä½“ä¸­ã€‚mapstructureå½“ç„¶ä¹Ÿå¯ä»¥å°† Go ç»“æ„ä½“åå‘è§£ç ä¸ºmap[string]interface{}ã€‚åœ¨åå‘è§£ç æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæŸäº›å­—æ®µè®¾ç½®mapstructure:\",omitempty\"ã€‚è¿™æ ·å½“è¿™äº›å­—æ®µä¸ºé»˜è®¤å€¼æ—¶ï¼Œå°±ä¸ä¼šå‡ºç°åœ¨ç»“æ„çš„map[string]interface{}ä¸­ï¼š type Person struct { Name string Age int Job string `mapstructure:\",omitempty\"` } func main() { p := \u0026Person{ Name: \"dj\", Age: 18, } var m map[string]interface{} mapstructure.Decode(p, \u0026m) data, _ := json.Marshal(m) fmt.Println(string(data)) } ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸ºJobå­—æ®µè®¾ç½®äº†mapstructure:\",omitempty\"ï¼Œä¸”å¯¹è±¡pçš„Jobå­—æ®µæœªè®¾ç½®ã€‚è¿è¡Œç»“æœï¼š $ go run main.go {\"Age\":18,\"Name\":\"dj\"} ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:6","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Metadata è§£ç æ—¶ä¼šäº§ç”Ÿä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œmapstructureå¯ä»¥ä½¿ç”¨Metadataæ”¶é›†è¿™äº›ä¿¡æ¯ã€‚Metadataç»“æ„å¦‚ä¸‹ï¼š // mapstructure.go type Metadata struct { Keys []string Unused []string } Metadataåªæœ‰ä¸¤ä¸ªå¯¼å‡ºå­—æ®µï¼š Keysï¼šè§£ç æˆåŠŸçš„é”®åï¼› Unusedï¼šåœ¨æºæ•°æ®ä¸­å­˜åœ¨ï¼Œä½†æ˜¯ç›®æ ‡ç»“æ„ä¸­ä¸å­˜åœ¨çš„é”®åã€‚ ä¸ºäº†æ”¶é›†è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨DecodeMetadataæ¥ä»£æ›¿Decodeæ–¹æ³•ï¼š type Person struct { Name string Age int } func main() { m := map[string]interface{}{ \"name\": \"dj\", \"age\": 18, \"job\": \"programmer\", } var p Person var metadata mapstructure.Metadata mapstructure.DecodeMetadata(m, \u0026p, \u0026metadata) fmt.Printf(\"keys:%#v unused:%#v\\n\", metadata.Keys, metadata.Unused) } å…ˆå®šä¹‰ä¸€ä¸ªMetadataç»“æ„ï¼Œä¼ å…¥DecodeMetadataæ”¶é›†è§£ç çš„ä¿¡æ¯ã€‚è¿è¡Œç»“æœï¼š $ go run main.go keys:[]string{\"Name\", \"Age\"} unused:[]string{\"job\"} ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:7","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"é”™è¯¯å¤„ç† mapstructureæ‰§è¡Œè½¬æ¢çš„è¿‡ç¨‹ä¸­ä¸å¯é¿å…åœ°ä¼šäº§ç”Ÿé”™è¯¯ï¼Œä¾‹å¦‚ JSON ä¸­æŸä¸ªé”®çš„ç±»å‹ä¸å¯¹åº” Go ç»“æ„ä½“ä¸­çš„å­—æ®µç±»å‹ä¸ä¸€è‡´ã€‚Decode/DecodeMetadataä¼šè¿”å›è¿™äº›é”™è¯¯ï¼š type Person struct { Name string Age int Emails []string } func main() { m := map[string]interface{}{ \"name\": 123, \"age\": \"bad value\", \"emails\": []int{1, 2, 3}, } var p Person err := mapstructure.Decode(m, \u0026p) if err != nil { fmt.Println(err.Error()) } } ä¸Šé¢ä»£ç ä¸­ï¼Œç»“æ„ä½“ä¸­Personä¸­å­—æ®µNameä¸ºstringç±»å‹ï¼Œä½†è¾“å…¥ä¸­nameä¸ºintç±»å‹ï¼›å­—æ®µAgeä¸ºintç±»å‹ï¼Œä½†è¾“å…¥ä¸­ageä¸ºstringç±»å‹ï¼›å­—æ®µEmailsä¸º[]stringç±»å‹ï¼Œä½†è¾“å…¥ä¸­emailsä¸º[]intç±»å‹ã€‚æ•…Decodeè¿”å›é”™è¯¯ã€‚è¿è¡Œç»“æœï¼š $ go run main.go 5 error(s) decoding: * 'Age' expected type 'int', got unconvertible type 'string' * 'Emails[0]' expected type 'string', got unconvertible type 'int' * 'Emails[1]' expected type 'string', got unconvertible type 'int' * 'Emails[2]' expected type 'string', got unconvertible type 'int' * 'Name' expected type 'string', got unconvertible type 'int' ä»é”™è¯¯ä¿¡æ¯ä¸­å¾ˆå®¹æ˜“çœ‹å‡ºå“ªé‡Œå‡ºé”™äº†ã€‚ å¼±ç±»å‹è¾“å…¥ æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³å¯¹ç»“æ„ä½“å­—æ®µç±»å‹å’Œmap[string]interface{}çš„å¯¹åº”é”®å€¼åšå¼ºç±»å‹ä¸€è‡´çš„æ ¡éªŒã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨WeakDecode/WeakDecodeMetadataæ–¹æ³•ï¼Œå®ƒä»¬ä¼šå°è¯•åšç±»å‹è½¬æ¢ï¼š type Person struct { Name string Age int Emails []string } func main() { m := map[string]interface{}{ \"name\": 123, \"age\": \"18\", \"emails\": []int{1, 2, 3}, } var p Person err := mapstructure.WeakDecode(m, \u0026p) if err == nil { fmt.Println(\"person:\", p) } else { fmt.Println(err.Error()) } } è™½ç„¶é”®nameå¯¹åº”çš„å€¼123æ˜¯intç±»å‹ï¼Œä½†æ˜¯åœ¨WeakDecodeä¸­ä¼šå°†å…¶è½¬æ¢ä¸ºstringç±»å‹ä»¥åŒ¹é…Person.Nameå­—æ®µçš„ç±»å‹ã€‚åŒæ ·çš„ï¼Œageçš„å€¼\"18\"æ˜¯stringç±»å‹ï¼Œåœ¨WeakDecodeä¸­ä¼šå°†å…¶è½¬æ¢ä¸ºintç±»å‹ä»¥åŒ¹é…Person.Ageå­—æ®µçš„ç±»å‹ã€‚ éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœç±»å‹è½¬æ¢å¤±è´¥äº†ï¼ŒWeakDecodeåŒæ ·ä¼šè¿”å›é”™è¯¯ã€‚ä¾‹å¦‚å°†ä¸Šä¾‹ä¸­çš„ageè®¾ç½®ä¸º\"bad value\"ï¼Œå®ƒå°±ä¸èƒ½è½¬ä¸ºintç±»å‹ï¼Œæ•…è€Œè¿”å›é”™è¯¯ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:8","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"è§£ç å™¨ é™¤äº†ä¸Šé¢ä»‹ç»çš„æ–¹æ³•å¤–ï¼Œmapstructureè¿˜æä¾›äº†æ›´çµæ´»çš„è§£ç å™¨ï¼ˆDecoderï¼‰ã€‚å¯ä»¥é€šè¿‡é…ç½®DecoderConfigå®ç°ä¸Šé¢ä»‹ç»çš„ä»»ä½•åŠŸèƒ½ï¼š // mapstructure.go type DecoderConfig struct { ErrorUnused bool ZeroFields bool WeaklyTypedInput bool Metadata *Metadata Result interface{} TagName string } å„ä¸ªå­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š ErrorUnusedï¼šä¸ºtrueæ—¶ï¼Œå¦‚æœè¾“å…¥ä¸­çš„é”®å€¼æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„å­—æ®µå°±è¿”å›é”™è¯¯ï¼› ZeroFieldsï¼šä¸ºtrueæ—¶ï¼Œåœ¨Decodeå‰æ¸…ç©ºç›®æ ‡mapã€‚ä¸ºfalseæ—¶ï¼Œåˆ™æ‰§è¡Œçš„æ˜¯mapçš„åˆå¹¶ã€‚ç”¨åœ¨structåˆ°mapçš„è½¬æ¢ä¸­ï¼› WeaklyTypedInputï¼šå®ç°WeakDecode/WeakDecodeMetadataçš„åŠŸèƒ½ï¼› Metadataï¼šä¸ä¸ºnilæ—¶ï¼Œæ”¶é›†Metadataæ•°æ®ï¼› Resultï¼šä¸ºç»“æœå¯¹è±¡ï¼Œåœ¨mapåˆ°structçš„è½¬æ¢ä¸­ï¼ŒResultä¸ºstructç±»å‹ã€‚åœ¨structåˆ°mapçš„è½¬æ¢ä¸­ï¼ŒResultä¸ºmapç±»å‹ï¼› TagNameï¼šé»˜è®¤ä½¿ç”¨mapstructureä½œä¸ºç»“æ„ä½“çš„æ ‡ç­¾åï¼Œå¯ä»¥é€šè¿‡è¯¥å­—æ®µè®¾ç½®ã€‚ çœ‹ç¤ºä¾‹ï¼š type Person struct { Name string Age int } func main() { m := map[string]interface{}{ \"name\": 123, \"age\": \"18\", \"job\": \"programmer\", } var p Person var metadata mapstructure.Metadata decoder, err := mapstructure.NewDecoder(\u0026mapstructure.DecoderConfig{ WeaklyTypedInput: true, Result: \u0026p, Metadata: \u0026metadata, }) if err != nil { log.Fatal(err) } err = decoder.Decode(m) if err == nil { fmt.Println(\"person:\", p) fmt.Printf(\"keys:%#v, unused:%#v\\n\", metadata.Keys, metadata.Unused) } else { fmt.Println(err.Error()) } } è¿™é‡Œç”¨Decoderçš„æ–¹å¼å®ç°äº†å‰é¢å¼±ç±»å‹è¾“å…¥å°èŠ‚ä¸­çš„ç¤ºä¾‹ä»£ç ã€‚å®é™…ä¸ŠWeakDecodeå†…éƒ¨å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼å®ç°çš„ï¼Œä¸‹é¢æ˜¯WeakDecodeçš„æºç ï¼š // mapstructure.go func WeakDecode(input, output interface{}) error { config := \u0026DecoderConfig{ Metadata: nil, Result: output, WeaklyTypedInput: true, } decoder, err := NewDecoder(config) if err != nil { return err } return decoder.Decode(input) } å†å®é™…ä¸Šï¼ŒDecode/DecodeMetadata/WeakDecodeMetadataå†…éƒ¨éƒ½æ˜¯å…ˆè®¾ç½®DecoderConfigçš„å¯¹åº”å­—æ®µï¼Œç„¶ååˆ›å»ºDecoderå¯¹è±¡ï¼Œæœ€åè°ƒç”¨å…¶Decodeæ–¹æ³•å®ç°çš„ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-mapstructure/:1:9","tags":["Go","mapstructure"],"title":"Go mapstructure","uri":"/posts/2023-11-11-go-mapstructure/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go leveldbåº“ githubåœ°å€ï¼šhttps://github.com/syndtr/goleveldb å®‰è£…ï¼š go get github.com/syndtr/goleveldb/leveldb ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-leveldb/:1:0","tags":["Go","leveldb"],"title":"Go leveldb","uri":"/posts/2023-11-11-go-leveldb/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç®€ä»‹ï¼š levelDBåœ¨åŒºå—é“¾ä¸­æ¯”è¾ƒå¸¸ç”¨ï¼Œå…¶æ˜¯Googleå¼€æºçš„æŒä¹…åŒ–å•æœºKey-Valueæ–‡ä»¶æ•°æ®åº“ï¼Œå…¶æ”¯æŒæŒ‰ç…§æ–‡ä»¶å¤§å°åˆ‡åˆ†æ–‡ä»¶çš„åŠŸèƒ½ã€‚levelDBå…·æœ‰å¾ˆé«˜çš„éšæœºå†™ï¼Œé¡ºåºè¯»/å†™æ€§èƒ½ï¼Œä½†æ˜¯éšæœºè¯»çš„æ€§èƒ½å¾ˆä¸€èˆ¬ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒlevelDBå¾ˆé€‚åˆåº”ç”¨åœ¨æŸ¥è¯¢è¾ƒå°‘ï¼Œè€Œå†™å¾ˆå¤šçš„åœºæ™¯ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-leveldb/:1:1","tags":["Go","leveldb"],"title":"Go leveldb","uri":"/posts/2023-11-11-go-leveldb/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"LevelDBç‰¹ç‚¹ 1ï¼‰keyå’Œvalueéƒ½æ˜¯ä»»æ„é•¿åº¦çš„å­—èŠ‚æ•°ç»„ï¼› 2ï¼‰entryï¼ˆå³ä¸€æ¡k-vè®°å½•ï¼‰é»˜è®¤æ˜¯æŒ‰ç…§keyçš„å­—å…¸é¡ºåºå­˜å‚¨çš„ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•ï¼› 3ï¼‰æä¾›äº†åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥æ¥å£ï¼› 4ï¼‰æ”¯æŒæ‰¹é‡æ“ä½œä»¥åŸå­æ“ä½œè¿›è¡Œï¼› 5ï¼‰å¼€æºåˆ›å»ºæ•°æ®å…¨æ™¯çš„snapshotï¼ˆå¿«ç…§ï¼‰ï¼Œå¹¶å…è®¸åœ¨å¿«ç…§ä¸­æŸ¥è¯¢ï¼› 6ï¼‰å¼€æºé€šè¿‡å‘å‰ï¼ˆåï¼‰è¿­ä»£å™¨éå†æ•°æ®ï¼ˆè¿­ä»£å™¨éšå«çš„åˆ›å»ºäº†ä¸€ä¸ªsnapshotï¼‰ï¼› 7ï¼‰è‡ªåŠ¨ä½¿ç”¨Snappyå‹ç¼©æ•°æ®ï¼› 8ï¼‰å¯ç§»æ¤æ€§ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-leveldb/:1:2","tags":["Go","leveldb"],"title":"Go leveldb","uri":"/posts/2023-11-11-go-leveldb/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"levelDBé™åˆ¶ 1ï¼‰NoSQLï¼Œä¸æ”¯æŒsqlè¯­å¥ï¼Œä¹Ÿä¸æ”¯æŒç´¢å¼•ï¼› 2ï¼‰ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åº“ï¼› 3ï¼‰æ²¡æœ‰å†…ç½®çš„C/Sæ¶æ„ï¼Œå¼€å‘è€…éœ€è¦ä½¿ç”¨levelDBåº“è‡ªå·±å°è£…ä¸€ä¸ªserverï¼› ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-leveldb/:1:3","tags":["Go","leveldb"],"title":"Go leveldb","uri":"/posts/2023-11-11-go-leveldb/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ä½¿ç”¨ï¼š 1ï¼‰æ‰“å¼€ã€åˆ›å»ºæ•°æ®åº“ db, err := leveldb.OpenFile(\"./block.db\", nil) 2ï¼‰å†™å…¥keyæ•°æ® err = db.Put([]byte(\"hello\"), []byte(\"world\"), nil) 3ï¼‰è¯»å–keyæ•°æ® data, _ := db.Get([]byte(\"hello\"), nil) 4ï¼‰éå†æ•°æ®åº“ iter := db.NewIterator(nil, nil) for iter.Next() { logger.Debug(iter.Key() + iter.Value()) } 5ï¼‰è¯»å–æŸä¸ªå‰ç¼€çš„æ‰€æœ‰KEYæ•°æ® è¯»å‡ºæ¥çš„æ•°æ®ä¼šè¢«æ”¾è¿›ä¸€ä¸ªIteratorä¸­ã€‚åŠ å…¥æ•°æ®åº“ç°åœ¨æœ‰key-$numä¸ºå¤´çš„æ•°æ¡æ•°æ® iter := db.NewIterator(dbUtil.BytesPrefix([]byte(\"key-\")), nil) éå†è¯»å–è¿™äº›æ•°æ® for iter.Next() { logger.Debug(string(iter.Key()) + string(iter.Value())) } è¯»å–æœ€åä¸€æ¡æ•°æ® if iter.Last() { logger.Debug(iter.Key() + iter.Value()) } 6ï¼‰åˆ é™¤æŸä¸ªKEY err = db.Delete([]byte(\"key-3\"), nil) 7ï¼‰æ‰¹é‡å†™ batch := new(leveldb.Batch) batch.Put([]byte(\"foo\"), []byte(\"value\")) batch.Put([]byte(\"bar\"), []byte(\"another value\")) batch.Delete([]byte(\"baz\")) err = db.Write(batch, nil) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-leveldb/:1:4","tags":["Go","leveldb"],"title":"Go leveldb","uri":"/posts/2023-11-11-go-leveldb/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go iniåº“ å‚è€ƒï¼šhttps://juejin.cn/post/6844904048764649479 ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:0","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç®€ä»‹ ini æ˜¯ Windows ä¸Šå¸¸ç”¨çš„é…ç½®æ–‡ä»¶æ ¼å¼ã€‚MySQL çš„ Windows ç‰ˆå°±æ˜¯ä½¿ç”¨ ini æ ¼å¼å­˜å‚¨é…ç½®çš„ã€‚ go-iniæ˜¯ Go è¯­è¨€ä¸­ç”¨äºæ“ä½œ ini æ–‡ä»¶çš„ç¬¬ä¸‰æ–¹åº“ã€‚ æœ¬æ–‡ä»‹ç»go-iniåº“çš„ä½¿ç”¨ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:1","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å¿«é€Ÿä½¿ç”¨ go-ini æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œä½¿ç”¨å‰éœ€è¦å®‰è£…ï¼š $ go get gopkg.in/ini.v1 ä¹Ÿå¯ä»¥ä½¿ç”¨ GitHub ä¸Šçš„ä»“åº“ï¼š $ go get github.com/go-ini/ini é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªmy.inié…ç½®æ–‡ä»¶ï¼š app_name = awesome web # possible values: DEBUG, INFO, WARNING, ERROR, FATAL log_level = DEBUG [mysql] ip = 127.0.0.1 port = 3306 user = dj password = 123456 database = awesome [redis] ip = 127.0.0.1 port = 6381 ä½¿ç”¨ go-ini åº“è¯»å–ï¼š package main import ( \"fmt\" \"log\" \"gopkg.in/ini.v1\" ) func main() { cfg, err := ini.Load(\"my.ini\") if err != nil { log.Fatal(\"Fail to read file: \", err) } fmt.Println(\"App Name:\", cfg.Section(\"\").Key(\"app_name\").String()) fmt.Println(\"Log Level:\", cfg.Section(\"\").Key(\"log_level\").String()) fmt.Println(\"MySQL IP:\", cfg.Section(\"mysql\").Key(\"ip\").String()) mysqlPort, err := cfg.Section(\"mysql\").Key(\"port\").Int() if err != nil { log.Fatal(err) } fmt.Println(\"MySQL Port:\", mysqlPort) fmt.Println(\"MySQL User:\", cfg.Section(\"mysql\").Key(\"user\").String()) fmt.Println(\"MySQL Password:\", cfg.Section(\"mysql\").Key(\"password\").String()) fmt.Println(\"MySQL Database:\", cfg.Section(\"mysql\").Key(\"database\").String()) fmt.Println(\"Redis IP:\", cfg.Section(\"redis\").Key(\"ip\").String()) redisPort, err := cfg.Section(\"redis\").Key(\"port\").Int() if err != nil { log.Fatal(err) } fmt.Println(\"Redis Port:\", redisPort) } åœ¨ ini æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªé”®å€¼å¯¹å ç”¨ä¸€è¡Œï¼Œä¸­é—´ä½¿ç”¨=éš”å¼€ã€‚ä»¥#å¼€å¤´çš„å†…å®¹ä¸ºæ³¨é‡Šã€‚ini æ–‡ä»¶æ˜¯ä»¥åˆ†åŒºï¼ˆsectionï¼‰ç»„ç»‡çš„ã€‚ åˆ†åŒºä»¥[name]å¼€å§‹ï¼Œåœ¨ä¸‹ä¸€ä¸ªåˆ†åŒºå‰ç»“æŸã€‚æ‰€æœ‰åˆ†åŒºå‰çš„å†…å®¹å±äºé»˜è®¤åˆ†åŒºï¼Œå¦‚my.iniæ–‡ä»¶ä¸­çš„app_nameå’Œlog_levelã€‚ ä½¿ç”¨go-iniè¯»å–é…ç½®æ–‡ä»¶çš„æ­¥éª¤å¦‚ä¸‹ï¼š é¦–å…ˆè°ƒç”¨ini.LoadåŠ è½½æ–‡ä»¶ï¼Œå¾—åˆ°é…ç½®å¯¹è±¡cfgï¼› ç„¶åä»¥åˆ†åŒºåè°ƒç”¨é…ç½®å¯¹è±¡çš„Sectionæ–¹æ³•å¾—åˆ°å¯¹åº”çš„åˆ†åŒºå¯¹è±¡sectionï¼Œé»˜è®¤åˆ†åŒºçš„åå­—ä¸º\"\"ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ini.DefaultSectionï¼› ä»¥é”®åè°ƒç”¨åˆ†åŒºå¯¹è±¡çš„Keyæ–¹æ³•å¾—åˆ°å¯¹åº”çš„é…ç½®é¡¹keyå¯¹è±¡ï¼› ç”±äºæ–‡ä»¶ä¸­è¯»å–å‡ºæ¥çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œkeyå¯¹è±¡éœ€æ ¹æ®ç±»å‹è°ƒç”¨å¯¹åº”çš„æ–¹æ³•è¿”å›å…·ä½“ç±»å‹çš„å€¼ä½¿ç”¨ï¼Œå¦‚ä¸Šé¢çš„Stringã€MustIntæ–¹æ³•ã€‚ è¿è¡Œä»¥ä¸‹ç¨‹åºï¼Œå¾—åˆ°è¾“å‡ºï¼š App Name: awesome web Log Level: DEBUG MySQL IP: 127.0.0.1 MySQL Port: 3306 MySQL User: dj MySQL Password: 123456 MySQL Database: awesome Redis IP: 127.0.0.1 Redis Port: 6381 é…ç½®æ–‡ä»¶ä¸­å­˜å‚¨çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ç±»å‹ä¸ºå­—ç¬¦ä¸²çš„é…ç½®é¡¹ä¸ä¼šå‡ºç°ç±»å‹è½¬æ¢å¤±è´¥çš„ï¼Œæ•…String()æ–¹æ³•åªè¿”å›ä¸€ä¸ªå€¼ã€‚ ä½†å¦‚æœç±»å‹ä¸ºInt/Uint/Float64è¿™äº›æ—¶ï¼Œè½¬æ¢å¯èƒ½å¤±è´¥ã€‚æ‰€ä»¥Int()/Uint()/Float64()è¿”å›ä¸€ä¸ªå€¼å’Œä¸€ä¸ªé”™è¯¯ã€‚ è¦ç•™æ„è¿™ç§ä¸ä¸€è‡´ï¼å¦‚æœæˆ‘ä»¬å°†é…ç½®ä¸­ redis ç«¯å£æ”¹æˆéæ³•çš„æ•°å­— x6381ï¼Œé‚£ä¹ˆè¿è¡Œç¨‹åºå°†æŠ¥é”™ï¼š 2020/01/14 22:43:13 strconv.ParseInt: parsing \"x6381\": invalid syntax å¤åˆ¶ä»£ç  ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:2","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Must*ä¾¿æ·æ–¹æ³• å¦‚æœæ¯æ¬¡å–å€¼éƒ½éœ€è¦è¿›è¡Œé”™è¯¯åˆ¤æ–­ï¼Œé‚£ä¹ˆä»£ç å†™èµ·æ¥ä¼šéå¸¸ç¹çã€‚ä¸ºæ­¤ï¼Œgo-iniä¹Ÿæä¾›å¯¹åº”çš„MustTypeï¼ˆType ä¸ºInit/Uint/Float64ç­‰ï¼‰æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åªè¿”å›ä¸€ä¸ªå€¼ã€‚ åŒæ—¶å®ƒæ¥å—å¯å˜å‚æ•°ï¼Œå¦‚æœç±»å‹æ— æ³•è½¬æ¢ï¼Œå–å‚æ•°ä¸­ç¬¬ä¸€ä¸ªå€¼è¿”å›ï¼Œå¹¶ä¸”è¯¥å‚æ•°è®¾ç½®ä¸ºè¿™ä¸ªé…ç½®çš„å€¼ï¼Œä¸‹æ¬¡è°ƒç”¨è¿”å›è¿™ä¸ªå€¼ï¼š package main import ( \"fmt\" \"log\" \"gopkg.in/ini.v1\" ) func main() { cfg, err := ini.Load(\"my.ini\") if err != nil { log.Fatal(\"Fail to read file: \", err) } redisPort, err := cfg.Section(\"redis\").Key(\"port\").Int() if err != nil { fmt.Println(\"before must, get redis port error:\", err) } else { fmt.Println(\"before must, get redis port:\", redisPort) } fmt.Println(\"redis Port:\", cfg.Section(\"redis\").Key(\"port\").MustInt(6381)) redisPort, err = cfg.Section(\"redis\").Key(\"port\").Int() if err != nil { fmt.Println(\"after must, get redis port error:\", err) } else { fmt.Println(\"after must, get redis port:\", redisPort) } } é…ç½®æ–‡ä»¶è¿˜æ˜¯ redis ç«¯å£ä¸ºéæ•°å­— x6381 æ—¶çš„çŠ¶æ€ï¼Œè¿è¡Œç¨‹åºï¼š before must, get redis port error: strconv.ParseInt: parsing \"x6381\": invalid syntax redis Port: 6381 after must, get redis port: 6381 å¤åˆ¶ä»£ç  æˆ‘ä»¬çœ‹åˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨Intè¿”å›é”™è¯¯ï¼Œä»¥ 6381 ä¸ºå‚æ•°è°ƒç”¨MustIntä¹‹åï¼Œå†æ¬¡è°ƒç”¨Intï¼ŒæˆåŠŸè¿”å› 6381ã€‚MustIntæºç ä¹Ÿæ¯”è¾ƒç®€å•ï¼š // gopkg.in/ini.v1/key.go func (k *Key) MustInt(defaultVal ...int) int { val, err := k.Int() if len(defaultVal) \u003e 0 \u0026\u0026 err != nil { k.value = strconv.FormatInt(int64(defaultVal[0]), 10) return defaultVal[0] } return val } å¤åˆ¶ä»£ç  ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:3","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"åˆ†åŒºæ“ä½œ è·å–ä¿¡æ¯ åœ¨åŠ è½½é…ç½®ä¹‹åï¼Œå¯ä»¥é€šè¿‡Sectionsæ–¹æ³•è·å–æ‰€æœ‰åˆ†åŒºï¼ŒSectionStrings()æ–¹æ³•è·å–æ‰€æœ‰åˆ†åŒºåã€‚ sections := cfg.Sections() names := cfg.SectionStrings() fmt.Println(\"sections: \", sections) fmt.Println(\"names: \", names) å¤åˆ¶ä»£ç  è¿è¡Œè¾“å‡º 3 ä¸ªåˆ†åŒºï¼š [DEFAULT mysql redis] å¤åˆ¶ä»£ç  è°ƒç”¨Section(name)è·å–åä¸ºnameçš„åˆ†åŒºï¼Œå¦‚æœè¯¥åˆ†åŒºä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåˆ†åŒºè¿”å›ï¼š newSection := cfg.Section(\"new\") fmt.Println(\"new section: \", newSection) fmt.Println(\"names: \", cfg.SectionStrings()) åˆ›å»ºä¹‹åè°ƒç”¨SectionStringsæ–¹æ³•ï¼Œæ–°åˆ†åŒºä¹Ÿä¼šè¿”å›ï¼š names: [DEFAULT mysql redis new] ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªæ–°åˆ†åŒºï¼Œå¦‚æœåˆ†åŒºå·²å­˜åœ¨ï¼Œåˆ™è¿”å›é”™è¯¯ï¼š err := cfg.NewSection(\"new\") çˆ¶å­åˆ†åŒº åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å ä½ç¬¦%(name)sè¡¨ç¤ºç”¨ä¹‹å‰å·²å®šä¹‰çš„é”®nameçš„å€¼æ¥æ›¿æ¢ï¼Œè¿™é‡Œçš„sè¡¨ç¤ºå€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼š NAME = ini VERSION = v1 IMPORT_PATH = gopkg.in/%(NAME)s.%(VERSION)s [package] CLONE_URL = https://%(IMPORT_PATH)s [package.sub] ä¸Šé¢åœ¨é»˜è®¤åˆ†åŒºä¸­è®¾ç½®IMPORT_PATHçš„å€¼æ—¶ï¼Œä½¿ç”¨äº†å‰é¢å®šä¹‰çš„NAMEå’ŒVERSIONã€‚ åœ¨packageåˆ†åŒºä¸­è®¾ç½®CLONE_URLçš„å€¼æ—¶ï¼Œä½¿ç”¨äº†é»˜è®¤åˆ†åŒºä¸­å®šä¹‰çš„IMPORT_PATHã€‚ æˆ‘ä»¬è¿˜å¯ä»¥åœ¨åˆ†åŒºåä¸­ä½¿ç”¨.è¡¨ç¤ºä¸¤ä¸ªæˆ–å¤šä¸ªåˆ†åŒºä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼Œä¾‹å¦‚package.subçš„çˆ¶åˆ†åŒºä¸ºpackageï¼Œpackageçš„çˆ¶åˆ†åŒºä¸ºé»˜è®¤åˆ†åŒºã€‚ å¦‚æœæŸä¸ªé”®åœ¨å­åˆ†åŒºä¸­ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåœ¨å®ƒçš„çˆ¶åˆ†åŒºä¸­å†æ¬¡æŸ¥æ‰¾ï¼Œç›´åˆ°æ²¡æœ‰çˆ¶åˆ†åŒºä¸ºæ­¢ï¼š cfg, err := ini.Load(\"parent_child.ini\") if err != nil { fmt.Println(\"Fail to read file: \", err) return } fmt.Println(\"Clone url from package.sub:\", cfg.Section(\"package.sub\").Key(\"CLONE_URL\").String()) è¿è¡Œç¨‹åºè¾“å‡ºï¼š Clone url from package.sub: https://gopkg.in/ini.v1 å­åˆ†åŒºä¸­package.subä¸­æ²¡æœ‰é”®CLONE_URLï¼Œè¿”å›äº†çˆ¶åˆ†åŒºpackageä¸­çš„å€¼ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:4","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ä¿å­˜é…ç½® æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†ç”Ÿæˆçš„é…ç½®å†™åˆ°æ–‡ä»¶ä¸­ã€‚ä¾‹å¦‚åœ¨å†™å·¥å…·çš„æ—¶å€™ã€‚ä¿å­˜æœ‰ä¸¤ç§ç±»å‹çš„æ¥å£ï¼Œä¸€ç§ç›´æ¥ä¿å­˜åˆ°æ–‡ä»¶ï¼Œå¦ä¸€ç§å†™å…¥åˆ°io.Writerä¸­ï¼š err = cfg.SaveTo(\"my.ini\") err = cfg.SaveToIndent(\"my.ini\", \"\\t\") cfg.WriteTo(writer) cfg.WriteToIndent(writer, \"\\t\") ä¸‹é¢æˆ‘ä»¬é€šè¿‡ç¨‹åºç”Ÿæˆå‰é¢ä½¿ç”¨çš„é…ç½®æ–‡ä»¶my.iniå¹¶ä¿å­˜ï¼š package main import ( \"fmt\" \"os\" \"gopkg.in/ini.v1\" ) func main() { cfg := ini.Empty() defaultSection := cfg.Section(\"\") defaultSection.NewKey(\"app_name\", \"awesome web\") defaultSection.NewKey(\"log_level\", \"DEBUG\") mysqlSection, err := cfg.NewSection(\"mysql\") if err != nil { fmt.Println(\"new mysql section failed:\", err) return } mysqlSection.NewKey(\"ip\", \"127.0.0.1\") mysqlSection.NewKey(\"port\", \"3306\") mysqlSection.NewKey(\"user\", \"root\") mysqlSection.NewKey(\"password\", \"123456\") mysqlSection.NewKey(\"database\", \"awesome\") redisSection, err := cfg.NewSection(\"redis\") if err != nil { fmt.Println(\"new redis section failed:\", err) return } redisSection.NewKey(\"ip\", \"127.0.0.1\") redisSection.NewKey(\"port\", \"6381\") err = cfg.SaveTo(\"my.ini\") if err != nil { fmt.Println(\"SaveTo failed: \", err) } err = cfg.SaveToIndent(\"my-pretty.ini\", \"\\t\") if err != nil { fmt.Println(\"SaveToIndent failed: \", err) } cfg.WriteTo(os.Stdout) fmt.Println() cfg.WriteToIndent(os.Stdout, \"\\t\") } è¿è¡Œç¨‹åºï¼Œç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶my.iniå’Œmy-pretty.iniï¼ŒåŒæ—¶æ§åˆ¶å°è¾“å‡ºæ–‡ä»¶å†…å®¹ã€‚ my.iniï¼š app_name = awesome web log_level = DEBUG [mysql] ip = 127.0.0.1 port = 3306 user = root password = 123456 database = awesome [redis] ip = 127.0.0.1 port = 6381 my-pretty.iniï¼š app_name = awesome web log_level = DEBUG [mysql] ip = 127.0.0.1 port = 3306 user = root password = 123456 database = awesome [redis] ip = 127.0.0.1 port = 6381 *Indentæ–¹æ³•ä¼šå¯¹å­åˆ†åŒºä¸‹çš„é”®å¢åŠ ç¼©è¿›ï¼Œçœ‹èµ·æ¥ç¾è§‚ä¸€ç‚¹ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:5","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"åˆ†åŒºä¸ç»“æ„ä½“å­—æ®µæ˜ å°„ å®šä¹‰ç»“æ„å˜é‡ï¼ŒåŠ è½½å®Œé…ç½®æ–‡ä»¶åï¼Œè°ƒç”¨MapToå°†é…ç½®é¡¹èµ‹å€¼åˆ°ç»“æ„å˜é‡çš„å¯¹åº”å­—æ®µä¸­ã€‚ package main import ( \"fmt\" \"gopkg.in/ini.v1\" ) type Config struct { AppName string `ini:\"app_name\"` LogLevel string `ini:\"log_level\"` MySQL MySQLConfig `ini:\"mysql\"` Redis RedisConfig `ini:\"redis\"` } type MySQLConfig struct { IP string `ini:\"ip\"` Port int `ini:\"port\"` User string `ini:\"user\"` Password string `ini:\"password\"` Database string `ini:\"database\"` } type RedisConfig struct { IP string `ini:\"ip\"` Port int `ini:\"port\"` } func main() { cfg, err := ini.Load(\"my.ini\") if err != nil { fmt.Println(\"load my.ini failed: \", err) } c := Config{} cfg.MapTo(\u0026c) fmt.Println(c) } MapToå†…éƒ¨ä½¿ç”¨äº†åå°„ï¼Œæ‰€ä»¥ç»“æ„ä½“å­—æ®µå¿…é¡»éƒ½æ˜¯å¯¼å‡ºçš„ã€‚å¦‚æœé”®åä¸å­—æ®µåä¸ç›¸åŒï¼Œé‚£ä¹ˆéœ€è¦åœ¨ç»“æ„æ ‡ç­¾ä¸­æŒ‡å®šå¯¹åº”çš„é”®åã€‚ è¿™ä¸€ç‚¹ä¸ Go æ ‡å‡†åº“encoding/jsonå’Œencoding/xmlä¸åŒã€‚æ ‡å‡†åº“json/xmlè§£ææ—¶å¯ä»¥å°†é”®åapp_nameå¯¹åº”åˆ°å­—æ®µåAppNameã€‚ æˆ–è®¸è¿™æ˜¯go-iniåº“å¯ä»¥ä¼˜åŒ–çš„ç‚¹ï¼Ÿ å…ˆåŠ è½½ï¼Œå†æ˜ å°„æœ‰ç‚¹ç¹çï¼Œç›´æ¥ä½¿ç”¨ini.MapToå°†ä¸¤æ­¥åˆå¹¶ï¼š err = ini.MapTo(\u0026c, \"my.ini\") å¤åˆ¶ä»£ç  ä¹Ÿå¯ä»¥åªæ˜ å°„ä¸€ä¸ªåˆ†åŒºï¼š mysqlCfg := MySQLConfig{} err = cfg.Section(\"mysql\").MapTo(\u0026mysqlCfg) è¿˜å¯ä»¥é€šè¿‡ç»“æ„ä½“ç”Ÿæˆé…ç½®ï¼š cfg := ini.Empty() c := Config { AppName: \"awesome web\", LogLevel: \"DEBUG\", MySQL: MySQLConfig { IP: \"127.0.0.1\", Port: 3306, User: \"root\", Password:\"123456\", Database:\"awesome\", }, Redis: RedisConfig { IP: \"127.0.0.1\", Port: 6381, }, } err := ini.ReflectFrom(cfg, \u0026c) if err != nil { fmt.Println(\"ReflectFrom failed: \", err) return } err = cfg.SaveTo(\"my-copy.ini\") if err != nil { fmt.Println(\"SaveTo failed: \", err) return } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:6","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ€»ç»“ æœ¬æ–‡ä»‹ç»äº†go-iniåº“çš„åŸºæœ¬ç”¨æ³•å’Œä¸€äº›æœ‰è¶£çš„ç‰¹æ€§ã€‚ç¤ºä¾‹ä»£ç å·²ä¸Šä¼ GitHubã€‚ å…¶å®go-iniè¿˜æœ‰å¾ˆå¤šé«˜çº§ç‰¹æ€§ã€‚å®˜æ–¹æ–‡æ¡£éå¸¸è¯¦ç»†ï¼Œæ¨èå»çœ‹ï¼Œè€Œä¸”æœ‰ä¸­æ–‡å“Ÿ~ ä½œè€…æ— é—»ï¼Œç›¸ä¿¡åš Go å¼€å‘çš„éƒ½ä¸é™Œç”Ÿã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:7","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å‚è€ƒ go-ini GitHub ä»“åº“ go-ini å®˜æ–¹æ–‡æ¡£ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-ini/:1:8","tags":["Go","ini"],"title":"Go ini","uri":"/posts/2023-11-11-go-ini/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"homedirå®¶ç›®å½• GitHubåœ°å€ï¼šhttps://github.com/mitchellh/go-homedir ä½¿ç”¨os/userè·å–ç”¨æˆ·å®¶ç›®å½•ï¼š package main import ( \"fmt\" \"log\" \"os/user\" ) func main() { u, err := user.Current() if err != nil { log.Fatal(err) } fmt.Println(\"Home dir:\", u.HomeDir) } é‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦go-homediråº“ï¼Ÿ åœ¨ Darwin ç³»ç»Ÿä¸Šï¼Œæ ‡å‡†åº“os/userçš„ä½¿ç”¨éœ€è¦ cgoã€‚æ‰€ä»¥ï¼Œä»»ä½•ä½¿ç”¨os/userçš„ä»£ç éƒ½ä¸èƒ½äº¤å‰ç¼–è¯‘ã€‚ ä½†æ˜¯ï¼Œå¤§å¤šæ•°äººä½¿ç”¨os/userçš„ç›®çš„ä»…ä»…åªæ˜¯æƒ³è·å–ä¸»ç›®å½•ã€‚å› æ­¤ï¼Œgo-homediråº“å‡ºç°äº†ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-homedir/:1:0","tags":["Go","homedir"],"title":"Go homedir","uri":"/posts/2023-11-11-go-homedir/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å¿«é€Ÿä½¿ç”¨ go-homediræ˜¯ç¬¬ä¸‰æ–¹åŒ…ï¼Œä½¿ç”¨å‰éœ€è¦å…ˆå®‰è£…ï¼š $ go get github.com/mitchellh/go-homedir ä½¿ç”¨éå¸¸ç®€å•ï¼š package main import ( \"fmt\" \"log\" \"github.com/mitchellh/go-homedir\" ) func main() { dir, err := homedir.Dir() if err != nil { log.Fatal(err) } fmt.Println(\"Home dir:\", dir) dir = \"~/golang/src\" expandedDir, err := homedir.Expand(dir) if err != nil { log.Fatal(err) } fmt.Printf(\"Expand of %s is: %s\\n\", dir, expandedDir) } go-homediræœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼š Dirï¼šè·å–ç”¨æˆ·ä¸»ç›®å½•ï¼› Expandï¼šå°†è·¯å¾„ä¸­çš„ç¬¬ä¸€ä¸ª~æ‰©å±•æˆç”¨æˆ·ä¸»ç›®å½•ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-homedir/:1:1","tags":["Go","homedir"],"title":"Go homedir","uri":"/posts/2023-11-11-go-homedir/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"é«˜çº§ç”¨æ³• ç”±äºDirçš„è°ƒç”¨å¯èƒ½æ¶‰åŠä¸€äº›ç³»ç»Ÿè°ƒç”¨å’Œå¤–éƒ¨æ‰§è¡Œå‘½ä»¤ï¼Œå¤šæ¬¡è°ƒç”¨è´¹æ€§èƒ½ã€‚æ‰€ä»¥go-homediræä¾›äº†ç¼“å­˜çš„åŠŸèƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜æ˜¯å¼€å¯çš„ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†DisableCacheè®¾ç½®ä¸ºfalseæ¥å…³é—­å®ƒã€‚ package main import ( \"fmt\" \"log\" \"github.com/mitchellh/go-homedir\" ) func main() { homedir.DisableCache = false dir, err := homedir.Dir() if err != nil { log.Fatal(err) } fmt.Println(\"Home dir:\", dir) } ä½¿ç”¨ç¼“å­˜æ—¶ï¼Œå¦‚æœç¨‹åºè¿è¡Œä¸­ä¿®æ”¹äº†ä¸»ç›®å½•ï¼Œå†æ¬¡è°ƒç”¨Dirè¿˜æ˜¯è¿”å›ä¹‹å‰çš„ç›®å½•ã€‚å¦‚æœéœ€è¦è·å–æœ€æ–°çš„ä¸»ç›®å½•ï¼Œå¯ä»¥å…ˆè°ƒç”¨Resetæ¸…é™¤ç¼“å­˜ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-homedir/:1:2","tags":["Go","homedir"],"title":"Go homedir","uri":"/posts/2023-11-11-go-homedir/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å®ç° go-homediræºç åªæœ‰ä¸€ä¸ªæ–‡ä»¶homedir.goï¼Œä»Šå¤©æˆ‘ä»¬å¤§æ¦‚çœ‹ä¸€ä¸‹Dirçš„å®ç°ï¼Œå»æ‰ç¼“å­˜ç›¸å…³ä»£ç ï¼š func Dir() (string, error) { var result string var err error if runtime.GOOS == \"windows\" { result, err = dirWindows() } else { // Unix-like system, so just assume Unix result, err = dirUnix() } if err != nil { return \"\", err } return result, nil } åˆ¤æ–­å½“å‰çš„ç³»ç»Ÿæ˜¯windowsè¿˜æ˜¯ç±» Unixï¼Œåˆ†åˆ«è°ƒç”¨ä¸åŒçš„æ–¹æ³•ã€‚å…ˆçœ‹ windows çš„ï¼Œæ¯”è¾ƒç®€å•ï¼š func dirWindows() (string, error) { // First prefer the HOME environmental variable if home := os.Getenv(\"HOME\"); home != \"\" { return home, nil } // Prefer standard environment variable USERPROFILE if home := os.Getenv(\"USERPROFILE\"); home != \"\" { return home, nil } drive := os.Getenv(\"HOMEDRIVE\") path := os.Getenv(\"HOMEPATH\") home := drive + path if drive == \"\" || path == \"\" { return \"\", errors.New(\"HOMEDRIVE, HOMEPATH, or USERPROFILE are blank\") } return home, nil } æµç¨‹å¦‚ä¸‹ï¼š è¯»å–ç¯å¢ƒå˜é‡HOMEï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œè¿”å›è¿™ä¸ªå€¼ï¼› è¯»å–ç¯å¢ƒå˜é‡USERPROFILEï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œè¿”å›è¿™ä¸ªå€¼ï¼› è¯»å–ç¯å¢ƒå˜é‡HOMEDRIVEå’ŒHOMEPATHï¼Œå¦‚æœä¸¤è€…éƒ½ä¸ä¸ºç©ºï¼Œæ‹¼æ¥è¿™ä¸¤ä¸ªå€¼è¿”å›ã€‚ ç±» Unix ç³»ç»Ÿçš„å®ç°ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼š func dirUnix() (string, error) { homeEnv := \"HOME\" if runtime.GOOS == \"plan9\" { // On plan9, env vars are lowercase. homeEnv = \"home\" } // First prefer the HOME environmental variable if home := os.Getenv(homeEnv); home != \"\" { return home, nil } var stdout bytes.Buffer // If that fails, try OS specific commands if runtime.GOOS == \"darwin\" { cmd := exec.Command(\"sh\", \"-c\", `dscl -q . -read /Users/\"$(whoami)\" NFSHomeDirectory | sed 's/^[^ ]*: //'`) cmd.Stdout = \u0026stdout if err := cmd.Run(); err == nil { result := strings.TrimSpace(stdout.String()) if result != \"\" { return result, nil } } } else { cmd := exec.Command(\"getent\", \"passwd\", strconv.Itoa(os.Getuid())) cmd.Stdout = \u0026stdout if err := cmd.Run(); err != nil { // If the error is ErrNotFound, we ignore it. Otherwise, return it. if err != exec.ErrNotFound { return \"\", err } } else { if passwd := strings.TrimSpace(stdout.String()); passwd != \"\" { // username:password:uid:gid:gecos:home:shell passwdParts := strings.SplitN(passwd, \":\", 7) if len(passwdParts) \u003e 5 { return passwdParts[5], nil } } } } // If all else fails, try the shell stdout.Reset() cmd := exec.Command(\"sh\", \"-c\", \"cd \u0026\u0026 pwd\") cmd.Stdout = \u0026stdout if err := cmd.Run(); err != nil { return \"\", err } result := strings.TrimSpace(stdout.String()) if result == \"\" { return \"\", errors.New(\"blank output when reading home directory\") } return result, nil } æµç¨‹å¦‚ä¸‹ï¼š å…ˆè¯»å–ç¯å¢ƒå˜é‡HOMEï¼ˆæ³¨æ„ plan9 ç³»ç»Ÿä¸Šä¸ºhomeï¼‰ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œè¿”å›è¿™ä¸ªå€¼ï¼› ä½¿ç”¨getnetå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿçš„æ•°æ®åº“ä¸­çš„ç›¸å…³è®°å½•ï¼Œæˆ‘ä»¬çŸ¥é“passwdæ–‡ä»¶ä¸­å­˜å‚¨äº†ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚ä½¿ç”¨getentå‘½ä»¤æŸ¥çœ‹passwdä¸­å½“å‰ç”¨æˆ·çš„é‚£æ¡è®°å½•ï¼Œç„¶åä»ä¸­æ‰¾åˆ°ä¸»ç›®å½•éƒ¨åˆ†è¿”å›ï¼› å¦‚æœä¸Šä¸€ä¸ªæ­¥éª¤å¤±è´¥äº†ï¼Œæˆ‘ä»¬çŸ¥é“cdåä¸åŠ å‚æ•°æ˜¯ç›´æ¥åˆ‡æ¢åˆ°ç”¨æˆ·ä¸»ç›®å½•çš„ï¼Œè€Œpwdå¯ä»¥æ˜¾ç¤ºå½“å‰ç›®å½•ã€‚é‚£ä¹ˆå°±å¯ä»¥ç»“åˆè¿™ä¸¤ä¸ªå‘½ä»¤è¿”å›ä¸»ç›®å½•ã€‚ è¿™é‡Œåˆ†ææºç å¹¶ä¸æ˜¯è¡¨ç¤ºä½¿ç”¨ä»»ä½•åº“éƒ½è¦ç†Ÿæ‚‰å®ƒçš„æºç ï¼Œæ¯•ç«Ÿä½¿ç”¨åº“å°±æ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘ã€‚ ä½†æ˜¯æºç æ˜¯æˆ‘ä»¬å­¦ä¹ å’Œæé«˜çš„ä¸€ä¸ªéå¸¸é‡è¦çš„é€”å¾„ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨åº“é‡åˆ°é—®é¢˜çš„æ—¶å€™ä¹Ÿè¦æœ‰èƒ½åŠ›ä»æ–‡æ¡£æˆ–ç”šè‡³æºç ä¸­æŸ¥æ‰¾åŸå› ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-homedir/:1:3","tags":["Go","homedir"],"title":"Go homedir","uri":"/posts/2023-11-11-go-homedir/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go Fsnotifyåº“ å®˜æ–¹ä»“åº“ï¼šgithub.com/fsnotify/fsnotify ç”¨äºç›‘æ§æ–‡ä»¶æˆ–ç›®å½•çš„æ”¹å˜ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fsnotify/:1:0","tags":["Go","fsnotify"],"title":"Go fsnotify","uri":"/posts/2023-11-11-go-fsnotify/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"1ã€å®˜ç½‘ç¤ºä¾‹ package main import ( \"log\" \"github.com/fsnotify/fsnotify\" ) func main() { watcher, err := fsnotify.NewWatcher() if err != nil { log.Fatal(err) } defer watcher.Close() done := make(chan bool) go func() { for { select { case event := \u003c-watcher.Events: log.Println(\"event:\", event) if event.Op\u0026fsnotify.Write == fsnotify.Write { log.Println(\"modified file:\", event.Name) } case err := \u003c-watcher.Errors: log.Println(\"error:\", err) } } }() err = watcher.Add(\"/tmp/foo\") if err != nil { log.Fatal(err) } \u003c-done } fsnotifyçš„ä½¿ç”¨æ¯”è¾ƒç®€å•: å…ˆæ¡ç”¨NewWatcheråˆ›å»ºä¸€ä¸ªç›‘å¬å™¨ ç„¶åæ¡ç”¨ç›‘å¬å™¨çš„Addç›‘å¬æ–‡ä»¶æˆ–ç›®å½• å¦‚æœç›®å½•æˆ–æ–‡ä»¶æœ‰äº‹ä»¶å‘ç”Ÿï¼Œç›‘å¬å™¨çš„é€šé“Eventså¯ä»¥å–å‡ºäº‹ä»¶ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼Œç›‘å¬å™¨ä¸­çš„é€šé“Errorså¯ä»¥å–å‡ºé”™è¯¯ä¿¡æ¯ã€‚ å…¶å®ï¼Œé‡å‘½åæ—¶ä¼šäº§ç”Ÿä¸¤ä¸ªäº‹ä»¶ï¼Œä¸€ä¸ªæ˜¯åŸæ–‡ä»¶çš„RENAMEäº‹ä»¶ï¼Œä¸€ä¸ªæ˜¯æ–°æ–‡ä»¶çš„CREATEäº‹ä»¶ã€‚ æ³¨æ„ï¼Œfsnotifyä½¿ç”¨äº†æ“ä½œç³»ç»Ÿæ¥å£ï¼Œç›‘å¬å™¨ä¸­ä¿å­˜äº†ç³»ç»Ÿèµ„æºçš„å¥æŸ„ï¼Œæ‰€ä»¥ä½¿ç”¨åéœ€è¦å…³é—­ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fsnotify/:1:1","tags":["Go","fsnotify"],"title":"Go fsnotify","uri":"/posts/2023-11-11-go-fsnotify/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"2ã€äº‹ä»¶ ä¸Šé¢ç¤ºä¾‹ä¸­çš„äº‹ä»¶æ˜¯fsnotify.Eventç±»å‹ï¼š // fsnotify/fsnotify.go type Event struct { Name string Op Op } äº‹ä»¶åªæœ‰ä¸¤ä¸ªå­—æ®µï¼ŒNameè¡¨ç¤ºå‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶æˆ–ç›®å½•åï¼ŒOpè¡¨ç¤ºå…·ä½“çš„å˜åŒ–ã€‚Opæœ‰ 5 ä¸­å–å€¼ï¼š // fsnotify/fsnotify.go type Op uint32 const ( Create Op = 1 \u003c\u003c iota Write Remove Rename Chmod ) 3ã€ç›‘æ§ç›®å½• å‚è€ƒé“¾æ¥ï¼šhttps://blog.csdn.net/finghting321/article/details/102852746 package main; import ( \"github.com/fsnotify/fsnotify\" \"fmt\" \"path/filepath\" \"os\" ) type NotifyFile struct { watch *fsnotify.Watcher } func NewNotifyFile() *NotifyFile { w := new(NotifyFile) w.watch, _ = fsnotify.NewWatcher() return w } //ç›‘æ§ç›®å½• func (this *NotifyFile) WatchDir(dir string) { //é€šè¿‡Walkæ¥éå†ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½• filepath.Walk(dir, func(path string, info os.FileInfo, err error) error { //åˆ¤æ–­æ˜¯å¦ä¸ºç›®å½•ï¼Œç›‘æ§ç›®å½•,ç›®å½•ä¸‹æ–‡ä»¶ä¹Ÿåœ¨ç›‘æ§èŒƒå›´å†…ï¼Œä¸éœ€è¦åŠ  if info.IsDir() { path, err := filepath.Abs(path) if err != nil { return err } err = this.watch.Add(path) if err != nil { return err } fmt.Println(\"ç›‘æ§ : \", path) } return nil }) go this.WatchEvent() //åç¨‹ } func (this *NotifyFile) WatchEvent() { for { select { case ev := \u003c-this.watch.Events: { if ev.Op\u0026fsnotify.Create == fsnotify.Create { fmt.Println(\"åˆ›å»ºæ–‡ä»¶ : \", ev.Name) //è·å–æ–°åˆ›å»ºæ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ç›®å½•ï¼Œåˆ™åŠ å…¥ç›‘æ§ä¸­ file, err := os.Stat(ev.Name) if err == nil \u0026\u0026 file.IsDir() { this.watch.Add(ev.Name) fmt.Println(\"æ·»åŠ ç›‘æ§ : \", ev.Name) } } if ev.Op\u0026fsnotify.Write == fsnotify.Write { //fmt.Println(\"å†™å…¥æ–‡ä»¶ : \", ev.Name) } if ev.Op\u0026fsnotify.Remove == fsnotify.Remove { fmt.Println(\"åˆ é™¤æ–‡ä»¶ : \", ev.Name) //å¦‚æœåˆ é™¤æ–‡ä»¶æ˜¯ç›®å½•ï¼Œåˆ™ç§»é™¤ç›‘æ§ fi, err := os.Stat(ev.Name) if err == nil \u0026\u0026 fi.IsDir() { this.watch.Remove(ev.Name) fmt.Println(\"åˆ é™¤ç›‘æ§ : \", ev.Name) } } if ev.Op\u0026fsnotify.Rename == fsnotify.Rename { //å¦‚æœé‡å‘½åæ–‡ä»¶æ˜¯ç›®å½•ï¼Œåˆ™ç§»é™¤ç›‘æ§ ,æ³¨æ„è¿™é‡Œæ— æ³•ä½¿ç”¨os.Statæ¥åˆ¤æ–­æ˜¯å¦æ˜¯ç›®å½•äº† //å› ä¸ºé‡å‘½ååï¼Œgoå·²ç»æ— æ³•æ‰¾åˆ°åŸæ–‡ä»¶æ¥è·å–ä¿¡æ¯äº†,æ‰€ä»¥ç®€å•ç²—çˆ†ç›´æ¥remove fmt.Println(\"é‡å‘½åæ–‡ä»¶ : \", ev.Name) this.watch.Remove(ev.Name) } if ev.Op\u0026fsnotify.Chmod == fsnotify.Chmod { fmt.Println(\"ä¿®æ”¹æƒé™ : \", ev.Name) } } case err := \u003c-this.watch.Errors: { fmt.Println(\"error : \", err) return } } } func main() { watch := FSNotify.NewNotifyFile() watch.WatchDir(\"G:\\\\Ferry\") select {} return } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fsnotify/:1:2","tags":["Go","fsnotify"],"title":"Go fsnotify","uri":"/posts/2023-11-11-go-fsnotify/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go fmtæ¨¡å— å‚è€ƒé“¾æ¥ï¼šhttps://www.liwenzhou.com/posts/Go/go_fmt/ fmt fmtåŒ…å®ç°äº†ç±»ä¼¼Cè¯­è¨€printfå’Œscanfçš„æ ¼å¼åŒ–I/Oã€‚ä¸»è¦åˆ†ä¸ºå‘å¤–è¾“å‡ºå†…å®¹å’Œè·å–è¾“å…¥å†…å®¹ä¸¤å¤§éƒ¨åˆ†ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fmt/:1:0","tags":["Go","fmt"],"title":"Go fmt","uri":"/posts/2023-11-11-go-fmt/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å‘å¤–è¾“å‡º æ ‡å‡†åº“fmtæä¾›äº†ä»¥ä¸‹å‡ ç§è¾“å‡ºç›¸å…³å‡½æ•°ã€‚ Print Printç³»åˆ—å‡½æ•°ä¼šå°†å†…å®¹è¾“å‡ºåˆ°ç³»ç»Ÿçš„æ ‡å‡†è¾“å‡ºï¼ŒåŒºåˆ«åœ¨äºPrintå‡½æ•°ç›´æ¥è¾“å‡ºå†…å®¹ï¼ŒPrintfå‡½æ•°æ”¯æŒæ ¼å¼åŒ–è¾“å‡ºå­—ç¬¦ä¸²ï¼ŒPrintlnå‡½æ•°ä¼šåœ¨è¾“å‡ºå†…å®¹çš„ç»“å°¾æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ func Print(a ...interface{}) (n int, err error) func Printf(format string, a ...interface{}) (n int, err error) func Println(a ...interface{}) (n int, err error) ä¾‹å¦‚ï¼š func main() { fmt.Print(\"åœ¨ç»ˆç«¯æ‰“å°è¯¥ä¿¡æ¯ã€‚\") name := \"æ²™æ²³å°ç‹å­\" fmt.Printf(\"æˆ‘æ˜¯ï¼š%s\\n\", name) fmt.Println(\"åœ¨ç»ˆç«¯æ‰“å°å•ç‹¬ä¸€è¡Œæ˜¾ç¤º\") } è¾“å‡ºç»“æœï¼š åœ¨ç»ˆç«¯æ‰“å°è¯¥ä¿¡æ¯ã€‚æˆ‘æ˜¯ï¼šæ²™æ²³å°ç‹å­ åœ¨ç»ˆç«¯æ‰“å°å•ç‹¬ä¸€è¡Œæ˜¾ç¤º Fprint Fprintç³»åˆ—å‡½æ•°ä¼šå°†å†…å®¹è¾“å‡ºåˆ°ä¸€ä¸ªio.Writeræ¥å£ç±»å‹çš„å˜é‡wä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨è¿™ä¸ªå‡½æ•°å¾€æ–‡ä»¶ä¸­å†™å…¥å†…å®¹ã€‚ func Fprint(w io.Writer, a ...interface{}) (n int, err error) func Fprintf(w io.Writer, format string, a ...interface{}) (n int, err error) func Fprintln(w io.Writer, a ...interface{}) (n int, err error) ä¾‹å¦‚ï¼š // å‘æ ‡å‡†è¾“å‡ºå†™å…¥å†…å®¹ fmt.Fprintln(os.Stdout, \"å‘æ ‡å‡†è¾“å‡ºå†™å…¥å†…å®¹\") fileObj, err := os.OpenFile(\"./xx.txt\", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0644) if err != nil { fmt.Println(\"æ‰“å¼€æ–‡ä»¶å‡ºé”™ï¼Œerr:\", err) return } name := \"æ²™æ²³å°ç‹å­\" // å‘æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ä¸­å†™å…¥å†…å®¹ fmt.Fprintf(fileObj, \"å¾€æ–‡ä»¶ä¸­å†™å¦‚ä¿¡æ¯ï¼š%s\", name) Sprint Sprintç³»åˆ—å‡½æ•°ä¼šæŠŠä¼ å…¥çš„æ•°æ®ç”Ÿæˆå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ func Sprint(a ...interface{}) string func Sprintf(format string, a ...interface{}) string func Sprintln(a ...interface{}) string ç¤ºä¾‹ï¼š s1 := fmt.Sprint(\"æ²™æ²³å°ç‹å­\") name := \"æ²™æ²³å°ç‹å­\" age := 18 s2 := fmt.Sprintf(\"name:%s,age:%d\", name, age) s3 := fmt.Sprintln(\"æ²™æ²³å°ç‹å­\") fmt.Println(s1, s2, s3) Errorf Errorfå‡½æ•°æ ¹æ®formatå‚æ•°ç”Ÿæˆæ ¼å¼åŒ–å­—ç¬¦ä¸²å¹¶è¿”å›ä¸€ä¸ªåŒ…å«è¯¥å­—ç¬¦ä¸²çš„é”™è¯¯ã€‚ func Errorf(format string, a ...interface{}) error é€šå¸¸ä½¿ç”¨è¿™ç§æ–¹å¼æ¥è‡ªå®šä¹‰é”™è¯¯ç±»å‹ï¼Œä¾‹å¦‚ï¼š err := fmt.Errorf(\"è¿™æ˜¯ä¸€ä¸ªé”™è¯¯\") Go1.13ç‰ˆæœ¬ä¸ºfmt.Errorfå‡½æ•°æ–°åŠ äº†ä¸€ä¸ª%wå ä½ç¬¦ç”¨æ¥ç”Ÿæˆä¸€ä¸ªå¯ä»¥åŒ…è£¹Errorçš„Wrapping Errorã€‚ e := errors.New(\"åŸå§‹é”™è¯¯e\") w := fmt.Errorf(\"Wrapäº†ä¸€ä¸ªé”™è¯¯%w\", e) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fmt/:1:1","tags":["Go","fmt"],"title":"Go fmt","uri":"/posts/2023-11-11-go-fmt/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ ¼å¼åŒ–å ä½ç¬¦ *printfç³»åˆ—å‡½æ•°éƒ½æ”¯æŒformatæ ¼å¼åŒ–å‚æ•°ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æŒ‰ç…§å ä½ç¬¦å°†è¢«æ›¿æ¢çš„å˜é‡ç±»å‹åˆ’åˆ†ï¼Œæ–¹ä¾¿æŸ¥è¯¢å’Œè®°å¿†ã€‚ é€šç”¨å ä½ç¬¦ å ä½ç¬¦ è¯´æ˜ %v å€¼çš„é»˜è®¤æ ¼å¼è¡¨ç¤º %+v ç±»ä¼¼%vï¼Œä½†è¾“å‡ºç»“æ„ä½“æ—¶ä¼šæ·»åŠ å­—æ®µå %#v å€¼çš„Goè¯­æ³•è¡¨ç¤º %T æ‰“å°å€¼çš„ç±»å‹ %% ç™¾åˆ†å· ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š fmt.Printf(\"%v\\n\", 100) fmt.Printf(\"%v\\n\", false) o := struct{ name string }{\"å°ç‹å­\"} fmt.Printf(\"%v\\n\", o) fmt.Printf(\"%#v\\n\", o) fmt.Printf(\"%T\\n\", o) fmt.Printf(\"100%%\\n\") è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 100 false {å°ç‹å­} struct { name string }{name:\"å°ç‹å­\"} struct { name string } 100% å¸ƒå°”å‹ å ä½ç¬¦ è¯´æ˜ %t trueæˆ–false æ•´å‹ å ä½ç¬¦ è¯´æ˜ %b è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶ %c è¯¥å€¼å¯¹åº”çš„unicodeç å€¼ %d è¡¨ç¤ºä¸ºåè¿›åˆ¶ %o è¡¨ç¤ºä¸ºå…«è¿›åˆ¶ %x è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œä½¿ç”¨a-f %X è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œä½¿ç”¨A-F %U è¡¨ç¤ºä¸ºUnicodeæ ¼å¼ï¼šU+1234ï¼Œç­‰ä»·äºâ€U+%04Xâ€ %q è¯¥å€¼å¯¹åº”çš„å•å¼•å·æ‹¬èµ·æ¥çš„goè¯­æ³•å­—ç¬¦å­—é¢å€¼ï¼Œå¿…è¦æ—¶ä¼šé‡‡ç”¨å®‰å…¨çš„è½¬ä¹‰è¡¨ç¤º ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š n := 65 fmt.Printf(\"%b\\n\", n) fmt.Printf(\"%c\\n\", n) fmt.Printf(\"%d\\n\", n) fmt.Printf(\"%o\\n\", n) fmt.Printf(\"%x\\n\", n) fmt.Printf(\"%X\\n\", n) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 1000001 A 65 101 41 41 æµ®ç‚¹æ•°ä¸å¤æ•° å ä½ç¬¦ è¯´æ˜ %b æ— å°æ•°éƒ¨åˆ†ã€äºŒè¿›åˆ¶æŒ‡æ•°çš„ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-123456p-78 %e ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-1234.456e+78 %E ç§‘å­¦è®¡æ•°æ³•ï¼Œå¦‚-1234.456E+78 %f æœ‰å°æ•°éƒ¨åˆ†ä½†æ— æŒ‡æ•°éƒ¨åˆ†ï¼Œå¦‚123.456 %F ç­‰ä»·äº%f %g æ ¹æ®å®é™…æƒ…å†µé‡‡ç”¨%eæˆ–%fæ ¼å¼ï¼ˆä»¥è·å¾—æ›´ç®€æ´ã€å‡†ç¡®çš„è¾“å‡ºï¼‰ %G æ ¹æ®å®é™…æƒ…å†µé‡‡ç”¨%Eæˆ–%Fæ ¼å¼ï¼ˆä»¥è·å¾—æ›´ç®€æ´ã€å‡†ç¡®çš„è¾“å‡ºï¼‰ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š f := 12.34 fmt.Printf(\"%b\\n\", f) fmt.Printf(\"%e\\n\", f) fmt.Printf(\"%E\\n\", f) fmt.Printf(\"%f\\n\", f) fmt.Printf(\"%g\\n\", f) fmt.Printf(\"%G\\n\", f) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 6946802425218990p-49 1.234000e+01 1.234000E+01 12.340000 12.34 12.34 å­—ç¬¦ä¸²å’Œ[]byte å ä½ç¬¦ è¯´æ˜ %s ç›´æ¥è¾“å‡ºå­—ç¬¦ä¸²æˆ–è€…[]byte %q è¯¥å€¼å¯¹åº”çš„åŒå¼•å·æ‹¬èµ·æ¥çš„goè¯­æ³•å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œå¿…è¦æ—¶ä¼šé‡‡ç”¨å®‰å…¨çš„è½¬ä¹‰è¡¨ç¤º %x æ¯ä¸ªå­—èŠ‚ç”¨ä¸¤å­—ç¬¦åå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼ˆä½¿ç”¨a-f %X æ¯ä¸ªå­—èŠ‚ç”¨ä¸¤å­—ç¬¦åå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼ˆä½¿ç”¨A-Fï¼‰ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š s := \"å°ç‹å­\" fmt.Printf(\"%s\\n\", s) fmt.Printf(\"%q\\n\", s) fmt.Printf(\"%x\\n\", s) fmt.Printf(\"%X\\n\", s) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š å°ç‹å­ \"å°ç‹å­\" e5b08fe78e8be5ad90 E5B08FE78E8BE5AD90 æŒ‡é’ˆ å ä½ç¬¦ è¯´æ˜ %p è¡¨ç¤ºä¸ºåå…­è¿›åˆ¶ï¼Œå¹¶åŠ ä¸Šå‰å¯¼çš„0x ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š a := 10 fmt.Printf(\"%p\\n\", \u0026a) fmt.Printf(\"%#p\\n\", \u0026a) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 0xc000094000 c000094000 å®½åº¦æ ‡è¯†ç¬¦ å®½åº¦é€šè¿‡ä¸€ä¸ªç´§è·Ÿåœ¨ç™¾åˆ†å·åé¢çš„åè¿›åˆ¶æ•°æŒ‡å®šï¼Œå¦‚æœæœªæŒ‡å®šå®½åº¦ï¼Œåˆ™è¡¨ç¤ºå€¼æ—¶é™¤å¿…éœ€ä¹‹å¤–ä¸ä½œå¡«å……ã€‚ç²¾åº¦é€šè¿‡ï¼ˆå¯é€‰çš„ï¼‰å®½åº¦åè·Ÿç‚¹å·åè·Ÿçš„åè¿›åˆ¶æ•°æŒ‡å®šã€‚å¦‚æœæœªæŒ‡å®šç²¾åº¦ï¼Œä¼šä½¿ç”¨é»˜è®¤ç²¾åº¦ï¼›å¦‚æœç‚¹å·åæ²¡æœ‰è·Ÿæ•°å­—ï¼Œè¡¨ç¤ºç²¾åº¦ä¸º0ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š å ä½ç¬¦ è¯´æ˜ %f é»˜è®¤å®½åº¦ï¼Œé»˜è®¤ç²¾åº¦ %9f å®½åº¦9ï¼Œé»˜è®¤ç²¾åº¦ %.2f é»˜è®¤å®½åº¦ï¼Œç²¾åº¦2 %9.2f å®½åº¦9ï¼Œç²¾åº¦2 %9.f å®½åº¦9ï¼Œç²¾åº¦0 ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š n := 12.34 fmt.Printf(\"%f\\n\", n) fmt.Printf(\"%9f\\n\", n) fmt.Printf(\"%.2f\\n\", n) fmt.Printf(\"%9.2f\\n\", n) fmt.Printf(\"%9.f\\n\", n) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 12.340000 12.340000 12.34 12.34 12 å…¶ä»–falg å ä½ç¬¦ è¯´æ˜ â€™+â€™ æ€»æ˜¯è¾“å‡ºæ•°å€¼çš„æ­£è´Ÿå·ï¼›å¯¹%qï¼ˆ%+qï¼‰ä¼šç”Ÿæˆå…¨éƒ¨æ˜¯ASCIIå­—ç¬¦çš„è¾“å‡ºï¼ˆé€šè¿‡è½¬ä¹‰ï¼‰ï¼› â€™ â€˜ å¯¹æ•°å€¼ï¼Œæ­£æ•°å‰åŠ ç©ºæ ¼è€Œè´Ÿæ•°å‰åŠ è´Ÿå·ï¼›å¯¹å­—ç¬¦ä¸²é‡‡ç”¨%xæˆ–%Xæ—¶ï¼ˆ% xæˆ–% Xï¼‰ä¼šç»™å„æ‰“å°çš„å­—èŠ‚ä¹‹é—´åŠ ç©ºæ ¼ â€™-â€™ åœ¨è¾“å‡ºå³è¾¹å¡«å……ç©ºç™½è€Œä¸æ˜¯é»˜è®¤çš„å·¦è¾¹ï¼ˆå³ä»é»˜è®¤çš„å³å¯¹é½åˆ‡æ¢ä¸ºå·¦å¯¹é½ï¼‰ï¼› â€™#â€™ å…«è¿›åˆ¶æ•°å‰åŠ 0ï¼ˆ%#oï¼‰ï¼Œåå…­è¿›åˆ¶æ•°å‰åŠ 0xï¼ˆ%#xï¼‰æˆ–0Xï¼ˆ%#Xï¼‰ï¼ŒæŒ‡é’ˆå»æ‰å‰é¢çš„0xï¼ˆ%#pï¼‰å¯¹%qï¼ˆ%#qï¼‰ï¼Œå¯¹%Uï¼ˆ%#Uï¼‰ä¼šè¾“å‡ºç©ºæ ¼å’Œå•å¼•å·æ‹¬èµ·æ¥çš„goå­—é¢å€¼ï¼› â€˜0â€™ ä½¿ç”¨0è€Œä¸æ˜¯ç©ºæ ¼å¡«å……ï¼Œå¯¹äºæ•°å€¼ç±»å‹ä¼šæŠŠå¡«å……çš„0æ”¾åœ¨æ­£è´Ÿå·åé¢ï¼› ä¸¾ä¸ªä¾‹å­ï¼š s := \"å°ç‹å­\" fmt.Printf(\"%s\\n\", s) fmt.Printf(\"%5s\\n\", s) fmt.Printf(\"%-5s\\n\", s) fmt.Printf(\"%5.7s\\n\", s) fmt.Printf(\"%-5.7s\\n\", s) fmt.Printf(\"%5.2s\\n\", s) fmt.Printf(\"%05s\\n\", s) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š å°ç‹å­ å°ç‹å­ å°ç‹å­ å°ç‹å­ å°ç‹å­ å°ç‹ 00å°ç‹å­ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fmt/:1:2","tags":["Go","fmt"],"title":"Go fmt","uri":"/posts/2023-11-11-go-fmt/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"è·å–è¾“å…¥ Goè¯­è¨€fmtåŒ…ä¸‹æœ‰fmt.Scanã€fmt.Scanfã€fmt.Scanlnä¸‰ä¸ªå‡½æ•°ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä»æ ‡å‡†è¾“å…¥è·å–ç”¨æˆ·çš„è¾“å…¥ã€‚ fmt.Scan å‡½æ•°å®šç­¾åå¦‚ä¸‹ï¼š func Scan(a ...interface{}) (n int, err error) Scanä»æ ‡å‡†è¾“å…¥æ‰«ææ–‡æœ¬ï¼Œè¯»å–ç”±ç©ºç™½ç¬¦åˆ†éš”çš„å€¼ä¿å­˜åˆ°ä¼ é€’ç»™æœ¬å‡½æ•°çš„å‚æ•°ä¸­ï¼Œæ¢è¡Œç¬¦è§†ä¸ºç©ºç™½ç¬¦ã€‚ æœ¬å‡½æ•°è¿”å›æˆåŠŸæ‰«æçš„æ•°æ®ä¸ªæ•°å’Œé‡åˆ°çš„ä»»ä½•é”™è¯¯ã€‚å¦‚æœè¯»å–çš„æ•°æ®ä¸ªæ•°æ¯”æä¾›çš„å‚æ•°å°‘ï¼Œä¼šè¿”å›ä¸€ä¸ªé”™è¯¯æŠ¥å‘ŠåŸå› ã€‚ å…·ä½“ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š func main() { var ( name string age int married bool ) fmt.Scan(\u0026name, \u0026age, \u0026married) fmt.Printf(\"æ‰«æç»“æœ name:%s age:%d married:%t \\n\", name, age, married) } å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘ååœ¨ç»ˆç«¯æ‰§è¡Œï¼Œåœ¨ç»ˆç«¯ä¾æ¬¡è¾“å…¥å°ç‹å­ã€28å’Œfalseä½¿ç”¨ç©ºæ ¼åˆ†éš”ã€‚ $ ./scan_demo å°ç‹å­ 28 false æ‰«æç»“æœ name:å°ç‹å­ age:28 married:false fmt.Scanä»æ ‡å‡†è¾“å…¥ä¸­æ‰«æç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå°†ä»¥ç©ºç™½ç¬¦åˆ†éš”çš„æ•°æ®åˆ†åˆ«å­˜å…¥æŒ‡å®šçš„å‚æ•°ã€‚ fmt.Scanf å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š func Scanf(format string, a ...interface{}) (n int, err error) Scanfä»æ ‡å‡†è¾“å…¥æ‰«ææ–‡æœ¬ï¼Œæ ¹æ®formatå‚æ•°æŒ‡å®šçš„æ ¼å¼å»è¯»å–ç”±ç©ºç™½ç¬¦åˆ†éš”çš„å€¼ä¿å­˜åˆ°ä¼ é€’ç»™æœ¬å‡½æ•°çš„å‚æ•°ä¸­ã€‚ æœ¬å‡½æ•°è¿”å›æˆåŠŸæ‰«æçš„æ•°æ®ä¸ªæ•°å’Œé‡åˆ°çš„ä»»ä½•é”™è¯¯ã€‚ ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š func main() { var ( name string age int married bool ) fmt.Scanf(\"1:%s 2:%d 3:%t\", \u0026name, \u0026age, \u0026married) fmt.Printf(\"æ‰«æç»“æœ name:%s age:%d married:%t \\n\", name, age, married) } å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘ååœ¨ç»ˆç«¯æ‰§è¡Œï¼Œåœ¨ç»ˆç«¯æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼ä¾æ¬¡è¾“å…¥å°ç‹å­ã€28å’Œfalseã€‚ $ ./scan_demo 1:å°ç‹å­ 2:28 3:false æ‰«æç»“æœ name:å°ç‹å­ age:28 married:false fmt.Scanfä¸åŒäºfmt.Scanç®€å•çš„ä»¥ç©ºæ ¼ä½œä¸ºè¾“å…¥æ•°æ®çš„åˆ†éš”ç¬¦ï¼Œfmt.Scanfä¸ºè¾“å…¥æ•°æ®æŒ‡å®šäº†å…·ä½“çš„è¾“å…¥å†…å®¹æ ¼å¼ï¼Œåªæœ‰æŒ‰ç…§æ ¼å¼è¾“å…¥æ•°æ®æ‰ä¼šè¢«æ‰«æå¹¶å­˜å…¥å¯¹åº”å˜é‡ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§ä¸Šä¸ªç¤ºä¾‹ä¸­ä»¥ç©ºæ ¼åˆ†éš”çš„æ–¹å¼è¾“å…¥ï¼Œfmt.Scanfå°±ä¸èƒ½æ­£ç¡®æ‰«æåˆ°è¾“å…¥çš„æ•°æ®ã€‚ $ ./scan_demo å°ç‹å­ 28 false æ‰«æç»“æœ name: age:0 married:false fmt.Scanln å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š func Scanln(a ...interface{}) (n int, err error) Scanlnç±»ä¼¼Scanï¼Œå®ƒåœ¨é‡åˆ°æ¢è¡Œæ—¶æ‰åœæ­¢æ‰«æã€‚æœ€åä¸€ä¸ªæ•°æ®åé¢å¿…é¡»æœ‰æ¢è¡Œæˆ–è€…åˆ°è¾¾ç»“æŸä½ç½®ã€‚ æœ¬å‡½æ•°è¿”å›æˆåŠŸæ‰«æçš„æ•°æ®ä¸ªæ•°å’Œé‡åˆ°çš„ä»»ä½•é”™è¯¯ã€‚ å…·ä½“ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š func main() { var ( name string age int married bool ) fmt.Scanln(\u0026name, \u0026age, \u0026married) fmt.Printf(\"æ‰«æç»“æœ name:%s age:%d married:%t \\n\", name, age, married) } å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘ååœ¨ç»ˆç«¯æ‰§è¡Œï¼Œåœ¨ç»ˆç«¯ä¾æ¬¡è¾“å…¥å°ç‹å­ã€28å’Œfalseä½¿ç”¨ç©ºæ ¼åˆ†éš”ã€‚ $ ./scan_demo å°ç‹å­ 28 false æ‰«æç»“æœ name:å°ç‹å­ age:28 married:false fmt.Scanlné‡åˆ°å›è½¦å°±ç»“æŸæ‰«æäº†ï¼Œè¿™ä¸ªæ¯”è¾ƒå¸¸ç”¨ã€‚ bufio.NewReader æœ‰æ—¶å€™æˆ‘ä»¬æƒ³å®Œæ•´è·å–è¾“å…¥çš„å†…å®¹ï¼Œè€Œè¾“å…¥çš„å†…å®¹å¯èƒ½åŒ…å«ç©ºæ ¼ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨bufioåŒ…æ¥å®ç°ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š func bufioDemo() { reader := bufio.NewReader(os.Stdin) // ä»æ ‡å‡†è¾“å…¥ç”Ÿæˆè¯»å¯¹è±¡ fmt.Print(\"è¯·è¾“å…¥å†…å®¹ï¼š\") text, _ := reader.ReadString('\\n') // è¯»åˆ°æ¢è¡Œ text = strings.TrimSpace(text) fmt.Printf(\"%#v\\n\", text) } Fscanç³»åˆ— è¿™å‡ ä¸ªå‡½æ•°åŠŸèƒ½åˆ†åˆ«ç±»ä¼¼äºfmt.Scanã€fmt.Scanfã€fmt.Scanlnä¸‰ä¸ªå‡½æ•°ï¼Œåªä¸è¿‡å®ƒä»¬ä¸æ˜¯ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®è€Œæ˜¯ä»io.Readerä¸­è¯»å–æ•°æ®ã€‚ func Fscan(r io.Reader, a ...interface{}) (n int, err error) func Fscanln(r io.Reader, a ...interface{}) (n int, err error) func Fscanf(r io.Reader, format string, a ...interface{}) (n int, err error) Sscanç³»åˆ— è¿™å‡ ä¸ªå‡½æ•°åŠŸèƒ½åˆ†åˆ«ç±»ä¼¼äºfmt.Scanã€fmt.Scanfã€fmt.Scanlnä¸‰ä¸ªå‡½æ•°ï¼Œåªä¸è¿‡å®ƒä»¬ä¸æ˜¯ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®è€Œæ˜¯ä»æŒ‡å®šå­—ç¬¦ä¸²ä¸­è¯»å–æ•°æ®ã€‚ func Sscan(str string, a ...interface{}) (n int, err error) func Sscanln(str string, a ...interface{}) (n int, err error) func Sscanf(str string, format string, a ...interface{}) (n int, err error) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-fmt/:1:3","tags":["Go","fmt"],"title":"Go fmt","uri":"/posts/2023-11-11-go-fmt/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Goæ–‡ä»¶æ“ä½œ å‚è€ƒé“¾æ¥ï¼šhttps://www.liwenzhou.com/posts/Go/go_file/ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-file/:1:0","tags":["Go","file"],"title":"Go file","uri":"/posts/2023-11-11-go-file/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ–‡ä»¶ è®¡ç®—æœºä¸­çš„æ–‡ä»¶æ˜¯å­˜å‚¨åœ¨å¤–éƒ¨ä»‹è´¨ï¼ˆé€šå¸¸æ˜¯ç£ç›˜ï¼‰ä¸Šçš„æ•°æ®é›†åˆï¼Œæ–‡ä»¶åˆ†ä¸ºæ–‡æœ¬æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-file/:1:1","tags":["Go","file"],"title":"Go file","uri":"/posts/2023-11-11-go-file/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ–‡ä»¶æ‰“å¼€å’Œå…³é—­ os.Open()å‡½æ•°èƒ½å¤Ÿæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ª*Fileå’Œä¸€ä¸ªerrã€‚å¯¹å¾—åˆ°çš„æ–‡ä»¶å®ä¾‹è°ƒç”¨close()æ–¹æ³•èƒ½å¤Ÿå…³é—­æ–‡ä»¶ã€‚ package main import ( \"fmt\" \"os\" ) func main() { // åªè¯»æ–¹å¼æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„main.goæ–‡ä»¶ file, err := os.Open(\"./main.go\") if err != nil { fmt.Println(\"open file failed!, err:\", err) return } // å…³é—­æ–‡ä»¶ file.Close() } ä¸ºäº†é˜²æ­¢æ–‡ä»¶å¿˜è®°å…³é—­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨deferæ³¨å†Œæ–‡ä»¶å…³é—­è¯­å¥ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-file/:1:2","tags":["Go","file"],"title":"Go file","uri":"/posts/2023-11-11-go-file/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"è¯»å–æ–‡ä»¶ file.Read() åŸºæœ¬ä½¿ç”¨ Readæ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š func (f *File) Read(b []byte) (n int, err error) å®ƒæ¥æ”¶ä¸€ä¸ªå­—èŠ‚åˆ‡ç‰‡ï¼Œè¿”å›è¯»å–çš„å­—èŠ‚æ•°å’Œå¯èƒ½çš„å…·ä½“é”™è¯¯ï¼Œè¯»åˆ°æ–‡ä»¶æœ«å°¾æ—¶ä¼šè¿”å›0å’Œio.EOFã€‚ ä¸¾ä¸ªä¾‹å­ï¼š func main() { // åªè¯»æ–¹å¼æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„main.goæ–‡ä»¶ file, err := os.Open(\"./main.go\") if err != nil { fmt.Println(\"open file failed!, err:\", err) return } defer file.Close() // ä½¿ç”¨Readæ–¹æ³•è¯»å–æ•°æ® var tmp = make([]byte, 128) n, err := file.Read(tmp) if err == io.EOF { fmt.Println(\"æ–‡ä»¶è¯»å®Œäº†\") return } if err != nil { fmt.Println(\"read file failed, err:\", err) return } fmt.Printf(\"è¯»å–äº†%då­—èŠ‚æ•°æ®\\n\", n) fmt.Println(string(tmp[:n])) } å¾ªç¯è¯»å– ä½¿ç”¨forå¾ªç¯è¯»å–æ–‡ä»¶ä¸­æ‰€æœ‰çš„æ•°æ® func main() { // åªè¯»æ–¹å¼æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„main.goæ–‡ä»¶ file, err := os.Open(\"./main.go\") if err != nil { fmt.Println(\"open file failed!, err:\", err) return } defer file.Close() // å¾ªç¯è¯»å–æ–‡ä»¶ var content []byte var tmp = make([]byte, 128) for { n, err := file.Read(tmp) if err == io.EOF { fmt.Println(\"æ–‡ä»¶è¯»å®Œäº†\") break } if err != nil { fmt.Println(\"read file failed, err:\", err) return } content = append(content, tmp[:n]...) } fmt.Println(string(content)) } bufioè¯»å–æ–‡ä»¶ bufioæ˜¯åœ¨fileçš„åŸºç¡€ä¸Šå°è£…äº†ä¸€å±‚APIï¼Œæ”¯æŒæ›´å¤šçš„åŠŸèƒ½ã€‚ package main import ( \"bufio\" \"fmt\" \"io\" \"os\" ) // bufioæŒ‰è¡Œè¯»å–ç¤ºä¾‹ func main() { file, err := os.Open(\"./xx.txt\") if err != nil { fmt.Println(\"open file failed, err:\", err) return } defer file.Close() reader := bufio.NewReader(file) for { line, err := reader.ReadString('\\n') //æ³¨æ„æ˜¯å­—ç¬¦ if err == io.EOF { if len(line) != 0 { fmt.Println(line) } fmt.Println(\"æ–‡ä»¶è¯»å®Œäº†\") break } if err != nil { fmt.Println(\"read file failed, err:\", err) return } fmt.Print(line) } } ioutilè¯»å–æ•´ä¸ªæ–‡ä»¶ io/ioutilåŒ…çš„ReadFileæ–¹æ³•èƒ½å¤Ÿè¯»å–å®Œæ•´çš„æ–‡ä»¶ï¼Œåªéœ€è¦å°†æ–‡ä»¶åä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ package main import ( \"fmt\" \"io/ioutil\" ) // ioutil.ReadFileè¯»å–æ•´ä¸ªæ–‡ä»¶ func main() { content, err := ioutil.ReadFile(\"./main.go\") if err != nil { fmt.Println(\"read file failed, err:\", err) return } fmt.Println(string(content)) } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-file/:1:3","tags":["Go","file"],"title":"Go file","uri":"/posts/2023-11-11-go-file/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ–‡ä»¶å†™å…¥ os.OpenFile()å‡½æ•°èƒ½å¤Ÿä»¥æŒ‡å®šæ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Œä»è€Œå®ç°æ–‡ä»¶å†™å…¥ç›¸å…³åŠŸèƒ½ã€‚ func OpenFile(name string, flag int, perm FileMode) (*File, error) { ... } å…¶ä¸­ï¼š nameï¼šè¦æ‰“å¼€çš„æ–‡ä»¶å flagï¼šæ‰“å¼€æ–‡ä»¶çš„æ¨¡å¼ã€‚ æ¨¡å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š æ¨¡å¼ å«ä¹‰ os.O_WRONLY åªå†™ os.O_CREATE åˆ›å»ºæ–‡ä»¶ os.O_RDONLY åªè¯» os.O_RDWR è¯»å†™ os.O_TRUNC æ¸…ç©º os.O_APPEND è¿½åŠ  permï¼šæ–‡ä»¶æƒé™ï¼Œä¸€ä¸ªå…«è¿›åˆ¶æ•°ã€‚rï¼ˆè¯»ï¼‰4ï¼Œwï¼ˆå†™ï¼‰2ï¼Œxï¼ˆæ‰§è¡Œï¼‰1ã€‚ Writeå’ŒWriteString func main() { file, err := os.OpenFile(\"xx.txt\", os.O_CREATE|os.O_TRUNC|os.O_WRONLY, 0666) if err != nil { fmt.Println(\"open file failed, err:\", err) return } defer file.Close() str := \"hello æ²™æ²³\" file.Write([]byte(str)) //å†™å…¥å­—èŠ‚åˆ‡ç‰‡æ•°æ® file.WriteString(\"hello å°ç‹å­\") //ç›´æ¥å†™å…¥å­—ç¬¦ä¸²æ•°æ® } bufio.NewWriter func main() { file, err := os.OpenFile(\"xx.txt\", os.O_CREATE|os.O_TRUNC|os.O_WRONLY, 0666) if err != nil { fmt.Println(\"open file failed, err:\", err) return } defer file.Close() writer := bufio.NewWriter(file) for i := 0; i \u003c 10; i++ { writer.WriteString(\"helloæ²™æ²³\\n\") //å°†æ•°æ®å…ˆå†™å…¥ç¼“å­˜ } writer.Flush() //å°†ç¼“å­˜ä¸­çš„å†…å®¹å†™å…¥æ–‡ä»¶ } ioutil.WriteFile func main() { str := \"hello æ²™æ²³\" err := ioutil.WriteFile(\"./xx.txt\", []byte(str), 0666) if err != nil { fmt.Println(\"write file failed, err:\", err) return } } ç»ƒä¹ ï¼š 1ã€å®ç°cpå‘½ä»¤ å€ŸåŠ©io.Copy()å®ç°ä¸€ä¸ªæ‹·è´æ–‡ä»¶å‡½æ•°ã€‚ // CopyFile æ‹·è´æ–‡ä»¶å‡½æ•° func CopyFile(dstName, srcName string) (written int64, err error) { // ä»¥è¯»æ–¹å¼æ‰“å¼€æºæ–‡ä»¶ src, err := os.Open(srcName) if err != nil { fmt.Printf(\"open %s failed, err:%v.\\n\", srcName, err) return } defer src.Close() // ä»¥å†™|åˆ›å»ºçš„æ–¹å¼æ‰“å¼€ç›®æ ‡æ–‡ä»¶ dst, err := os.OpenFile(dstName, os.O_WRONLY|os.O_CREATE, 0644) if err != nil { fmt.Printf(\"open %s failed, err:%v.\\n\", dstName, err) return } defer dst.Close() return io.Copy(dst, src) //è°ƒç”¨io.Copy()æ‹·è´å†…å®¹ } func main() { _, err := CopyFile(\"dst.txt\", \"src.txt\") if err != nil { fmt.Println(\"copy file failed, err:\", err) return } fmt.Println(\"copy done!\") } 2ã€å®ç°catå‘½ä»¤ ä½¿ç”¨æ–‡ä»¶æ“ä½œç›¸å…³çŸ¥è¯†ï¼Œæ¨¡æ‹Ÿå®ç°linuxå¹³å°catå‘½ä»¤çš„åŠŸèƒ½ package main import ( \"bufio\" \"flag\" \"fmt\" \"io\" \"os\" ) // catå‘½ä»¤å®ç° func cat(r *bufio.Reader) { for { buf, err := r.ReadBytes('\\n') //æ³¨æ„æ˜¯å­—ç¬¦ if err == io.EOF { // é€€å‡ºä¹‹å‰å°†å·²è¯»åˆ°çš„å†…å®¹è¾“å‡º fmt.Fprintf(os.Stdout, \"%s\", buf) break } fmt.Fprintf(os.Stdout, \"%s\", buf) } } func main() { flag.Parse() // è§£æå‘½ä»¤è¡Œå‚æ•° if flag.NArg() == 0 { // å¦‚æœæ²¡æœ‰å‚æ•°é»˜è®¤ä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹ cat(bufio.NewReader(os.Stdin)) } // ä¾æ¬¡è¯»å–æ¯ä¸ªæŒ‡å®šæ–‡ä»¶çš„å†…å®¹å¹¶æ‰“å°åˆ°ç»ˆç«¯ for i := 0; i \u003c flag.NArg(); i++ { f, err := os.Open(flag.Arg(i)) if err != nil { fmt.Fprintf(os.Stdout, \"reading from %s failed, err:%v\\n\", flag.Arg(i), err) continue } cat(bufio.NewReader(f)) } } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-file/:1:4","tags":["Go","file"],"title":"Go file","uri":"/posts/2023-11-11-go-file/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Excelåº“excelize å‚è€ƒé“¾æ¥ï¼š[Go è¯­è¨€è¯»å†™ Excel - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/33417413#:~:text=Excelize æ˜¯ Go è¯­è¨€ç¼–å†™çš„ç”¨äºæ“ä½œ Office Excel æ–‡æ¡£ç±»åº“ï¼ŒåŸºäº ECMA-376,æ ‡å‡†ã€‚ å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å–ã€å†™å…¥ç”± Microsoft Excelâ„¢ 2007 åŠä»¥ä¸Šç‰ˆæœ¬åˆ›å»ºçš„ XLSX æ–‡æ¡£ã€‚) Excelize æ˜¯ Go è¯­è¨€ç¼–å†™çš„ç”¨äºæ“ä½œ Office Excel æ–‡æ¡£ç±»åº“ï¼ŒåŸºäº ECMA-376 Office OpenXML æ ‡å‡†ã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å–ã€å†™å…¥ç”± Microsoft Excelâ„¢ 2007 åŠä»¥ä¸Šç‰ˆæœ¬åˆ›å»ºçš„ XLSX æ–‡æ¡£ã€‚ç›¸æ¯”è¾ƒå…¶ä»–çš„å¼€æºç±»åº“ï¼ŒExcelize æ”¯æŒå†™å…¥åŸæœ¬å¸¦æœ‰å›¾ç‰‡(è¡¨)ã€é€è§†è¡¨å’Œåˆ‡ç‰‡å™¨ç­‰å¤æ‚æ ·å¼çš„æ–‡æ¡£ï¼Œè¿˜æ”¯æŒå‘ Excel æ–‡æ¡£ä¸­æ’å…¥å›¾ç‰‡ä¸å›¾è¡¨ï¼Œå¹¶ä¸”åœ¨ä¿å­˜åä¸ä¼šä¸¢å¤±æ–‡æ¡£åŸæœ‰æ ·å¼ï¼Œå¯ä»¥åº”ç”¨äºå„ç±»æŠ¥è¡¨ç³»ç»Ÿä¸­ã€‚ä½¿ç”¨æœ¬ç±»åº“è¦æ±‚ä½¿ç”¨çš„ Go è¯­è¨€ä¸º 1.8 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå®Œæ•´çš„ API ä½¿ç”¨æ–‡æ¡£è¯·è®¿é—® godoc.org æˆ–æŸ¥çœ‹å‚è€ƒæ–‡æ¡£ã€‚ GitHub: excelize å®˜æ–¹æ–‡æ¡£ï¼šhttps://xuri.me/excelize ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-excelize/:1:0","tags":["Go","excelize","xls","xlsx"],"title":"Go excelize","uri":"/posts/2023-11-11-go-excelize/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"1ã€ç®€å•ä½¿ç”¨ å®‰è£… go get github.com/xuri/excelize/v2 1ï¼‰åˆ›å»ºXLSX package main import \"github.com/360EntSecGroup-Skylar/excelize\" func main() { f := excelize.NewFile() // åˆ›å»ºä¸€ä¸ªå·¥ä½œè¡¨ index := f.NewSheet(\"Sheet2\") // è®¾ç½®å•å…ƒæ ¼çš„å€¼ f.SetCellValue(\"Sheet1\", \"A2\", \"Hello world.\") f.SetCellValue(\"Sheet1\", \"B2\", 100) f.SetCellValue(\"Sheet1\", \"B3\", \"github\") // è®¾ç½®å·¥ä½œç°¿çš„é»˜è®¤å·¥ä½œè¡¨ f.SetActiveSheet(index) // æ ¹æ®æŒ‡å®šè·¯å¾„ä¿å­˜æ–‡ä»¶ if err := f.SaveAs(\"Book1.xlsx\"); err != nil { println(err.Error()) } } ç»“æœï¼š SetCellValueå‡½æ•°è§£é‡Š f.SetCellValue(sheet string, axis string, value interface{}) f.SetCellValue(\"Sheet1\", \"B3\", \"github\") sheetï¼šæ˜¯sheetè¡¨æ ¼çš„çš„åå­—ã€‚ axisï¼šåŒ…å«ä¸¤éƒ¨åˆ†ï¼Œå­—æ¯è¡¨ç¤ºåˆ—ï¼Œæ•°å­—è¡¨ç¤ºè¡Œã€‚ valueï¼šè¡¨ç¤ºå€¼ã€‚ 2ï¼‰è¯»å–xlsx func ReadXlsx() { filename := \"Book1.xlsx\" f, err := excelize.OpenFile(filename) if err != nil { fmt.Printf(\"æ— æ³•æ‰“å¼€xlsxï¼š%v é”™è¯¯åŸå› ï¼š%v\", filename, err) return } // è·å–å·¥ä½œè¡¨ä¸­æŒ‡å®šå•å…ƒæ ¼çš„å€¼ cell, err := f.GetCellValue(\"Sheet1\", \"B3\") if err != nil { fmt.Printf(\"è·å– %v çš„%vçš„ å€¼ å¤±è´¥,å¤±è´¥åŸå› ï¼š%v\", \"Sheet1\", \"B3\", err) } fmt.Printf(\"è¯»å–çš„å†…å®¹ä¸ºï¼š%v\", cell) // è·å– Sheet1 ä¸Šæ‰€æœ‰å•å…ƒæ ¼ rows, err := f.GetRows(\"Sheet1\") if err != nil { fmt.Printf(\"è·å– %vçš„å•å…ƒæ ¼å¤±è´¥,å¤±è´¥åŸå› ï¼š%v\", \"Sheet1\", err) } for _, row := range rows { for _, colCell := range row { print(colCell, \"\\t\") } println() } } 3ï¼‰æ’å…¥ä¸€è¡Œæ•°æ® func (exa *ExcelService) ParseInfoList2Excel(infoList []system.SysBaseMenu, filePath string) error { excel := excelize.NewFile() excel.SetSheetRow(\"Sheet1\", \"A1\", \u0026[]string{\"ID\", \"è·¯ç”±Name\", \"è·¯ç”±Path\", \"æ˜¯å¦éšè—\", \"çˆ¶èŠ‚ç‚¹\", \"æ’åº\", \"æ–‡ä»¶åç§°\"}) for i, menu := range infoList { axis := fmt.Sprintf(\"A%d\", i+2) excel.SetSheetRow(\"Sheet1\", axis, \u0026[]interface{}{ menu.ID, menu.Name, menu.Path, menu.Hidden, menu.ParentId, menu.Sort, menu.Component, }) } err := excel.SaveAs(filePath) return err } 4ï¼‰ä»è¡¨æ ¼ä¸­å¯¼å…¥æ•°æ® func PasreExcel2List(filepath string, fileHeader []string, skipHeader bool) (data [][]string, err error) { file, err := excelize.OpenFile(filepath) if err != nil { return } defer file.Close() rows, err := file.GetRows(\"Sheet1\") if err != nil { return } if skipHeader { if ForEqualStringSlice(rows[0], fileHeader) { rows = rows[1:] } else { err = errors.New(\"FileHeader not Equal.\") return } } data = rows return } func (exa *ExcelService) ParseExcel2InfoList() ([]system.SysBaseMenu, error) { skipHeader := true fixedHeader := []string{\"ID\", \"è·¯ç”±Name\", \"è·¯ç”±Path\", \"æ˜¯å¦éšè—\", \"çˆ¶èŠ‚ç‚¹\", \"æ’åº\", \"æ–‡ä»¶åç§°\"} file, err := excelize.OpenFile(global.GVA_CONFIG.Excel.Dir + \"ExcelImport.xlsx\") if err != nil { return nil, err } menus := make([]system.SysBaseMenu, 0) rows, err := file.Rows(\"Sheet1\") if err != nil { return nil, err } for rows.Next() { row, err := rows.Columns() if err != nil { return nil, err } if skipHeader { if exa.compareStrSlice(row, fixedHeader) { skipHeader = false continue } else { return nil, errors.New(\"Excelæ ¼å¼é”™è¯¯\") } } if len(row) != len(fixedHeader) { continue } id, _ := strconv.Atoi(row[0]) hidden, _ := strconv.ParseBool(row[3]) sort, _ := strconv.Atoi(row[5]) menu := system.SysBaseMenu{ GVA_MODEL: global.GVA_MODEL{ ID: uint(id), }, Name: row[1], Path: row[2], Hidden: hidden, ParentId: row[4], Sort: sort, Component: row[6], } menus = append(menus, menu) } return menus, nil } func (exa *ExcelService) compareStrSlice(a, b []string) bool { if len(a) != len(b) { return false } if (b == nil) != (a == nil) { return false } for key, value := range a { if value != b[key] { return false } } return true } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-excelize/:1:1","tags":["Go","excelize","xls","xlsx"],"title":"Go excelize","uri":"/posts/2023-11-11-go-excelize/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"cronå®šæ—¶ä»»åŠ¡ å‚è€ƒé“¾æ¥ï¼šhttps://segmentfault.com/a/1190000023029219 ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:0","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç®€ä»‹ cronä¸€ä¸ªç”¨äºç®¡ç†å®šæ—¶ä»»åŠ¡çš„åº“ï¼Œç”¨ Go å®ç° Linux ä¸­crontabè¿™ä¸ªå‘½ä»¤çš„æ•ˆæœã€‚ä¹‹å‰æˆ‘ä»¬ä¹Ÿä»‹ç»è¿‡ä¸€ä¸ªç±»ä¼¼çš„ Go åº“â€”â€”gronã€‚gronä»£ç å°å·§ï¼Œç”¨äºå­¦ä¹ æ˜¯æ¯”è¾ƒå¥½çš„ã€‚ä½†æ˜¯å®ƒåŠŸèƒ½ç›¸å¯¹ç®€å•äº›ï¼Œå¹¶ä¸”å·²ç»ä¸ç»´æŠ¤äº†ã€‚å¦‚æœæœ‰å®šæ—¶ä»»åŠ¡éœ€æ±‚ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨cronã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:1","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å¿«é€Ÿä½¿ç”¨ å®‰è£…cronï¼Œç›®å‰æœ€æ–°ç¨³å®šç‰ˆæœ¬ä¸º v3ï¼š $ go get github.com/robfig/cron/v3 ä½¿ç”¨ package main import ( \"fmt\" \"time\" \"github.com/robfig/cron/v3\" ) func main() { c := cron.New() c.AddFunc(\"@every 1s\", func() { fmt.Println(\"tick every 1 second\") }) c.Start() time.Sleep(time.Second * 5) } ä½¿ç”¨éå¸¸ç®€å•ï¼Œåˆ›å»ºcronå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç”¨äºç®¡ç†å®šæ—¶ä»»åŠ¡ã€‚ è°ƒç”¨cronå¯¹è±¡çš„AddFunc()æ–¹æ³•å‘ç®¡ç†å™¨ä¸­æ·»åŠ å®šæ—¶ä»»åŠ¡ã€‚AddFunc()æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå‚æ•° 1 ä»¥å­—ç¬¦ä¸²å½¢å¼æŒ‡å®šè§¦å‘æ—¶é—´è§„åˆ™ï¼Œå‚æ•° 2 æ˜¯ä¸€ä¸ªæ— å‚çš„å‡½æ•°ï¼Œæ¯æ¬¡è§¦å‘æ—¶è°ƒç”¨ã€‚@every 1sè¡¨ç¤ºæ¯ç§’è§¦å‘ä¸€æ¬¡ï¼Œ@everyååŠ ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œè¡¨ç¤ºæ¯éš”å¤šé•¿æ—¶é—´è§¦å‘ä¸€æ¬¡ã€‚ä¾‹å¦‚@every 1hè¡¨ç¤ºæ¯å°æ—¶è§¦å‘ä¸€æ¬¡ï¼Œ@every 1m2sè¡¨ç¤ºæ¯éš” 1 åˆ† 2 ç§’è§¦å‘ä¸€æ¬¡ã€‚time.ParseDuration()æ”¯æŒçš„æ ¼å¼éƒ½å¯ä»¥ç”¨åœ¨è¿™é‡Œã€‚ è°ƒç”¨c.Start()å¯åŠ¨å®šæ—¶å¾ªç¯ã€‚ æ³¨æ„ä¸€ç‚¹ï¼Œå› ä¸ºc.Start()å¯åŠ¨ä¸€ä¸ªæ–°çš„ goroutine åšå¾ªç¯æ£€æµ‹ï¼Œæˆ‘ä»¬åœ¨ä»£ç æœ€ååŠ äº†ä¸€è¡Œtime.Sleep(time.Second * 5)é˜²æ­¢ä¸» goroutine é€€å‡ºã€‚ è¿è¡Œæ•ˆæœï¼Œæ¯éš” 1s è¾“å‡ºä¸€è¡Œå­—ç¬¦ä¸²ï¼š $ go run main.go tick every 1 second tick every 1 second tick every 1 second tick every 1 second tick every 1 second ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:2","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ—¶é—´æ ¼å¼ ä¸Linux ä¸­crontabå‘½ä»¤ç›¸ä¼¼ï¼Œcronåº“æ”¯æŒç”¨ 5 ä¸ªç©ºæ ¼åˆ†éš”çš„åŸŸæ¥è¡¨ç¤ºæ—¶é—´ã€‚è¿™ 5 ä¸ªåŸŸå«ä¹‰ä¾æ¬¡ä¸ºï¼š Minutesï¼šåˆ†é’Ÿï¼Œå–å€¼èŒƒå›´[0-59]ï¼Œæ”¯æŒç‰¹æ®Šå­—ç¬¦* / , -ï¼› Hoursï¼šå°æ—¶ï¼Œå–å€¼èŒƒå›´[0-23]ï¼Œæ”¯æŒç‰¹æ®Šå­—ç¬¦* / , -ï¼› Day of monthï¼šæ¯æœˆçš„ç¬¬å‡ å¤©ï¼Œå–å€¼èŒƒå›´[1-31]ï¼Œæ”¯æŒç‰¹æ®Šå­—ç¬¦* / , - ?ï¼› Monthï¼šæœˆï¼Œå–å€¼èŒƒå›´[1-12]æˆ–è€…ä½¿ç”¨æœˆä»½åå­—ç¼©å†™[JAN-DEC]ï¼Œæ”¯æŒç‰¹æ®Šå­—ç¬¦* / , -ï¼› Day of weekï¼šå‘¨å†ï¼Œå–å€¼èŒƒå›´[0-6]æˆ–åå­—ç¼©å†™[JUN-SAT]ï¼Œæ”¯æŒç‰¹æ®Šå­—ç¬¦* / , - ?ã€‚ æ³¨æ„ï¼Œæœˆä»½å’Œå‘¨å†åç§°éƒ½æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´SUN/Sun/sunè¡¨ç¤ºåŒæ ·çš„å«ä¹‰ï¼ˆéƒ½æ˜¯å‘¨æ—¥ï¼‰ã€‚ ç‰¹æ®Šå­—ç¬¦å«ä¹‰å¦‚ä¸‹ï¼š *ï¼šä½¿ç”¨*çš„åŸŸå¯ä»¥åŒ¹é…ä»»ä½•å€¼ï¼Œä¾‹å¦‚å°†æœˆä»½åŸŸï¼ˆç¬¬ 4 ä¸ªï¼‰è®¾ç½®ä¸º*ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆï¼› /ï¼šç”¨æ¥æŒ‡å®šèŒƒå›´çš„æ­¥é•¿ï¼Œä¾‹å¦‚å°†å°æ—¶åŸŸï¼ˆç¬¬ 2 ä¸ªï¼‰è®¾ç½®ä¸º3-59/15è¡¨ç¤ºç¬¬ 3 åˆ†é’Ÿè§¦å‘ï¼Œä»¥åæ¯éš” 15 åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ï¼Œå› æ­¤ç¬¬ 2 æ¬¡è§¦å‘ä¸ºç¬¬ 18 åˆ†é’Ÿï¼Œç¬¬ 3 æ¬¡ä¸º 33 åˆ†é’Ÿã€‚ã€‚ã€‚ç›´åˆ°åˆ†é’Ÿå¤§äº 59ï¼› ,ï¼šç”¨æ¥åˆ—ä¸¾ä¸€äº›ç¦»æ•£çš„å€¼å’Œå¤šä¸ªèŒƒå›´ï¼Œä¾‹å¦‚å°†å‘¨å†çš„åŸŸï¼ˆç¬¬ 5 ä¸ªï¼‰è®¾ç½®ä¸ºMON,WED,FRIè¡¨ç¤ºå‘¨ä¸€ã€ä¸‰å’Œäº”ï¼› -ï¼šç”¨æ¥è¡¨ç¤ºèŒƒå›´ï¼Œä¾‹å¦‚å°†å°æ—¶çš„åŸŸï¼ˆç¬¬ 1 ä¸ªï¼‰è®¾ç½®ä¸º9-17è¡¨ç¤ºä¸Šåˆ 9 ç‚¹åˆ°ä¸‹åˆ 17 ç‚¹ï¼ˆåŒ…æ‹¬ 9 å’Œ 17ï¼‰ï¼› ?ï¼šåªèƒ½ç”¨åœ¨æœˆå†å’Œå‘¨å†çš„åŸŸä¸­ï¼Œç”¨æ¥ä»£æ›¿*ï¼Œè¡¨ç¤ºæ¯æœˆ/å‘¨çš„ä»»æ„ä¸€å¤©ã€‚ äº†è§£è§„åˆ™ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä»»æ„æ—¶é—´ï¼š 30 * * * *ï¼šåˆ†é’ŸåŸŸä¸º 30ï¼Œå…¶ä»–åŸŸéƒ½æ˜¯*è¡¨ç¤ºä»»æ„ã€‚æ¯å°æ—¶çš„ 30 åˆ†è§¦å‘ï¼› 30 3-6,20-23 * * *ï¼šåˆ†é’ŸåŸŸä¸º 30ï¼Œå°æ—¶åŸŸçš„3-6,20-23è¡¨ç¤º 3 ç‚¹åˆ° 6 ç‚¹å’Œ 20 ç‚¹åˆ° 23 ç‚¹ã€‚3,4,5,6,20,21,22,23 æ—¶çš„ 30 åˆ†è§¦å‘ï¼› 0 0 1 1 *ï¼š1ï¼ˆç¬¬ 4 ä¸ªï¼‰ æœˆ 1ï¼ˆç¬¬ 3 ä¸ªï¼‰ å·çš„ 0ï¼ˆç¬¬ 2 ä¸ªï¼‰ æ—¶ 0ï¼ˆç¬¬ 1 ä¸ªï¼‰ åˆ†è§¦å‘ã€‚ è®°ç†Ÿäº†è¿™å‡ ä¸ªåŸŸçš„é¡ºåºï¼Œå†å¤šç»ƒä¹ å‡ æ¬¡å¾ˆå®¹æ˜“å°±èƒ½æŒæ¡æ ¼å¼ã€‚ç†Ÿæ‚‰è§„åˆ™äº†ä¹‹åï¼Œå°±èƒ½ç†Ÿç»ƒä½¿ç”¨crontabå‘½ä»¤äº†ã€‚ func main() { c := cron.New() c.AddFunc(\"30 * * * *\", func() { fmt.Println(\"Every hour on the half hour\") }) c.AddFunc(\"30 3-6,20-23 * * *\", func() { fmt.Println(\"On the half hour of 3-6am, 8-11pm\") }) c.AddFunc(\"0 0 1 1 *\", func() { fmt.Println(\"Jun 1 every year\") }) c.Start() for { time.Sleep(time.Second) } } é¢„å®šä¹‰æ—¶é—´è§„åˆ™ ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œcroné¢„å®šä¹‰äº†ä¸€äº›æ—¶é—´è§„åˆ™ï¼š @yearlyï¼šä¹Ÿå¯ä»¥å†™ä½œ@annuallyï¼Œè¡¨ç¤ºæ¯å¹´ç¬¬ä¸€å¤©çš„ 0 ç‚¹ã€‚ç­‰ä»·äº0 0 1 1 *ï¼› @monthlyï¼šè¡¨ç¤ºæ¯æœˆç¬¬ä¸€å¤©çš„ 0 ç‚¹ã€‚ç­‰ä»·äº0 0 1 * *ï¼› @weeklyï¼šè¡¨ç¤ºæ¯å‘¨ç¬¬ä¸€å¤©çš„ 0 ç‚¹ï¼Œæ³¨æ„ç¬¬ä¸€å¤©ä¸ºå‘¨æ—¥ï¼Œå³å‘¨å…­ç»“æŸï¼Œå‘¨æ—¥å¼€å§‹çš„é‚£ä¸ª 0 ç‚¹ã€‚ç­‰ä»·äº0 0 * * 0ï¼› @dailyï¼šä¹Ÿå¯ä»¥å†™ä½œ@midnightï¼Œè¡¨ç¤ºæ¯å¤© 0 ç‚¹ã€‚ç­‰ä»·äº0 0 * * *ï¼› @hourlyï¼šè¡¨ç¤ºæ¯å°æ—¶çš„å¼€å§‹ã€‚ç­‰ä»·äº0 * * * *ã€‚ ä¾‹å¦‚ï¼š func main() { c := cron.New() c.AddFunc(\"@hourly\", func() { fmt.Println(\"Every hour\") }) c.AddFunc(\"@daily\", func() { fmt.Println(\"Every day on midnight\") }) c.AddFunc(\"@weekly\", func() { fmt.Println(\"Every week\") }) c.Start() for { time.Sleep(time.Second) } } ä¸Šé¢ä»£ç åªæ˜¯æ¼”ç¤ºç”¨æ³•ï¼Œå®é™…è¿è¡Œå¯èƒ½è¦ç­‰å¾…éå¸¸é•¿çš„æ—¶é—´æ‰èƒ½æœ‰è¾“å‡ºã€‚ å›ºå®šæ—¶é—´é—´éš” cronæ”¯æŒå›ºå®šæ—¶é—´é—´éš”ï¼Œæ ¼å¼ä¸ºï¼š @every \u003cduration\u003e å«ä¹‰ä¸ºæ¯éš”durationè§¦å‘ä¸€æ¬¡ã€‚``ä¼šè°ƒç”¨time.ParseDuration()å‡½æ•°è§£æï¼Œæ‰€ä»¥ParseDurationæ”¯æŒçš„æ ¼å¼éƒ½å¯ä»¥ã€‚ä¾‹å¦‚1h30m10sã€‚åœ¨å¿«é€Ÿå¼€å§‹éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»æ¼”ç¤ºäº†@everyçš„ç”¨æ³•äº†ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:3","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"æ—¶åŒº é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ—¶é—´éƒ½æ˜¯åŸºäºå½“å‰æ—¶åŒºçš„ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šæ—¶åŒºï¼Œæœ‰ 2 ä¸¤ç§æ–¹å¼ï¼š åœ¨æ—¶é—´å­—ç¬¦ä¸²å‰é¢æ·»åŠ ä¸€ä¸ªCRON_TZ= + å…·ä½“æ—¶åŒºï¼Œå…·ä½“æ—¶åŒºçš„æ ¼å¼åœ¨ä¹‹å‰carbonçš„æ–‡ç« ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚ä¸œäº¬æ—¶åŒºä¸ºAsia/Tokyoï¼Œçº½çº¦æ—¶åŒºä¸ºAmerica/New_Yorkï¼› åˆ›å»ºcronå¯¹è±¡æ—¶å¢åŠ ä¸€ä¸ªæ—¶åŒºé€‰é¡¹cron.WithLocation(location)ï¼Œlocationä¸ºtime.LoadLocation(zone)åŠ è½½çš„æ—¶åŒºå¯¹è±¡ï¼Œzoneä¸ºå…·ä½“çš„æ—¶åŒºæ ¼å¼ã€‚æˆ–è€…è°ƒç”¨å·²åˆ›å»ºå¥½çš„cronå¯¹è±¡çš„SetLocation()æ–¹æ³•è®¾ç½®æ—¶åŒºã€‚ ç¤ºä¾‹ï¼š func main() { nyc, _ := time.LoadLocation(\"America/New_York\") c := cron.New(cron.WithLocation(nyc)) c.AddFunc(\"0 6 * * ?\", func() { fmt.Println(\"Every 6 o'clock at New York\") }) c.AddFunc(\"CRON_TZ=Asia/Tokyo 0 6 * * ?\", func() { fmt.Println(\"Every 6 o'clock at Tokyo\") }) c.Start() for { time.Sleep(time.Second) } } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:4","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Jobæ¥å£ é™¤äº†ç›´æ¥å°†æ— å‚å‡½æ•°ä½œä¸ºå›è°ƒå¤–ï¼Œcronè¿˜æ”¯æŒJobæ¥å£ï¼š // cron.go type Job interface { Run() } æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå®ç°æ¥å£Jobçš„ç»“æ„ï¼š type GreetingJob struct { Name string } func (g GreetingJob) Run() { fmt.Println(\"Hello \", g.Name) } è°ƒç”¨cronå¯¹è±¡çš„AddJob()æ–¹æ³•å°†GreetingJobå¯¹è±¡æ·»åŠ åˆ°å®šæ—¶ç®¡ç†å™¨ä¸­ï¼š func main() { c := cron.New() c.AddJob(\"@every 1s\", GreetingJob{\"dj\"}) c.Start() time.Sleep(5 * time.Second) } è¿è¡Œæ•ˆæœï¼š $ go run main.go Hello dj Hello dj Hello dj Hello dj Hello dj ä½¿ç”¨è‡ªå®šä¹‰çš„ç»“æ„å¯ä»¥è®©ä»»åŠ¡æºå¸¦çŠ¶æ€ï¼ˆNameå­—æ®µï¼‰ã€‚ å®é™…ä¸ŠAddFunc()æ–¹æ³•å†…éƒ¨ä¹Ÿè°ƒç”¨äº†AddJob()æ–¹æ³•ã€‚é¦–å…ˆï¼ŒcronåŸºäºfunc()ç±»å‹å®šä¹‰ä¸€ä¸ªæ–°çš„ç±»å‹FuncJobï¼š // cron.go type FuncJob func() ç„¶åè®©FuncJobå®ç°Jobæ¥å£ï¼š // cron.go func (f FuncJob) Run() { f() } åœ¨AddFunc()æ–¹æ³•ä¸­ï¼Œå°†ä¼ å…¥çš„å›è°ƒè½¬ä¸ºFuncJobç±»å‹ï¼Œç„¶åè°ƒç”¨AddJob()æ–¹æ³•ï¼š func (c *Cron) AddFunc(spec string, cmd func()) (EntryID, error) { return c.AddJob(spec, FuncJob(cmd)) } ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:5","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"çº¿ç¨‹å®‰å…¨ cronä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ goroutine æ¥æ‰§è¡Œè§¦å‘å›è°ƒã€‚å¦‚æœè¿™äº›å›è°ƒéœ€è¦å¹¶å‘è®¿é—®ä¸€äº›èµ„æºã€æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°åšåŒæ­¥ã€‚ ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:6","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"è‡ªå®šä¹‰æ—¶é—´æ ¼å¼ cronæ”¯æŒçµæ´»çš„æ—¶é—´æ ¼å¼ï¼Œå¦‚æœé»˜è®¤çš„æ ¼å¼ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰æ—¶é—´æ ¼å¼ã€‚æ—¶é—´è§„åˆ™å­—ç¬¦ä¸²éœ€è¦cron.Parserå¯¹è±¡æ¥è§£æã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹é»˜è®¤çš„è§£æå™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ é¦–å…ˆå®šä¹‰å„ä¸ªåŸŸï¼š // parser.go const ( Second ParseOption = 1 \u003c\u003c iota SecondOptional Minute Hour Dom Month Dow DowOptional Descriptor ) é™¤äº†Minute/Hour/Dom(Day of month)/Month/Dow(Day of week)å¤–ï¼Œè¿˜å¯ä»¥æ”¯æŒSecondã€‚ç›¸å¯¹é¡ºåºéƒ½æ˜¯å›ºå®šçš„ï¼š // parser.go var places = []ParseOption{ Second, Minute, Hour, Dom, Month, Dow, } var defaults = []string{ \"0\", \"0\", \"0\", \"*\", \"*\", \"*\", } é»˜è®¤çš„æ—¶é—´æ ¼å¼ä½¿ç”¨ 5 ä¸ªåŸŸã€‚ æˆ‘ä»¬å¯ä»¥è°ƒç”¨cron.NewParser()åˆ›å»ºè‡ªå·±çš„Parserå¯¹è±¡ï¼Œä»¥ä½æ ¼å¼ä¼ å…¥ä½¿ç”¨å“ªäº›åŸŸï¼Œä¾‹å¦‚ä¸‹é¢çš„Parserä½¿ç”¨ 6 ä¸ªåŸŸï¼Œæ”¯æŒSecondï¼ˆç§’ï¼‰ï¼š parser := cron.NewParser( cron.Second | cron.Minute | cron.Hour | cron.Dom | cron.Month | cron.Dow | cron.Descriptor, ) è°ƒç”¨cron.WithParser(parser)åˆ›å»ºä¸€ä¸ªé€‰é¡¹ä¼ å…¥æ„é€ å‡½æ•°cron.New()ï¼Œä½¿ç”¨æ—¶å°±å¯ä»¥æŒ‡å®šç§’äº†ï¼š c := cron.New(cron.WithParser(parser)) c.AddFunc(\"1 * * * * *\", func () { fmt.Println(\"every 1 second\") }) c.Start() è¿™é‡Œæ—¶é—´æ ¼å¼å¿…é¡»ä½¿ç”¨ 6 ä¸ªåŸŸï¼Œé¡ºåºä¸ä¸Šé¢çš„constå®šä¹‰ä¸€è‡´ã€‚ å› ä¸ºä¸Šé¢çš„æ—¶é—´æ ¼å¼å¤ªå¸¸è§äº†ï¼Œcronå®šä¹‰äº†ä¸€ä¸ªä¾¿æ·çš„å‡½æ•°ï¼š // option.go func WithSeconds() Option { return WithParser(NewParser( Second | Minute | Hour | Dom | Month | Dow | Descriptor, )) } æ³¨æ„Descriptorè¡¨ç¤ºå¯¹@every/@hourç­‰çš„æ”¯æŒã€‚æœ‰äº†WithSeconds()ï¼Œæˆ‘ä»¬ä¸ç”¨æ‰‹åŠ¨åˆ›å»ºParserå¯¹è±¡äº†ï¼š c := cron.New(cron.WithSeconds()) ","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:7","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"é€‰é¡¹ cronå¯¹è±¡åˆ›å»ºä½¿ç”¨äº†é€‰é¡¹æ¨¡å¼ï¼Œæˆ‘ä»¬å‰é¢å·²ç»ä»‹ç»äº† 3 ä¸ªé€‰é¡¹ï¼š WithLocationï¼šæŒ‡å®šæ—¶åŒºï¼› WithParserï¼šä½¿ç”¨è‡ªå®šä¹‰çš„è§£æå™¨ï¼› WithSecondsï¼šè®©æ—¶é—´æ ¼å¼æ”¯æŒç§’ï¼Œå®é™…ä¸Šå†…éƒ¨è°ƒç”¨äº†WithParserã€‚ cronè¿˜æä¾›äº†å¦å¤–ä¸¤ç§é€‰é¡¹ï¼š WithLoggerï¼šè‡ªå®šä¹‰Loggerï¼› WithChainï¼šJob åŒ…è£…å™¨ã€‚ WithLogger WithLoggerå¯ä»¥è®¾ç½®cronå†…éƒ¨ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„Loggerï¼š func main() { c := cron.New( cron.WithLogger( cron.VerbosePrintfLogger(log.New(os.Stdout, \"cron: \", log.LstdFlags)))) c.AddFunc(\"@every 1s\", func() { fmt.Println(\"hello world\") }) c.Start() time.Sleep(5 * time.Second) } ä¸Šé¢è°ƒç”¨cron.VerbosPrintfLogger()åŒ…è£…log.Loggerï¼Œè¿™ä¸ªloggerä¼šè¯¦ç»†è®°å½•cronå†…éƒ¨çš„è°ƒåº¦è¿‡ç¨‹ï¼š $ go run main.go cron: 2020/06/26 07:09:14 start cron: 2020/06/26 07:09:14 schedule, now=2020-06-26T07:09:14+08:00, entry=1, next=2020-06-26T07:09:15+08:00 cron: 2020/06/26 07:09:15 wake, now=2020-06-26T07:09:15+08:00 cron: 2020/06/26 07:09:15 run, now=2020-06-26T07:09:15+08:00, entry=1, next=2020-06-26T07:09:16+08:00 hello world cron: 2020/06/26 07:09:16 wake, now=2020-06-26T07:09:16+08:00 cron: 2020/06/26 07:09:16 run, now=2020-06-26T07:09:16+08:00, entry=1, next=2020-06-26T07:09:17+08:00 hello world cron: 2020/06/26 07:09:17 wake, now=2020-06-26T07:09:17+08:00 cron: 2020/06/26 07:09:17 run, now=2020-06-26T07:09:17+08:00, entry=1, next=2020-06-26T07:09:18+08:00 hello world cron: 2020/06/26 07:09:18 wake, now=2020-06-26T07:09:18+08:00 hello world cron: 2020/06/26 07:09:18 run, now=2020-06-26T07:09:18+08:00, entry=1, next=2020-06-26T07:09:19+08:00 cron: 2020/06/26 07:09:19 wake, now=2020-06-26T07:09:19+08:00 hello world cron: 2020/06/26 07:09:19 run, now=2020-06-26T07:09:19+08:00, entry=1, next=2020-06-26T07:09:20+08:0 æˆ‘ä»¬çœ‹çœ‹é»˜è®¤çš„Loggeræ˜¯ä»€ä¹ˆæ ·çš„ï¼š // logger.go var DefaultLogger Logger = PrintfLogger(log.New(os.Stdout, \"cron: \", log.LstdFlags)) func PrintfLogger(l interface{ Printf(string, ...interface{}) }) Logger { return printfLogger{l, false} } func VerbosePrintfLogger(l interface{ Printf(string, ...interface{}) }) Logger { return printfLogger{l, true} } type printfLogger struct { logger interface{ Printf(string, ...interface{}) } logInfo bool } WithChain Job åŒ…è£…å™¨å¯ä»¥åœ¨æ‰§è¡Œå®é™…çš„Jobå‰åæ·»åŠ ä¸€äº›é€»è¾‘ï¼š æ•è·panicï¼› å¦‚æœJobä¸Šæ¬¡è¿è¡Œè¿˜æœªç»“æŸï¼Œæ¨è¿Ÿæœ¬æ¬¡æ‰§è¡Œ; å¦‚æœJobä¸Šæ¬¡è¿è¡Œè¿˜æœªä»‹ç»ï¼Œè·³è¿‡æœ¬æ¬¡æ‰§è¡Œï¼› è®°å½•æ¯ä¸ªJobçš„æ‰§è¡Œæƒ…å†µã€‚ æˆ‘ä»¬å¯ä»¥å°†Chainç±»æ¯”ä¸º Web å¤„ç†å™¨çš„ä¸­é—´ä»¶ã€‚å®é™…ä¸Šå°±æ˜¯åœ¨Jobçš„æ‰§è¡Œé€»è¾‘å¤–åœ¨å°è£…ä¸€å±‚é€»è¾‘ã€‚æˆ‘ä»¬çš„å°è£…é€»è¾‘éœ€è¦å†™æˆä¸€ä¸ªå‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªJobç±»å‹ï¼Œè¿”å›å°è£…åçš„Jobã€‚cronä¸ºè¿™ç§å‡½æ•°å®šä¹‰äº†ä¸€ä¸ªç±»å‹JobWrapperï¼š // chain.go type JobWrapper func(Job) Job ç„¶åä½¿ç”¨ä¸€ä¸ªChainå¯¹è±¡å°†è¿™äº›JobWrapperç»„åˆåˆ°ä¸€èµ·ï¼š type Chain struct { wrappers []JobWrapper } func NewChain(c ...JobWrapper) Chain { return Chain{c} } è°ƒç”¨Chainå¯¹è±¡çš„Then(job)æ–¹æ³•åº”ç”¨è¿™äº›JobWrapperï¼Œè¿”å›æœ€ç»ˆçš„`Jobï¼š func (c Chain) Then(j Job) Job { for i := range c.wrappers { j = c.wrappers[len(c.wrappers)-i-1](j) } return j } æ³¨æ„åº”ç”¨JobWrapperçš„é¡ºåºã€‚ å†…ç½®JobWrapper cronå†…ç½®äº† 3 ä¸ªç”¨å¾—æ¯”è¾ƒå¤šçš„JobWrapperï¼š Recoverï¼šæ•è·å†…éƒ¨Jobäº§ç”Ÿçš„ panicï¼› DelayIfStillRunningï¼šè§¦å‘æ—¶ï¼Œå¦‚æœä¸Šä¸€æ¬¡ä»»åŠ¡è¿˜æœªæ‰§è¡Œå®Œæˆï¼ˆè€—æ—¶å¤ªé•¿ï¼‰ï¼Œåˆ™ç­‰å¾…ä¸Šä¸€æ¬¡ä»»åŠ¡å®Œæˆä¹‹åå†æ‰§è¡Œï¼› SkipIfStillRunningï¼šè§¦å‘æ—¶ï¼Œå¦‚æœä¸Šä¸€æ¬¡ä»»åŠ¡è¿˜æœªå®Œæˆï¼Œåˆ™è·³è¿‡æ­¤æ¬¡æ‰§è¡Œã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»ã€‚ Recover å…ˆçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ï¼š type panicJob struct { count int } func (p *panicJob) Run() { p.count++ if p.count == 1 { panic(\"oooooooooooooops!!!\") } fmt.Println(\"hello world\") } func main() { c := cron.New() c.AddJob(\"@every 1s\", cron.NewChain(cron.Recover(cron.DefaultLogger)).Then(\u0026panicJob{})) c.Start() time.Sleep(5 * time.Second) } panicJobåœ¨ç¬¬ä¸€æ¬¡è§¦å‘æ—¶ï¼Œè§¦å‘äº†panicã€‚å› ä¸ºæœ‰cron.Recover()ä¿æŠ¤ï¼Œåç»­ä»»åŠ¡è¿˜èƒ½æ‰§è¡Œï¼š go run main.go cron: 2020/06/27 14:02:00 panic, error=oooooooooooooops!!!, stack=... goroutine 18 [running]: github.com/robfig/cron/v3.Recover.func1.1.1(0x514ee0, 0xc0000044a0) D:/code/golang/pkg/mod/github.com/robfig/cron/v3@v3.0.1/chain.go:45 +0xbc panic(0x4cf380, 0x513280) C:/Go/src/runtime/panic.go:969 +0x174 main.(*panicJob).Run(0xc0000140e8) D:/code/golang/src/github.com/darjun/go-daily-lib/cron/recover/main.go:17 +0xba github.com/robfig/cron/v3.Recover.func1.1() D:/code/golang/pkg/mod/github.com/robfig/cron/v3@v3.0.1/chain.go:53 +0x6f github.com/robfig/cron/v3.FuncJob.Run(0xc000070390) D:/code/golang/pkg/mod/github.com/robfig/cron/v3@v3.0.1/cron.go:136 +0x2c github.com/robfig/cron/v3.(*Cron).startJob.func1(0xc00005c0a0, 0x514d20, 0xc000070390) D:/code/golang/pkg/mod/github.com/robfig/cron/v3@v3.0.1/cron.go:312 +0x68 created by github.com/robfig/cron/v3.(*Cron).startJob D:","date":"2023-11-11","objectID":"/posts/2023-11-11-go-cron/:1:8","tags":["Go","cron"],"title":"Go cron","uri":"/posts/2023-11-11-go-cron/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go gophåº“ é“¾æ¥åœ°å€ï¼š github.com/melbahja/goph github.com/serialt/goph (æ–¹ä¾¿æŒ‡å®šç«¯å£) ","date":"2023-11-10","objectID":"/posts/go-goth/:0:0","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ç‰¹æ€§ æ˜“äºä½¿ç”¨ï¼Œç®€åŒ– ssh apiã€‚ æ”¯æŒssh å¯†ç ã€ç§é’¥ï¼Œå¸¦å¯†ç çš„ç§é’¥ã€‚ æ”¯æŒä»æœ¬åœ°ä¸Šä¼ æ–‡ä»¶å’Œä»è¿œç¨‹ä¸‹è½½æ–‡ä»¶ã€‚ æ”¯æŒ ssh ä½¿ç”¨ ssh-agent è¿æ¥ä¼šè¯ã€‚ æ”¯æŒå¢åŠ ä¸»æœºåˆ° known_hosts æ–‡ä»¶ã€‚ ","date":"2023-11-10","objectID":"/posts/go-goth/:1:0","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å®‰è£… go get github.com/serialt/goph ","date":"2023-11-10","objectID":"/posts/go-goth/:2:0","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ä½¿ç”¨ç¤ºä¾‹ ","date":"2023-11-10","objectID":"/posts/go-goth/:3:0","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"1ã€ä½¿ç”¨æ‰§è¡Œå‘½ä»¤ package main import ( \"fmt\" \"log\" \"github.com/serialt/goph\" ) var Client *goph.Client func init() { auth, err := goph.Key(os.Getenv(\"HOME\")+\"/.ssh/id_rsa\", \"\") if err != nil { log.Fatalf(\"cat read the ssh private key: %v\", err) } client, err := goph.New(\"root\", \"10.10.16.10\", 22, auth) if err != nil { log.Fatalf(\"ssh link faild: %v\", err) } Client = client } func main() { result, err := Client.Run(\"date\") fmt.Printf(\"result: %v\\nerr: %v\", string(result), err) defer Client.Close() } ","date":"2023-11-10","objectID":"/posts/go-goth/:3:1","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"2ã€ä»å­—ç¬¦ä¸²ä¸­è¯»å–ç§é’¥ package main import ( \"fmt\" \"log\" \"github.com/serialt/goph\" ) var Client *goph.Client var sshkey = ` -----BEGIN OPENSSH PRIVATE KEY----- NeY6rItzuvwtiPa5etNiAAAAGnNlcmlhbHQgdHNlcmlhbHRAZ21haWwuY29tAQID NeY6rItzuvwtiPa5etNiAAAAGnNlcmlhbHQgdHNlcmlhbHRAZ21haWwuY29tAQID NeY6rItzuvwtiPa5etNiAAAAGnNlcmlhbHQgdHNlcmlhbHRAZ21haWwuY29tAQID AAAECptYaTKFA2Omsb67+FN2SPr3daBAA0IxpVwv5KYJ1QKWR98JYVP7/WAqffRO NeY6rItzuvwtiPa5etNiAAAAGnNlcmlhbHQgdHNlcmlhbHRAZ21haWwuY29tAQID -----END OPENSSH PRIVATE KEY----- ` func init() { auth, err := goph.RawKey(sshkey, \"\") if err != nil { log.Fatalf(\"cat read the ssh private key: %v\", err) } client, err := goph.New(\"root\", \"10.10.16.10\", 22, auth) if err != nil { log.Fatalf(\"ssh link faild: %v\", err) } Client = client } func main() { result, err := Client.Run(\"date\") fmt.Printf(\"result: %v\\nerr: %v\", string(result), err) defer Client.Close() } ","date":"2023-11-10","objectID":"/posts/go-goth/:3:2","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"3ã€å¯†é’¥å¸¦å¯†ç  auth, err := goph.Key(os.Getenv(\"HOME\")+\"/.ssh/id_rsa\", \"you_passphrase_here\") if err != nil { // handle error } client, err := goph.New(\"root\", \"192.1.1.3\", auth) ","date":"2023-11-10","objectID":"/posts/go-goth/:3:3","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"4ã€ä½¿ç”¨å¯†ç  auth, err := goph.UseAgent() if err != nil { // handle error } client, err := goph.New(\"root\", \"192.1.1.1\", auth) ","date":"2023-11-10","objectID":"/posts/go-goth/:3:4","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"5ã€ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ // upload local file to remote err := client.Upload(\"/path/to/local/file\", \"/path/to/remote/file\") // download remote file to local err := client.Download(\"/path/to/remote/file\", \"/path/to/local/file\") ","date":"2023-11-10","objectID":"/posts/go-goth/:3:5","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"6ã€æ‰§è¡Œshellå‘½ä»¤ // execute bash commands out, err := client.Run(\"bash -c 'printenv'\") // execute bash command whith timeout context, cancel := context.WithTimeout(ctx, time.Second) defer cancel() // will send SIGINT and return error after 1 second out, err := client.RunContext(ctx, \"sleep 5\") // execute bash command whith env variables out, err := client.Run(`env MYVAR=\"MY VALUE\" bash -c 'echo $MYVAR;'`) ","date":"2023-11-10","objectID":"/posts/go-goth/:3:6","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"7ã€ä½¿ç”¨goph cmd Goph.Cmd struct is like the Go standard os/exec.Cmd. // Get new `Goph.Cmd` cmd, err := client.Command(\"ls\", \"-alh\", \"/tmp\") // or with context: // cmd, err := client.CommandContext(ctx, \"ls\", \"-alh\", \"/tmp\") if err != nil { // handle the error! } // You can set env vars, but the server must be configured to `AcceptEnv line`. cmd.Env = []string{\"MY_VAR=MYVALUE\"} // Run you command. err = cmd.Run() ust like os/exec.Cmd you can run CombinedOutput, Output, Start, Wait, and ssh.Session methods like Signalâ€¦ ","date":"2023-11-10","objectID":"/posts/go-goth/:3:7","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"8ã€ä½¿ç”¨sftpæ“ä½œæ–‡ä»¶ç³»ç»Ÿ sftp, err := client.NewSftp() if err != nil { // handle the error! } file, err := sftp.Create(\"/tmp/remote_file\") file.Write([]byte(`Hello world`)) file.Close() For more file operations see SFTP Docs. ","date":"2023-11-10","objectID":"/posts/go-goth/:3:8","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"å®˜æ–¹ç¤ºä¾‹ package main import ( \"bufio\" \"context\" \"errors\" \"flag\" \"fmt\" \"log\" \"net\" \"os\" osuser \"os/user\" \"path/filepath\" \"strings\" \"time\" \"github.com/pkg/sftp\" \"github.com/serialt/goph\" \"golang.org/x/crypto/ssh\" \"golang.org/x/crypto/ssh/terminal\" ) // // Run command and auth via password: // \u003e go run main.go --ip 192.168.122.102 --pass --cmd ls // // Run command and auth via private key: // \u003e go run main.go --ip 192.168.122.102 --cmd ls // Or: // \u003e go run main.go --ip 192.168.122.102 --key /path/to/private_key --cmd ls // // Run command and auth with private key and passphrase: // \u003e go run main.go --ip 192.168.122.102 --passphrase --cmd ls // // Run a command and interrupt it after 1 second: // \u003e go run main.go --ip 192.168.122.102 --cmd \"sleep 10\" --timeout=1s // // You can test with the interactive mode without passing --cmd flag. // var ( err error auth goph.Auth client *goph.Client addr string user string port uint key string cmd string pass bool passphrase bool timeout time.Duration agent bool sftpc *sftp.Client ) func init() { usr, err := osuser.Current() if err != nil { fmt.Println(\"couldn't determine current user. defaulting to 'root'\") usr.Username = \"root\" } flag.StringVar(\u0026addr, \"ip\", \"127.0.0.1\", \"machine ip address.\") flag.StringVar(\u0026user, \"user\", usr.Username, \"ssh user.\") flag.UintVar(\u0026port, \"port\", 22, \"ssh port number.\") flag.StringVar(\u0026key, \"key\", filepath.Join(os.Getenv(\"HOME\"), \".ssh\", \"id_rsa\"), \"private key path.\") flag.StringVar(\u0026cmd, \"cmd\", \"\", \"command to run.\") flag.BoolVar(\u0026pass, \"pass\", false, \"ask for ssh password instead of private key.\") flag.BoolVar(\u0026agent, \"agent\", false, \"use ssh agent for authentication (unix systems only).\") flag.BoolVar(\u0026passphrase, \"passphrase\", false, \"ask for private key passphrase.\") flag.DurationVar(\u0026timeout, \"timeout\", 0, \"interrupt a command with SIGINT after a given timeout (0 means no timeout)\") } func VerifyHost(host string, remote net.Addr, key ssh.PublicKey) error { // // If you want to connect to new hosts. // here your should check new connections public keys // if the key not trusted you shuld return an error // // hostFound: is host in known hosts file. // err: error if key not in known hosts file OR host in known hosts file but key changed! hostFound, err := goph.CheckKnownHost(host, remote, key, \"\") // Host in known hosts but key mismatch! // Maybe because of MAN IN THE MIDDLE ATTACK! if hostFound \u0026\u0026 err != nil { return err } // handshake because public key already exists. if hostFound \u0026\u0026 err == nil { return nil } // Ask user to check if he trust the host public key. if askIsHostTrusted(host, key) == false { // Make sure to return error on non trusted keys. return errors.New(\"you typed no, aborted!\") } // Add the new host to known hosts file. return goph.AddKnownHost(host, remote, key, \"\") } func main() { flag.Parse() var err error if agent || goph.HasAgent() { auth, err = goph.UseAgent() } else if pass { auth = goph.Password(askPass(\"Enter SSH Password: \")) } else { auth, err = goph.Key(key, getPassphrase(passphrase)) } if err != nil { panic(err) } client, err = goph.NewConn(\u0026goph.Config{ User: user, Addr: addr, Port: port, Auth: auth, Callback: VerifyHost, }) if err != nil { panic(err) } // Close client net connection defer client.Close() // If the cmd flag exists if cmd != \"\" { ctx := context.Background() // create a context with timeout, if supplied in the argumetns if timeout \u003e 0 { var cancel context.CancelFunc ctx, cancel = context.WithTimeout(ctx, timeout) defer cancel() } out, err := client.RunContext(ctx, cmd) fmt.Println(string(out), err) return } // else open interactive mode. playWithSSHJustForTestingThisProgram(client) } func askPass(msg string) string { fmt.Print(msg) pass, err := terminal.ReadPassword(0) if err != nil { panic(err) } fmt.Println(\"\") return strings.TrimSpace(string(pass)) } func getPassphrase(ask bool) string { if ask { return askPass(\"Enter Private Key Passphrase: \") } return \"\" } func askIsHostTrusted(host string, key ssh.Public","date":"2023-11-10","objectID":"/posts/go-goth/:4:0","tags":["Go","goph","ssh","sftp"],"title":"Go goph","uri":"/posts/go-goth/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"é•œåƒåŒæ­¥ å‚è€ƒé“¾æ¥ï¼š https://lework.github.io/2020/04/13/skopeo/ https://blog.k8s.li/skopeo.html æ—¥å¸¸å·¥ä½œä¸­ï¼Œéœ€è¦å°†å„ç§é•œåƒæ¬åˆ°å¯¹åº”çš„ä»“åº“ä¸­ï¼Œdocker é€‚åˆäºæ„å»ºé•œåƒï¼Œå°†é•œåƒæ¨é€äºä»“åº“ä¸­ã€‚é•œåƒè¢«æ¨é€åˆ°ä»“åº“ä¸­åï¼Œå¦‚æœéœ€è¦å¯¹é•œåƒè¿›è¡Œæ¬è¿ï¼Œåœ¨ä»“åº“ä¸æä¾›è¿™ä¸ªåŠŸèƒ½çš„æƒ…å†µä¸‹ï¼ŒåŒæ­¥é•œåƒæ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚ skopeo æ˜¯çº¢å¸½å¼€æºçš„å®¹å™¨é•œåƒç®¡ç†å·¥å…·ã€‚ç›¸æ¯”äºdockerï¼Œå®ƒæœ‰ä¸€ä¸‹çš„ä¼˜ç‚¹ï¼š æ”¯æŒå¤šä¸ªå¹³å°ï¼šskopeo æ”¯æŒ Linuxï¼ŒMac å’Œ Windowsã€‚ æ— éœ€ docker æˆ–è€… podmanï¼šskopeo å¯ä»¥æ„å»ºä¸ºå•ä¸€çš„ cliï¼Œä¸ä¾èµ–äº docker æœåŠ¡æˆ–è€… podmanã€‚ æ”¯æŒå¤šä¸ª OCI é•œåƒä»“åº“é—´åŒæ­¥ï¼šæ”¯æŒ OCI çš„é•œåƒæ‰˜ç®¡æœåŠ¡ï¼Œéƒ½å¯ä»¥ç›¸äº’åŒæ­¥ã€‚ æ”¯æŒå¤šæ¶æ„é•œåƒåŒæ­¥ï¼šå¯ä»¥åŒæ­¥å¤šç§æ¶æ„çš„é•œåƒã€‚ é•œåƒéªŒç­¾ï¼šskopeo æ”¯æŒé•œåƒç­¾åï¼Œå¯ç¡®ä¿é•œåƒçš„å®Œæ•´æ€§å’Œå¯é æ€§ã€‚ ","date":"2023-11-08","objectID":"/posts/skopeo/:0:0","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"ä¸€ã€ç¼–è¯‘skopeo skopeo å®˜æ–¹å¹¶ä¸æä¾›ç¼–è¯‘å¥½çš„é™æ€äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¸¸è§çš„ç³»ç»Ÿæºä¸­å·²ç»åŒ…å«äº† skopeoï¼Œä½†ç”±äº skopeo çš„ç‰ˆæœ¬è¿­ä»£æ¯”è¾ƒå¿«ï¼Œæ–°çš„åŠŸèƒ½ä¹Ÿéšä¹‹å¢åŠ ï¼Œéƒ¨åˆ†æ“ä½œç³»ç»Ÿé‡Œæä¾›çš„å®‰è£…åŒ…ç‰ˆæœ¬å¯èƒ½æ¯”è¾ƒä½ï¼Œæ— æ³•é€‚ç”¨ï¼Œä¸” skopeo å¤§å¤šéƒ½æ˜¯é“¾æ¥äº†åŠ¨æ€åº“ï¼Œæ— æ³•é€šç”¨äºå¤šä¸ª linux å‘è¡Œç‰ˆï¼Œå› æ­¤å¯ä»¥å€ŸåŠ©dockerå®ç°skopeoçš„é™æ€ç¼–è¯‘ã€‚ åŸºäºgithub actionæ„å»ºskopeo: skopeo ","date":"2023-11-08","objectID":"/posts/skopeo/:1:0","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"ä¸‹è½½ skopeo æºç  # download source code git clone --depth=1 https://github.com/containers/skopeo.git ","date":"2023-11-08","objectID":"/posts/skopeo/:1:1","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"æ„å»ºbuildé•œåƒçš„Dockerfile å›½å†…æ„å»ºåˆ™éœ€è¦ä¿®æ”¹ alpine å’Œ go é•œåƒåœ°å€ï¼Œå¯ç›´è¿ github çš„å¯ä»¥å¿½ç•¥æ­¤æ­¥ FROM golang:1.19-alpine3.16 AS builder ENV LANG=C.UTF-8 ENV TZ=Asia/Shanghai ENV CGO_ENABLED=0 ENV GOPROXY=https://goproxy.cn,direct RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories RUN apk update --no-cache \u0026\u0026 apk add --no-cache ca-certificates ","date":"2023-11-08","objectID":"/posts/skopeo/:1:2","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"æ„å»º build é•œåƒ docker build -t skopeo-build . ","date":"2023-11-08","objectID":"/posts/skopeo/:1:3","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"æ„å»º skopeo é™æ€äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ cd skopeo/ # æ„å»º linux amd64 æ¶æ„ docker run --rm -t -v $PWD:/build skopeo-build sh -c \"apk update \u0026\u0026 apk add gpgme btrfs-progs-dev llvm13-dev gcc musl-dev \u0026\u0026 cd /build \u0026\u0026 CGO_ENABLE=0 GO111MODULE=on GOOS=linux GOARCH=amd64 go build -mod=vendor '-buildmode=pie' -ldflags '-extldflags -static' -gcflags '' -tags 'exclude_graphdriver_devicemapper exclude_graphdriver_btrfs containers_image_openpgp' -o ./bin/skopeo-linux-amd64 ./cmd/skopeo \" # æ„å»º linux arm64 æ¶æ„ docker run --rm -t -v $PWD:/build skopeo-build sh -c \"apk update \u0026\u0026 apk add gpgme btrfs-progs-dev llvm13-dev gcc musl-dev \u0026\u0026 cd /build \u0026\u0026 CGO_ENABLE=0 GO111MODULE=on GOOS=linux GOARCH=arm64 go build -mod=vendor '-buildmode=pie' -ldflags '-extldflags -static' -gcflags '' -tags 'exclude_graphdriver_devicemapper exclude_graphdriver_btrfs containers_image_openpgp' -o ./bin/skopeo-linux-arm64 ./cmd/skopeo \" ","date":"2023-11-08","objectID":"/posts/skopeo/:1:4","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"äºŒã€skopeo å‘½ä»¤ä½¿ç”¨ [root@tc ~]# skopeo -v skopeo version 1.11.1-dev [root@tc ~]# skopeo --help Various operations with container images and container image registries Usage: skopeo [flags] skopeo [command] Available Commands: copy Copy an IMAGE-NAME from one location to another delete Delete image IMAGE-NAME generate-sigstore-key Generate a sigstore public/private key pair help Help about any command inspect Inspect image IMAGE-NAME list-tags List tags in the transport/repository specified by the SOURCE-IMAGE login Login to a container registry logout Logout of a container registry manifest-digest Compute a manifest digest of a file standalone-sign Create a signature using local files standalone-verify Verify a signature using local files sync Synchronize one or more images from one location to another Flags: --command-timeout duration timeout for the command execution --debug enable debug output -h, --help help for skopeo --insecure-policy run the tool without any policy check --override-arch ARCH use ARCH instead of the architecture of the machine for choosing images --override-os OS use OS instead of the running OS for choosing images --override-variant VARIANT use VARIANT instead of the running architecture variant for choosing images --policy string Path to a trust policy file --registries.d DIR use registry configuration files in DIR (e.g. for container signature storage) --tmpdir string directory used to store temporary files -v, --version Version for Skopeo Use \"skopeo [command] --help\" for more information about a command. # ç™»å½•ä¸ç™»å‡º oci skopeo login -u username docker.io skopeo logout docker.io ä¸ä¸‹è½½é•œåƒæƒ…å†µä¸‹è·å–é•œåƒä¿¡æ¯ [root@tc ~]# skopeo inspect docker://docker.io/alpine { \"Name\": \"docker.io/library/alpine\", \"Digest\": \"sha256:eece025e432126ce23f223450a0326fbebde39cdf496a85d8c016293fc851978\", \"RepoTags\": [ \"20220316\", \"20220328\", \"20220715\", \"20221110\", \"20230208\", \"20230329\", \"20230901\", \"3\", \"3.17\", \"3.17.0\", \"3.17.0_rc1\", \"3.17.1\", \"3.17.2\", \"3.17.3\", \"3.17.4\", \"3.17.5\", \"3.18\", \"3.18.0\", \"3.18.2\", \"3.18.3\", \"3.18.4\", \"edge\", \"latest\" ], \"Created\": \"2023-09-28T21:19:27.801479409Z\", \"DockerVersion\": \"20.10.23\", \"Labels\": null, \"Architecture\": \"amd64\", \"Os\": \"linux\", \"Layers\": [ \"sha256:96526aa774ef0126ad0fe9e9a95764c5fc37f409ab9e97021e7b4775d82bf6fa\" ], \"LayersData\": [ { \"MIMEType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"Digest\": \"sha256:96526aa774ef0126ad0fe9e9a95764c5fc37f409ab9e97021e7b4775d82bf6fa\", \"Size\": 3401967, \"Annotations\": null } ], \"Env\": [ \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\" ] } docker://: æ˜¯ä½¿ç”¨ Docker Registry HTTP API V2 è¿›è¡Œè¿æ¥è¿œç«¯ docker.io: è¿œç¨‹ä»“åº“ alpine: é•œåƒåç§° è·å–æœ¬åœ°é•œåƒä¿¡æ¯ [root@tc ~]# skopeo inspect docker-daemon:alpine:3 { \"Name\": \"docker.io/library/alpine\", \"Digest\": \"sha256:844bc35fdf7a96e5b6bf5e76e20989a797cc75976fad73275061a36f448b92b9\", \"RepoTags\": [], \"Created\": \"2023-09-28T21:19:27.801479409Z\", \"DockerVersion\": \"20.10.23\", \"Labels\": null, \"Architecture\": \"amd64\", \"Os\": \"linux\", \"Layers\": [ \"sha256:cc2447e1835a40530975ab80bb1f872fbab0f2a0faecf2ab16fbbb89b3589438\" ], \"LayersData\": [ { \"MIMEType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"Digest\": \"sha256:cc2447e1835a40530975ab80bb1f872fbab0f2a0faecf2ab16fbbb89b3589438\", \"Size\": 7625728, \"Annotations\": null } ], \"Env\": [ \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\" ] } docker-daemon: dockerå®ˆæŠ¤é•œåƒçš„é•œåƒ alpine:3: æœ¬åœ°é•œåƒçš„åç§° ","date":"2023-11-08","objectID":"/posts/skopeo/:2:0","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"copyé•œåƒ # skopeo --insecure-policy copy docker://nginx:1.17.6 docker-archive:/tmp/nginx.tar Getting image source signatures Copying blob 8ec398bc0356 done Copying blob 465560073b6f done Copying blob f473f9fd0a8c done Copying config f7bb5701a3 done Writing manifest to image destination Storing signatures # ls -alh /tmp/nginx.tar -rw-r--r-- 1 root root 125M 4æœˆ 13 15:22 /tmp/nginx.tar --insecure-policy: ç”¨äºå¿½ç•¥å®‰å…¨ç­–ç•¥é…ç½®æ–‡ä»¶ docker://nginx:1.17.6: è¯¥å‘½ä»¤å°†ä¼šç›´æ¥é€šè¿‡ http ä¸‹è½½ç›®æ ‡é•œåƒ docker-archive: å­˜å‚¨ä¸º /tmp/nginx.tarï¼Œæ­¤æ–‡ä»¶å¯ä»¥ç›´æ¥é€šè¿‡ docker load å‘½ä»¤å¯¼å…¥ ç›¸åº”çš„ï¼Œå¯ä»¥å°†ä¸‹è½½çš„æ–‡ä»¶å¯¼å…¥åˆ°æœ¬åœ° # skopeo copy docker-archive:/tmp/nginx.tar docker-daemon:nginx:latest Getting image source signatures Copying blob 556c5fb0d91b done Copying blob 49434cc20e95 done Copying blob 75248c0d5438 done Copying config f7bb5701a3 done Writing manifest to image destination Storing signatures # docker images nginx REPOSITORY TAG IMAGE ID CREATED SIZE nginx latest f7bb5701a33c 3 months ago 126MB COPY # ä¹Ÿå¯ä»¥å°†é•œåƒä¸‹è½½åˆ°æŒ‡å®šç›®å½• # skopeo copy docker://busybox:latest dir:/tmp/busybox Getting image source signatures Copying blob 0669b0daf1fb done Copying config 83aa35aa1c done Writing manifest to image destination Storing signatures # ls -alh /tmp/busybox/ æ€»ç”¨é‡ 760K drwxr-xr-x 2 root root 186 4æœˆ 13 15:26 . drwxrwxrwt. 12 root root 4.0K 4æœˆ 13 15:25 .. -rw-r--r-- 1 root root 743K 4æœˆ 13 15:26 0669b0daf1fba90642d105f3bc2c94365c5282155a33cc65ac946347a90d90d1 -rw-r--r-- 1 root root 1.5K 4æœˆ 13 15:26 83aa35aa1c79e4b6957e018da6e322bfca92bf3b4696a211b42502543c242d6f -rw-r--r-- 1 root root 527 4æœˆ 13 15:26 manifest.json -rw-r--r-- 1 root root 33 4æœˆ 13 15:25 version #æˆ–è€…ä»æŒ‡å®šç›®å½•å¯¼å…¥åˆ°æœ¬åœ° # skopeo copy dir:/tmp/busybox docker-daemon:busybox:latest Getting image source signatures Copying blob 0669b0daf1fb done Copying config 83aa35aa1c done Writing manifest to image destination Storing signatures # docker images busybox REPOSITORY TAG IMAGE ID CREATED SIZE busybox latest 83aa35aa1c79 4 weeks ago 1.22MB ","date":"2023-11-08","objectID":"/posts/skopeo/:2:1","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"åˆ é™¤é•œåƒ skopeo delete docker://localhost:5000/nginx:latest ","date":"2023-11-08","objectID":"/posts/skopeo/:2:2","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"è®¤è¯æ–‡ä»¶ è®¤è¯æ–‡ä»¶é»˜è®¤å­˜æ”¾åœ¨ $HOME/.docker/config.json æ–‡ä»¶å†…å®¹ { \"auths\": { \"myregistrydomain.com:5000\": { \"auth\": \"dGVzdHVzZXI6dGVzdHxxxxxxxx\", \"email\": \"cc@local.com\" } } } ","date":"2023-11-08","objectID":"/posts/skopeo/:2:3","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"sync åœ¨ OCI é—´åŒæ­¥é•œåƒ ä½¿ç”¨ docke råœ¨ OCI é—´åŒæ­¥é•œåƒçš„æ—¶å€™ï¼Œéœ€è¦å…ˆæŠŠé•œåƒæ‹‰ä¸‹æ¥ï¼Œæ‰“ä¸Š tag ï¼Œç„¶ååœ¨æ¨é€åˆ°ç›®çš„ OCI ä¸Šã€‚åœ¨è¿™ä¸ªæ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œå³å ç”¨äº†å­˜å‚¨ï¼Œåˆå ç”¨äº†å¸¦å®½ï¼Œåœ¨åŒæ­¥å¤§çš„é•œåƒæˆ–è€…å¤§é‡çš„é•œåƒçš„æ—¶å€™ï¼Œå­˜å‚¨ä¼šä¸¥é‡å½±å“é•œåƒåœ¨ OCI é—´åŒæ­¥çš„æ•ˆç‡ã€‚skopeo æ­£å¥½å¯ä»¥è§£å†³è¿™ä¸ªç¼ºç‚¹ï¼Œskopeo åœ¨åŒæ­¥ OCI é•œåƒçš„è¿‡ç¨‹ä¸­ï¼Œåªå ç”¨å¸¦å®½ï¼Œä¸ä¼šæŠŠé•œåƒä¸‹è½½åˆ°æœ¬åœ°ã€‚ åŸºäº yaml æ–‡ä»¶çš„åŒæ­¥ # sync.yaml ghcr.io: images: kube-vip/kube-vip: - 'v0.6.0' - 'v0.4.4' k3d-io/k3d-tools: - '5.5.2' åŒæ­¥é•œåƒ skopeo --insecure-policy sync -a --src yaml --dest docker sync.yaml repo.local.com/serialt ","date":"2023-11-08","objectID":"/posts/skopeo/:2:4","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"ä¸‰ã€åŒæ­¥é•œåƒ ç›®å‰ï¼Œå¸¸ç”¨çš„ OCI ä»“åº“æœ‰ï¼šdocker.ioï¼Œquay.ioï¼Œgcr.ioï¼Œregistry.k8s.ioï¼Œghcr.io ç­‰ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œå› ä¸ºæŸäº›åŸå› ï¼Œè¿™äº› OCI ä»“åº“åœ¨å›½å†…æ— æ³•è®¿é—®ï¼Œè€Œä¸€äº›é¡¹ç›®åˆä¸¥é‡ä¾èµ–äºå­˜å‚¨åœ¨è¿™äº› OCI ä»“åº“çš„é•œåƒï¼Œè™½ç„¶æœ‰çƒ­å¿ƒçš„å¤§ä½¬ä»¬ä¼šæŠŠ gcr å’Œ ghcr ä¸Šå­˜å‚¨çš„é•œåƒåŒæ­¥åˆ° docker hub ä¸­ï¼Œä½†å› ä¸ºè¿™äº›è¢«æ¨é€åˆ° docker hub ä¸­çš„é•œåƒä¸æ˜¯å®˜æ–¹ç»´æŠ¤çš„ï¼Œå¯èƒ½ä¼šå­˜åœ¨æ¯”è¾ƒå¤§çš„é•œåƒçš„åŒæ­¥æ—¶é—´å·®ï¼ŒæŸäº›éœ€è¦çš„é•œåƒæ— æ³•åœ¨ docker hub ä¸Šæ‰¾åˆ°ï¼ŒåŒæ—¶ä¹Ÿå®¹æ˜“å¼•èµ·å®¹å™¨é•œåƒçš„ä¾›åº”é“¾å®‰å…¨é—®é¢˜ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ github action ä½¿ç”¨ skopeo è¿›è¡ŒåŒæ­¥é•œåƒã€‚ é¡¹ç›®åœ°å€ï¼šsync-image ","date":"2023-11-08","objectID":"/posts/skopeo/:3:0","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"1ã€å®‰è£…sync-image å’Œ skopeo wget https://github.com/serialt/skopeo/releases/download/v1.13.3/skopeo-linux-amd64 go install github.com/serialt/sync-image@latest ","date":"2023-11-08","objectID":"/posts/skopeo/:3:1","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"2ã€é…ç½®sync-image yaml é…ç½®æ–‡ä»¶ # config.yaml # é•œåƒåŒæ­¥çš„ä¸ªæ•° last: 10 # mcråŒæ­¥çš„ä¸ªæ•°ï¼Œmcrä¸­åŒ…å«å¤šä¸ª vscode å®¹å™¨å¼€å‘çš„é•œåƒ mcrLast: 50 autoSyncfile: sync.yaml # ä¸åŒæ­¥å¸¦æœ‰ä»¥ä¸‹å…³é”®å­—çš„é•œåƒçš„tag exclude: - 'alpha' - 'beta' - 'rc' - 'amd64' - 'ppc64le' - 'arm64' - 'arm' - 's390x' - 'SNAPSHOT' - 'snapshot' - 'debug' - 'master' - 'latest' - 'main' - 'sig' - 'sha' - 'mips' # éœ€è¦åŒæ­¥çš„é•œåƒ images: docker.elastic.co: - elasticsearch/elasticsearch - kibana/kibana - logstash/logstash - beats/filebeat - beats/heartbeat - beats/packetbeat - beats/auditbeat - beats/journalbeat - beats/metricbeat - apm/apm-server - app-search/app-search quay.io: - coreos/flannel - ceph/ceph - cephcsi/cephcsi - csiaddons/k8s-sidecar - csiaddons/volumereplication-operator - prometheus/prometheus - prometheus/alertmanager - prometheus/pushgateway - prometheus/blackbox-exporter - prometheus/node-exporter - prometheus-operator/prometheus-config-reloader - prometheus-operator/prometheus-operator - brancz/kube-rbac-proxy - jetstack/cert-manager-webhook - jetstack/cert-manager-controller - jetstack/cert-manager-cainjector k8s.gcr.io: - conformance - dns/k8s-dns-node-cache - metrics-server/metrics-server - kube-state-metrics/kube-state-metrics - prometheus-adapter/prometheus-adapter registry.k8s.io: - sig-storage/local-volume-provisioner - metrics-server/metrics-server - defaultbackend - ingress-nginx/controller - ingress-nginx/kube-webhook-certgen - sig-storage/nfs-subdir-external-provisioner - sig-storage/csi-node-driver-registrar - sig-storage/csi-provisioner - sig-storage/csi-resizer - sig-storage/csi-snapshotter - sig-storage/snapshot-controller - sig-storage/snapshot-validation-webhook - sig-storage/nfsplugin - sig-storage/csi-attacher - sig-storage/livenessprobe - defaultbackend-amd64 - defaultbackend-arm64 - pause - etcd - kube-proxy - kube-apiserver - kube-scheduler - kube-controller-manager - coredns/coredns - build-image/kube-cross gcr.io: - kaniko-project/executor ghcr.io: - k3d-io/k3d-tools - k3d-io/k3d-proxy - kube-vip/kube-vip mcr.microsoft.com: - devcontainers/base - devcontainers/go docker.io: - flannel/flannel - flannel/flannel-cni-plugin - calico/kube-controllers - serialt/rocky - serialt/alma - calico/cni - calico/pod2daemon-flexvol - calico/kube-controllers - calico/node - rancher/mirrored-flannelcni-flannel-cni-plugin - rancher/mirrored-flannelcni-flanne ","date":"2023-11-08","objectID":"/posts/skopeo/:3:2","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"3ã€ç”ŸæˆåŠ¨æ€åŒæ­¥çš„ yaml æ–‡ä»¶ sync-image -c config.yaml ","date":"2023-11-08","objectID":"/posts/skopeo/:3:3","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"4ã€åŒæ­¥é•œåƒ ä¾èµ–çš„ç¯å¢ƒå˜é‡ DEST_HUB_USERNAME DEST_HUB_PASSWORD MY_GITHUB_TOKEN åŒæ­¥çš„shellè„šæœ¬ hub=\"docker.io\" repo=\"$hub/${DEST_HUB_USERNAME}\" hub2=\"registry.cn-hangzhou.aliyuncs.com\" repo2=\"$hub2/${DEST_HUB_USERNAME}\" if [ -f sync.yaml ]; then echo \"[Start] sync.......\" sudo skopeo login -u ${DEST_HUB_USERNAME} -p ${DEST_HUB_PASSWORD} ${hub} \\ \u0026\u0026 sudo skopeo --insecure-policy sync -a --src yaml --dest docker sync.yaml ${repo} \\ \u0026\u0026 sudo skopeo --insecure-policy sync -a --src yaml --dest docker custom_sync.yaml ${repo} sleep 3 sudo skopeo login -u ${DEST_HUB_USERNAME} -p ${DEST_HUB_PASSWORD} ${hub2} \\ \u0026\u0026 sudo skopeo --insecure-policy sync -a --src yaml --dest docker sync.yaml ${repo2} \\ \u0026\u0026 sudo skopeo --insecure-policy sync -a --src yaml --dest docker custom_sync.yaml ${repo2} echo \"[End] done.\" else echo \"[Error]not found sync.yaml!\" fi ","date":"2023-11-08","objectID":"/posts/skopeo/:3:4","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["åŒæ­¥ocié•œåƒ"],"content":"5ã€github action é…ç½®æ–‡ä»¶ name: sync on: push: branches: - master - main schedule: - cron: \"0 2 * * *\" # Allows you to run this workflow manually from the Actions tab workflow_dispatch: jobs: sync: runs-on: ubuntu-latest steps: - uses: actions/checkout@v4 - name: Set up Go uses: actions/setup-go@v4 with: go-version: '\u003e=1.21.0' - name: Install dependencies run: | export version=v1.10.0 \u0026\u0026 export arch=amd64 \u0026\u0026 sudo wget https://github.com/lework/skopeo-binary/releases/download/${version}/skopeo-linux-${arch} -O /usr/bin/skopeo \u0026\u0026 sudo chmod +x /usr/bin/skopeo skopeo --version go install github.com/serialt/sync-image@latest - name: generate_sync_yaml env: SRC_HUB_USERNAME: ${{ secrets.SRC_HUB_USERNAME }} DEST_HUB_USERNAME: ${{ secrets.DEST_HUB_USERNAME }} DEST_HUB_PASSWORD: ${{ secrets.DEST_HUB_PASSWORD }} MY_GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }} timeout-minutes: 10 run: | sync-image - name: sync image env: SRC_HUB_USERNAME: ${{ secrets.SRC_HUB_USERNAME }} DEST_HUB_USERNAME: ${{ secrets.DEST_HUB_USERNAME }} DEST_HUB_PASSWORD: ${{ secrets.DEST_HUB_PASSWORD }} run: | bash sync.sh ","date":"2023-11-08","objectID":"/posts/skopeo/:3:5","tags":["skopeo","image","oci-image-sync"],"title":"Skopeo","uri":"/posts/skopeo/"},{"categories":["morseç¼–ç "],"content":"Morse Code äºŒå‰æ ‘è®°å¿†æ³• start E T I A N M S U R W D K G O H V F L P J B X C Y Z Q . - E T .. .- -. -- I A N M ... ..- .-. ..- -.. -.- --. --- S U R W D K G O .... ...- ..-. .-.. .--. .--- -... -..- -.-. -.-- --.. --.- H v F L P J B X C Y Z Q ","date":"2023-11-08","objectID":"/posts/morse-code/:1:0","tags":["morse","morse-code"],"title":"Morse Code","uri":"/posts/morse-code/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"æ“ä½œç³»ç»Ÿæˆ–è€…è½¯ä»¶æ¢æºåŠ é€Ÿ ","date":"2023-11-07","objectID":"/posts/mirror-cn/:0:0","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"1ã€æ“ä½œç³»ç»Ÿ ","date":"2023-11-07","objectID":"/posts/mirror-cn/:1:0","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"rocky # 8 base sed -e 's|^mirrorlist=|#mirrorlist=|g' \\ -e 's|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.ustc.edu.cn/rocky|g' \\ -i.bak /etc/yum.repos.d/Rocky*.repo # 8 epel sed -e 's|^metalink=|#metalink=|g' \\ -e 's|^#baseurl=https\\?://download.fedoraproject.org/pub/epel/|baseurl=https://mirrors.ustc.edu.cn/epel/|g' \\ -e 's|^#baseurl=https\\?://download.example/pub/epel/|baseurl=https://mirrors.ustc.edu.cn/epel/|g' \\ -i.bak /etc/yum.repos.d/epel*.repo # 9 base sed -e 's|^mirrorlist=|#mirrorlist=|g' \\ -e 's|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.ustc.edu.cn/rocky|g' \\ -i.bak /etc/yum.repos.d/rocky*.repo # 9 epel sed -e 's|^metalink=|#metalink=|g' \\ -e 's|^#baseurl=https\\?://download.fedoraproject.org/pub/epel/|baseurl=https://mirrors.ustc.edu.cn/epel/|g' \\ -e 's|^#baseurl=https\\?://download.example/pub/epel/|baseurl=https://mirrors.ustc.edu.cn/epel/|g' \\ -i.bak /etc/yum.repos.d/epel*.repo ","date":"2023-11-07","objectID":"/posts/mirror-cn/:1:1","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"ubuntu # http sed -e \"s@http://.*archive.ubuntu.com@http://mirrors.aliyun.com@g\" \\ -e \"s@http://.*security.ubuntu.com@http://mirrors.aliyun.com@g\" \\ -i.bak -i /etc/apt/sources.list # https sed -e \"s@http://.*archive.ubuntu.com@https://mirrors.aliyun.com@g\" \\ -e \"s@http://.*security.ubuntu.com@https://mirrors.aliyun.com@g\" \\ -i.bak -i /etc/apt/sources.list ","date":"2023-11-07","objectID":"/posts/mirror-cn/:1:2","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"debian # debian 12åŠä»¥ä¸Š sed -i 's/\\w*.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list.d/debian.sources sed -i \"s@http://mirrors.ustc.edu.cn@https://mirrors.ustc.edu.cn@g\" /etc/apt/sources.list.d/debian.sources # debian 12ä»¥ä¸‹ sed -i 's/\\w*.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list sed -i \"s@http://mirrors.ustc.edu.cn@https://mirrors.ustc.edu.cn@g\" /etc/apt/sources.list ","date":"2023-11-07","objectID":"/posts/mirror-cn/:1:3","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"alpine # alpine å®˜æ–¹æº https://dl-cdn.alpinelinux.org/alpine/v3.18/main https://dl-cdn.alpinelinux.org/alpine/v3.18/community # ustc sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories # edge æº echo \"https://mirrors.ustc.edu.cn/alpine/edge/main\" \u003e\u003e /etc/apk/repositories echo \"https://mirrors.ustc.edu.cn/alpine/edge/community\" \u003e\u003e /etc/apk/repositories echo \"https://mirrors.ustc.edu.cn/alpine/edge/testing\" \u003e\u003e /etc/apk/repositories ","date":"2023-11-07","objectID":"/posts/mirror-cn/:1:4","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"2ã€å¼€å‘è¯­è¨€ç±» go export GOPROXY=https://goproxy.cn,direct # aliyun export GOPROXY=https://mirrors.aliyun.com/goproxy/ python export PIP_MIRROR=mirrors.aliyun.com echo -e \"[global]\\nindex-url=https://${PIP_MIRROR}/pypi/simple\\n[install]\\ntrusted-host=${PIP_MIRROR}\" \u003e /etc/pip.conf # å‘½ä»¤é…ç½® pip3 install xxx -i https://mirrors.aliyun.com/pypi/simple/ npm # è®¾ç½®å…¨å±€ npm config set registry https://registry.npmmirror.com # cmd npm install -y --registry=https://registry.npmmirror.com # å®˜æ–¹åœ°å€ https://registry.npmjs.org/ # é˜¿é‡Œäº‘åœ°å€ https://registry.npmmirror.com # è…¾è®¯ http://mirrors.cloud.tencent.com/npm/ # åä¸º https://repo.huaweicloud.com/repository/npm/ # å—äº¬å¤§å­¦ https://repo.nju.edu.cn/repository/npm/ ","date":"2023-11-07","objectID":"/posts/mirror-cn/:2:0","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["ç³»ç»Ÿæˆ–è½¯ä»¶æ¢æº"],"content":"3ã€å®¹å™¨ä»£ç† é…ç½®æ¨¡ç‰ˆ { \"insecure-registries\": [ \"repo.local.com\" ], \"exec-opts\": [ \"native.cgroupdriver=systemd\" ], \"registry-mirrors\": [ \"https://docker.mirrors.sjtug.sjtu.edu.cn\", \"https://docker.nju.edu.cn\", \"http://hub-mirror.c.163.com\" ], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"100m\", \"max-file\": \"3\" }, \"bip\":\"192.161.20.1/24\", \"dns\": [ \"119.29.29.29\", \"223.5.5.5\" ], \"data-root\": \"/var/lib/docker\", \"features\": { \"buildkit\": true } } docker registry # ä¸Šæµ·äº¤å¤§ https://docker.mirrors.sjtug.sjtu.edu.cn # å—äº¬å¤§å­¦ https://docker.nju.edu.cn # dockerproxy https://dockerproxy.com gcr.io # ä¸Šæµ·äº¤å¤§ https://gcr-io.mirrors.sjtug.sjtu.edu.cn # å—äº¬å¤§å­¦ https://gcr.nju.edu.cn # dockerproxy https://gcr.dockerproxy.com ghcr.io # å—äº¬å¤§å­¦ https://htghcr.nju.edu.cn # dockerproxy https://ghcr.dockerproxy.com nvcr.io # å—äº¬å¤§å­¦ https://nvcr.nju.edu.cn quay.io # å—äº¬å¤§å­¦ https://quay.nju.edu.cn # dockerproxy quay.dockerproxy.com registry.k8s.io # å—äº¬å¤§å­¦ k8s.mirror.nju.edu.cn # dockerproxy k8s.dockerproxy.com Microsoft Artifact Registry mcr.dockerproxy.com ","date":"2023-11-07","objectID":"/posts/mirror-cn/:3:0","tags":["mirror","source","mirror-to-cn"],"title":"To-mirror","uri":"/posts/mirror-cn/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"req Goè¯­è¨€äººæ€§åŒ–HTTPè¯·æ±‚åº“ ç‰¹æ€§ è½»é‡çº§ ç®€å• å®¹æ˜“æ“ä½œJSONå’ŒXML å®¹æ˜“è°ƒè¯•å’Œæ—¥å¿—è®°å½• å®¹æ˜“ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ å®¹æ˜“ç®¡ç†Cookie å®¹æ˜“è®¾ç½®ä»£ç† å®¹æ˜“è®¾ç½®è¶…æ—¶ å®¹æ˜“è‡ªå®šä¹‰HTTPå®¢æˆ·ç«¯ å®‰è£… go get github.com/serialt/req æ¦‚è¦ req åŸºäºæ ‡å‡†åº“ net/http å®ç°äº†ä¸€ä¸ªå‹å¥½çš„API. Req å’Œ Resp æ˜¯ä¸¤ä¸ªæœ€é‡è¦çš„ç»“æ„ä½“, ä½ å¯ä»¥æŠŠ Req çœ‹ä½œå®¢æˆ·ç«¯ï¼Œ æŠŠResp çœ‹ä½œå­˜æ”¾è¯·æ±‚åŠå…¶å“åº”çš„å®¹å™¨ï¼Œå®ƒä»¬éƒ½æä¾›è®¸å¤šç®€æ´æ–¹ä¾¿çš„APIï¼Œè®©ä½ å¯ä»¥å¾ˆè½»æ¾åšå¾ˆå¤šå¾ˆå¤šäº‹æƒ…ã€‚ func (r *Req) Post(url string, v ...interface{}) (*Resp, error) å¤§å¤šæƒ…å†µä¸‹ï¼Œå‘èµ·è¯·æ±‚åªæœ‰urlæ˜¯å¿…é€‰å‚æ•°ï¼Œå…¶å®ƒéƒ½å¯é€‰ï¼Œæ¯”å¦‚è¯·æ±‚å¤´ã€è¯·æ±‚å‚æ•°ã€æ–‡ä»¶æˆ–è¯·æ±‚ä½“ç­‰ã€‚ åŒ…ä¸­å«ä¸€ä¸ªé»˜è®¤çš„ Req å¯¹è±¡, å®ƒæ‰€æœ‰çš„å…¬æœ‰æ–¹æ³•éƒ½è¢«reqåŒ…å¯¹åº”çš„å…¬æœ‰æ–¹æ³•åŒ…è£…äº†ï¼Œæ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ç›´æ¥å¯ä»¥æŠŠreqåŒ…çœ‹ä½œä¸€ä¸ªReqå¯¹è±¡æ¥ä½¿ç”¨ã€‚ // åˆ›å»ºReqå¯¹è±¡æ¥å‘èµ·è¯·æ±‚ r := req.New() r.Get(url) // ç›´æ¥ä½¿ç”¨reqåŒ…å‘èµ·è¯·æ±‚ req.Get(url) ä½ å¯ä»¥ä½¿ç”¨ req.New() æ–¹æ³•æ¥åˆ›å»º *Req ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å®¢æˆ·ç«¯ ä¾‹å­ åŸºç¡€ç”¨æ³• è®¾ç½®è¯·æ±‚å¤´ è®¾ç½®è¯·æ±‚å‚æ•° è®¾ç½®è¯·æ±‚ä½“ è°ƒè¯• è¾“å‡ºæ ¼å¼ ToJSON \u0026 ToXML è·å– *http.Response ä¸Šä¼  ä¸‹è½½ Cookie è®¾ç½®è¶…æ—¶ è®¾ç½®ä»£ç† è‡ªå®šä¹‰ http.Client ","date":"2023-10-09","objectID":"/posts/req/:0:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"åŸºç¡€ç”¨æ³• header := req.Header{ \"Accept\": \"application/json\", \"Authorization\": \"Basic YWRtaW46YWRtaW4=\", } param := req.Param{ \"name\": \"imroc\", \"cmd\": \"add\", } // åªæœ‰urlå¿…é€‰ï¼Œå…¶å®ƒå‚æ•°éƒ½æ˜¯å¯é€‰ r, err = req.Post(\"http://foo.bar/api\", header, param) if err != nil { log.Fatal(err) } r.ToJSON(\u0026foo) // å“åº”ä½“è½¬æˆå¯¹è±¡ log.Printf(\"%+v\", r) // æ‰“å°è¯¦ç»†ä¿¡æ¯ ","date":"2023-10-09","objectID":"/posts/req/:1:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è®¾ç½®è¯·æ±‚å¤´ ä½¿ç”¨ req.Header (å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª map[string]string) authHeader := req.Header{ \"Accept\": \"application/json\", \"Authorization\": \"Basic YWRtaW46YWRtaW4=\", } req.Get(\"https://www.baidu.com\", authHeader, req.Header{\"User-Agent\": \"V1.1\"}) ä½¿ç”¨ http.Header header := make(http.Header) header.Set(\"Accept\", \"application/json\") req.Get(\"https://www.baidu.com\", header) ä½ å¯ä»¥ä½¿ç”¨ struct æ¥è®¾ç½®è¯·æ±‚å¤´ï¼Œç”¨ HeaderFromStruct è¿™ä¸ªå‡½æ•°æ¥è§£æä½ çš„ struct type HeaderStruct struct { UserAgent string `json:\"User-Agent\"` Authorization string `json:\"Authorization\"` } func main(){ h := HeaderStruct{ \"V1.0.0\", \"roc\", } authHeader := req.HeaderFromStruct(h) req.Get(\"https://www.baidu.com\", authHeader, req.Header{\"User-Agent\": \"V1.1\"}) } æ³¨ï¼šè¯·ç»™ä½ çš„ struct åŠ ä¸Š json tag. ","date":"2023-10-09","objectID":"/posts/req/:2:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è®¾ç½®è¯·æ±‚å‚æ•° Use req.Param (å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª map[string]interface{}) param := req.Param{ \"id\": \"imroc\", \"pwd\": \"roc\", } req.Get(\"http://foo.bar/api\", param) // http://foo.bar/api?id=imroc\u0026pwd=roc req.Post(url, param) // è¯·æ±‚ä½“ =\u003e id=imroc\u0026pwd=roc ä½¿ç”¨ req.QueryParam å¼ºåˆ¶å°†è¯·æ±‚å‚æ•°æ‹¼åœ¨urlåé¢ (å®ƒå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ª map[string]interface{}) req.Post(\"http://foo.bar/api\", req.Param{\"name\": \"roc\", \"age\": \"22\"}, req.QueryParam{\"access_token\": \"fedledGF9Hg9ehTU\"}) /* POST /api?access_token=fedledGF9Hg9ehTU HTTP/1.1 Host: foo.bar User-Agent: Go-http-client/1.1 Content-Length: 15 Content-Type: application/x-www-form-urlencoded;charset=UTF-8 Accept-Encoding: gzip age=22\u0026name=roc */ ","date":"2023-10-09","objectID":"/posts/req/:3:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è®¾ç½®è¯·æ±‚ä½“ Put string, []byte and io.Reader as body directly. req.Post(url, \"id=roc\u0026cmd=query\") å°†å¯¹è±¡ä½œä¸ºJSONæˆ–XMLè¯·æ±‚ä½“ï¼ˆè‡ªåŠ¨æ·»åŠ  Content-Type è¯·æ±‚å¤´ï¼‰ req.Post(url, req.BodyJSON(\u0026foo)) req.Post(url, req.BodyXML(\u0026bar)) ","date":"2023-10-09","objectID":"/posts/req/:4:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è°ƒè¯• å°†å…¨å±€å˜é‡ req.Debug è®¾ç½®ä¸ºtrueï¼Œå°†ä¼šæŠŠæ‰€æœ‰è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯æ‰“å°åœ¨æ ‡å‡†è¾“å‡ºã€‚ req.Debug = true req.Post(\"http://localhost/test\" \"hi\") ","date":"2023-10-09","objectID":"/posts/req/:5:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è¾“å‡ºæ ¼å¼ æ‚¨å¯ä»¥ä½¿ç”¨æŒ‡å®šç±»å‹çš„è¾“å‡ºæ ¼å¼åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•è¯·æ±‚å’Œå“åº”çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨å¼€å‘é˜¶æ®µä½¿ç”¨ï¼…+væ ¼å¼ï¼Œå¯ä»¥è®©ä½ è§‚å¯Ÿè¯·æ±‚å’Œå“åº”çš„ç»†èŠ‚ä¿¡æ¯ã€‚ åœ¨ç”Ÿäº§é˜¶æ®µä½¿ç”¨ï¼…væˆ–ï¼…-vè¾“å‡ºæ ¼å¼ï¼Œåªè®°å½•æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚ ","date":"2023-10-09","objectID":"/posts/req/:6:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"%+v æˆ– %+s è¯¦ç»†è¾“å‡º r, _ := req.Post(url, header, param) log.Printf(\"%+v\", r) // è¾“å‡ºæ ¼å¼å’ŒDebugå¼€å¯æ—¶çš„æ ¼å¼ä¸€æ · ","date":"2023-10-09","objectID":"/posts/req/:6:1","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"%v æˆ– %s ç®€å•è¾“å‡ºï¼ˆé»˜è®¤æ ¼å¼ï¼‰ r, _ := req.Get(url, param) log.Printf(\"%v\\n\", r) // GET http://foo.bar/api?name=roc\u0026cmd=add {\"code\":\"0\",\"msg\":\"success\"} log.Prinln(r) // å’Œä¸Šé¢ä¸€æ · ","date":"2023-10-09","objectID":"/posts/req/:6:2","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"%-v æˆ– %-s ç®€å•è¾“å‡ºå¹¶ä¿æŒæ‰€æœ‰å†…å®¹åœ¨ä¸€è¡Œå†…ï¼ˆè¯·æ±‚ä½“æˆ–å“åº”ä½“å¯èƒ½åŒ…å«å¤šè¡Œï¼Œè¿™ç§æ ¼å¼ä¼šå°†æ‰€æœ‰æ¢è¡Œã€å›è½¦æ›¿æ¢æˆ\" \", è¿™åœ¨ä¼šè®©ä½ åœ¨æŸ¥æ—¥å¿—çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼‰ ","date":"2023-10-09","objectID":"/posts/req/:6:3","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"Flag ä½ å¯ä»¥è°ƒç”¨ SetFlags æ§åˆ¶è¾“å‡ºå†…å®¹ï¼Œå†³å®šå“ªäº›éƒ¨åˆ†èƒ½å¤Ÿè¢«è¾“å‡ºã€‚ const ( LreqHead = 1 \u003c\u003c iota // è¾“å‡ºè¯·æ±‚é¦–éƒ¨ï¼ˆåŒ…å«è¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´ï¼‰ LreqBody // è¾“å‡ºè¯·æ±‚ä½“ LrespHead // è¾“å‡ºå“åº”é¦–éƒ¨ï¼ˆåŒ…å«å“åº”è¡Œå’Œå“åº”å¤´ï¼‰ LrespBody // è¾“å‡ºå“åº”ä½“ Lcost // è¾“å‡ºè¯·æ±‚æ‰€æ¶ˆè€—æ‰æ—¶é•¿ LstdFlags = LreqHead | LreqBody | LrespHead | LrespBody ) req.SetFlags(req.LreqHead | req.LreqBody | req.LrespHead) ","date":"2023-10-09","objectID":"/posts/req/:6:4","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"ç›‘æ§è¯·æ±‚è€—æ—¶ req.SetFlags(req.LstdFlags | req.Lcost) // è¾“å‡ºæ ¼å¼æ˜¾ç¤ºè¯·æ±‚è€—æ—¶ r,_ := req.Get(url) log.Println(r) // http://foo.bar/api 3.260802ms {\"code\":0 \"msg\":\"success\"} if r.Cost() \u003e 3 * time.Second { // æ£€æŸ¥è€—æ—¶ log.Println(\"WARN: slow request:\", r) } ","date":"2023-10-09","objectID":"/posts/req/:6:5","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"ToJSON \u0026 ToXML r, _ := req.Get(url) r.ToJSON(\u0026foo) r, _ = req.Post(url, req.BodyXML(\u0026bar)) r.ToXML(\u0026baz) ","date":"2023-10-09","objectID":"/posts/req/:7:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è·å– *http.Response // func (r *Req) Response() *http.Response r, _ := req.Get(url) resp := r.Response() fmt.Println(resp.StatusCode) ","date":"2023-10-09","objectID":"/posts/req/:8:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"ä¸Šä¼  ä½¿ç”¨ req.File åŒ¹é…æ–‡ä»¶ req.Post(url, req.File(\"imroc.png\"), req.File(\"/Users/roc/Pictures/*.png\")) ä½¿ç”¨ req.FileUpload ç»†ç²’åº¦æ§åˆ¶ä¸Šä¼  file, _ := os.Open(\"imroc.png\") req.Post(url, req.FileUpload{ File: file, FieldName: \"file\", // FieldName æ˜¯è¡¨å•å­—æ®µå FileName: \"avatar.png\", // Filename æ˜¯è¦ä¸Šä¼ çš„æ–‡ä»¶çš„åç§°ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥çŒœæµ‹mimetypeï¼Œå¹¶å°†å…¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Š }) ä½¿ç”¨req.UploadProgressç›‘å¬ä¸Šä¼ è¿›åº¦ progress := func(current, total int64) { fmt.Println(float32(current)/float32(total)*100, \"%\") } req.Post(url, req.File(\"/Users/roc/Pictures/*.png\"), req.UploadProgress(progress)) fmt.Println(\"upload complete\") ","date":"2023-10-09","objectID":"/posts/req/:9:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"ä¸‹è½½ r, _ := req.Get(url) r.ToFile(\"imroc.png\") ä½¿ç”¨req.DownloadProgressç›‘å¬ä¸‹è½½è¿›åº¦ progress := func(current, total int64) { fmt.Println(float32(current)/float32(total)*100, \"%\") } r, _ := req.Get(url, req.DownloadProgress(progress)) r.ToFile(\"hello.mp4\") fmt.Println(\"download complete\") ","date":"2023-10-09","objectID":"/posts/req/:10:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"Cookie é»˜è®¤æƒ…å†µä¸‹ï¼Œåº•å±‚çš„ *http.Client ä¼šè‡ªåŠ¨ç®¡ç†ä½ çš„cookieï¼ˆå¦‚æœæœåŠ¡å™¨ç»™ä½ å‘äº†cookieï¼Œä¹‹åçš„è¯·æ±‚å®ƒä¼šè‡ªåŠ¨å¸¦ä¸Šcookieè¯·æ±‚å¤´ç»™æœåŠ¡å™¨ï¼‰, ä½ å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•å–æ¶ˆè‡ªåŠ¨ç®¡ç†ï¼š req.EnableCookie(false) ä½ è¿˜å¯ä»¥åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™è‡ªå·±ä¼ å…¥ *http.Cookie cookie := new(http.Cookie) // ...... req.Get(url, cookie) ","date":"2023-10-09","objectID":"/posts/req/:11:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è®¾ç½®è¶…æ—¶ req.SetTimeout(50 * time.Second) ","date":"2023-10-09","objectID":"/posts/req/:12:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è®¾ç½®ä»£ç† é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœç³»ç»Ÿç¯å¢ƒå˜é‡æœ‰ http_proxy æˆ– https_proxy ï¼Œreqä¼šè®²å¯¹åº”çš„åœ°å€ä½œä¸ºå¯¹åº”åè®®çš„ä»£ç†ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è®¾ç½®ä»£ç†ï¼Œæˆ–è€…å°†å…¶ç½®ä¸ºnilï¼Œå³å–æ¶ˆä»£ç†ã€‚ req.SetProxy(func(r *http.Request) (*url.URL, error) { if strings.Contains(r.URL.Hostname(), \"google\") { return url.Parse(\"http://my.vpn.com:23456\") } return nil, nil }) è®¾ç½®ç®€å•ä»£ç†ï¼ˆå°†æ‰€æœ‰è¯·æ±‚éƒ½è½¬å‘åˆ°æŒ‡å®šä»£ç†urlåœ°å€ä¸Šï¼‰ req.SetProxyUrl(\"http://my.proxy.com:23456\") ","date":"2023-10-09","objectID":"/posts/req/:13:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go req åº“æ–‡æ¡£"],"content":"è‡ªå®šä¹‰HTTPå®¢æˆ·ç«¯ ä½¿ç”¨ SetClient æ”¹å˜åº•å±‚çš„ *http.Client req.SetClient(client) ç»™æŸä¸ªè¯·æ±‚åˆ¶å®šç‰¹å®šçš„ *http.Client client := \u0026http.Client{Timeout: 30 * time.Second} req.Get(url, client) æ”¹å˜åº•å±‚ *http.Client çš„æŸäº›å±æ€§ req.Client().Jar, _ = cookiejar.New(nil) trans, _ := req.Client().Transport.(*http.Transport) trans.MaxIdleConns = 20 trans.TLSHandshakeTimeout = 20 * time.Second trans.DisableKeepAlives = true trans.TLSClientConfig = \u0026tls.Config{InsecureSkipVerify: true} ","date":"2023-10-09","objectID":"/posts/req/:14:0","tags":["Go","http","req"],"title":"Go Http Client","uri":"/posts/req/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"Go åŸç”Ÿhttpåº“ Goè¯­è¨€å†…ç½®çš„net/httpåŒ…ååˆ†çš„ä¼˜ç§€ï¼Œæä¾›äº†HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å®ç°ã€‚ ","date":"2023-10-09","objectID":"/posts/go-http/:0:0","tags":["Go","http"],"title":"Go Http","uri":"/posts/go-http/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"ä¸€ã€net/httpä»‹ç» Goè¯­è¨€å†…ç½®çš„net/httpåŒ…æä¾›äº†HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å®ç°ã€‚ HTTPåè®® è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼ŒHyperText Transfer Protocol)æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œä¼ è¾“åè®®ï¼Œæ‰€æœ‰çš„WWWæ–‡ä»¶éƒ½å¿…é¡»éµå®ˆè¿™ä¸ªæ ‡å‡†ã€‚è®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚ ","date":"2023-10-09","objectID":"/posts/go-http/:1:0","tags":["Go","http"],"title":"Go Http","uri":"/posts/go-http/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"äºŒã€HTTPå®¢æˆ·ç«¯ Getã€Headã€Postå’ŒPostFormå‡½æ•°å‘å‡ºHTTP/HTTPSè¯·æ±‚ã€‚ resp, err := http.Get(\"http://example.com/\") ... resp, err := http.Post(\"http://example.com/upload\", \"image/jpeg\", \u0026buf) ... resp, err := http.PostForm(\"http://example.com/form\", url.Values{\"key\": {\"Value\"}, \"id\": {\"123\"}}) ç¨‹åºåœ¨ä½¿ç”¨å®Œresponseåå¿…é¡»å…³é—­å›å¤çš„ä¸»ä½“ã€‚ resp, err := http.Get(\"http://example.com/\") if err != nil { // handle error } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) // ... ","date":"2023-10-09","objectID":"/posts/go-http/:2:0","tags":["Go","http"],"title":"Go Http","uri":"/posts/go-http/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"GETè¯·æ±‚ç¤ºä¾‹ package main import ( \"fmt\" \"io\" \"net/http\" ) func main() { resp, err := http.Get(\"https://httpbin.org/uuid\") if err != nil { fmt.Printf(\"get failed, err:%v\\n\", err) return } defer resp.Body.Close() body, err := io.ReadAll(resp.Body) if err != nil { fmt.Printf(\"read from resp.Body failed, err:%v\\n\", err) return } fmt.Print(string(body)) } è‡ªå®šä¹‰è¯·æ±‚ package main import ( \"encoding/json\" \"fmt\" \"io\" \"net/http\" \"net/url\" ) type UUID struct { Uuid string `json:\"uuid\"` } func main() { apiURL := \"https://httpbin.org/uuid\" query := url.Values{} query.Add(\"q\", \"golang\") query.Add(\"page\", \"1\") ApiURL, _ := url.ParseRequestURI(apiURL) ApiURL.RawQuery = query.Encode() req, _ := http.NewRequest(\"GET\", ApiURL.String(), nil) req.Header.Add(\"Accept\", \"*/*\") client := \u0026http.Client{} resp, err := client.Do(req) if err != nil { return } defer resp.Body.Close() var uuid UUID body, err := io.ReadAll(resp.Body) if err != nil { fmt.Printf(\"read from resp.Body failed, err:%v\\n\", err) return } json.Unmarshal(body, \u0026uuid) fmt.Println(uuid.Uuid) } ","date":"2023-10-09","objectID":"/posts/go-http/:2:1","tags":["Go","http"],"title":"Go Http","uri":"/posts/go-http/"},{"categories":["Go åº“æ–‡æ¡£"],"content":"POST è¯·æ±‚ç¤ºä¾‹ package main import ( \"encoding/json\" \"io\" \"net/http\" \"net/url\" ) type dockerToken struct { Token string `json:\"token\"` } func main() { apiUrl := \"https://hub.docker.com/v2/users/login\" data := url.Values{} data.Set(\"username\", \"username\") data.Set(\"password\", \"password\") resp, err := http.PostForm(apiUrl, data) if err != nil { return } defer resp.Body.Close() _data, _ := io.ReadAll(resp.Body) var tmpT dockerToken json.Unmarshal(_data, \u0026tmpT) } package main import ( \"bytes\" \"io\" \"net/http\" \"net/url\" \"strings\" \"log/slog\" ) func POST1() { apiURL := \"https://httpbin.org/post\" form := url.Values{} form.Add(\"ln\", \"ln222\") form.Add(\"ip\", \"1.1.1.1\") form.Add(\"ua\", \"ua123\") client := \u0026http.Client{} req, _ := http.NewRequest(\"POST\", apiURL, strings.NewReader(form.Encode())) req.Header.Set(\"User-Agent\", \"test\") req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\") // å‘é€è¯·æ±‚ resp, err := client.Do(req) if err != nil { slog.Error(\"POST request failed\", \"err\", err) return } defer resp.Body.Close() // è¯»å–å†…å®¹ body, err := io.ReadAll(resp.Body) if err != nil { slog.Error(\"POST request\", \"err\", err) } else { slog.Info(string(body)) } } func POSTJson() { apiURL := \"https://httpbin.org/post\" var jsonStr = []byte(`{\"title\":\"this is a title\", \"cate\": 1}`) client := \u0026http.Client{} req, _ := http.NewRequest(\"POST\", apiURL, bytes.NewBuffer(jsonStr)) req.Header.Set(\"User-Agent\", \"test\") req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\") // å‘é€è¯·æ±‚ resp, err := client.Do(req) if err != nil { slog.Error(\"POST request failed\", \"err\", err) return } defer resp.Body.Close() // è¯»å–å†…å®¹ body, err := io.ReadAll(resp.Body) if err != nil { slog.Error(\"POST request\", \"err\", err) } else { slog.Info(string(body)) } } func main() { // POST1() POSTJson() } ","date":"2023-10-09","objectID":"/posts/go-http/:2:2","tags":["Go","http"],"title":"Go Http","uri":"/posts/go-http/"},{"categories":["Kubernetes"],"content":"Dev in kubernetes â€‹ ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼ä¸­ï¼Œæ˜¯ä»£ç å­˜æ”¾åœ¨æœ¬åœ°ï¼Œä½¿ç”¨ IDE è¿›è¡Œç¼–è¾‘å’Œ debug ã€‚ä½†éšç€å®¹å™¨åŒ–ç«äº†ä¹‹åï¼Œå¾ˆå¤šå•ä¸€æœåŠ¡éƒ½è¿›è¡Œäº†æ‹†åˆ†ï¼Œå¾®æœåŠ¡åŒ–ã€‚åœ¨å¼€å‘é˜¶æ®µï¼Œéœ€è¦æœ¬åœ°åŒæ—¶å¯åŠ¨å¤šä¸ªæœåŠ¡ï¼Œè¿™ä½¿å¾—æœ¬åœ°å¼€å‘è°ƒè¯•å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚Okteto æ˜¯ä¸€ä¸ªé€šè¿‡åœ¨ Kubernetes ä¸­æ¥å¼€å‘å’Œæµ‹è¯•ä»£ç çš„åº”ç”¨ç¨‹åºå¼€å‘å·¥å…·ã€‚å¯ä»¥é€šè¿‡ Okteto åœ¨ Kubernetes ä¸­ä¸€é”®ä¸ºæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå¼€å‘ç¯å¢ƒï¼Œéå¸¸ç®€å•æ–¹ä¾¿ã€‚Google æ¨å‡ºçš„ Skaffold åªæ˜¯æŠŠ CICD é›†æˆåˆ°æœ¬åœ°ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒå›°éš¾ã€‚Okteto çš„å·¥ä½œåŸç†æ˜¯åœ¨ kubernetes ä¸­å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼ŒæŠŠæœ¬åœ°ä»£ç åŒæ­¥åˆ° pod ä¸­ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤è®©æœåŠ¡è¿è¡Œèµ·æ¥ï¼ŒOkteto å¯ä»¥è¿›è¡Œç«¯å£çš„è½¬å‘ï¼Œè½¬å‘podé‡ŒæœåŠ¡çš„ç«¯å£åˆ°æœ¬åœ°ï¼Œåœ¨è¿›è¡Œ debug çš„æ—¶å€™ï¼Œpodé‡Œå¯åŠ¨çš„ç«¯å£å¯ä»¥è¢« kubernetes å†…çš„å…¶ä»–æœåŠ¡æ‰€è®¿é—®ï¼Œæœ¬åœ°è½¬å‘çš„ç«¯å£å¯ä»¥è¢«æœ¬åœ°çš„å·¥å…·ï¼ˆä¾‹å¦‚ postman ï¼‰è®¿é—®ã€‚ oktetoå®˜ç½‘æ–‡æ¡£ï¼šhttps://www.okteto.com/docs Go é…ç½®æ–‡æ¡£ï¼šhttps://www.okteto.com/docs/samples/golang/ ç¤ºä¾‹ç¯å¢ƒï¼š vscode 1.82.1(éœ€è¦å®‰è£… Remote - Kubernetes æ’ä»¶ï¼Œæ’ä»¶codeï¼šokteto.remote-kubernetes) k3d mac ","date":"2023-09-26","objectID":"/posts/okteto/:0:0","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"å®‰è£…ä¸é…ç½® ä¸‹è½½oktetoï¼šhttps://github.com/okteto/okteto/releases [crab@Sugar ~]ğŸ³ wget https://ghproxy.com/https://github.com/okteto/okteto/releases/download/2.20.0/okteto-Darwin-arm64 [crab@Sugar ~]ğŸ³ chmod +x okteto-Darwin-arm64 [crab@Sugar ~]ğŸ³ sudo mv okteto-Darwin-arm64 /usr/local/bin/okteto ","date":"2023-09-26","objectID":"/posts/okteto/:1:0","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"ä¸‹è½½ç¤ºä¾‹ä»£ç  [crab@Sugar ~]ğŸ³ git clone https://github.com/okteto/go-getting-started go-okteto [crab@Sugar ~]ğŸ³ cd go-okteto ","date":"2023-09-26","objectID":"/posts/okteto/:1:1","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"é…ç½®port-forwardç«¯å£ éœ€è¦è½¬å‘ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æœåŠ¡çš„ç«¯å£ï¼Œå¦ä¸€ä¸ªæ˜¯debugä½¿ç”¨çš„ç«¯å£ okteto.yaml build: hello-world: image: serialt/go-hello-world:1.0.0 context: . deploy: - kubectl apply -f k8s.yml dev: hello-world: # è¢«æ›¿æ¢çš„æœåŠ¡å image: okteto/golang:1 command: bash sync: - .:/usr/src/app volumes: - /go - /root/.cache securityContext: capabilities: add: - SYS_PTRACE forward: - 2345:2345 - 8080:8080 # \u003c---- å¢åŠ 8080æœåŠ¡ç«¯å£è½¬å‘ è®¾ç½®okteto contextï¼Œokteto é»˜è®¤ä¼šä¼˜å…ˆä½¿ç”¨KUBECONFIGç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨ ~/.kube/configæ–‡ä»¶ [crab@Sugar go-okteto]ğŸ³ okteto context âœ“ Context 'k3d-mycluster' selected âœ“ Using dev @ k3d-mycluster ","date":"2023-09-26","objectID":"/posts/okteto/:1:2","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"å¯åŠ¨æœåŠ¡ [crab@Sugar go-okteto]ğŸ³ okteto up i Using dev @ k3d-mycluster as context i 'go-getting-started' was already deployed. To redeploy run 'okteto deploy' or 'okteto up --deploy' i Images were already built. To rebuild your images run 'okteto build' or 'okteto deploy --build' âœ“ Images successfully pulled âœ“ Files synchronized Context: k3d-mycluster Namespace: dev Name: hello-world Forward: 2345 -\u003e 2345 8080 -\u003e 8080 Welcome to your development container. Happy coding! dev:hello-world app\u003e dev:hello-world app\u003e ls Dockerfile LICENSE Makefile README.md bashrc go.mod k8s.yml main.go okteto.yml ","date":"2023-09-26","objectID":"/posts/okteto/:1:3","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"è¿œç¨‹å¼€å‘ # oktetoç»ˆç«¯ dev:hello-world app\u003e go run main.go Starting hello-world server... # ç»ˆç«¯æµ‹è¯• [crab@Sugar ~]ğŸ³ curl 127.0.0.1:8080 Hello world! ","date":"2023-09-26","objectID":"/posts/okteto/:1:4","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["Kubernetes"],"content":"è¿œç¨‹è°ƒè¯• # oktetoç»ˆç«¯, æ‰§è¡Œdlvå‘½ä»¤ dev:hello-world app\u003e dlv debug --headless --listen=:2345 --log --api-version=2 API server listening at: [::]:2345 2023-09-26T13:40:51Z warning layer=rpc Listening for remote connections (connections are not authenticated nor encrypted) 2023-09-26T13:40:51Z info layer=debugger launching process with args: [./__debug_bin3213431902] 2023-09-26T13:40:51Z debug layer=debugger Adding target 575 \"/usr/src/app/__debug_bin3213431902\" # main.go æ‰“ä¸Šdebugæ ‡è®° func helloServer(w http.ResponseWriter, r *http.Request) { fmt.Fprint(w, \"Hello world from Okteto!, k3d is great! \") fmt.Println(\"okteto ccccccc\") # æ ‡è®°æ­¤è¡Œ } åœ¨vscode debugä¸­ç‚¹å‡»å¼€å§‹debug ä½¿ç”¨å‘½ä»¤è¯·æ±‚ http://127.0.0.1:8080ï¼Œå³å¯debugåˆ°æ ‡è®°ç‚¹ [sugar@Sugar go-okteto]ğŸ³ curl http://127.0.0.1:8080 Hello world from Okteto!, k3d is great! ","date":"2023-09-26","objectID":"/posts/okteto/:1:5","tags":["okteto","kubernetes","vscode","dev"],"title":"Okteto","uri":"/posts/okteto/"},{"categories":["vscode"],"content":"Debug shell 1ã€å®‰è£…æ’ä»¶ å®‰è£…bashdbæ’ä»¶ rogalmic.bash-debug 2ã€å¢åŠ ä¸€ä¸ªvscode launch.jsoné…ç½®æ–‡ä»¶ Select Debug -\u003e Add Configuration to add custom debug configuration ç¤ºä¾‹ï¼š { \"configurations\": [ { \"type\": \"bashdb\", \"request\": \"launch\", \"name\": \"Bash-Debug\", \"cwd\": \"${workspaceFolder}\", \"program\": \"${workspaceFolder}/ccc.sh\", \"args\": [] }, ] } å°±å¯ä»¥åƒdebugå…¶ä»–è¯­è¨€ä¸€æ ·è¿›è¡Œè°ƒè¯•shellè„šæœ¬ ","date":"2023-09-24","objectID":"/posts/debug-shell-in-vscode/:0:0","tags":["shell"],"title":"Debug Shell in VSCode","uri":"/posts/debug-shell-in-vscode/"},{"categories":["mirror-web"],"content":"æ¸…åé•œåƒç½‘é¡µæ­å»ºé•œåƒç«™ tuna mirror-webåœ°å€ï¼šhttps://github.com/tuna/mirror-web.git tuna mirror-webåŸºäºjekyllå¼€å‘ï¼Œç”±äºrubyç¯å¢ƒå®‰è£…å¤æ‚ï¼Œå› æ­¤é‡‡ç”¨dockerç¼–è¯‘ï¼Œä½†åœ¨buildé•œåƒçš„æ—¶å€™ï¼Œå‡ºç°å®‰è£…åŒ…ä¾èµ–å®‰è£…å¤±è´¥ï¼Œåœ¨å¤šæ¬¡æµ‹è¯•åï¼Œæ— æ³•buildæˆé•œåƒã€‚å‰æ®µæ—¶é—´ï¼Œåœ¨æŸ¥çœ‹mirror-webæ®µissuesæ—¶ï¼Œæœ‰äººè¯¢é—®mirror-webæ®µREADME.mdæ–‡æ¡£çš„ä¸‹ä¸€æ­¥ï¼Œå®˜æ–¹ç»™äº†ä¸€ç‚¹æç¤ºï¼Œæœ‰å…³äºåŸºäºnginxçš„ç¬¬ä¸‰æ–¹æ¨¡å—æ¥å®ç°ç›®å½•ç¬¬æ¸²æŸ“çš„æç¤ºè¯´æ˜ï¼Œå†æ¬¡å°è¯•åï¼Œç»å†å„ç§å›°éš¾å’ŒæŠ˜ç£¨ï¼Œç»ˆäºæ‘¸ç´¢å‡ºã€‚ ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:0","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"1ã€ä¸‹è½½mirror-webçš„jekyllç¼–è¯‘ç¯å¢ƒ tunaçš„ç¼–è¯‘é•œåƒï¼štunathu/mirror-web åœ¨ä¸‹è½½tunathu/mirror-webæ—¶å‘ç”Ÿäº†ä¸€ä¸ªå°é—®é¢˜ï¼Œç”±äºåœ¨å›½å†…ä½¿ç”¨çš„dockeré•œåƒåŠ é€Ÿï¼Œä¸‹è½½çš„é•œåƒæ˜¯æ—§ç‰ˆæœ¬çš„ï¼Œä½†å¢ƒå¤–çš„æœåŠ¡å™¨ä¸‹è½½çš„é•œåƒæ˜¯æœ€æ–°çš„ï¼Œåœ¨è¸©å‘åæœæ–­æ¨åˆ°è‡ªå·±çš„dockerhubä¸Šï¼Œæ–°çš„ä¸‹è½½åœ°å€ï¼šserialt/tuna-mirror-webã€‚ ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:1","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"2ã€ä¸‹è½½githubä»“åº“ git clone https://github.com/tuna/mirror-web.git /opt/mirror-web ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:2","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"3ã€ä¸‹è½½é¢å¤–èµ„æºå’Œç¼–è¯‘ cd /opt/mirror-web wget https://mirrors.tuna.tsinghua.edu.cn/static/tunasync.json -O static/tunasync.json wget https://mirrors.tuna.tsinghua.edu.cn/static/tunet.json -O static/tunet.json mkdir -p static/status wget https://mirrors.tuna.tsinghua.edu.cn/static/status/isoinfo.json -O static/status/isoinfo.json docker run -it -v /opt/mirror-web/:/data serialt/tuna-mirror-web:20211006 ç¼–è¯‘çš„åé™æ€æ–‡ä»¶åœ¨_siteé‡Œ ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:3","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"4ã€ç¼–è¯‘nginx éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å— modules/ngx_http_js_module.so modules/ngx_http_fancyindex_module.so [root@serialt nginx]# ll æ€»ç”¨é‡ 1068 drwxr-xr-x 9 sonar sonar 186 10æœˆ 5 22:27 nginx-1.20.1 -rw-r--r-- 1 root root 1061461 5æœˆ 25 23:34 nginx-1.20.1.tar.gz drwxrwxr-x 3 root root 217 10æœˆ 27 2020 ngx-fancyindex-0.5.1 -rw-r--r-- 1 root root 25148 10æœˆ 27 2020 ngx-fancyindex-0.5.1.tar.xz drwxr-xr-x 10 root root 228 10æœˆ 6 15:49 njs # njsä¸‹è½½ git clone https://github.com/nginx/njs # ngx-fancyindex ä¸‹è½½ wget https://github.com/aperezdc/ngx-fancyindex/releases/download/v0.5.1/ngx-fancyindex-0.5.1.tar.xz ç¼–è¯‘ï¼š [root@serialt nginx]# ls nginx-1.20.1 nginx-1.20.1.tar.gz ngx-fancyindex-0.5.1 ngx-fancyindex-0.5.1.tar.xz njs [root@serialt nginx]# cd nginx-1.20.1/ [root@serialt nginx-1.20.1]# ./configure --prefix=/usr/local/nginx --with-pcre --with-http_auth_request_module --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-mail --with-mail_ssl_module --with-stream --with-stream_ssl_module --with-stream_realip_module --add-dynamic-module=/root/nginx/ngx-fancyindex-0.5.1 --add-dynamic-module=/root/nginx/njs/nginx # add m 3997 [2022-02-25 00:49:21] [root] [10.5.0.10] ./configure --with-compat --add-dynamic-module=/root/github/tuna-mirror-web/njs-0.6.2/nginx 3998 [2022-02-25 00:49:31] [root] [10.5.0.10] make modules nginxé…ç½®æ–‡ä»¶å†…å®¹ [root@serialt mirrors]# cat /usr/local/nginx/conf/nginx.conf #user nobody; worker_processes 1; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; load_module modules/ngx_http_js_module.so; load_module modules/ngx_http_fancyindex_module.so; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; map $http_user_agent $isbrowser { default 0; \"~*validation server\" 0; \"~*mozilla\" 1; } js_path /opt/mirror-web/_site/static/njs; js_include /opt/mirror-web/_site/static/njs/all.njs; #js_path /opt/mirror-web/static/njs; #js_include /opt/mirror-web/static/njs/all.njs; server { listen 8007; server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; #root /opt/mirror-web/_site; fancyindex_header /fancy-index/before; fancyindex_footer /fancy-index/after; fancyindex_exact_size off; fancyindex_time_format \"%d %b %Y %H:%M:%S +0000\"; fancyindex_name_length 256; error_page 404 /404.html; location /fancy-index { internal; root /opt/mirror-web/_site; subrequest_output_buffer_size 100k; location = /fancy-index/before { js_content fancyIndexBeforeRender; } location = /fancy-index/after { js_content fancyIndexAfterRender; } } location / { root /opt/mirror-web/_site; index index.html index.htm; #try_files /_site/$uri $uri/ /_site/$uri; fancyindex on; } # location / { # root html; # index index.html index.htm; # } #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } } [root@serialt mirrors]# ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:4","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"5ã€é•œåƒèµ„æºæš´éœ² æ–¹æ³•1ï¼šä»¥è½¯é“¾æ¥å½¢å¼å­˜æ”¾åœ¨/opt/mirror-web/_siteä¸­ [root@serialt _site]# pwd /opt/mirror-web/_site [root@serialt _site]# ll æ€»ç”¨é‡ 160 -rw-r--r-- 1 root root 16415 10æœˆ 6 15:37 404.html drwxr-xr-x 2 root root 6 10æœˆ 6 17:14 cc drwxr-xr-x 2 root root 19 10æœˆ 6 17:14 centos drwxr-xr-x 2 root root 94 10æœˆ 6 09:25 fancy-index -rw-r--r-- 1 root root 36650 10æœˆ 6 15:37 feed.xml drwxr-xr-x 103 root root 4096 10æœˆ 6 09:25 help -rw-r--r-- 1 root root 27679 10æœˆ 6 15:37 index.html -rw-r--r-- 1 root root 20728 10æœˆ 6 15:37 legacy_index.html -rw-r--r-- 1 root root 18092 10æœˆ 6 15:37 LICENSE drwxr-xr-x 47 root root 4096 10æœˆ 6 09:25 news -rw-r--r-- 1 root root 58 10æœˆ 6 15:37 robots.txt -rw-r--r-- 1 root root 19134 10æœˆ 6 15:37 sitemap.xml drwxr-xr-x 8 root root 115 10æœˆ 6 15:37 static drwxr-xr-x 2 root root 24 10æœˆ 6 09:25 status æ–¹æ³•äºŒï¼šæŠŠ/opt/mirror-web/_siteé‡Œçš„æ–‡ä»¶ä»¥è½¯é“¾æ¥çš„æ–¹å¼é“¾æ¥åˆ°é•œåƒçš„è·Ÿç›®å½•ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰ ln -snf /opt/mirror-web/_site/* /opt/imau ç›®å½•æè¿°æ–‡ä»¶ï¼š_data/options.yml ç«™ç‚¹èµ„æºæ˜¾ç¤ºæ§åˆ¶ï¼šstatic/tunasync.json tunasync.json [ { \"name\": \"ant\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"book\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"centos\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"dev\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"frp\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"git\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"go\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"grafana\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"iso\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"jdk\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"jmeter\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"kubernetes\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"mac\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"monitor\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"node\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"root-ca\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"other\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"printer\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"prometheus\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"pycharm\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"python\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"repo\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"script\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"test\", \"is_master\": true, \"status\": \"success\" }, { \"name\": \"tool\", \"is_master\": true, \"status\": \"success\" } ] \"last_update\": \"2022-01-11 16:39:37 +0800\", \"last_update_ts\": 1641890377, \"last_started\": \"2022-01-11 16:39:21 +0800\", \"last_started_ts\": 1641890361, \"last_ended\": \"2022-01-11 16:39:37 +0800\", \"last_ended_ts\": 1641890377, \"next_schedule\": \"2022-01-11 22:39:37 +0800\", \"next_schedule_ts\": 1641911977, \"upstream\": \"rsync://msync.centos.org/CentOS/\", - status: 'success' last_update: '-' name: \"AUR\" url: 'https://aur.tuna.tsinghua.edu.cn/' upstream: 'https://aur.archlinux.org/' is_master: true options.yml # Content Related mirror_desc: - name: git desc: git äºŒè¿›åˆ¶ç¼–è¯‘ç‰ˆæœ¬ - name: go desc: golang å¼€å‘ç¯å¢ƒ - name: grafana desc: grafana çš„å®‰è£…åŒ… - name: helm desc: helm çš„äºŒè¿›åˆ¶å‘è¡ŒåŒ… - name: ios desc: é•œåƒæ–‡ä»¶ï¼Œå¦‚centos, ubuntu, rockyç­‰ - name: jdk desc: java å¼€å‘ç¯å¢ƒå®‰è£…åŒ… new_mirrors: - hugging-face-models - endeavouros - ubuntukylin - putty - postmarketOS - postmarketOS-images - obs-studio - stellarium unlisted_mirrors: - status: 'success' last_update: '-' name: \"AUR\" url: 'https://aur.tuna.tsinghua.edu.cn/' upstream: 'https://aur.archlinux.org/' is_master: true - link_to: 'osdn' name: \"manjaro-cd\" url: '/osdn/storage/g/m/ma/manjaro/' - link_to: 'osdn' name: \"manjaro-arm-cd\" url: '/osdn/storage/g/m/ma/manjaro-arm/' - link_to: 'osdn' name: \"mxlinux-isos\" url: '/osdn/storage/g/m/mx/mx-linux/ISOs/' - link_to: 'osdn' name: \"garuda-linux\" url: '/osdn/storage/g/g/ga/garuda-linux/' - link_to: 'osdn' name: \"linuxlite-cd\" url: '/osdn/storage/g/l/li/linuxlite/' - link_to: 'github-release' name: \"prometheus\" url: '/github-rele","date":"2023-09-24","objectID":"/posts/tuna-web/:1:5","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"6ã€dockeré•œåƒä½¿ç”¨ é™æ€æ–‡ä»¶ç¼–è¯‘ æ„å»º Jekyll çš„ docker é•œåƒç¯å¢ƒå¤æ‚ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨å®˜æ–¹æˆ–è€…å·²ç»å­˜åœ¨çš„é•œåƒtunathu/mirror-webæˆ–è€…serialt/tuna-mirror-web [root@tc ~]# docker run -it -v /path/to/mirror-web/:/data serialt/tuna-mirror-web ä¸€äº›åŠ¨æ€æ•°æ®å·²ç»ä¸‹è½½ï¼Œè‹¥éœ€è¦æœ€æ–°çš„ï¼Œå¯ä»¥å°±è¡Œä»¥ä¸‹æ“ä½œ,ç„¶ååœ¨æ„å»º ä¸‹è½½æœ€æ–°çš„åŠ¨æ€æ•°æ®æ–‡ä»¶ wget https://mirrors.tuna.tsinghua.edu.cn/static/tunasync.json -O static/tunasync.json wget https://mirrors.tuna.tsinghua.edu.cn/static/tunet.json -O static/tunet.json mkdir -p static/status wget https://mirrors.tuna.tsinghua.edu.cn/static/status/isoinfo.json -O static/status/isoinfo.json è¿è¡ŒæœåŠ¡ dockeré•œåƒç½‘é¡µæ ¹ç›®å½•: /opt/mirror-web é•œåƒç«™èµ„æºæ ¹ç›®å½•: /opt/mirror å¯åŠ¨æœåŠ¡ docker run -tid -v /opt/tuna-mirror-web/_site:/opt/mirror-web -v /opt/mirror:/opt/mirror -p 8099:80 --name=tuna-mirror-nginx serialt/tuna-mirror-web-nginx:7b0c89d version: \"3\" networks: tuna-mirror-nginx: external: false services: tuna-mirror-nginx: image: serialt/tuna-mirror-web-nginx:latest container_name: mirror-nginx hostname: mirror-nginx restart: always networks: - tuna-mirror-nginx volumes: - \"/etc/localtime:/etc/localtime:ro\" - \"/opt/mirror-web/_site:/opt/mirror-web\" - \"/opt/mirror:/opt/mirror\" ports: - \"80:80\" dns: - 223.5.5.5 - 223.6.6.6 ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:6","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"æ–°é•œåƒç«™ç‰ˆæœ¬å‘å¸ƒ docker run -it --rm -v /opt/tuna-mirror-web:/data serialt/tuna-mirror-web docker restart tuna-mirror-nginx ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:7","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"ç¼–å†™è¯´æ˜ _data/options.yml: æ˜¯æ˜¾ç¤ºåœ¨é•œåƒç«™ä¸»é¡µå¯¹å„ä¸ªç›®å½•çš„è¯´æ˜ static/tunasync.json: æ˜¯å¯¹å½“å‰repoçš„åŒæ­¥ä¿¡æ¯çš„æè¿°ï¼Œå¯ä»¥è‡ªè¡Œç¼–è¾‘ï¼Œä¹Ÿå¯ä»¥ä»tunaä¸Šä¸‹è½½ help: helpç›®å½•é‡Œå­˜æœ‰å„ä¸ªrepoçš„å¸®åŠ©ä¿¡æ¯ï¼Œåœ¨ä¸»é¡µä¸Šä¼šæ˜¾ç¤ºæœ‰ä¸ª\"?\" news: é•œåƒç«™çš„æ–°é—»ä¿¡æ¯ ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:8","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["mirror-web"],"content":"help è¯´æ˜ permalink æ˜¯è¡¨ç¤ºhelpçš„é¦–é¡µçš„è·¯å¾„ï¼Œå¿…é¡»è¦æœ‰ --- layout: help category: help mirrorid: app permalink: /help/app/ --- ","date":"2023-09-24","objectID":"/posts/tuna-web/:1:9","tags":["mirrors"],"title":"Tuna Web","uri":"/posts/tuna-web/"},{"categories":["Kubernetes"],"content":"helm oci ","date":"2023-09-24","objectID":"/posts/helm-migrate-oci/:1:0","tags":["helm"],"title":"Helm Migrate OCI","uri":"/posts/helm-migrate-oci/"},{"categories":["Kubernetes"],"content":"ç¼˜ç”± Helm 3.8 ç‰ˆæœ¬å¼€å§‹ï¼Œæ”¯æŒä½¿ç”¨ociè¿›è¡Œå­˜å‚¨chartã€‚é•œåƒå­˜å‚¨å¸¸ç”¨çš„Harboråœ¨v1.6ç‰ˆæœ¬å¼€å§‹æ”¯æŒHelm Chartä»“åº“åŠŸèƒ½ï¼Œ chartä»“åº“ç”±chartmuseumä»¥æ’ä»¶çš„æ–¹å¼æä¾›ã€‚éšç€å…¼å®¹OCIè§„èŒƒçš„Helm Chartåœ¨ç¤¾åŒºä¸Šè¢«æ›´å¹¿æ³›åœ°æ¥å—ï¼ŒHelm Chartèƒ½ä»¥Artifactçš„å½¢å¼åœ¨Harborä¸­å­˜å‚¨å’Œç®¡ç†ï¼Œä¸å†ä¾èµ–ChartMuseumï¼Œå› æ­¤Harboråœ¨v2.8.0ç‰ˆæœ¬ä¸­ï¼Œç§»é™¤å¯¹ChartMuseumçš„æ”¯æŒã€‚ ","date":"2023-09-24","objectID":"/posts/helm-migrate-oci/:1:1","tags":["helm"],"title":"Helm Migrate OCI","uri":"/posts/helm-migrate-oci/"},{"categories":["Kubernetes"],"content":"registry ä»“åº“ä½¿ç”¨ åŸºæœ¬ä½¿ç”¨ ### registry # ç™»å½• helm registry login -u serialt docker.io # æ³¨é”€ helm registry logout docker.io # pull chart helm fetch oci://docker.io/serialt/loki-stack --version=2.9.11 # push chart helm push loki-stack-2.9.11.tgz oci://docker.io/serialt ociæ”¯æŒçš„å…¶ä»–å‘½ä»¤ helm pull helm show helm template helm install helm upgrade $ helm pull oci://localhost:5000/helm-charts/mychart --version 0.1.0 Pulled: localhost:5000/helm-charts/mychart:0.1.0 Digest: sha256:0be7ec9fb7b962b46d81e4bb74fdcdb7089d965d3baca9f85d64948b05b402ff $ helm show all oci://localhost:5000/helm-charts/mychart --version 0.1.0 apiVersion: v2 appVersion: 1.16.0 description: A Helm chart for Kubernetes name: mychart ... $ helm template myrelease oci://localhost:5000/helm-charts/mychart --version 0.1.0 --- # Source: mychart/templates/serviceaccount.yaml apiVersion: v1 kind: ServiceAccount ... $ helm install myrelease oci://localhost:5000/helm-charts/mychart --version 0.1.0 NAME: myrelease LAST DEPLOYED: Wed Oct 27 15:11:40 2021 NAMESPACE: default STATUS: deployed REVISION: 1 NOTES: ... $ helm upgrade myrelease oci://localhost:5000/helm-charts/mychart --version 0.2.0 Release \"myrelease\" has been upgraded. Happy Helming! NAME: myrelease LAST DEPLOYED: Wed Oct 27 15:12:05 2021 NAMESPACE: default STATUS: deployed REVISION: 2 NOTES: ... ","date":"2023-09-24","objectID":"/posts/helm-migrate-oci/:1:2","tags":["helm"],"title":"Helm Migrate OCI","uri":"/posts/helm-migrate-oci/"},{"categories":["Kubernetes"],"content":"è¿ç§» chart repo åˆ° oci ä»“åº“ åŸºäº github action é•œåƒ helm repo ä»“åº“åˆ° docker hubï¼Œä»¥åŠ é€Ÿ helm repo åˆ°è®¿é—®ã€‚ migrate-chart ","date":"2023-09-24","objectID":"/posts/helm-migrate-oci/:1:3","tags":["helm"],"title":"Helm Migrate OCI","uri":"/posts/helm-migrate-oci/"}]